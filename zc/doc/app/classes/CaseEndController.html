<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseEndController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseEndController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/case_end_controller_rb.html">
                app/controllers/case_end_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000670">final_do</a>&nbsp;&nbsp;
      <a href="#M000669">list</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000670" class="method-detail">
        <a name="M000670"></a>

        <div class="method-heading">
          <a href="#M000670" class="method-signature">
          <span class="method-name">final_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000670-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000670-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_end_controller.rb, line 407</span>
407:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">final_do</span>
408:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0007'</span>)
409:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])
410:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0007'</span>)
411:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
412:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
413:       <span class="ruby-keyword kw">end</span>
414:       <span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
415:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_date</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:dat</span>]
416:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
417:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
418: 
419:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
420:         <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]=<span class="ruby-keyword kw">nil</span>
421:         <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]=<span class="ruby-keyword kw">nil</span>
422:         <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]=<span class="ruby-keyword kw">nil</span>
423:         <span class="ruby-identifier">a_p</span>=<span class="ruby-value str">&quot;final_tex&quot;</span>
424:       <span class="ruby-keyword kw">else</span>
425:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;终审操作失败！&quot;</span>
426:         <span class="ruby-identifier">a_p</span>=<span class="ruby-value str">&quot;list&quot;</span>
427:       <span class="ruby-keyword kw">end</span>
428:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">a_p</span>,<span class="ruby-identifier">:r_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">recevice_code</span>
429:     <span class="ruby-keyword kw">else</span>
430:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
431:     <span class="ruby-keyword kw">end</span>
432:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000669" class="method-detail">
        <a name="M000669"></a>

        <div class="method-heading">
          <a href="#M000669" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
检查条件：无立案号、无办案助理、无受理日期不能终审、有欠费不能终审，简易程序无仲裁员不能终审、
普通程序没有三个仲裁员不能终审，无结案号、结案方式、结案日期、无裁决书不能终审，
撤案结案方式的，如果无仲裁员,可以终审
关于日期：立案&lt;=组庭&lt;=开庭&lt;=结案
终审检查的时候，对有开庭时间，没有该开庭日期对应的庭审笔录的应卡住
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000669-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000669-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_end_controller.rb, line 7</span>
  7:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
  8:     <span class="ruby-identifier">r0</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#受理日期</span>
  9:     <span class="ruby-identifier">r3</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#仲裁员</span>
 10:     <span class="ruby-identifier">r1</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#结案信息</span>
 11:     <span class="ruby-identifier">r2</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#交费情况</span>
 12:     <span class="ruby-identifier">r4</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#立案日期不能大于组庭日期</span>
 13:     <span class="ruby-identifier">r5</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#组庭日期不能大于开庭日期</span>
 14:     <span class="ruby-identifier">r6</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#开庭日期不能大于结案日期</span>
 15:     <span class="ruby-identifier">r7</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#代理人所在单位不能为空</span>
 16:     <span class="ruby-identifier">r8</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#庭审笔录</span>
 17:     <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;&quot;</span>  <span class="ruby-comment cmt">#仲裁员评分</span>
 18:     <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#某些情况下必须有组庭信息</span>
 19:     <span class="ruby-comment cmt">#r10=&quot;&quot; 对应收款记录</span>
 20:     <span class="ruby-identifier">r11</span>=<span class="ruby-value str">&quot;&quot;</span>  <span class="ruby-comment cmt">#检查校核信息，若没填写不让终审</span>
 21:     <span class="ruby-identifier">r12</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未拆净的金额或者存在尚未对应的明细,要检测不通过</span>
 22:     <span class="ruby-identifier">r13</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未对应的明细，进行检测</span>
 23:     <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#案件合同没有上传</span>
 24:     <span class="ruby-identifier">r15</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#必须有新工时汇总信息，否则不能终审。</span>
 25:     <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 如果有管辖权异议，那么必须上传管辖权决定，否则不能终审。</span>
 26:     <span class="ruby-identifier">r17</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#有仲裁员的案件必须处长把报酬信息提交到财务</span>
 27:     <span class="ruby-identifier">r18</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#仲裁员提交裁决时间稿时间是否填写</span>
 28:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 29:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span>
 30:       <span class="ruby-comment cmt">#当前案件</span>
 31:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])
 32:       <span class="ruby-comment cmt">#立案日期或不受理日期</span>
 33:       <span class="ruby-ivar">@nowdate</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate</span>
 34:       <span class="ruby-comment cmt">#组庭信息</span>
 35:       <span class="ruby-ivar">@caseorg</span> = <span class="ruby-constant">TbCaseorg</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
 36:       <span class="ruby-comment cmt">#开庭信息</span>
 37:       <span class="ruby-ivar">@sitting</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
 38:       <span class="ruby-comment cmt">#结案信息</span>
 39:       <span class="ruby-ivar">@caseendbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
 40: 
 41:       <span class="ruby-comment cmt">#判断是否有受理日期</span>
 42:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">accepttime</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 43:         <span class="ruby-identifier">r0</span> = <span class="ruby-value str">&quot;无受理日期；&quot;</span>
 44:       <span class="ruby-keyword kw">end</span>
 45: 
 46:       <span class="ruby-comment cmt">#判断案件合同是否上传</span>
 47:       <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and typ='0005' and used='Y'&quot;</span>)
 48: 
 49:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">empty?</span>
 50:         <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;案件合同未上传；&quot;</span>
 51:       <span class="ruby-keyword kw">else</span>
 52:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">file</span>
 53:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span>
 54:             <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;案件合同未上传；&quot;</span>
 55:           <span class="ruby-keyword kw">end</span>
 56:         <span class="ruby-keyword kw">end</span>
 57:       <span class="ruby-keyword kw">end</span>
 58: 
 59:       <span class="ruby-comment cmt"># 判断是否有管辖权异议，有的话必须上传管辖权决定，否则不能终审。</span>
 60:       <span class="ruby-identifier">jurisdiction</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
 61:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">j</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">jurisdiction</span>
 62:         <span class="ruby-identifier">jfile</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and typ='0006' and used='Y' and p_id='#{j.id}'&quot;</span>)
 63:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">jfile</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment cmt"># 没有记录</span>
 64:           <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;管辖权决定未上传；&quot;</span>
 65:         <span class="ruby-keyword kw">else</span>
 66:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">jf</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">jfile</span>
 67:               <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;管辖权决定未上传；&quot;</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">jf</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-comment cmt"># 有记录记录，但是文件没有上传。</span>
 68:           <span class="ruby-keyword kw">end</span>
 69:         <span class="ruby-keyword kw">end</span>
 70:       <span class="ruby-keyword kw">end</span>
 71: 
 72: 
 73:       <span class="ruby-comment cmt">#判断组庭信息是否正确，包括以下项目：</span>
 74:       <span class="ruby-comment cmt">#  1 立案日期 &lt;= 组庭日期 &lt;= 开庭日期 &lt;= 结案日期；</span>
 75:       <span class="ruby-comment cmt">#  2 存在，并且已经上传庭审笔录；</span>
 76:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 77:         <span class="ruby-ivar">@orgdate</span> = <span class="ruby-ivar">@caseorg</span>.<span class="ruby-identifier">orgdate</span> <span class="ruby-comment cmt">#组庭日期</span>
 78:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@nowdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@orgdate</span>
 79:           <span class="ruby-identifier">r4</span> = <span class="ruby-value str">&quot;立案日期不能大于组庭日期；&quot;</span>
 80:         <span class="ruby-keyword kw">end</span>
 81:         <span class="ruby-comment cmt">#庭审笔录.如果是多次开庭，验证最后一次庭审笔录</span>
 82:         <span class="ruby-ivar">@casebook</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code = ? and typ = '0001' and book_name&lt;&gt;'' and p_id=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>])
 83:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 84:           <span class="ruby-ivar">@sittingdate</span> = <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingdate</span>
 85:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@orgdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@casebook</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 86:             <span class="ruby-identifier">r5</span> = <span class="ruby-value str">&quot;组庭日期不能大于开庭日期；无庭审笔录；&quot;</span>
 87:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@orgdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@casebook</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
 88:             <span class="ruby-identifier">r5</span> = <span class="ruby-value str">&quot;组庭日期不能大于开庭日期；&quot;</span>
 89:           <span class="ruby-keyword kw">end</span>
 90: 
 91:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseendbook</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 92:             <span class="ruby-ivar">@decideDate</span> = <span class="ruby-ivar">@caseendbook</span>.<span class="ruby-identifier">decideDate</span>
 93:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@decideDate</span>
 94:               <span class="ruby-identifier">r6</span> = <span class="ruby-value str">&quot;开庭日期不能大于结案日期；&quot;</span>
 95:             <span class="ruby-keyword kw">end</span>
 96:           <span class="ruby-keyword kw">end</span>
 97:           <span class="ruby-comment cmt">#庭审笔录</span>
 98:           <span class="ruby-identifier">p_id</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and sittingdate=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@sittingdate</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>).<span class="ruby-identifier">id</span>
 99:           <span class="ruby-ivar">@doc</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and p_id=? and typ='0001' and book_name&lt;&gt;''&quot;</span>,<span class="ruby-identifier">p_id</span>])
100:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@doc</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
101:             <span class="ruby-identifier">r8</span>=<span class="ruby-value str">&quot;未上传庭审笔录；&quot;</span>
102:           <span class="ruby-keyword kw">end</span>
103:         <span class="ruby-keyword kw">end</span>
104:       <span class="ruby-keyword kw">end</span>
105: 
106:       <span class="ruby-comment cmt">#撤案类型案件可以没有仲裁员</span>
107:       <span class="ruby-comment cmt">#仲裁员类型 TbEvaluate（仲裁员评价表）</span>
108:       <span class="ruby-comment cmt">#arbitman_type  001 独任； 002 首席； 003 申请方； 004 被申请方；</span>
109:       <span class="ruby-identifier">tb_ev1</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0001'</span>])
110:       <span class="ruby-identifier">tb_ev2</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0002'</span>])
111:       <span class="ruby-identifier">tb_ev3</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0003'</span>])
112:       <span class="ruby-identifier">tb_ev4</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0004'</span>])
113: 
114:       <span class="ruby-ivar">@ar0</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0001'</span>)
115:       <span class="ruby-ivar">@ar1</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0002'</span>)
116:       <span class="ruby-ivar">@ar2</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0003'</span>)
117:       <span class="ruby-ivar">@ar3</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0004'</span>)
118:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseendbook</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#没有结案信息</span>
119:         <span class="ruby-identifier">r1</span> = <span class="ruby-value str">&quot;没有结案信息；&quot;</span>
120:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>
121:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任</span>
122:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
123:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
124:             <span class="ruby-keyword kw">else</span>
125:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
126:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
127:               <span class="ruby-keyword kw">end</span>
128:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
129:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
130:               <span class="ruby-keyword kw">end</span>
131:             <span class="ruby-keyword kw">end</span>
132:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 简易程序约定三人仲裁庭</span>
133:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
134:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
135:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
136:               <span class="ruby-keyword kw">end</span>
137:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
138:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
139:               <span class="ruby-keyword kw">end</span>
140:             <span class="ruby-keyword kw">else</span>
141:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
142:             <span class="ruby-keyword kw">end</span>
143:           <span class="ruby-keyword kw">end</span>
144:         <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
145:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
146:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
147:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
148:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
149:               <span class="ruby-keyword kw">end</span>
150:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
151:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
152:               <span class="ruby-keyword kw">end</span>
153:             <span class="ruby-keyword kw">else</span>
154:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
155:             <span class="ruby-keyword kw">end</span>
156:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#普通程序约定独任仲裁庭</span>
157:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
158:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
159:             <span class="ruby-keyword kw">else</span>
160:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
161:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
162:               <span class="ruby-keyword kw">end</span>
163:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
164:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
165:               <span class="ruby-keyword kw">end</span>
166:             <span class="ruby-keyword kw">end</span>
167:           <span class="ruby-keyword kw">end</span>
168:         <span class="ruby-keyword kw">end</span>
169:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#有结案信息</span>
170:         <span class="ruby-ivar">@sty</span> = <span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]]).<span class="ruby-identifier">endStyle</span>
171:         <span class="ruby-ivar">@book_name1</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and book_name!='' and book_typ=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@sty</span>])
172:         <span class="ruby-ivar">@book_name</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-ivar">@book_name1</span>)
173:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book_name</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
174:           <span class="ruby-identifier">r1</span> = <span class="ruby-value str">&quot;没有裁决书；&quot;</span>
175:         <span class="ruby-keyword kw">end</span>
176:         <span class="ruby-ivar">@endStyle</span> = <span class="ruby-ivar">@caseendbook</span>.<span class="ruby-identifier">endStyle</span>
177:         <span class="ruby-comment cmt">#撤案结案类型的终审可以没有组庭 ; 撤案案件检查时，有仲裁员的，才检查有无评价；无仲裁员的，不检查评价</span>
178:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@endStyle!</span>=<span class="ruby-value str">'0003'</span>
179:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>
180:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任</span>
181:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
182:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
183:               <span class="ruby-keyword kw">else</span>
184:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
185:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
186:                 <span class="ruby-keyword kw">end</span>
187:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
188:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
189:                 <span class="ruby-keyword kw">end</span>
190:               <span class="ruby-keyword kw">end</span>
191:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#  简易程序约定三人仲裁庭</span>
192:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
193:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
194:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
195:                 <span class="ruby-keyword kw">end</span>
196:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
197:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
198:                 <span class="ruby-keyword kw">end</span>
199:               <span class="ruby-keyword kw">else</span>
200:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
201:               <span class="ruby-keyword kw">end</span>
202:             <span class="ruby-keyword kw">end</span>
203:           <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
204:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
205:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
206:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
207:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
208:                 <span class="ruby-keyword kw">end</span>
209:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
210:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
211:                 <span class="ruby-keyword kw">end</span>
212:               <span class="ruby-keyword kw">else</span>
213:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
214:               <span class="ruby-keyword kw">end</span>
215:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 普通程序约定独任仲裁庭</span>
216:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
217:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
218:               <span class="ruby-keyword kw">else</span>
219:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
220:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
221:                 <span class="ruby-keyword kw">end</span>
222:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
223:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
224:                 <span class="ruby-keyword kw">end</span>
225:               <span class="ruby-keyword kw">end</span>
226:             <span class="ruby-keyword kw">end</span>
227:           <span class="ruby-keyword kw">end</span>
228: 
229:           <span class="ruby-comment cmt"># 检查是否录入了新工时汇总信息</span>
230:           <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{@case.recevice_code}' and used='Y'&quot;</span>
231:           <span class="ruby-ivar">@remun1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
232:           <span class="ruby-ivar">@remun2</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
233: 
234:           <span class="ruby-identifier">r15</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;没有录入工时汇总内的裁决书制作信息；&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun1</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
235:           <span class="ruby-identifier">r15</span> <span class="ruby-operator">+=</span> <span class="ruby-value str">&quot;没有录入绩效评价信息；&quot;</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@caseendbook</span>.<span class="ruby-identifier">decideDate</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>) <span class="ruby-operator">&lt;</span> <span class="ruby-value str">&quot;2013-03-01&quot;</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@remun2</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
236: 
237:         <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#撤案 ##############################3</span>
238:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>
239:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任</span>
240:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-value str">&quot;&quot;</span>
241:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
242:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
243:                 <span class="ruby-keyword kw">end</span>
244:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
245:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
246:                 <span class="ruby-keyword kw">end</span>
247:               <span class="ruby-keyword kw">end</span>
248:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#简易程序约定三人仲裁庭</span>
249:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
250:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
251:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
252:                 <span class="ruby-keyword kw">end</span>
253:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
254:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
255:                 <span class="ruby-keyword kw">end</span>
256:               <span class="ruby-keyword kw">end</span>
257:             <span class="ruby-keyword kw">end</span>
258:           <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
259:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
260:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
261:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
262:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
263:                 <span class="ruby-keyword kw">end</span>
264:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
265:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
266:                 <span class="ruby-keyword kw">end</span>
267:               <span class="ruby-keyword kw">end</span>
268:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 普通程序约定独任仲裁庭</span>
269:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0!</span>=<span class="ruby-value str">&quot;&quot;</span>
270:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
271:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
272:                 <span class="ruby-keyword kw">end</span>
273:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
274:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
275:                 <span class="ruby-keyword kw">end</span>
276:               <span class="ruby-keyword kw">end</span>
277:             <span class="ruby-keyword kw">end</span>
278:           <span class="ruby-keyword kw">end</span>
279:         <span class="ruby-keyword kw">end</span>
280:       <span class="ruby-keyword kw">end</span>
281:       <span class="ruby-comment cmt">#无论结案（不管撤案、还是其他结案方式）、未结：有仲裁员则—评价、组庭信息。</span>
282: 
283:       <span class="ruby-comment cmt">#有无收款记录</span>
284:       <span class="ruby-ivar">@ccc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code]}'&quot;</span>)
285:       <span class="ruby-comment cmt">#应收仲裁费用的和，即应交</span>
286:       <span class="ruby-identifier">s1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
287:       <span class="ruby-comment cmt">#减交仲裁费用的和</span>
288:       <span class="ruby-identifier">s2</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
289:       <span class="ruby-comment cmt">#已收仲裁费用的和，即实交</span>
290:       <span class="ruby-identifier">s3</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
291: 
292:       
293:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ccc</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ccc</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
294:         <span class="ruby-identifier">r2</span> = <span class="ruby-value str">&quot;没有交费记录；&quot;</span>
295:       <span class="ruby-keyword kw">else</span>
296:         <span class="ruby-identifier">s</span>=<span class="ruby-identifier">s1</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s2</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s3</span>.<span class="ruby-identifier">to_f</span>
297:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">abs</span> <span class="ruby-operator">&gt;=</span><span class="ruby-value">0</span><span class="ruby-value">.01</span>
298:           <span class="ruby-identifier">r2</span>=<span class="ruby-value str">&quot;有欠缴费用未交；&quot;</span> 
299:         <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#费用对应明细</span>
300:           <span class="ruby-identifier">s4</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and re_rmb_money=0 and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
301: <span class="ruby-comment cmt">#          tb_should_refund = TbShouldRefund.find_by_sql(&quot;&quot;)</span>
302:           <span class="ruby-comment cmt">#应退 - 减退 如果&gt;0,提醒有退费，不进行；如果没，</span>
303: <span class="ruby-comment cmt">#            if</span>
304: <span class="ruby-comment cmt">#            r14 = &quot;存在未对应的费用明细【收费明细对应中存在为0】的检测；反之进行检测&quot;</span>
305: <span class="ruby-comment cmt">#            end</span>
306:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">s4</span>.<span class="ruby-identifier">empty?</span>)
307:             <span class="ruby-identifier">r2</span> = <span class="ruby-value str">&quot;案件收费明细对应中存在为0的记录；&quot;</span>
308:           <span class="ruby-keyword kw">end</span>
309:           <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未拆净的金额或者存在尚未对应的明细，进行检测</span>
310: <span class="ruby-comment cmt">#          s4 = TbShouldCharge.find(:first,:select=&gt;&quot;sum(rmb_money - re_rmb_money) as ss&quot;,:conditions=&gt;[&quot;used='Y' and recevice_code=? and (typ='0007' or typ='0008')&quot;,session[:recevice_code]]) #未对应的明细费用</span>
311:           <span class="ruby-identifier">s5</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y' and typ='b'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]]) <span class="ruby-comment cmt">#被拆分的原始收款总记录</span>
312:           <span class="ruby-identifier">s6</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y' and typ='c'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]]) <span class="ruby-comment cmt">#拆分后的收款记录</span>
313:           <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s5</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s6</span>.<span class="ruby-identifier">to_i</span>
314:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
315:             <span class="ruby-identifier">r12</span> = <span class="ruby-value str">&quot;存在尚未拆净的收款费用；&quot;</span>
316:           <span class="ruby-keyword kw">end</span>
317:           <span class="ruby-identifier">s4</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and should_id=0 and state=2 and (typ='a' or typ='c') and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
318:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s4</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
319:             <span class="ruby-identifier">r13</span> = <span class="ruby-value str">&quot;存在未对应的费用明细；&quot;</span>
320:           <span class="ruby-keyword kw">end</span>
321: <span class="ruby-comment cmt">#          if s4!=nil &amp;&amp; s4.ss.to_i&gt;0</span>
322: <span class="ruby-comment cmt">#            r13 = &quot;存在未对应的费用明细；&quot;</span>
323: <span class="ruby-comment cmt">#          end</span>
324:         <span class="ruby-keyword kw">end</span>
325:       <span class="ruby-keyword kw">end</span>
326:       <span class="ruby-ivar">@award</span>=<span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
327:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
328:         <span class="ruby-identifier">r11</span>=<span class="ruby-value str">&quot;请填写裁决书报校核信息；&quot;</span>
329:       <span class="ruby-keyword kw">end</span>
330:       <span class="ruby-comment cmt">#收款记录对应</span>
331:       <span class="ruby-ivar">@homologous</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='a' or typ='c') and should_id=0&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
332:       <span class="ruby-comment cmt">#代理人所在单位</span>
333:       <span class="ruby-identifier">agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and company=''&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
334:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
335:         <span class="ruby-identifier">r7</span>=<span class="ruby-value str">&quot;代理人所在单位不能为空；&quot;</span>
336:       <span class="ruby-keyword kw">end</span>
337: 
338:       <span class="ruby-identifier">r17</span> = <span class="ruby-value str">&quot;存在仲裁员无报酬记录；&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and used='Y'&quot;</span>)<span class="ruby-operator">&gt;</span><span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;N&quot;</span>
339: 
340:       <span class="ruby-identifier">r18</span>=<span class="ruby-value str">&quot;&quot;</span>
341:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and used='Y' and end_typ&lt;&gt;'0004' and arbitman_submit_t is null&quot;</span>)
342:         <span class="ruby-identifier">r18</span>=<span class="ruby-value str">&quot;仲裁员提交裁决稿时间未填写&quot;</span>
343:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and used='Y' and end_typ&lt;&gt;'0004' and award_submit_t is null&quot;</span>)
344:         <span class="ruby-identifier">r18</span>=<span class="ruby-value str">&quot;裁决书报校核时间未填写&quot;</span>
345:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and used='Y' and end_typ&lt;&gt;'0004' and award_return_t is null&quot;</span>)
346:         <span class="ruby-identifier">r18</span>=<span class="ruby-value str">&quot;裁决书报校核返回时间未填写&quot;</span>
347:       <span class="ruby-keyword kw">end</span>
348:       
349:       <span class="ruby-ivar">@r_mes</span> = <span class="ruby-identifier">r0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r14</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r3</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r10</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r5</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r6</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r7</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r8</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r9</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r11</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r12</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r13</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r15</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r16</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r17</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r18</span>
350: 
351: 
352: 
353:       <span class="ruby-comment cmt"># -----------------------------以下各项检查仅作为提示，如果检查不通过也可以终审--------------------------------------</span>
354: 
355:       <span class="ruby-comment cmt">#仲裁员实际开支费用 :当事人预缴仲裁员开支费用 - (助理录入)仲裁员实际开支、抹零数据</span>
356:       <span class="ruby-identifier">m_1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
357:       <span class="ruby-ivar">@shoud1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
358:       <span class="ruby-ivar">@should2</span>= <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
359:       <span class="ruby-comment cmt">#出纳录入的仲裁员开支费用</span>
360:       <span class="ruby-comment cmt">#      @arbitspend=TbArbitmanSpend.sum(:rmb_money,:conditions=&gt;[&quot;used='Y' and recevice_code=?&quot;,session[:recevice_code]])</span>
361:       <span class="ruby-comment cmt">#助理录入的仲裁庭支出费用</span>
362:       <span class="ruby-comment cmt">#      @sroom = TbArbitcourtSpend.sum(:rmb_money,:conditions=&gt;[&quot;used='Y' and recevice_code=?&quot;,session[:recevice_code]])</span>
363:       <span class="ruby-ivar">@aribitprog_num</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span>
364:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0005'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0007'</span>
365:         <span class="ruby-identifier">as11</span>=<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_typ&lt;&gt;'0001'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
366:         <span class="ruby-identifier">as44</span>=<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
367:         <span class="ruby-identifier">as</span>=<span class="ruby-identifier">as11</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">as44</span>.<span class="ruby-identifier">to_i</span>
368:       <span class="ruby-keyword kw">else</span>
369:         <span class="ruby-identifier">as11</span>=<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_typ='0001'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
370:         <span class="ruby-identifier">as44</span>=<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
371:         <span class="ruby-identifier">as</span>=<span class="ruby-identifier">as11</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">as44</span>.<span class="ruby-identifier">to_i</span>
372:       <span class="ruby-keyword kw">end</span>
373:       <span class="ruby-identifier">fe1</span> = <span class="ruby-ivar">@shoud1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">as</span>
374: 
375:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fe1!</span>=<span class="ruby-value">0</span>
376:         <span class="ruby-identifier">s1</span>=<span class="ruby-value str">&quot;仲裁员实际费用平衡表 结余不为0；&quot;</span>
377:       <span class="ruby-keyword kw">else</span>
378:         <span class="ruby-identifier">s1</span>=<span class="ruby-value str">&quot;&quot;</span>
379:       <span class="ruby-keyword kw">end</span>
380:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m_1</span>.<span class="ruby-identifier">to_i!</span>=<span class="ruby-value">0</span>
381:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@shoud1</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
382:           <span class="ruby-identifier">s2</span> = <span class="ruby-value str">&quot;仲裁员实际开支费用没有交纳；&quot;</span>
383:         <span class="ruby-keyword kw">else</span>
384:           <span class="ruby-identifier">s2</span>=<span class="ruby-value str">&quot;&quot;</span>
385:         <span class="ruby-keyword kw">end</span>
386:       <span class="ruby-keyword kw">else</span>
387:         <span class="ruby-identifier">s2</span>=<span class="ruby-value str">&quot;&quot;</span>
388:       <span class="ruby-keyword kw">end</span>
389:       <span class="ruby-comment cmt">#当事人地区，如果存在“中国内地”输入项目，提示，不作为终审卡住条件</span>
390:       <span class="ruby-identifier">tb_party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and area='001'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
391:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_party</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
392:         <span class="ruby-identifier">s3</span>=<span class="ruby-value str">&quot;当事人地区为中国内地，请明确其所在省份；&quot;</span>
393:       <span class="ruby-keyword kw">else</span>
394:         <span class="ruby-identifier">s3</span>=<span class="ruby-value str">&quot;&quot;</span>
395:       <span class="ruby-keyword kw">end</span>
396: 
397:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0009'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]]) <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
398:         <span class="ruby-identifier">s4</span>=<span class="ruby-value str">&quot;请注意，有当事人多交仲裁费；&quot;</span>
399:       <span class="ruby-keyword kw">else</span>
400:         <span class="ruby-identifier">s4</span>=<span class="ruby-value str">&quot;&quot;</span>
401:       <span class="ruby-keyword kw">end</span>
402: 
403:       <span class="ruby-ivar">@m_fee</span>=<span class="ruby-identifier">s1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s3</span>  <span class="ruby-operator">+</span> <span class="ruby-identifier">s4</span>
404:     <span class="ruby-keyword kw">end</span>
405:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>