<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ReportTotal3Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ReportTotal3Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/report_total3_controller_rb.html">
                app/controllers/report_total3_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001929">bom</a>&nbsp;&nbsp;
      <a href="#M001931">bom_2</a>&nbsp;&nbsp;
      <a href="#M001928">list</a>&nbsp;&nbsp;
      <a href="#M001930">list4</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001929" class="method-detail">
        <a name="M001929"></a>

        <div class="method-heading">
          <a href="#M001929" class="method-signature">
          <span class="method-name">bom</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
明细表信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001929-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001929-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/report_total3_controller.rb, line 277</span>
277:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bom</span>
278:   
279:         <span class="ruby-ivar">@dispute2</span>={<span class="ruby-value str">&quot;001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;全部&quot;</span>,<span class="ruby-value str">&quot;01&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;是&quot;</span>,<span class="ruby-value str">&quot;02&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;否&quot;</span>}  <span class="ruby-comment cmt">#结案方式</span>
280:     <span class="ruby-ivar">@endcase</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:endcase</span>]
281:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
282:       <span class="ruby-ivar">@endcase</span>=<span class="ruby-value str">&quot;001&quot;</span>
283:     <span class="ruby-keyword kw">end</span>
284:         
285:             <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot;&quot;</span>
286:         <span class="ruby-keyword kw">if</span>  <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-value str">'01'</span>
287:           <span class="ruby-comment cmt">#结案</span>
288:           <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot; and caseendbook_id_first is not null &quot;</span>
289:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-value str">'02'</span>
290:           <span class="ruby-comment cmt">#未结案</span>
291:           <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot; and caseendbook_id_first is  null  &quot;</span>
292:         <span class="ruby-keyword kw">end</span>
293: 
294:     <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
295:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;used='Y' and  state&gt;=4 and nowdate&gt;=? and nowdate&lt;=? and agent=?&quot;</span><span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d1</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d2</span>], <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>]],
296:       <span class="ruby-identifier">:order</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;right(case_code,7) desc&quot;</span>
297:     )
298:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001931" class="method-detail">
        <a name="M001931"></a>

        <div class="method-heading">
          <a href="#M001931" class="method-signature">
          <span class="method-name">bom_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001931-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001931-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/report_total3_controller.rb, line 528</span>
528:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">bom_2</span>
529:     <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(
530:       <span class="ruby-identifier">:all</span>,
531:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;used='Y' and  state&gt;=4 and nowdate&gt;=? and nowdate&lt;=? and agent=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d2</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>]],
532:       <span class="ruby-identifier">:order</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;right(case_code,7)&quot;</span>
533:     )
534:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001928" class="method-detail">
        <a name="M001928"></a>

        <div class="method-heading">
          <a href="#M001928" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
受理案件仲裁条款及争议金额分析
按照设定的时间区间和仲裁机构： 1
分别统计本请求或者反请求的一下数据以及合计
</p>
<pre>
   明确争议金额收费、不明确争议金额收费、无明确争议金额收费、实收
</pre>
<p>
2 按照金额区间统计案件数量
</p>
<pre>
   百万以下  1百万至5百万  5百万至1千万  1千万至5千万  5千万至1亿  1亿以上
</pre>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001928-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001928-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/report_total3_controller.rb, line 9</span>
  9:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 10:     
 11:     <span class="ruby-ivar">@order</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">&quot;typ&quot;</span>
 12:     <span class="ruby-ivar">@page_lines</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>] <span class="ruby-operator">||</span> <span class="ruby-value">2000000</span>
 13: 
 14:     <span class="ruby-ivar">@d1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d1</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">at_beginning_of_year</span>.<span class="ruby-identifier">to_date</span>
 15:     <span class="ruby-ivar">@d2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d2</span>] <span class="ruby-operator">||</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_date</span>
 16: 
 17:                 <span class="ruby-ivar">@dispute2</span>={<span class="ruby-value str">&quot;001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;全部&quot;</span>,<span class="ruby-value str">&quot;01&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;是&quot;</span>,<span class="ruby-value str">&quot;02&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;否&quot;</span>}  <span class="ruby-comment cmt">#结案方式</span>
 18:     <span class="ruby-ivar">@endcase</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:endcase</span>]
 19:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 20:       <span class="ruby-ivar">@endcase</span>=<span class="ruby-value str">&quot;001&quot;</span>
 21:     <span class="ruby-keyword kw">end</span>
 22:                 
 23:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
 24:     <span class="ruby-keyword kw">return</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@d1</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@d2</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@endcase</span>)
 25:  
 26: 
 27:   
 28:                                 <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot;&quot;</span>
 29:         <span class="ruby-keyword kw">if</span>  <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-value str">'01'</span>
 30:           <span class="ruby-comment cmt">#结案</span>
 31:           <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot; and caseendbook_id_first is not null &quot;</span>
 32:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@endcase</span><span class="ruby-operator">==</span><span class="ruby-value str">'02'</span>
 33:           <span class="ruby-comment cmt">#未结案</span>
 34:           <span class="ruby-identifier">addConditions</span>=<span class="ruby-value str">&quot; and caseendbook_id_first is  null  &quot;</span>
 35:         <span class="ruby-keyword kw">end</span>
 36: 
 37: 
 38:    
 39:     <span class="ruby-constant">ReportTotal3</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>)
 40: 
 41:     <span class="ruby-comment cmt">#查询所有的 仲裁机构  并插入到 report_total3s</span>
 42:     <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(
 43:       <span class="ruby-node">&quot; insert into report_total3s (user_code,typ,typ_name)
 44:         select '#{session[:user_code]}',data_val,data_text
 45:         from tb_dictionaries
 46:         where typ_code='0004' and state='Y' and state='Y'  order by ind,data_val&quot;</span>
 47:     )
 48:       
 49:     <span class="ruby-identifier">report_total3</span> = <span class="ruby-constant">ReportTotal3</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>)
 50: 
 51:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">report_total3</span>
 52:       <span class="ruby-comment cmt"># 1百万以下</span>
 53:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_a</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 54:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&lt;1000000 and
 55:           agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 56:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 57: 
 58:       <span class="ruby-comment cmt"># 1百万－5百万</span>
 59:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_b</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 60:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&gt;=1000000 and
 61:           amount&lt;5000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 62:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 63: 
 64:       <span class="ruby-comment cmt"># 5百万－1千万</span>
 65:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_c</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 66:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&gt;=5000000 and
 67:           amount&lt;10000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 68:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 69: 
 70:       <span class="ruby-comment cmt"># 1千万－5千万</span>
 71:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_d</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 72:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&gt;=10000000 and
 73:           amount&lt;50000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 74:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 75: 
 76:       <span class="ruby-comment cmt"># 5千万－1亿</span>
 77:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_e</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 78:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&gt;=50000000 and
 79:           amount&lt;100000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 80:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 81: 
 82:       <span class="ruby-comment cmt">#1亿以上</span>
 83:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_f</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(
 84:         <span class="ruby-node">&quot; used='Y' and  state&gt;=4 and amount&gt;=100000000 and
 85:           agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
 86:       ) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
 87: 
 88:       <span class="ruby-comment cmt"># 合计</span>
 89:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">h</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_b</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_c</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_d</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_e</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_f</span>
 90:       
 91:       <span class="ruby-comment cmt">#本诉明确争议金额</span>
 92:       <span class="ruby-identifier">b_amount_0001_all</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
 93:         <span class="ruby-node">&quot;select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END) as n
 94:          from tb_cases,tb_case_amounts
 95:          where tb_cases.used='Y' and tb_case_amounts.used='Y'  and 
 96:                tb_cases.recevice_code=tb_case_amounts.recevice_code  and
 97:                tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
 98:                tb_case_amounts.partytype='1' and tb_case_amounts.amount_typ='0001'  and
 99:                tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
100:       )
101:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0001</span> = <span class="ruby-identifier">b_amount_0001_all</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
102:       
103:       <span class="ruby-comment cmt"># 本诉不明确争议金额</span>
104:       <span class="ruby-identifier">b_amount_0002_all</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
105:         <span class="ruby-node">&quot;select sum( CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END ) as n
106:          from tb_cases,tb_case_amounts
107:          where tb_cases.used='Y' and tb_case_amounts.used='Y'  and
108:                tb_cases.recevice_code=tb_case_amounts.recevice_code  and
109:                tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
110:                tb_case_amounts.partytype='1' and tb_case_amounts.amount_typ='0002' and
111:                tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
112:       )
113:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0002</span> = <span class="ruby-identifier">b_amount_0002_all</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
114:       
115:       <span class="ruby-comment cmt"># 本诉争议金额合计</span>
116:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_h</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0001</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0002</span>
117:       
118:       <span class="ruby-comment cmt"># 反诉明确争议金额</span>
119:       <span class="ruby-identifier">f_amount_0001_all</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
120:         <span class="ruby-node">&quot; select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END) as n
121:           from tb_cases,tb_case_amounts
122:           where tb_cases.used='Y' and tb_case_amounts.used='Y'  and
123:                 tb_cases.recevice_code=tb_case_amounts.recevice_code  and
124:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and 
125:                 tb_case_amounts.partytype='2' and tb_case_amounts.amount_typ='0001' and
126:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
127:       )
128:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0001</span> = <span class="ruby-identifier">f_amount_0001_all</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
129:       
130:       <span class="ruby-comment cmt"># 反诉不明确争议金额</span>
131:       <span class="ruby-identifier">f_amount_0002_all</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
132:         <span class="ruby-node">&quot; select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END)  as n
133:           from tb_cases,tb_case_amounts
134:           where tb_cases.used='Y' and tb_case_amounts.used='Y' and
135:                 tb_cases.recevice_code=tb_case_amounts.recevice_code  and
136:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
137:                 tb_case_amounts.partytype='2' and tb_case_amounts.amount_typ='0002' and
138:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
139:       )
140:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0002</span> = <span class="ruby-identifier">f_amount_0002_all</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
141: 
142:       <span class="ruby-comment cmt"># 反诉争议金额合计</span>
143:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_h</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0001</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0002</span>
144: 
145:       <span class="ruby-comment cmt"># 争议金额总计</span>
146:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">amount_h</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_h</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_h</span>
147:       
148:       <span class="ruby-comment cmt"># 本诉无明确争议金额 收费</span>
149:       <span class="ruby-identifier">b_charge_0004_all_a</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
150:         <span class="ruby-node">&quot; select sum(tb_should_charges.rmb_money)  as n
151:           from tb_cases,tb_should_charges
152:           where tb_cases.used='Y' and tb_should_charges.used='Y'  and
153:                 tb_cases.recevice_code=tb_should_charges.recevice_code  and
154:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
155:                 tb_should_charges.payment='0001' and tb_should_charges.typ='0004' and
156:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
157:       )
158:       
159:       <span class="ruby-comment cmt"># 本诉无明确争议金额 退费</span>
160:       <span class="ruby-identifier">b_charge_0004_all_b</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
161:         <span class="ruby-node">&quot; select sum(tb_should_refunds.rmb_money)  as n
162:           from tb_cases,tb_should_refunds
163:           where tb_cases.used='Y' and tb_should_refunds.used='Y'  and
164:                 tb_cases.recevice_code=tb_should_refunds.recevice_code  and
165:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
166:                 tb_should_refunds.payment='0001' and tb_should_refunds.typ='0004' and
167:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and
168:                 tb_should_refunds.state&lt;&gt;3 &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
169:       )
170: 
171:       <span class="ruby-identifier">b_charge_0004_a</span> = <span class="ruby-identifier">b_charge_0004_all_a</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
172:       <span class="ruby-identifier">b_charge_0004_b</span> = <span class="ruby-identifier">b_charge_0004_all_b</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
173: 
174:       <span class="ruby-comment cmt">#无明确争议金额 总收费</span>
175:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge_0004</span> = <span class="ruby-identifier">b_charge_0004_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b_charge_0004_b</span>.<span class="ruby-identifier">to_f</span>
176: 
177:       <span class="ruby-comment cmt"># 本诉仲裁费(实交)</span>
178:       <span class="ruby-identifier">b_charge_all_a</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
179:         <span class="ruby-node">&quot; select sum(tb_should_charges.re_rmb_money) as n
180:           from tb_cases,tb_should_charges
181:           where tb_cases.used='Y' and tb_should_charges.used='Y'  and
182:                 tb_cases.recevice_code=tb_should_charges.recevice_code  and
183:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
184:                 tb_should_charges.payment='0001' and
185:                 (tb_should_charges.typ='0001' or tb_should_charges.typ='0004') and
186:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
187:       )
188:       <span class="ruby-comment cmt"># 本诉仲裁费(实退)</span>
189:       <span class="ruby-identifier">b_charge_all_b</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
190:         <span class="ruby-node">&quot; select sum(tb_should_refunds.re_rmb_money) as n
191:           from tb_cases,tb_should_refunds
192:           where tb_cases.used='Y' and tb_should_refunds.used='Y'  and
193:                 tb_cases.recevice_code = tb_should_refunds.recevice_code  and
194:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
195:                 tb_should_refunds.payment='0001' and
196:                 (tb_should_refunds.typ='0001' or tb_should_refunds.typ='0004') and
197:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state=2 &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
198:       )
199: 
200:       <span class="ruby-identifier">b_charge_a</span> = <span class="ruby-identifier">b_charge_all_a</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
201:       <span class="ruby-identifier">b_charge_b</span> = <span class="ruby-identifier">b_charge_all_b</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
202:       
203:       <span class="ruby-comment cmt"># （本请求）实收费用 = 实交 - 实退</span>
204:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge</span> = <span class="ruby-identifier">b_charge_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b_charge_b</span>.<span class="ruby-identifier">to_f</span>
205: 
206:       <span class="ruby-comment cmt"># 反诉无明确争议金额 收费之和</span>
207:       <span class="ruby-identifier">f_charge_0004_all_a</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
208:         <span class="ruby-node">&quot; select sum(tb_should_charges.rmb_money)  as n
209:           from tb_cases,tb_should_charges
210:           where tb_cases.used='Y' and tb_should_charges.used='Y'  and
211:                 tb_cases.recevice_code=tb_should_charges.recevice_code  and
212:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
213:                 tb_should_charges.payment='0002' and tb_should_charges.typ='0004' and
214:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
215:       )
216:       <span class="ruby-comment cmt"># 反诉无明确争议金额 退费之和</span>
217:       <span class="ruby-identifier">f_charge_0004_all_b</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
218:         <span class="ruby-node">&quot; select sum(tb_should_refunds.rmb_money)  as n
219:           from tb_cases,tb_should_refunds
220:           where tb_cases.used='Y' and tb_should_refunds.used='Y'  and
221:                 tb_cases.recevice_code=tb_should_refunds.recevice_code  and
222:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
223:                 tb_should_refunds.payment='0002' and 
224:                 tb_should_refunds.typ='0004' and tb_cases.nowdate&gt;='#{@d1}' and
225:                 tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state&lt;&gt;3 &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
226:       )
227:       
228:       <span class="ruby-identifier">f_charge_0004_a</span> = <span class="ruby-identifier">f_charge_0004_all_a</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
229:       <span class="ruby-identifier">f_charge_0004_b</span> = <span class="ruby-identifier">f_charge_0004_all_b</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
230: 
231:       <span class="ruby-comment cmt">#反诉 无明确争议金额 总收费</span>
232:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge_0004</span> = <span class="ruby-identifier">f_charge_0004_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">f_charge_0004_b</span>.<span class="ruby-identifier">to_f</span>
233: 
234:       <span class="ruby-comment cmt"># 反诉仲裁费(实交)</span>
235:       <span class="ruby-identifier">f_charge_all_a</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
236:         <span class="ruby-node">&quot; select sum(tb_should_charges.re_rmb_money)  as n
237:           from tb_cases,tb_should_charges
238:           where tb_cases.used='Y' and tb_should_charges.used='Y'  and
239:                 tb_cases.recevice_code=tb_should_charges.recevice_code  and
240:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
241:                 tb_should_charges.payment='0002' and
242:                 (tb_should_charges.typ='0001' or tb_should_charges.typ='0004') and
243:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
244:       )
245:       <span class="ruby-comment cmt"># 反诉仲裁费(实退)</span>
246:       <span class="ruby-identifier">f_charge_all_b</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(
247:         <span class="ruby-node">&quot; select sum(tb_should_refunds.re_rmb_money)  as n
248:           from tb_cases,tb_should_refunds
249:           where tb_cases.used='Y' and tb_should_refunds.used='Y'  and
250:                 tb_cases.recevice_code=tb_should_refunds.recevice_code  and
251:                 tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and
252:                 tb_should_refunds.payment='0002' and
253:                 (tb_should_refunds.typ='0001' or tb_should_refunds.typ='0004') and
254:                 tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state=2&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">addConditions</span>
255:       )
256: 
257:       <span class="ruby-identifier">f_charge_a</span> = <span class="ruby-identifier">f_charge_all_a</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
258:       <span class="ruby-identifier">f_charge_b</span> = <span class="ruby-identifier">f_charge_all_b</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">n</span> <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
259:       <span class="ruby-comment cmt"># 实收 = 实交 - 实退</span>
260:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge</span> = <span class="ruby-identifier">f_charge_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">f_charge_b</span>.<span class="ruby-identifier">to_f</span>
261: 
262:       <span class="ruby-comment cmt"># 仲裁费总计 = （本请求）无明确争议金额总收费 + （本请求）实收费用 + （反请求）无明确争议金额 总收费 + （反请求）实收费用</span>
263:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">charge_h</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge_0004</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge_0004</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge</span>
264: 
265:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
266:     <span class="ruby-keyword kw">end</span>
267:     
268:     <span class="ruby-ivar">@case_pages</span>,<span class="ruby-ivar">@case</span> = <span class="ruby-identifier">paginate</span>(
269:       <span class="ruby-identifier">:report_total3s</span>,
270:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>,
271:       <span class="ruby-identifier">:order</span>      =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@order</span>,
272:       <span class="ruby-identifier">:per_page</span>   =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>
273:     )
274:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001930" class="method-detail">
        <a name="M001930"></a>

        <div class="method-heading">
          <a href="#M001930" class="method-signature">
          <span class="method-name">list4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁条款分析&#8212;处长使用
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001930-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001930-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/report_total3_controller.rb, line 301</span>
301:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list4</span>
302:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
303:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
304:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
305:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id&quot;</span>
306:     <span class="ruby-keyword kw">end</span>
307:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
308:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
309:       <span class="ruby-ivar">@page_lines</span>=<span class="ruby-value">2000000</span>
310:     <span class="ruby-keyword kw">end</span>
311:     <span class="ruby-ivar">@d1</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d1</span>]
312:     <span class="ruby-ivar">@d2</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:d2</span>]
313:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@d1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
314:       <span class="ruby-ivar">@d1</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">at_beginning_of_year</span>.<span class="ruby-identifier">to_date</span>
315:     <span class="ruby-keyword kw">end</span>
316:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@d2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
317:       <span class="ruby-ivar">@d2</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_date</span>
318:     <span class="ruby-keyword kw">end</span>
319: 
320:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@d1</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@d2</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
321:       <span class="ruby-constant">ReportTotal4</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>)
322:       <span class="ruby-constant">ActiveRecord</span><span class="ruby-operator">::</span><span class="ruby-constant">Base</span>.<span class="ruby-identifier">connection</span>.<span class="ruby-identifier">execute</span>(<span class="ruby-node">&quot;insert into report_total4s (user_code,typ,typ_name)   select '#{session[:user_code]}',data_val,data_text from tb_dictionaries where typ_code='0004' and state='Y' and used='Y' order by ind,data_val&quot;</span>)
323: 
324:       <span class="ruby-ivar">@c</span>=<span class="ruby-constant">ReportTotal4</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>)
325:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@c</span>
326:         <span class="ruby-comment cmt"># 1百万以下</span>
327:         <span class="ruby-identifier">c_a</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&lt;1000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
328:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
329:           <span class="ruby-identifier">c_a</span>=<span class="ruby-value">0</span>
330:         <span class="ruby-keyword kw">end</span>
331:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_a</span>=<span class="ruby-identifier">c_a</span>
332:         <span class="ruby-comment cmt">#1百万－5百万</span>
333:         <span class="ruby-identifier">c_b</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&gt;=1000000 and amount&lt;5000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
334:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
335:           <span class="ruby-identifier">c_b</span>=<span class="ruby-value">0</span>
336:         <span class="ruby-keyword kw">end</span>
337:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_b</span>=<span class="ruby-identifier">c_b</span>
338:         <span class="ruby-comment cmt"># 5百万－1千万</span>
339:         <span class="ruby-identifier">c_c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&gt;=5000000 and amount&lt;10000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
340:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_c</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
341:           <span class="ruby-identifier">c_c</span>=<span class="ruby-value">0</span>
342:         <span class="ruby-keyword kw">end</span>
343:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_c</span>=<span class="ruby-identifier">c_c</span>
344:         <span class="ruby-comment cmt"># 1千万－5千万</span>
345:         <span class="ruby-identifier">c_d</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&gt;=10000000 and amount&lt;50000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
346:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_d</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
347:           <span class="ruby-identifier">c_d</span>=<span class="ruby-value">0</span>
348:         <span class="ruby-keyword kw">end</span>
349:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_d</span>=<span class="ruby-identifier">c_d</span>
350:         <span class="ruby-comment cmt"># 5千万－1亿</span>
351:         <span class="ruby-identifier">c_e</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&gt;=50000000 and amount&lt;100000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
352:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_e</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
353:           <span class="ruby-identifier">c_e</span>=<span class="ruby-value">0</span>
354:         <span class="ruby-keyword kw">end</span>
355:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_e</span>=<span class="ruby-identifier">c_e</span>
356:         <span class="ruby-comment cmt">#1亿以上</span>
357:         <span class="ruby-identifier">c_f</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">count</span>(<span class="ruby-node">&quot;used='Y' and  state&gt;=4 and amount&gt;=100000000 and agent='#{c.typ}' and nowdate&gt;='#{@d1}' and nowdate&lt;='#{@d2}'&quot;</span>)
358:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
359:           <span class="ruby-identifier">c_f</span>=<span class="ruby-value">0</span>
360:         <span class="ruby-keyword kw">end</span>
361:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">c_f</span>=<span class="ruby-identifier">c_f</span>
362:         <span class="ruby-comment cmt"># 合计</span>
363:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">h</span>=<span class="ruby-identifier">c_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_b</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_c</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_d</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_e</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_f</span>
364:         <span class="ruby-comment cmt">#本诉明确争议金额</span>
365:         <span class="ruby-identifier">b_amount_0001_all</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END)  as n    from tb_cases,tb_case_amounts where tb_cases.used='Y' and tb_case_amounts.used='Y'  and tb_cases.recevice_code=tb_case_amounts.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_case_amounts.partytype='1' and tb_case_amounts.amount_typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
366:         <span class="ruby-identifier">b_amount_0001_all</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_amount_0001_all</span>)
367:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_amount_0001_all</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
368:           <span class="ruby-identifier">b_amount_0001</span>=<span class="ruby-value">0</span>
369:         <span class="ruby-keyword kw">else</span>
370:           <span class="ruby-identifier">b_amount_0001</span>=<span class="ruby-identifier">b_amount_0001_all</span>.<span class="ruby-identifier">n</span>
371:         <span class="ruby-keyword kw">end</span>
372:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_amount_0001</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
373:           <span class="ruby-identifier">b_amount_0001</span>=<span class="ruby-value">0</span>
374:         <span class="ruby-keyword kw">end</span>
375:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0001</span>=<span class="ruby-identifier">b_amount_0001</span>
376:         <span class="ruby-comment cmt"># 本诉不明确争议金额</span>
377:         <span class="ruby-identifier">b_amount_0002_all</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END)  as n    from tb_cases,tb_case_amounts where tb_cases.used='Y' and tb_case_amounts.used='Y'  and tb_cases.recevice_code=tb_case_amounts.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_case_amounts.partytype='1' and tb_case_amounts.amount_typ='0002' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
378:         <span class="ruby-identifier">b_amount_0002_all</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_amount_0002_all</span>)
379:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_amount_0002_all</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
380:           <span class="ruby-identifier">b_amount_0002</span>=<span class="ruby-value">0</span>
381:         <span class="ruby-keyword kw">else</span>
382:           <span class="ruby-identifier">b_amount_0002</span>=<span class="ruby-identifier">b_amount_0002_all</span>.<span class="ruby-identifier">n</span>
383:         <span class="ruby-keyword kw">end</span>
384:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_amount_0002</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
385:           <span class="ruby-identifier">b_amount_0002</span>=<span class="ruby-value">0</span>
386:         <span class="ruby-keyword kw">end</span>
387:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0002</span>=<span class="ruby-identifier">b_amount_0002</span>
388:         <span class="ruby-comment cmt"># 本诉争议金额合计</span>
389:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_h</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0001</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_0002</span>
390:         <span class="ruby-comment cmt"># 反诉明确争议金额</span>
391:         <span class="ruby-identifier">f_amount_0001_all</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END)  as n    from tb_cases,tb_case_amounts where tb_cases.used='Y' and tb_case_amounts.used='Y'  and tb_cases.recevice_code=tb_case_amounts.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_case_amounts.partytype='2' and tb_case_amounts.amount_typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
392:         <span class="ruby-identifier">f_amount_0001_all</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_amount_0001_all</span>)
393:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_amount_0001_all</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
394:           <span class="ruby-identifier">f_amount_0001</span>=<span class="ruby-value">0</span>
395:         <span class="ruby-keyword kw">else</span>
396:           <span class="ruby-identifier">f_amount_0001</span>=<span class="ruby-identifier">f_amount_0001_all</span>.<span class="ruby-identifier">n</span>
397:         <span class="ruby-keyword kw">end</span>
398:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_amount_0001</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
399:           <span class="ruby-identifier">f_amount_0001</span>=<span class="ruby-value">0</span>
400:         <span class="ruby-keyword kw">end</span>
401:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0001</span>=<span class="ruby-identifier">f_amount_0001</span>
402:         <span class="ruby-comment cmt"># 反诉不明确争议金额</span>
403:         <span class="ruby-identifier">f_amount_0002_all</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(CASE tb_case_amounts.typ WHEN '0003' THEN  -1 * tb_case_amounts.rmb_money ELSE tb_case_amounts.rmb_money END)  as n    from tb_cases,tb_case_amounts where tb_cases.used='Y' and tb_case_amounts.used='Y'  and tb_cases.recevice_code=tb_case_amounts.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_case_amounts.partytype='2' and tb_case_amounts.amount_typ='0002' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
404:         <span class="ruby-identifier">f_amount_0002_all</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_amount_0002_all</span>)
405:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_amount_0002_all</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
406:           <span class="ruby-identifier">f_amount_0002</span>=<span class="ruby-value">0</span>
407:         <span class="ruby-keyword kw">else</span>
408:           <span class="ruby-identifier">f_amount_0002</span>=<span class="ruby-identifier">f_amount_0002_all</span>.<span class="ruby-identifier">n</span>
409:         <span class="ruby-keyword kw">end</span>
410:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_amount_0002</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
411:           <span class="ruby-identifier">f_amount_0002</span>=<span class="ruby-value">0</span>
412:         <span class="ruby-keyword kw">end</span>
413:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0002</span>=<span class="ruby-identifier">f_amount_0002</span>
414:         <span class="ruby-comment cmt"># 反诉争议金额合计</span>
415:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_h</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0001</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_0002</span>
416:         <span class="ruby-comment cmt"># 争议金额总计</span>
417:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">amount_h</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_amount_h</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_amount_h</span>
418:         <span class="ruby-comment cmt"># 本诉无明确争议金额收费</span>
419:         <span class="ruby-identifier">b_charge_0004_all_a</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_charges.rmb_money)  as n    from tb_cases,tb_should_charges where tb_cases.used='Y' and tb_should_charges.used='Y'  and tb_cases.recevice_code=tb_should_charges.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_charges.payment='0001' and tb_should_charges.typ='0004' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
420:         <span class="ruby-identifier">b_charge_0004_all_b</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_refunds.rmb_money)  as n    from tb_cases,tb_should_refunds where tb_cases.used='Y' and tb_should_refunds.used='Y'  and tb_cases.recevice_code=tb_should_refunds.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_refunds.payment='0001' and tb_should_refunds.typ='0004' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state&lt;&gt;3&quot;</span>)
421: 
422:         <span class="ruby-identifier">b_charge_0004_all_a</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_charge_0004_all_a</span>)
423:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_0004_all_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
424:           <span class="ruby-identifier">b_charge_0004_a</span>=<span class="ruby-value">0</span>
425:         <span class="ruby-keyword kw">else</span>
426:           <span class="ruby-identifier">b_charge_0004_a</span>=<span class="ruby-identifier">b_charge_0004_all_a</span>.<span class="ruby-identifier">n</span>
427:         <span class="ruby-keyword kw">end</span>
428:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_0004_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
429:           <span class="ruby-identifier">b_charge_0004_a</span>=<span class="ruby-value">0</span>
430:         <span class="ruby-keyword kw">end</span>
431: 
432:         <span class="ruby-identifier">b_charge_0004_all_b</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_charge_0004_all_b</span>)
433:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_0004_all_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
434:           <span class="ruby-identifier">b_charge_0004_b</span>=<span class="ruby-value">0</span>
435:         <span class="ruby-keyword kw">else</span>
436:           <span class="ruby-identifier">b_charge_0004_b</span>=<span class="ruby-identifier">b_charge_0004_all_b</span>.<span class="ruby-identifier">n</span>
437:         <span class="ruby-keyword kw">end</span>
438:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_0004_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
439:           <span class="ruby-identifier">b_charge_0004_b</span>=<span class="ruby-value">0</span>
440:         <span class="ruby-keyword kw">end</span>
441: 
442:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge_0004</span>=<span class="ruby-identifier">b_charge_0004_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b_charge_0004_b</span>.<span class="ruby-identifier">to_f</span>
443:         <span class="ruby-comment cmt"># 本诉仲裁费(实收)</span>
444:         <span class="ruby-identifier">b_charge_all_a</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_charges.rmb_money)  as n    from tb_cases,tb_should_charges where tb_cases.used='Y' and tb_should_charges.used='Y'  and tb_cases.recevice_code=tb_should_charges.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_charges.payment='0001' and tb_should_charges.typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
445:         <span class="ruby-identifier">b_charge_all_b</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_refunds.rmb_money)  as n    from tb_cases,tb_should_refunds where tb_cases.used='Y' and tb_should_refunds.used='Y'  and tb_cases.recevice_code=tb_should_refunds.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_refunds.payment='0001' and tb_should_refunds.typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state&lt;&gt;3&quot;</span>)
446: 
447:         <span class="ruby-identifier">b_charge_all_a</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_charge_all_a</span>)
448:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_all_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
449:           <span class="ruby-identifier">b_charge_a</span>=<span class="ruby-value">0</span>
450:         <span class="ruby-keyword kw">else</span>
451:           <span class="ruby-identifier">b_charge_a</span>=<span class="ruby-identifier">b_charge_all_a</span>.<span class="ruby-identifier">n</span>
452:         <span class="ruby-keyword kw">end</span>
453:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
454:           <span class="ruby-identifier">b_charge_a</span>=<span class="ruby-value">0</span>
455:         <span class="ruby-keyword kw">end</span>
456: 
457:         <span class="ruby-identifier">b_charge_all_b</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">b_charge_all_b</span>)
458:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_all_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
459:           <span class="ruby-identifier">b_charge_b</span>=<span class="ruby-value">0</span>
460:         <span class="ruby-keyword kw">else</span>
461:           <span class="ruby-identifier">b_charge_b</span>=<span class="ruby-identifier">b_charge_all_b</span>.<span class="ruby-identifier">n</span>
462:         <span class="ruby-keyword kw">end</span>
463:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
464:           <span class="ruby-identifier">b_charge_b</span>=<span class="ruby-value">0</span>
465:         <span class="ruby-keyword kw">end</span>
466: 
467:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge</span>=<span class="ruby-identifier">b_charge_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b_charge_b</span>.<span class="ruby-identifier">to_f</span>
468:         <span class="ruby-comment cmt"># 反诉无明确争议金额收费</span>
469:         <span class="ruby-identifier">f_charge_0004_all_a</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_charges.rmb_money)  as n    from tb_cases,tb_should_charges where tb_cases.used='Y' and tb_should_charges.used='Y'  and tb_cases.recevice_code=tb_should_charges.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_charges.payment='0002' and tb_should_charges.typ='0004' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
470:         <span class="ruby-identifier">f_charge_0004_all_b</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_refunds.rmb_money)  as n    from tb_cases,tb_should_refunds where tb_cases.used='Y' and tb_should_refunds.used='Y'  and tb_cases.recevice_code=tb_should_refunds.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_refunds.payment='0002' and tb_should_refunds.typ='0004' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state&lt;&gt;3&quot;</span>)
471: 
472:         <span class="ruby-identifier">f_charge_0004_all_a</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_charge_0004_all_a</span>)
473:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_0004_all_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
474:           <span class="ruby-identifier">f_charge_0004_a</span>=<span class="ruby-value">0</span>
475:         <span class="ruby-keyword kw">else</span>
476:           <span class="ruby-identifier">f_charge_0004_a</span>=<span class="ruby-identifier">f_charge_0004_all_a</span>.<span class="ruby-identifier">n</span>
477:         <span class="ruby-keyword kw">end</span>
478:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_0004_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
479:           <span class="ruby-identifier">f_charge_0004_a</span>=<span class="ruby-value">0</span>
480:         <span class="ruby-keyword kw">end</span>
481: 
482:         <span class="ruby-identifier">f_charge_0004_all_b</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_charge_0004_all_b</span>)
483:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_0004_all_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
484:           <span class="ruby-identifier">f_charge_0004_b</span>=<span class="ruby-value">0</span>
485:         <span class="ruby-keyword kw">else</span>
486:           <span class="ruby-identifier">f_charge_0004_b</span>=<span class="ruby-identifier">f_charge_0004_all_b</span>.<span class="ruby-identifier">n</span>
487:         <span class="ruby-keyword kw">end</span>
488:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_0004_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
489:           <span class="ruby-identifier">f_charge_0004_b</span>=<span class="ruby-value">0</span>
490:         <span class="ruby-keyword kw">end</span>
491: 
492:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge_0004</span>=<span class="ruby-identifier">f_charge_0004_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">f_charge_0004_b</span>.<span class="ruby-identifier">to_f</span>
493:         <span class="ruby-comment cmt"># 反诉仲裁费(实收)</span>
494:         <span class="ruby-identifier">f_charge_all_a</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_charges.rmb_money)  as n    from tb_cases,tb_should_charges where tb_cases.used='Y' and tb_should_charges.used='Y'  and tb_cases.recevice_code=tb_should_charges.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_charges.payment='0002' and tb_should_charges.typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}'&quot;</span>)
495:         <span class="ruby-identifier">f_charge_all_b</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(tb_should_refunds.rmb_money)  as n    from tb_cases,tb_should_refunds where tb_cases.used='Y' and tb_should_refunds.used='Y'  and tb_cases.recevice_code=tb_should_refunds.recevice_code  and  tb_cases.state&gt;=4 and  tb_cases.agent='#{c.typ}' and tb_should_refunds.payment='0002' and tb_should_refunds.typ='0001' and tb_cases.nowdate&gt;='#{@d1}' and tb_cases.nowdate&lt;='#{@d2}' and tb_should_refunds.state&lt;&gt;3&quot;</span>)
496: 
497:         <span class="ruby-identifier">f_charge_all_a</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_charge_all_a</span>)
498:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_charge_all_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
499:           <span class="ruby-identifier">f_charge_a</span>=<span class="ruby-value">0</span>
500:         <span class="ruby-keyword kw">else</span>
501:           <span class="ruby-identifier">f_charge_a</span>=<span class="ruby-identifier">f_charge_all_a</span>.<span class="ruby-identifier">n</span>
502:         <span class="ruby-keyword kw">end</span>
503:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_a</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
504:           <span class="ruby-identifier">f_charge_a</span>=<span class="ruby-value">0</span>
505:         <span class="ruby-keyword kw">end</span>
506: 
507:         <span class="ruby-identifier">f_charge_all_b</span>=<span class="ruby-identifier">p</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">f_charge_all_b</span>)
508:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_all_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
509:           <span class="ruby-identifier">f_charge_b</span>=<span class="ruby-value">0</span>
510:         <span class="ruby-keyword kw">else</span>
511:           <span class="ruby-identifier">f_charge_b</span>=<span class="ruby-identifier">f_charge_all_b</span>.<span class="ruby-identifier">n</span>
512:         <span class="ruby-keyword kw">end</span>
513:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f_charge_b</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
514:           <span class="ruby-identifier">f_charge_b</span>=<span class="ruby-value">0</span>
515:         <span class="ruby-keyword kw">end</span>
516: 
517:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge</span>=<span class="ruby-identifier">f_charge_a</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">f_charge_b</span>.<span class="ruby-identifier">to_f</span>
518:         <span class="ruby-comment cmt"># 仲裁费总计</span>
519:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">charge_h</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge_0004</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">b_charge</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge_0004</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">f_charge</span>
520: 
521: 
522:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
523:       <span class="ruby-keyword kw">end</span>
524:     <span class="ruby-keyword kw">end</span>
525:     <span class="ruby-ivar">@case_pages</span>,<span class="ruby-ivar">@case</span>=<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:report_total4s</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;user_code='#{session[:user_code]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>,<span class="ruby-identifier">:per_page=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>)
526:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>