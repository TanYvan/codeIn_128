<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseConsultation3Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseConsultation3Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/case_consultation3_controller_rb.html">
                app/controllers/case_consultation3_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000580">a_list</a>&nbsp;&nbsp;
      <a href="#M000611">agent_create</a>&nbsp;&nbsp;
      <a href="#M000614">agent_delete</a>&nbsp;&nbsp;
      <a href="#M000612">agent_edit</a>&nbsp;&nbsp;
      <a href="#M000609">agent_list</a>&nbsp;&nbsp;
      <a href="#M000610">agent_new</a>&nbsp;&nbsp;
      <a href="#M000613">agent_update</a>&nbsp;&nbsp;
      <a href="#M000600">clerk_select</a>&nbsp;&nbsp;
      <a href="#M000599">clerk_select_list</a>&nbsp;&nbsp;
      <a href="#M000595">con_create</a>&nbsp;&nbsp;
      <a href="#M000598">con_delete</a>&nbsp;&nbsp;
      <a href="#M000596">con_edit</a>&nbsp;&nbsp;
      <a href="#M000593">con_list</a>&nbsp;&nbsp;
      <a href="#M000594">con_new</a>&nbsp;&nbsp;
      <a href="#M000597">con_update</a>&nbsp;&nbsp;
      <a href="#M000583">create</a>&nbsp;&nbsp;
      <a href="#M000605">create_amount</a>&nbsp;&nbsp;
      <a href="#M000586">delete</a>&nbsp;&nbsp;
      <a href="#M000608">delete_amount</a>&nbsp;&nbsp;
      <a href="#M000584">edit</a>&nbsp;&nbsp;
      <a href="#M000606">edit_amount</a>&nbsp;&nbsp;
      <a href="#M000603">edit_dispute_amount</a>&nbsp;&nbsp;
      <a href="#M000601">establishment</a>&nbsp;&nbsp;
      <a href="#M000602">establishment_no</a>&nbsp;&nbsp;
      <a href="#M000617">file_create</a>&nbsp;&nbsp;
      <a href="#M000620">file_delete</a>&nbsp;&nbsp;
      <a href="#M000624">file_destroy</a>&nbsp;&nbsp;
      <a href="#M000623">file_down</a>&nbsp;&nbsp;
      <a href="#M000618">file_edit</a>&nbsp;&nbsp;
      <a href="#M000615">file_list</a>&nbsp;&nbsp;
      <a href="#M000616">file_new</a>&nbsp;&nbsp;
      <a href="#M000619">file_update</a>&nbsp;&nbsp;
      <a href="#M000621">file_upload</a>&nbsp;&nbsp;
      <a href="#M000622">file_upload_do</a>&nbsp;&nbsp;
      <a href="#M000581">list</a>&nbsp;&nbsp;
      <a href="#M000582">new</a>&nbsp;&nbsp;
      <a href="#M000604">new_amount</a>&nbsp;&nbsp;
      <a href="#M000577">p_list</a>&nbsp;&nbsp;
      <a href="#M000574">p_set</a>&nbsp;&nbsp;
      <a href="#M000575">p_set_2</a>&nbsp;&nbsp;
      <a href="#M000589">party_create</a>&nbsp;&nbsp;
      <a href="#M000592">party_delete</a>&nbsp;&nbsp;
      <a href="#M000590">party_edit</a>&nbsp;&nbsp;
      <a href="#M000587">party_list</a>&nbsp;&nbsp;
      <a href="#M000588">party_new</a>&nbsp;&nbsp;
      <a href="#M000576">party_set</a>&nbsp;&nbsp;
      <a href="#M000591">party_update</a>&nbsp;&nbsp;
      <a href="#M000579">rate_set</a>&nbsp;&nbsp;
      <a href="#M000578">select_with_ajax</a>&nbsp;&nbsp;
      <a href="#M000585">update</a>&nbsp;&nbsp;
      <a href="#M000607">update_amount</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000580" class="method-detail">
        <a name="M000580"></a>

        <div class="method-heading">
          <a href="#M000580" class="method-signature">
          <span class="method-name">a_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000580-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000580-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 62</span>
62:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">a_list</span>
63:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:company</span>]
64:     <span class="ruby-identifier">cov</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
65:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">company</span>)
66:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">strip!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">company</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
67:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct company,addr from tb_agents where company like '%#{company}%'  ORDER BY addr desc&quot;</span>)
68:     <span class="ruby-keyword kw">else</span>
69:       <span class="ruby-identifier">p</span>=<span class="ruby-keyword kw">nil</span>
70:     <span class="ruby-keyword kw">end</span>
71:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
72:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'a_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'a_l'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">p</span>
73:     <span class="ruby-keyword kw">end</span>
74:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000611" class="method-detail">
        <a name="M000611"></a>

        <div class="method-heading">
          <a href="#M000611" class="method-signature">
          <span class="method-name">agent_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000611-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000611-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 683</span>
683:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_create</span>
684:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
685:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
686:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
687:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
688:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
689:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
690:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
691:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
692:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
693:     <span class="ruby-keyword kw">else</span>
694:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
695:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
696:     <span class="ruby-keyword kw">end</span>
697:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000614" class="method-detail">
        <a name="M000614"></a>

        <div class="method-heading">
          <a href="#M000614" class="method-signature">
          <span class="method-name">agent_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000614-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000614-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 716</span>
716:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_delete</span>
717:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
718:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
719:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
720:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
721:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
722:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
723:     <span class="ruby-keyword kw">else</span>
724:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
725:     <span class="ruby-keyword kw">end</span>
726:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
727:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000612" class="method-detail">
        <a name="M000612"></a>

        <div class="method-heading">
          <a href="#M000612" class="method-signature">
          <span class="method-name">agent_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000612-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000612-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 698</span>
698:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_edit</span>
699:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
700:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000609" class="method-detail">
        <a name="M000609"></a>

        <div class="method-heading">
          <a href="#M000609" class="method-signature">
          <span class="method-name">agent_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
代理人##############################################
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000609-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000609-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 668</span>
668:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_list</span>
669: <span class="ruby-comment cmt">#    @isperson={1=&gt;&quot;是&quot;,2=&gt;&quot;否&quot;}</span>
670:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人方&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人方&quot;</span>}
671:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
672:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
673:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
674:     <span class="ruby-keyword kw">end</span>
675:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
676:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
677:       <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
678:     <span class="ruby-keyword kw">end</span>
679:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000610" class="method-detail">
        <a name="M000610"></a>

        <div class="method-heading">
          <a href="#M000610" class="method-signature">
          <span class="method-name">agent_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000610-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000610-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 680</span>
680:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_new</span>
681:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>()
682:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000613" class="method-detail">
        <a name="M000613"></a>

        <div class="method-heading">
          <a href="#M000613" class="method-signature">
          <span class="method-name">agent_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000613-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000613-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 701</span>
701:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_update</span>
702:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
703:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
704:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
705:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
706:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
707:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
708:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
709:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
710:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
711:     <span class="ruby-keyword kw">else</span>
712:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
713:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
714:     <span class="ruby-keyword kw">end</span>
715:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000600" class="method-detail">
        <a name="M000600"></a>

        <div class="method-heading">
          <a href="#M000600" class="method-signature">
          <span class="method-name">clerk_select</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000600-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000600-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 346</span>
346:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select</span>
347:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>])
348:     <span class="ruby-identifier">old_clerk</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
349:     <span class="ruby-identifier">new_clerk</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
350:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
351: 
352:     <span class="ruby-identifier">tc</span>=<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">new</span>()
353:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>]).<span class="ruby-identifier">recevice_code</span>
354:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">changedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
355:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">beforeclerk</span>=<span class="ruby-identifier">old_clerk</span>
356:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">afterclerk</span>=<span class="ruby-identifier">new_clerk</span>
357:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
358:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
359:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">falg</span>=<span class="ruby-value">0</span>
360: 
361:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">save</span>
362:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;仲裁助理指定成功&quot;</span>
363:     <span class="ruby-keyword kw">else</span>
364:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;仲裁助理指定失败&quot;</span>
365:     <span class="ruby-keyword kw">end</span>
366: 
367:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'1'</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
368:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000599" class="method-detail">
        <a name="M000599"></a>

        <div class="method-heading">
          <a href="#M000599" class="method-signature">
          <span class="method-name">clerk_select_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000599-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000599-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 335</span>
335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select_list</span>
336:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0001&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
337:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003'  )&quot;</span>)
338:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0003&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
339:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003' and user_code='#{session[:user_code_2]}')&quot;</span>)
340:     <span class="ruby-keyword kw">else</span>
341:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  1=2&quot;</span>)
342:     <span class="ruby-keyword kw">end</span>
343: 
344:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000595" class="method-detail">
        <a name="M000595"></a>

        <div class="method-heading">
          <a href="#M000595" class="method-signature">
          <span class="method-name">con_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000595-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000595-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 290</span>
290:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_create</span>
291:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
292:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
293:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
294:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
295:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
296:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
297:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
298:     <span class="ruby-keyword kw">else</span>
299:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
300:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_new&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
301:     <span class="ruby-keyword kw">end</span>
302: 
303:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000598" class="method-detail">
        <a name="M000598"></a>

        <div class="method-heading">
          <a href="#M000598" class="method-signature">
          <span class="method-name">con_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000598-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000598-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 322</span>
322:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_delete</span>
323:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
324:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
325:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
326:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
327:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
328:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
329:     <span class="ruby-keyword kw">else</span>
330:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
331:     <span class="ruby-keyword kw">end</span>
332:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
333:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000596" class="method-detail">
        <a name="M000596"></a>

        <div class="method-heading">
          <a href="#M000596" class="method-signature">
          <span class="method-name">con_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000596-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000596-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 305</span>
305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_edit</span>
306:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
307:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000593" class="method-detail">
        <a name="M000593"></a>

        <div class="method-heading">
          <a href="#M000593" class="method-signature">
          <span class="method-name">con_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000593-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000593-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 274</span>
274:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_list</span>
275:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
276:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
277:     <span class="ruby-keyword kw">end</span>
278:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
279:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
280:       <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
281:     <span class="ruby-keyword kw">end</span>
282:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000594" class="method-detail">
        <a name="M000594"></a>

        <div class="method-heading">
          <a href="#M000594" class="method-signature">
          <span class="method-name">con_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000594-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000594-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 284</span>
284:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_new</span>
285:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>()
286:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">contractdate</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">acceptt</span>
287:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">pactname</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">casereason</span>
288:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000597" class="method-detail">
        <a name="M000597"></a>

        <div class="method-heading">
          <a href="#M000597" class="method-signature">
          <span class="method-name">con_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000597-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000597-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 309</span>
309:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_update</span>
310:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
311:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
312:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
313:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
314:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
315:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
316:     <span class="ruby-keyword kw">else</span>
317:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
318:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
319:     <span class="ruby-keyword kw">end</span>
320:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000583" class="method-detail">
        <a name="M000583"></a>

        <div class="method-heading">
          <a href="#M000583" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000583-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000583-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 110</span>
110:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
111:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
112:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
113:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
114:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
115:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code_limit_dat</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span> <span class="ruby-operator">+</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">&quot;1010&quot;</span>).<span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_i</span>
116:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0001</span>()
117:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
118:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
119:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
120:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
121:       <span class="ruby-keyword kw">end</span>
122:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
123:         <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;&quot;</span>
124:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">CaseApplySyn</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">create</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>], <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>])
125:           <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;____申请信息复制成功&quot;</span>
126:         <span class="ruby-keyword kw">else</span>
127:           <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;____申请信息复制失败!!!&quot;</span>
128:         <span class="ruby-keyword kw">end</span>
129:         <span class="ruby-comment cmt"># 如果创建成功，系统自动为申请人和被申请人分别创建案件应收费“当事人多交费用”，金额是 0</span>
130:         <span class="ruby-ivar">@should1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
131:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
132:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
133:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
134:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
135:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0001&quot;</span>
136:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
137:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
138:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
139:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
140:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
141:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">save</span>
142: 
143:         <span class="ruby-ivar">@should2</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
144:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
145:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
146:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
147:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
148:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0002&quot;</span>
149:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
150:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
151:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
152:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
153:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
154:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">save</span>
155: 
156:         <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
157:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;创建成功，咨询流水号:#{@case.recevice_code} #{apply_create}&quot;</span>
158:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
159:       <span class="ruby-keyword kw">else</span>
160:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
161:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
162:       <span class="ruby-keyword kw">end</span>
163:     <span class="ruby-keyword kw">else</span>
164:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
165:     <span class="ruby-keyword kw">end</span>
166:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000605" class="method-detail">
        <a name="M000605"></a>

        <div class="method-heading">
          <a href="#M000605" class="method-signature">
          <span class="method-name">create_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000605-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000605-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 537</span>
537:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_amount</span>
538:     <span class="ruby-ivar">@current_case</span>          = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
539:     <span class="ruby-ivar">@amount</span>               = <span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
540:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
541:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">case_code</span>
542:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">general_code</span>
543:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
544:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
545:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
546:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>      = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>.<span class="ruby-identifier">to_i</span>
547: 
548:     <span class="ruby-identifier">sum1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
549:     <span class="ruby-identifier">sum2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
550:     
551:     <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:spec</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;on&quot;</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum1</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum2</span>)
552:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败,减少争议金额不能大于原争议金额的总和！&quot;</span>
553:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
554:     <span class="ruby-keyword kw">else</span>
555:       
556:       <span class="ruby-identifier">old_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">1</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的立案费</span>
557:       <span class="ruby-identifier">old_arbitration_fee</span>  = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">2</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的仲裁费</span>
558: 
559:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
560:         <span class="ruby-ivar">@money</span>=<span class="ruby-constant">Money</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;used='Y'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
561:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">m</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@money</span>
562:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-value str">'0'</span>
563:             <span class="ruby-ivar">@amount_detail</span>=<span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">new</span>()
564:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">parent_id</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">id</span>
565:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
566:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">case_code</span>
567:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">general_code</span>
568:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">partytype</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
569:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
570:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>
571:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span>
572:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">amount_typ</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">amount_typ</span>
573:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">dt</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>
574:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">currency</span>=<span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>
575:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">f_money</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;f_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
576:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rate</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rate_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
577:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rmb_money</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
578:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">save</span>
579:           <span class="ruby-keyword kw">end</span>
580:         <span class="ruby-keyword kw">end</span>
581:         
582:         <span class="ruby-comment cmt">#调用是有方法的函数，在增加争议金额的时候进行应收或应退的增加</span>
583:         <span class="ruby-identifier">should_add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>,<span class="ruby-identifier">old_registration_fee</span>,<span class="ruby-identifier">old_arbitration_fee</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
584: 
585:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount</span>   = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
586:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
587:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
588:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">save</span>
589:           <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
590:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
591:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
592:                       <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
593:                       <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
594:         <span class="ruby-keyword kw">else</span>
595:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
596:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
597:                  <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
598:                  <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
599:         <span class="ruby-keyword kw">end</span>
600:       <span class="ruby-keyword kw">else</span>
601:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
602:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
603:                <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
604:                <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
605:       <span class="ruby-keyword kw">end</span>
606:     <span class="ruby-keyword kw">end</span>
607:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000586" class="method-detail">
        <a name="M000586"></a>

        <div class="method-heading">
          <a href="#M000586" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000586-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000586-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 191</span>
191:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>
192:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
193:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
194:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
195:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
196:     <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">del_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
197:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
198:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
199:     <span class="ruby-keyword kw">else</span>
200:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
201:     <span class="ruby-keyword kw">end</span>
202:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
203:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000608" class="method-detail">
        <a name="M000608"></a>

        <div class="method-heading">
          <a href="#M000608" class="method-signature">
          <span class="method-name">delete_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000608-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000608-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 642</span>
642:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_amount</span>
643:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
644:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
645:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
646:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
647:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
648:       <span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;parent_id=#{@amount.id}&quot;</span>)
649:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
650:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
651:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
652:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
653:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
654:       <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>)
655:       <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>) 
656:       <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
657:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
658:     <span class="ruby-keyword kw">else</span>
659:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
660:     <span class="ruby-keyword kw">end</span>
661:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
662:                 <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
663:                 <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
664:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000584" class="method-detail">
        <a name="M000584"></a>

        <div class="method-heading">
          <a href="#M000584" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000584-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000584-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 168</span>
168:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
169:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
170:     <span class="ruby-ivar">@t_typ</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
171:     <span class="ruby-ivar">@typ1</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
172:     <span class="ruby-ivar">@typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{@case.casetype_num}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
173:     <span class="ruby-ivar">@placed</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{params[:recevice_code]}' and (typ='0001' or typ='0004') and re_rmb_money&lt;&gt;0&quot;</span>)
174:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000606" class="method-detail">
        <a name="M000606"></a>

        <div class="method-heading">
          <a href="#M000606" class="method-signature">
          <span class="method-name">edit_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000606-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000606-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 609</span>
609:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_amount</span>
610:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
611:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000603" class="method-detail">
        <a name="M000603"></a>

        <div class="method-heading">
          <a href="#M000603" class="method-signature">
          <span class="method-name">edit_dispute_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
关于争议金额的处理
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000603-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000603-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 430</span>
430:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_dispute_amount</span>
431:     <span class="ruby-ivar">@case</span>=<span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
432:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
433:     <span class="ruby-keyword kw">else</span>
434:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
435:       <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
436:       <span class="ruby-ivar">@typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;争议金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;追加争议金额&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;减少争议金额&quot;</span>}
437:       <span class="ruby-ivar">@amount_typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;明确金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;不明确金额&quot;</span>}
438:       <span class="ruby-ivar">@amount1</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y' and partytype=1&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
439:       <span class="ruby-ivar">@amount2</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y' and partytype=2&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
440:       <span class="ruby-comment cmt">#申请人明确争议金额</span>
441:       <span class="ruby-ivar">@applicant_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
442:       <span class="ruby-comment cmt">#被申请人明确争议金额</span>
443:       <span class="ruby-ivar">@respondent_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
444:       <span class="ruby-comment cmt">#申请人不明确争议金额</span>
445:       <span class="ruby-ivar">@applicant_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
446:       <span class="ruby-comment cmt">#被申请人不明确争议金额</span>
447:       <span class="ruby-ivar">@respondent_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
448:       <span class="ruby-comment cmt">#申请人费用汇总</span>
449:       <span class="ruby-identifier">applicant_all</span> = <span class="ruby-ivar">@applicant_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_undefinites</span>
450:       <span class="ruby-comment cmt">#被申请人费用汇总</span>
451:       <span class="ruby-identifier">respondent_all</span> = <span class="ruby-ivar">@respondent_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_undefinites</span>
452:       <span class="ruby-comment cmt">#金融案件仲裁费/立案费</span>
453:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case!</span>=<span class="ruby-keyword kw">nil</span>
454:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0005&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0006&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0007&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0008&quot;</span>
455:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
456:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">applicant_all</span>)   <span class="ruby-comment cmt">#仲裁费</span>
457:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">applicant_all</span>)      <span class="ruby-comment cmt">#立案费</span>
458:           <span class="ruby-keyword kw">else</span>
459:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
460:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
461:           <span class="ruby-keyword kw">end</span>
462:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
463:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">respondent_all</span>)
464:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">respondent_all</span>)
465:           <span class="ruby-keyword kw">else</span>
466:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
467:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
468:           <span class="ruby-keyword kw">end</span>
469:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
470:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
471:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
472:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
473:       <span class="ruby-comment cmt">#涉外案件仲裁费/立案费</span>
474: 
475:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0004&quot;</span>
476:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
477:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">applicant_all</span>)   <span class="ruby-comment cmt">#仲裁费</span>
478:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">applicant_all</span>)      <span class="ruby-comment cmt">#立案费</span>
479:           <span class="ruby-keyword kw">else</span>
480:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
481:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
482:           <span class="ruby-keyword kw">end</span>
483:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
484:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">respondent_all</span>)
485:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">respondent_all</span>) 
486:           <span class="ruby-keyword kw">else</span>
487:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
488:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
489:           <span class="ruby-keyword kw">end</span>
490:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
491:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
492:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
493:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
494:       <span class="ruby-comment cmt">#国内案件受理费/处理费计算</span>
495:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
496:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
497:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">respondent_all</span>)
498:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">respondent_all</span>)
499:         <span class="ruby-keyword kw">else</span>
500:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
501:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
502:         <span class="ruby-keyword kw">end</span>
503:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
504:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">applicant_all</span>)
505:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">applicant_all</span>)
506:         <span class="ruby-keyword kw">else</span>
507:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>
508:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>
509:         <span class="ruby-keyword kw">end</span>
510:         <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
511:         <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
512:         <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
513:         <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
514:       <span class="ruby-keyword kw">end</span>
515:       <span class="ruby-ivar">@applicant_sum</span> = <span class="ruby-ivar">@applicant_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_processing_fee</span>
516:       <span class="ruby-ivar">@respondent_sum</span> = <span class="ruby-ivar">@respondent_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_processing_fee</span>
517:       <span class="ruby-keyword kw">end</span>
518:     <span class="ruby-keyword kw">end</span>
519:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000601" class="method-detail">
        <a name="M000601"></a>

        <div class="method-heading">
          <a href="#M000601" class="method-signature">
          <span class="method-name">establishment</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000601-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000601-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 370</span>
370:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment</span>
371:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
372:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
373:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
374:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
375:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
376:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
377:         <span class="ruby-keyword kw">end</span>
378:         <span class="ruby-identifier">add_2</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0002</span>()
379:         <span class="ruby-comment cmt">#### 华南仲裁委个性化</span>
380:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0005'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span>
381:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN D&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
382:         <span class="ruby-keyword kw">else</span>
383:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
384:         <span class="ruby-keyword kw">end</span>
385:         <span class="ruby-comment cmt">####</span>
386:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0003</span>()
387:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
388:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
389: 
390: <span class="ruby-comment cmt">#        c.limit_dat=Workday.after_day(SysArg.find_by_code('1000').val.to_i)</span>
391: <span class="ruby-comment cmt">#        c.finally_limit_dat=c.limit_dat</span>
392: 
393:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
394:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
395:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已立案&quot;</span>
396:         <span class="ruby-keyword kw">else</span>
397:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件立案立案失败，如有问题请与软件供应商联系&quot;</span>
398:         <span class="ruby-keyword kw">end</span>
399:       <span class="ruby-keyword kw">end</span>
400:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
401:     <span class="ruby-keyword kw">else</span>
402:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
403:     <span class="ruby-keyword kw">end</span>
404:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000602" class="method-detail">
        <a name="M000602"></a>

        <div class="method-heading">
          <a href="#M000602" class="method-signature">
          <span class="method-name">establishment_no</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000602-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000602-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 406</span>
406:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment_no</span>
407:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
408:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
409:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
410:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
411:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
412:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
413:         <span class="ruby-keyword kw">end</span>
414:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
415:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
416:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
417:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
418:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已设置为不受理&quot;</span>
419:         <span class="ruby-keyword kw">else</span>
420:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件不受理，操作失败，如有问题请与软件供应商联系&quot;</span>
421:         <span class="ruby-keyword kw">end</span>
422:       <span class="ruby-keyword kw">end</span>
423:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
424: 
425:     <span class="ruby-keyword kw">else</span>
426:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
427:     <span class="ruby-keyword kw">end</span>
428:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000617" class="method-detail">
        <a name="M000617"></a>

        <div class="method-heading">
          <a href="#M000617" class="method-signature">
          <span class="method-name">file_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000617-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000617-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 740</span>
740:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_create</span>
741:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:file</span>])
742:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
743:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0005&quot;</span>
744:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
745:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
746:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
747:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
748:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
749:     <span class="ruby-keyword kw">else</span>
750:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
751:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;file_new&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
752:     <span class="ruby-keyword kw">end</span>
753:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000620" class="method-detail">
        <a name="M000620"></a>

        <div class="method-heading">
          <a href="#M000620" class="method-signature">
          <span class="method-name">file_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000620-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000620-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 772</span>
772:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_delete</span>
773:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
774:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
775:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
776:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
777:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
778:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span>
779:         <span class="ruby-ivar">@yea</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
780:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{file.recevice_code}/#{file.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
781:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{file.recevice_code}/#{file.book_name}&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
782:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_u</span>    = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
783:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_dat</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
784:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-value str">&quot;&quot;</span>
785:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
786:         <span class="ruby-keyword kw">end</span>
787:       <span class="ruby-keyword kw">end</span>
788: 
789:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
790:     <span class="ruby-keyword kw">else</span>
791:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
792:     <span class="ruby-keyword kw">end</span>
793:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
794:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000624" class="method-detail">
        <a name="M000624"></a>

        <div class="method-heading">
          <a href="#M000624" class="method-signature">
          <span class="method-name">file_destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000624-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000624-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 851</span>
851:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_destroy</span>
852:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
853:     <span class="ruby-ivar">@yea</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
854:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
855:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-value">1</span>
856:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_u</span>    = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
857:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_dat</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
858:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-value str">&quot;&quot;</span>
859:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">save</span>
860:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除成功&quot;</span>
861:     <span class="ruby-keyword kw">else</span>
862:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除失败&quot;</span>
863:     <span class="ruby-keyword kw">end</span>
864:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
865:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000623" class="method-detail">
        <a name="M000623"></a>

        <div class="method-heading">
          <a href="#M000623" class="method-signature">
          <span class="method-name">file_down</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000623-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000623-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 845</span>
845:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_down</span>
846:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
847:     <span class="ruby-ivar">@yea</span> = <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
848:     <span class="ruby-identifier">send_file</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>)
849:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000618" class="method-detail">
        <a name="M000618"></a>

        <div class="method-heading">
          <a href="#M000618" class="method-signature">
          <span class="method-name">file_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000618-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000618-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 755</span>
755:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_edit</span>
756:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
757:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000615" class="method-detail">
        <a name="M000615"></a>

        <div class="method-heading">
          <a href="#M000615" class="method-signature">
          <span class="method-name">file_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
合同文件上传下载
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000615-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000615-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 731</span>
731:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_list</span>
732:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and typ='0005' and used='Y'&quot;</span>
733:     <span class="ruby-ivar">@contract</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
734:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000616" class="method-detail">
        <a name="M000616"></a>

        <div class="method-heading">
          <a href="#M000616" class="method-signature">
          <span class="method-name">file_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000616-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000616-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 736</span>
736:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_new</span>
737:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>()
738:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000619" class="method-detail">
        <a name="M000619"></a>

        <div class="method-heading">
          <a href="#M000619" class="method-signature">
          <span class="method-name">file_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000619-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000619-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 759</span>
759:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_update</span>
760:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
761:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
762:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
763:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:file</span>])
764:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
765:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
766:     <span class="ruby-keyword kw">else</span>
767:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
768:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;fiel_edit&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
769:     <span class="ruby-keyword kw">end</span>
770:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000621" class="method-detail">
        <a name="M000621"></a>

        <div class="method-heading">
          <a href="#M000621" class="method-signature">
          <span class="method-name">file_upload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000621-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000621-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 796</span>
796:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_upload</span>
797:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
798:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000622" class="method-detail">
        <a name="M000622"></a>

        <div class="method-heading">
          <a href="#M000622" class="method-signature">
          <span class="method-name">file_upload_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000622-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000622-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 800</span>
800:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_upload_do</span>
801:     <span class="ruby-ivar">@file</span>    = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
802:     <span class="ruby-ivar">@case</span>   = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@file</span>.<span class="ruby-identifier">recevice_code</span>)
803:     <span class="ruby-comment cmt">#########################################</span>
804:     <span class="ruby-ivar">@yea</span>          = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
805:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_u</span>   = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
806:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_dat</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
807:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>].<span class="ruby-identifier">blank?</span>
808:       <span class="ruby-identifier">f_name</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>].<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">last</span>
809:     <span class="ruby-keyword kw">end</span>
810:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-node">&quot;#{@file.typ}_#{@file.recevice_code}_contractfile_#{@file.id}.#{f_name}&quot;</span>
811: 
812:     <span class="ruby-identifier">utf8_to_gbk</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'gbk'</span>,<span class="ruby-value str">'utf-8'</span>)
813:     <span class="ruby-identifier">gbk_to_utf8</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)
814: 
815:     <span class="ruby-identifier">file</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>]   <span class="ruby-comment cmt">#获取文档，此处为tempfile类型的</span>
816:     <span class="ruby-comment cmt">#设置文档保存的路径，自由设置</span>
817:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs&quot;</span>)
818:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/&quot;</span>)
819:     <span class="ruby-keyword kw">end</span>
820:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
821:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
822:     <span class="ruby-keyword kw">end</span>
823:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}&quot;</span>)
824:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}&quot;</span>)
825:     <span class="ruby-keyword kw">end</span>
826:     <span class="ruby-comment cmt">#读取文档的内容，目前不用编码转换即可正常显示，在存入数据库中时或许涉及到编码转换</span>
827:     <span class="ruby-keyword kw">begin</span>
828:       <span class="ruby-identifier">content</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>  <span class="ruby-comment cmt">#gbk_to_utf8.iconv</span>
829:       <span class="ruby-comment cmt">#新建同名文件，读取修改的文件内容用以覆盖源文件，注意路径要与读取的一致</span>
830:       <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
831:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">content</span>)
832:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
833:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">empty?</span>
834:         <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">save</span>
835:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传成功&quot;</span>
836:       <span class="ruby-keyword kw">else</span>
837:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败&quot;</span>
838:       <span class="ruby-keyword kw">end</span>
839:     <span class="ruby-keyword kw">rescue</span>
840:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败！&quot;</span>
841:     <span class="ruby-keyword kw">end</span>
842:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
843:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000581" class="method-detail">
        <a name="M000581"></a>

        <div class="method-heading">
          <a href="#M000581" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000581-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000581-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 75</span>
75:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
76:     <span class="ruby-ivar">@typ</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:typ</span>]
77:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
78:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
79:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'1'</span>
80:         <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id desc&quot;</span>
81:       <span class="ruby-keyword kw">else</span>
82:         <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;recevice_code desc&quot;</span>
83:       <span class="ruby-keyword kw">end</span>
84:     <span class="ruby-keyword kw">end</span>
85:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
86:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
87:       <span class="ruby-ivar">@page_lines</span>=<span class="ruby-value">100000000</span>
88:     <span class="ruby-keyword kw">end</span>
89:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@typ</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
90:       <span class="ruby-ivar">@case</span>=<span class="ruby-keyword kw">nil</span>
91:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'1'</span>
92:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from tb_cases where u='#{session[:user_code_2]}' and used='Y' and state=1 and recevice_code_limit_dat&gt;='#{Date.today}'  order by id desc limit 1&quot;</span>)
93:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'2'</span>
94:       <span class="ruby-ivar">@case</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
95:     <span class="ruby-keyword kw">end</span>
96:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000582" class="method-detail">
        <a name="M000582"></a>

        <div class="method-heading">
          <a href="#M000582" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000582-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000582-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 97</span>
 97:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
 98:     <span class="ruby-ivar">@t_typ</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
 99:     <span class="ruby-ivar">@typ1</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
100:     <span class="ruby-identifier">oopp</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val&quot;</span>)
101:     <span class="ruby-ivar">@typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{oopp.data_val}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
102: 
103:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>()
104:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>()
105:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">apply_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>]
106:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">casereason</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_casereason</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_casereason</span>]
107:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_remark</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_remark</span>]
108:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000604" class="method-detail">
        <a name="M000604"></a>

        <div class="method-heading">
          <a href="#M000604" class="method-signature">
          <span class="method-name">new_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000604-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000604-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 521</span>
521:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_amount</span>
522:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>()
523:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
524:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">currency</span>=<span class="ruby-value str">'0001'</span>
525:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">f_money</span>=<span class="ruby-value">0</span>
526:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rate</span>=<span class="ruby-value">1</span>
527:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span>=<span class="ruby-value">0</span>
528:     <span class="ruby-ivar">@respondent</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(
529:       <span class="ruby-identifier">:all</span>,
530:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and partytype=2 and recevice_code='#{params[:recevice_code]}'&quot;</span>,
531:       <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id&quot;</span>,
532:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id,partyname&quot;</span>
533:     ).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span>]}.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,[<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>])
534:     <span class="ruby-comment cmt"># 当 @respondent.size 的值大于二的时候，说明有多个被申请人，此时才可以为多个被申请人录入各自的反请求争议金额</span>
535:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000577" class="method-detail">
        <a name="M000577"></a>

        <div class="method-heading">
          <a href="#M000577" class="method-signature">
          <span class="method-name">p_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面 Ajax 调用该方法查询当事人信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000577-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000577-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 26</span>
26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_list</span>
27:     <span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partyname</span>]
28:     <span class="ruby-identifier">cov</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
29:     <span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">cov</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">partyname</span>)
30:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">partyname</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
31:       <span class="ruby-identifier">p_case</span> = <span class="ruby-constant">VParty</span>.<span class="ruby-identifier">find_by_sql</span>(
32:         <span class="ruby-node">&quot; select distinct partyname,recevice_code,case_code,nowdate,end_code,caseendbook_id_last,clerk,mobiletel,area,tel
33:           from  v_parties
34:           where partyname like '%#{partyname}%' order by tel desc&quot;</span>
35:       )
36:     <span class="ruby-keyword kw">else</span>
37:       <span class="ruby-identifier">p_case</span> = <span class="ruby-keyword kw">nil</span>
38:     <span class="ruby-keyword kw">end</span>
39: 
40:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
41:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'p_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'p_l'</span>, <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p_case</span>
42:     <span class="ruby-keyword kw">end</span>
43:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000574" class="method-detail">
        <a name="M000574"></a>

        <div class="method-heading">
          <a href="#M000574" class="method-signature">
          <span class="method-name">p_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000574-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000574-source">
<pre>
   <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 3</span>
3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set</span>
4:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{params[:p_typ]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>)
5:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
6:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_casetype_num2'</span>
7:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
8:     <span class="ruby-keyword kw">end</span>
9:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000575" class="method-detail">
        <a name="M000575"></a>

        <div class="method-heading">
          <a href="#M000575" class="method-signature">
          <span class="method-name">p_set_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000575-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000575-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 10</span>
10:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set_2</span>
11:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select data_val,data_text from tb_dictionaries where used='Y' and state='Y' and typ_code = '0001' and data_val in (select app_code from charge_fun_detail where role_code=?  and used='Y')  order by ind,data_val&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_typ</span>]])
12:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
13:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_aribitprog_num'</span>
14:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set_2'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv_2'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
15:     <span class="ruby-keyword kw">end</span>
16:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000589" class="method-detail">
        <a name="M000589"></a>

        <div class="method-heading">
          <a href="#M000589" class="method-signature">
          <span class="method-name">party_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000589-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000589-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_create</span>
223:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
224:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
225:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
226:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
227:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
228:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
229:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
230:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
231:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
232:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
233:     <span class="ruby-keyword kw">else</span>
234:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
235:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
236:     <span class="ruby-keyword kw">end</span>
237:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000592" class="method-detail">
        <a name="M000592"></a>

        <div class="method-heading">
          <a href="#M000592" class="method-signature">
          <span class="method-name">party_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000592-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000592-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 260</span>
260:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_delete</span>
261:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
262:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
263:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
264:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
265:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
266: 
267:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
268:     <span class="ruby-keyword kw">else</span>
269:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
270:     <span class="ruby-keyword kw">end</span>
271:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
272:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000590" class="method-detail">
        <a name="M000590"></a>

        <div class="method-heading">
          <a href="#M000590" class="method-signature">
          <span class="method-name">party_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000590-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000590-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 239</span>
239:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_edit</span>
240:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
241:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000587" class="method-detail">
        <a name="M000587"></a>

        <div class="method-heading">
          <a href="#M000587" class="method-signature">
          <span class="method-name">party_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000587-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000587-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_list</span>
206:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value str">&quot;1&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value str">&quot;2&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
207:     <span class="ruby-ivar">@isperson</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;是&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;否&quot;</span>}
208:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
209:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
210:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
211:     <span class="ruby-keyword kw">end</span>
212:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
213:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
214:       <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
215:     <span class="ruby-keyword kw">end</span>
216:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000588" class="method-detail">
        <a name="M000588"></a>

        <div class="method-heading">
          <a href="#M000588" class="method-signature">
          <span class="method-name">party_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000588-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000588-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 218</span>
218:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_new</span>
219:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>()
220:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000576" class="method-detail">
        <a name="M000576"></a>

        <div class="method-heading">
          <a href="#M000576" class="method-signature">
          <span class="method-name">party_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000576-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000576-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 17</span>
17:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_set</span>
18:     <span class="ruby-identifier">party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;partytype=#{params[:partytype]} and used='Y' and recevice_code='#{params[:recevice_code]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'partyname'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;partyname,id&quot;</span>)
19:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
20:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'agent_party_id'</span>
21:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'party_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'par'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">party</span>
22:     <span class="ruby-keyword kw">end</span>
23:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000591" class="method-detail">
        <a name="M000591"></a>

        <div class="method-heading">
          <a href="#M000591" class="method-signature">
          <span class="method-name">party_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000591-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000591-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 243</span>
243:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_update</span>
244:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
245:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
246:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
247:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
248:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
249:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
250:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
251:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
252:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
253:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
254:     <span class="ruby-keyword kw">else</span>
255:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
256:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
257:     <span class="ruby-keyword kw">end</span>
258:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000579" class="method-detail">
        <a name="M000579"></a>

        <div class="method-heading">
          <a href="#M000579" class="method-signature">
          <span class="method-name">rate_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000579-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000579-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 56</span>
56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rate_set</span>
57:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
58:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'amount_rate'</span>
59:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'rate_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rate'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Money</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:money_code</span>]).<span class="ruby-identifier">rate</span>
60:     <span class="ruby-keyword kw">end</span>
61:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000578" class="method-detail">
        <a name="M000578"></a>

        <div class="method-heading">
          <a href="#M000578" class="method-signature">
          <span class="method-name">select_with_ajax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面Ajax调用该方法获得行业小分类信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000578-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000578-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_with_ajax</span>
47:     <span class="ruby-identifier">profession_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:profession_id</span>]
48:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">profession_id</span>.<span class="ruby-identifier">blank?</span>
49:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='000dd'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
50:     <span class="ruby-keyword kw">else</span>
51:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='#{profession_id}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
52:     <span class="ruby-keyword kw">end</span>
53:     <span class="ruby-identifier">render</span>
54:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000585" class="method-detail">
        <a name="M000585"></a>

        <div class="method-heading">
          <a href="#M000585" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000585-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000585-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 176</span>
176:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
177:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
178:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
179:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
180:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
181:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
182:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
183:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
184:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'1'</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
185:     <span class="ruby-keyword kw">else</span>
186:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
187:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
188:     <span class="ruby-keyword kw">end</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000607" class="method-detail">
        <a name="M000607"></a>

        <div class="method-heading">
          <a href="#M000607" class="method-signature">
          <span class="method-name">update_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000607-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000607-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation3_controller.rb, line 613</span>
613:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_amount</span>
614:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
615:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code_2</span>]
616:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
617:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
618:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
619:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
620:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
621:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
622:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
623:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
624:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
625:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
626:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
627:       <span class="ruby-keyword kw">else</span>
628:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
629:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
630:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
631:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
632:       <span class="ruby-keyword kw">end</span>
633:     <span class="ruby-keyword kw">else</span>
634:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
635:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
636:         <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
637:         <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
638:     <span class="ruby-keyword kw">end</span>
639: 
640:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>