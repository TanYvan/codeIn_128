<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseCopy</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseCopy</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/case_copy_rb.html">
                app/controllers/case_copy.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
To change this template, choose Tools | Templates and open the template in
the editor.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001734">copy</a>&nbsp;&nbsp;
      <a href="#M001733">new</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Class methods</h3>

      <div id="method-M001733" class="method-detail">
        <a name="M001733"></a>

        <div class="method-heading">
          <a href="#M001733" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001733-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001733-source">
<pre>
   <span class="ruby-comment cmt"># File app/controllers/case_copy.rb, line 5</span>
5:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>
6:     
7:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001734" class="method-detail">
        <a name="M001734"></a>

        <div class="method-heading">
          <a href="#M001734" class="method-signature">
          <span class="method-name">copy</span><span class="method-args">(code_old,code_new,user_code)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001734-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001734-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_copy.rb, line 9</span>
  9:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">copy</span>(<span class="ruby-identifier">code_old</span>,<span class="ruby-identifier">code_new</span>,<span class="ruby-identifier">user_code</span>)
 10:       <span class="ruby-identifier">pt</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>
 11:       <span class="ruby-ivar">@case_old</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">code_old</span>)
 12:       <span class="ruby-ivar">@case_new</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>
 13:       <span class="ruby-identifier">pt</span>.<span class="ruby-identifier">put_to</span>(<span class="ruby-ivar">@case_old</span>, <span class="ruby-ivar">@case_new</span>)
 14:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">code_new</span>
 15:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">clerk_2</span> = <span class="ruby-identifier">user_code</span>
 16:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">clerk</span> = <span class="ruby-value str">&quot;&quot;</span>
 17:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">state</span> = <span class="ruby-value">1</span>
 18:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">general_code</span> = <span class="ruby-value str">&quot;&quot;</span>
 19:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">case_code</span> = <span class="ruby-value str">&quot;&quot;</span>
 20:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">end_code</span> = <span class="ruby-value str">&quot;&quot;</span>
 21:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">remun_state</span> = <span class="ruby-value str">&quot;N&quot;</span>
 22:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">trial_typ</span> = <span class="ruby-keyword kw">nil</span>
 23:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">amount</span> = <span class="ruby-value">0</span>
 24:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">amount_1</span> = <span class="ruby-value">0</span>
 25:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">amount_2</span> = <span class="ruby-value">0</span>
 26:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_rmb_money</span> = <span class="ruby-value">0</span>
 27:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_re_rmb_money</span> = <span class="ruby-value">0</span>
 28:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_lack_rmb_money</span> = <span class="ruby-value">0</span>
 29:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_rmb_money_2</span> = <span class="ruby-value">0</span>
 30:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_re_rmb_money_2</span> = <span class="ruby-value">0</span>
 31:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">m_lack_rmb_money_2</span> = <span class="ruby-value">0</span>
 32:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">nowdate</span> = <span class="ruby-keyword kw">nil</span>
 33:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">nowdate_t</span> = <span class="ruby-keyword kw">nil</span>
 34:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">limit_dat</span> = <span class="ruby-keyword kw">nil</span>
 35:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">finally_limit_dat</span> = <span class="ruby-keyword kw">nil</span>
 36:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">limit_deduct_t</span> = <span class="ruby-keyword kw">nil</span>
 37:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">limit_deduct_text</span> = <span class="ruby-keyword kw">nil</span>
 38:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-keyword kw">nil</span>
 39:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">end_u</span> = <span class="ruby-keyword kw">nil</span>
 40:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">end_t</span> = <span class="ruby-keyword kw">nil</span>
 41:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">re_code</span> = <span class="ruby-keyword kw">nil</span>
 42:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_submit_remark</span> = <span class="ruby-keyword kw">nil</span>
 43:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_submit_u</span> = <span class="ruby-keyword kw">nil</span>
 44:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_submit_t</span> = <span class="ruby-keyword kw">nil</span>
 45:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_up_u</span> = <span class="ruby-keyword kw">nil</span>
 46:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_up_t</span> = <span class="ruby-keyword kw">nil</span>
 47:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">runstyle</span> = <span class="ruby-keyword kw">nil</span>
 48:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">runremark</span> = <span class="ruby-keyword kw">nil</span>
 49:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">isback</span> = <span class="ruby-keyword kw">nil</span>
 50:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">book_num</span> = <span class="ruby-value">0</span>
 51:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">caseorg_id_first</span> = <span class="ruby-keyword kw">nil</span>
 52:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">caseorg_id_last</span> = <span class="ruby-keyword kw">nil</span>
 53:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">sitting_id_first</span> = <span class="ruby-keyword kw">nil</span>
 54:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">sitting_id_last</span> = <span class="ruby-keyword kw">nil</span>
 55:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">caseendbook_id_first</span> = <span class="ruby-keyword kw">nil</span>
 56:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">caseendbook_id_last</span> = <span class="ruby-keyword kw">nil</span>
 57:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_arbitBookNum</span> = <span class="ruby-keyword kw">nil</span>
 58:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_num_1</span> = <span class="ruby-keyword kw">nil</span>
 59:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_num_2</span> = <span class="ruby-keyword kw">nil</span>
 60:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_typ</span> = <span class="ruby-keyword kw">nil</span>
 61:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_receive_u</span> = <span class="ruby-keyword kw">nil</span>
 62:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_receive_t</span> = <span class="ruby-keyword kw">nil</span>
 63:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">file_num_3</span> = <span class="ruby-keyword kw">nil</span>
 64:       <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">save</span>
 65: 
 66:       <span class="ruby-comment cmt">#如果创建成功，系统自动为申请人和被申请人分别创建案件应收费“当事人多交费用”，金额是 0</span>
 67:       <span class="ruby-ivar">@should1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
 68:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">recevice_code</span>
 69:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">case_code</span>
 70:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">general_code</span>
 71:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
 72:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0001&quot;</span>
 73:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
 74:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
 75:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
 76:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
 77:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
 78:       <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">save</span>
 79: 
 80:       <span class="ruby-ivar">@should2</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
 81:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">recevice_code</span>
 82:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">case_code</span>
 83:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case_new</span>.<span class="ruby-identifier">general_code</span>
 84:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
 85:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0002&quot;</span>
 86:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
 87:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
 88:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
 89:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
 90:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
 91:       <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">save</span>
 92: 
 93:       <span class="ruby-ivar">@pary_old</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y'&quot;</span>,<span class="ruby-identifier">code_old</span>], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
 94:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@pary_old</span>
 95:         <span class="ruby-identifier">party_new</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>
 96:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span>
 97:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">partytype</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">partytype</span>
 98:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">isperson</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">isperson</span>
 99:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">commissary</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">commissary</span>
100:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">dutyname</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">dutyname</span>
101:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">post_tel_code</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">post_tel_code</span>
102:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">postcode</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">postcode</span>
103:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">profession</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">profession</span>
104:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">subprofession</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">subprofession</span>
105:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">area</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">area</span>
106:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">addr</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">addr</span>
107:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">email</span>
108:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">mobiletel</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">mobiletel</span>
109:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">tel</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">tel</span>
110:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">code_new</span>
111:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">used</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">used</span>
112:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">user_code</span>
113:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
114:         <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">save</span>
115:         <span class="ruby-ivar">@agent_old</span> = <span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and  party_id=? and used='Y'&quot;</span>,<span class="ruby-identifier">code_old</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span>], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
116:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">a</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@agent_old</span>
117:           <span class="ruby-identifier">agent_new</span> = <span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>
118:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">party_id</span> = <span class="ruby-identifier">party_new</span>.<span class="ruby-identifier">id</span>
119:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">name</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">name</span>
120:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">status</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">status</span>
121:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">duty</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">duty</span>
122:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">postcode</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">postcode</span>
123:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">company</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">company</span>
124:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">addr</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">addr</span>
125:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">email</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">email</span>
126:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">mobiletel</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">mobiletel</span>
127:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">tel</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">tel</span>
128:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">post_tel_code</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">post_tel_code</span>
129:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">partytype</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">partytype</span>
130:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">code_new</span>
131:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;Y&quot;</span>
132:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">user_code</span>
133:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
134:           <span class="ruby-identifier">agent_new</span>.<span class="ruby-identifier">save</span>
135:         <span class="ruby-keyword kw">end</span>
136:       <span class="ruby-keyword kw">end</span>
137:       <span class="ruby-ivar">@con</span> = <span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y'&quot;</span>,<span class="ruby-identifier">code_old</span>], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
138:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@con</span>
139:         <span class="ruby-identifier">contra_new</span> = <span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>
140:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">code_new</span>
141:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">contractdate</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">contractdate</span>
142:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">pactname</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">pactname</span>
143:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">note</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">contractdate</span>
144:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;Y&quot;</span>
145:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">user_code</span>
146:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
147:         <span class="ruby-identifier">contra_new</span>.<span class="ruby-identifier">save</span>
148:       <span class="ruby-keyword kw">end</span>
149: 
150:       <span class="ruby-ivar">@case_book</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and typ='0005' and used='Y'&quot;</span>, <span class="ruby-identifier">code_old</span>], <span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
151:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case_book</span>
152:         <span class="ruby-identifier">f_name</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">last</span>
153:         <span class="ruby-identifier">book_new</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>
154:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;Y&quot;</span>
155:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">code_new</span>
156:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">p_id</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">p_id</span>
157:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_typ</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_typ</span>
158:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">typ</span>
159:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_code</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_code</span>
160:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">title</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">title</span>
161:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">remarks</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">remarks</span>
162:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_name</span>
163:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_u</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_u</span>
164:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_dat</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">book_dat</span>
165:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">state</span>
166:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">user_code</span>
167:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
168:         <span class="ruby-identifier">book_id</span> = <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">save</span>
169:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-node">&quot;#{book_new.typ}_#{book_new.recevice_code}_contractfile_#{book_id}.#{f_name}&quot;</span>
170:         <span class="ruby-identifier">book_new</span>.<span class="ruby-identifier">save</span>
171: 
172:         <span class="ruby-identifier">path_old</span> = <span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{b.recevice_code.slice(0,4)}/#{b.recevice_code}/#{b.book_name}&quot;</span>
173:         <span class="ruby-identifier">path_new</span> = <span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{book_new.recevice_code.slice(0,4)}/#{book_new.recevice_code}/#{book_new.book_name}&quot;</span>
174:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs&quot;</span>)
175:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/&quot;</span>)
176:         <span class="ruby-keyword kw">end</span>
177:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{book_new.recevice_code.slice(0,4)}&quot;</span>)
178:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{book_new.recevice_code.slice(0,4)}&quot;</span>)
179:         <span class="ruby-keyword kw">end</span>
180:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{book_new.recevice_code.slice(0,4)}/#{book_new.recevice_code}&quot;</span>)
181:           <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{book_new.recevice_code.slice(0,4)}/#{book_new.recevice_code}&quot;</span>)
182:         <span class="ruby-keyword kw">end</span>
183:         <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">copy_file</span>(<span class="ruby-identifier">path_old</span>, <span class="ruby-identifier">path_new</span>)
184:         
185:       <span class="ruby-keyword kw">end</span>
186: 
187:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>