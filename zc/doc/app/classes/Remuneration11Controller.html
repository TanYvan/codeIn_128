<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Remuneration11Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Remuneration11Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/remuneration11_controller_rb.html">
                app/controllers/remuneration11_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
新的仲裁员报酬
助理录入裁决书制作信息、绩效信息，由处长对此做评级，评级的同时自动计算相应的报酬。
录入或者删除裁决书制作信息和绩效信息的同时需要修改
tb_bonus_penalties 对应的记录
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001517">create_1</a>&nbsp;&nbsp;
      <a href="#M001518">create_1_all</a>&nbsp;&nbsp;
      <a href="#M001524">create_2</a>&nbsp;&nbsp;
      <a href="#M001521">delete_1</a>&nbsp;&nbsp;
      <a href="#M001527">delete_2</a>&nbsp;&nbsp;
      <a href="#M001519">edit_1</a>&nbsp;&nbsp;
      <a href="#M001525">edit_2</a>&nbsp;&nbsp;
      <a href="#M001514">list</a>&nbsp;&nbsp;
      <a href="#M001515">list_1</a>&nbsp;&nbsp;
      <a href="#M001522">list_2</a>&nbsp;&nbsp;
      <a href="#M001516">new_1</a>&nbsp;&nbsp;
      <a href="#M001523">new_2</a>&nbsp;&nbsp;
      <a href="#M001520">update_1</a>&nbsp;&nbsp;
      <a href="#M001526">update_2</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001517" class="method-detail">
        <a name="M001517"></a>

        <div class="method-heading">
          <a href="#M001517" class="method-signature">
          <span class="method-name">create_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 创建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001517-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001517-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 31</span>
31:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_1</span>
32:     <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
33:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and typ='0001'
34:                       and p='#{params[:remun][:p_code]}' and used='Y' and extend_code&lt;&gt;''&quot;</span>
35:     ) <span class="ruby-comment cmt"># 当前案件session[:recevice_code_1] 当前仲裁员params[:remun][:p_code] 且 已经发放</span>
36: 
37:     <span class="ruby-comment cmt"># 不可以录入相同的记录</span>
38:     <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>]])
39:     <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>]])
40: 
41:     <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
42:       <span class="ruby-identifier">:all</span>,
43:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code_1]}'&quot;</span>,
44:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
45:     ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
46: 
47:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
48:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,与现有记录重复！&quot;</span>
49:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
50:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
51:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,该裁决书制作者另有他人！&quot;</span>
52:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
53:     <span class="ruby-keyword kw">else</span>
54:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># 该仲裁员报酬未发放  如果报酬已经发放则不可以创建</span>
55:         <span class="ruby-ivar">@remun</span>               = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
56:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
57:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
58:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
59:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">'0001'</span>
60:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
61:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
62:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
63:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
64:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
65:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
66:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
67:         <span class="ruby-keyword kw">else</span>
68:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
69:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
70:         <span class="ruby-keyword kw">end</span>
71:       <span class="ruby-keyword kw">else</span>
72:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;本案件中该仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;如果有继续发放报酬的需求，请通过报酬奖励方式进行（报酬奖励模块大概在处长操作中）。&quot;</span>
73:       <span class="ruby-keyword kw">end</span>
74:     <span class="ruby-keyword kw">end</span> 
75:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001518" class="method-detail">
        <a name="M001518"></a>

        <div class="method-heading">
          <a href="#M001518" class="method-signature">
          <span class="method-name">create_1_all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 批量创建
从裁决书报校核信息读取裁决书制作信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001518-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001518-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 78</span>
 78:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_1_all</span>
 79:     <span class="ruby-identifier">notice</span> = <span class="ruby-value str">&quot;&quot;</span>
 80:     <span class="ruby-comment cmt"># 查找所有的校核信息</span>
 81:     <span class="ruby-identifier">award</span> = <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>)
 82:     <span class="ruby-identifier">awarddetail</span> = <span class="ruby-keyword kw">nil</span>
 83:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">award</span>.<span class="ruby-identifier">blank?</span>
 84:       <span class="ruby-identifier">awarddetail</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 85:         <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'typ,draftsman_typ,draftsman'</span>,
 86:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and (typ='0002' or typ='0003' or typ='0005') &quot;</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
 87:       )
 88:     <span class="ruby-keyword kw">end</span>
 89:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 90:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;无法根据校核信息创建，请手工创建！&quot;</span>
 91:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
 92:     <span class="ruby-keyword kw">else</span>
 93:       <span class="ruby-identifier">type</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9022' and data_val&lt;&gt;'0000' and used='y'&quot;</span>) <span class="ruby-comment cmt"># 裁决书类型</span>
 94:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
 95:         <span class="ruby-identifier">:all</span>,
 96:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code]}'&quot;</span>,
 97:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
 98:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>; <span class="ruby-identifier">k</span>} <span class="ruby-comment cmt"># 仲裁员类型</span>
 99: 
100:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">t</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">type</span>
101:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
102:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0002&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
103:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0005&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
104:         <span class="ruby-identifier">ad</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
105:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and typ='#{typ}'&quot;</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
106:         )
107:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ad</span>.<span class="ruby-identifier">blank?</span>
108:           <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(
109:             <span class="ruby-identifier">:first</span>,
110:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and typ='0001'
111:                             and p='#{ad.draftsman}' and used='Y' and extend_code&lt;&gt;''&quot;</span>
112:           )
113:           <span class="ruby-comment cmt"># 不可以录入相同的记录</span>
114:           <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>,<span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>])
115:           <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>])
116: 
117:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
118:             <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;与现有记录重复；&lt;br/&gt;&quot;</span>
119:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
120:             <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;该裁决书制作者另有他人；&lt;br/&gt;&quot;</span>
121:           <span class="ruby-keyword kw">else</span>
122:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># 如果已经录入了金额或者已经发放则不可以修改</span>
123:               <span class="ruby-identifier">remun</span>               = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>
124:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span>          =  <span class="ruby-value str">'Y'</span>
125:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
126:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
127:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
128:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">'0001'</span>
129:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>
130:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>        = <span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>
131:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>]
132:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">remark</span>        = <span class="ruby-value str">&quot;&quot;</span>
133:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
134:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
135:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">save</span>()
136:                 <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>)
137:               <span class="ruby-keyword kw">end</span>
138:             <span class="ruby-keyword kw">else</span>
139:               <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;&quot;</span>
140:             <span class="ruby-keyword kw">end</span>
141:           <span class="ruby-keyword kw">end</span>
142:         <span class="ruby-keyword kw">end</span>
143:       <span class="ruby-keyword kw">end</span>
144:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-identifier">notice</span>.<span class="ruby-identifier">blank?</span><span class="ruby-value">? </span><span class="ruby-value str">&quot;创建完成！&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;由于以下原因，创建失败，请手工创建：&lt;br/&gt;&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">notice</span>
145:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
146:     <span class="ruby-keyword kw">end</span>
147:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001524" class="method-detail">
        <a name="M001524"></a>

        <div class="method-heading">
          <a href="#M001524" class="method-signature">
          <span class="method-name">create_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 创建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001524-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001524-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 236</span>
236:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_2</span>
237:     <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(
238:       <span class="ruby-identifier">:first</span>,
239:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and
240:                       typ='0001' and p='#{params[:remun][:p_code]}' and
241:                       used='Y' and extend_code&lt;&gt;''&quot;</span>
242:     )
243:     
244:     <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
245:       <span class="ruby-identifier">:all</span>,
246:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code]}'&quot;</span>,
247:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
248:     ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
249: 
250:     <span class="ruby-identifier">rem</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]])
251:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
252:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,请勿重复录入！&quot;</span>
253:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_2&quot;</span>
254:     <span class="ruby-keyword kw">else</span>
255:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
256:         <span class="ruby-ivar">@remun</span>               = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
257:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
258:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
259:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
260:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">&quot;0001&quot;</span>
261:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
262:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
263:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
264:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
265:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>,  <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
266:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
267:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
268:         <span class="ruby-keyword kw">else</span>
269:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
270:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_2&quot;</span>
271:         <span class="ruby-keyword kw">end</span>
272:       <span class="ruby-keyword kw">else</span>
273:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;本案件中该仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;如果有继续发放报酬的需求，请通过报酬奖励方式进行（报酬奖励模块大概在处长操作中）。&quot;</span>
274:       <span class="ruby-keyword kw">end</span>
275:     <span class="ruby-keyword kw">end</span>
276:     
277:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001521" class="method-detail">
        <a name="M001521"></a>

        <div class="method-heading">
          <a href="#M001521" class="method-signature">
          <span class="method-name">delete_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001521-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001521-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 192</span>
192:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_1</span>
193:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
194:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span><span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
195:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
196:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
197:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
198:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>)
199:         <span class="ruby-comment cmt"># 删除的时候应当使用 del_set 方法，这样才可以将 view_mun 的值减 1 </span>
200:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;gc_rmb&quot;</span>,<span class="ruby-value">0</span>)
201:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
202:       <span class="ruby-keyword kw">else</span>
203:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
204:       <span class="ruby-keyword kw">end</span>
205:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list_1&quot;</span>
206:     <span class="ruby-keyword kw">end</span>
207:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001527" class="method-detail">
        <a name="M001527"></a>

        <div class="method-heading">
          <a href="#M001527" class="method-signature">
          <span class="method-name">delete_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001527-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001527-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 307</span>
307:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_2</span>
308:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
309:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
310:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
311:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>   = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
312:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>   = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
313:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
314:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>, <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;zc_rmb&quot;</span>,<span class="ruby-value">0</span>)
315:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
316:       <span class="ruby-keyword kw">else</span>
317:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除失败&quot;</span>
318:       <span class="ruby-keyword kw">end</span>
319:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
320:     <span class="ruby-keyword kw">end</span>
321:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001519" class="method-detail">
        <a name="M001519"></a>

        <div class="method-heading">
          <a href="#M001519" class="method-signature">
          <span class="method-name">edit_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 修改
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001519-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001519-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 150</span>
150:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_1</span>
151:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
152:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001525" class="method-detail">
        <a name="M001525"></a>

        <div class="method-heading">
          <a href="#M001525" class="method-signature">
          <span class="method-name">edit_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 修改
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001525-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001525-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 280</span>
280:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_2</span>
281:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
282:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001514" class="method-detail">
        <a name="M001514"></a>

        <div class="method-heading">
          <a href="#M001514" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001514-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001514-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 6</span>
 6:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 7:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
 8:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 9:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
10:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
11:     <span class="ruby-keyword kw">end</span>
12:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001515" class="method-detail">
        <a name="M001515"></a>

        <div class="method-heading">
          <a href="#M001515" class="method-signature">
          <span class="method-name">list_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001515-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001515-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 15</span>
15:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_1</span>
16:     <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span> <span class="ruby-comment cmt"># 设置flash信息只在当前action有效，不带入到下个action</span>
17:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
18:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
19:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>])
20:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>
21:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
22:     <span class="ruby-keyword kw">end</span>
23:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001522" class="method-detail">
        <a name="M001522"></a>

        <div class="method-heading">
          <a href="#M001522" class="method-signature">
          <span class="method-name">list_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001522-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001522-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 212</span>
212:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2</span>
213:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
214:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
215:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>])
216:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>
217:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
218:     <span class="ruby-keyword kw">end</span>
219:     <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(
220:       <span class="ruby-node">&quot;select tb_arbitmen.code as code ,tb_arbitmen.name as name
221:        from tb_casearbitmen ,tb_arbitmen
222:        where tb_casearbitmen.recevice_code='#{session[:recevice_code_1]}' and tb_casearbitmen.used='Y'
223:              and tb_casearbitmen.arbitman=tb_arbitmen.code
224:        order by tb_arbitmen.name&quot;</span> )
225:     <span class="ruby-ivar">@rs1</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9023' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
226:     <span class="ruby-ivar">@rs2</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9024' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
227:     <span class="ruby-ivar">@rs3</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9025' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
228:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001516" class="method-detail">
        <a name="M001516"></a>

        <div class="method-heading">
          <a href="#M001516" class="method-signature">
          <span class="method-name">new_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 新建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001516-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001516-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 26</span>
26:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_1</span>
27:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>()
28:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001523" class="method-detail">
        <a name="M001523"></a>

        <div class="method-heading">
          <a href="#M001523" class="method-signature">
          <span class="method-name">new_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 新建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001523-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001523-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_2</span>
232:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">new</span>()
233:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001520" class="method-detail">
        <a name="M001520"></a>

        <div class="method-heading">
          <a href="#M001520" class="method-signature">
          <span class="method-name">update_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001520-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001520-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 155</span>
155:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_1</span>
156:     <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y' and id&lt;&gt;?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
157:     <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y' and id&lt;&gt;?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
158: 
159:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
160:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败,与现有记录重复！&quot;</span>
161:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
162:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
163:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败,该裁决书制作者另有他人！&quot;</span>
164:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
165:     <span class="ruby-keyword kw">else</span>
166:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
167:         <span class="ruby-identifier">:all</span>,
168:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code_1]}'&quot;</span>,
169:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
170:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
171:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
172:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
173:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:arbitman_type</span>] = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
174:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
175:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
176:         <span class="ruby-identifier">p</span> = <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>
177:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
178:           <span class="ruby-comment cmt"># 修改裁决书信息的时候 需要更新 tb_bonus_penalty 表，否则tb_bonus_penalty的p字段不会改变</span>
179:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">p</span>)
180:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
181:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
182:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list_1&quot;</span>
183:         <span class="ruby-keyword kw">else</span>
184:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
185:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
186:         <span class="ruby-keyword kw">end</span>
187:       <span class="ruby-keyword kw">end</span>
188:     <span class="ruby-keyword kw">end</span>
189:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001526" class="method-detail">
        <a name="M001526"></a>

        <div class="method-heading">
          <a href="#M001526" class="method-signature">
          <span class="method-name">update_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001526-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001526-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_controller.rb, line 285</span>
285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_2</span>
286:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
287:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
288:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
289:         <span class="ruby-identifier">:all</span>,
290:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{@remun.recevice_code}'&quot;</span>,
291:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
292:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
293:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
294:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
295:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:arbitman_type</span>] = <span class="ruby-identifier">arbitman</span>[<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>]
296:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
297:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
298:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
299:       <span class="ruby-keyword kw">else</span>
300:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
301:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
302:       <span class="ruby-keyword kw">end</span>
303:     <span class="ruby-keyword kw">end</span>
304:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>