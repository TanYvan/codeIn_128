<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: SittingController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">SittingController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/sitting_controller_rb.html">
                app/controllers/sitting_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000533">appearman_create</a>&nbsp;&nbsp;
      <a href="#M000536">appearman_delete</a>&nbsp;&nbsp;
      <a href="#M000534">appearman_edit</a>&nbsp;&nbsp;
      <a href="#M000531">appearman_list</a>&nbsp;&nbsp;
      <a href="#M000532">appearman_new</a>&nbsp;&nbsp;
      <a href="#M000535">appearman_update</a>&nbsp;&nbsp;
      <a href="#M000557">book_create</a>&nbsp;&nbsp;
      <a href="#M000560">book_delete</a>&nbsp;&nbsp;
      <a href="#M000564">book_destroy</a>&nbsp;&nbsp;
      <a href="#M000563">book_down</a>&nbsp;&nbsp;
      <a href="#M000558">book_edit</a>&nbsp;&nbsp;
      <a href="#M000555">book_list</a>&nbsp;&nbsp;
      <a href="#M000556">book_new</a>&nbsp;&nbsp;
      <a href="#M000559">book_update</a>&nbsp;&nbsp;
      <a href="#M000561">book_upload</a>&nbsp;&nbsp;
      <a href="#M000562">book_upload_do</a>&nbsp;&nbsp;
      <a href="#M000545">hotel_create</a>&nbsp;&nbsp;
      <a href="#M000548">hotel_delete</a>&nbsp;&nbsp;
      <a href="#M000546">hotel_edit</a>&nbsp;&nbsp;
      <a href="#M000543">hotel_list</a>&nbsp;&nbsp;
      <a href="#M000544">hotel_new</a>&nbsp;&nbsp;
      <a href="#M000547">hotel_update</a>&nbsp;&nbsp;
      <a href="#M000539">room_create</a>&nbsp;&nbsp;
      <a href="#M000542">room_delete</a>&nbsp;&nbsp;
      <a href="#M000540">room_edit</a>&nbsp;&nbsp;
      <a href="#M000537">room_list</a>&nbsp;&nbsp;
      <a href="#M000538">room_new</a>&nbsp;&nbsp;
      <a href="#M000541">room_update</a>&nbsp;&nbsp;
      <a href="#M000523">sitting_create</a>&nbsp;&nbsp;
      <a href="#M000524">sitting_create_2</a>&nbsp;&nbsp;
      <a href="#M000529">sitting_delete</a>&nbsp;&nbsp;
      <a href="#M000530">sitting_delete_2</a>&nbsp;&nbsp;
      <a href="#M000525">sitting_edit</a>&nbsp;&nbsp;
      <a href="#M000526">sitting_edit_2</a>&nbsp;&nbsp;
      <a href="#M000520">sitting_list</a>&nbsp;&nbsp;
      <a href="#M000521">sitting_new</a>&nbsp;&nbsp;
      <a href="#M000522">sitting_new_2</a>&nbsp;&nbsp;
      <a href="#M000527">sitting_update</a>&nbsp;&nbsp;
      <a href="#M000528">sitting_update_2</a>&nbsp;&nbsp;
      <a href="#M000551">sittingdelay_create</a>&nbsp;&nbsp;
      <a href="#M000554">sittingdelay_delete</a>&nbsp;&nbsp;
      <a href="#M000552">sittingdelay_edit</a>&nbsp;&nbsp;
      <a href="#M000549">sittingdelay_list</a>&nbsp;&nbsp;
      <a href="#M000550">sittingdelay_new</a>&nbsp;&nbsp;
      <a href="#M000553">sittingdelay_update</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000533" class="method-detail">
        <a name="M000533"></a>

        <div class="method-heading">
          <a href="#M000533" class="method-signature">
          <span class="method-name">appearman_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000533-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000533-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 407</span>
407:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_create</span>
408:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:appearman</span>])
409:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
410:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
411:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
412:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
413:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
414:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
415:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">save</span>
416:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
417:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;appearman_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
418:     <span class="ruby-keyword kw">else</span>
419:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
420:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;appearman_new&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
421:     <span class="ruby-keyword kw">end</span>
422:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000536" class="method-detail">
        <a name="M000536"></a>

        <div class="method-heading">
          <a href="#M000536" class="method-signature">
          <span class="method-name">appearman_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000536-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000536-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 441</span>
441:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_delete</span>
442:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
443:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
444:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
445:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
446:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">save</span>
447:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
448:     <span class="ruby-keyword kw">else</span>
449:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
450:     <span class="ruby-keyword kw">end</span>
451:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;appearman_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
452:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000534" class="method-detail">
        <a name="M000534"></a>

        <div class="method-heading">
          <a href="#M000534" class="method-signature">
          <span class="method-name">appearman_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000534-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000534-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 424</span>
424:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_edit</span>
425:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
426:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000531" class="method-detail">
        <a name="M000531"></a>

        <div class="method-heading">
          <a href="#M000531" class="method-signature">
          <span class="method-name">appearman_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000531-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000531-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 398</span>
398:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_list</span>
399:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;sitting_id=#{params[:sitting_id]} and used='Y'&quot;</span>
400:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
401:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000532" class="method-detail">
        <a name="M000532"></a>

        <div class="method-heading">
          <a href="#M000532" class="method-signature">
          <span class="method-name">appearman_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000532-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000532-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 403</span>
403:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_new</span>
404:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">new</span>()
405:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000535" class="method-detail">
        <a name="M000535"></a>

        <div class="method-heading">
          <a href="#M000535" class="method-signature">
          <span class="method-name">appearman_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000535-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000535-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 428</span>
428:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">appearman_update</span>
429:     <span class="ruby-ivar">@appearman</span>=<span class="ruby-constant">TbAppearman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
430:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
431:     <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
432:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@appearman</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:appearman</span>])
433:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
434:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;appearman_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
435:     <span class="ruby-keyword kw">else</span>
436:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
437:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;appearman_edit&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
438:     <span class="ruby-keyword kw">end</span>
439:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000557" class="method-detail">
        <a name="M000557"></a>

        <div class="method-heading">
          <a href="#M000557" class="method-signature">
          <span class="method-name">book_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000557-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000557-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 648</span>
648:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_create</span>
649:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:book</span>])
650:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
651:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
652:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
653:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">&quot;0001&quot;</span>
654:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">p_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
655:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
656:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
657:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">save</span>
658:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
659:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_list&quot;</span>,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
660:     <span class="ruby-keyword kw">else</span>
661:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
662:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_new&quot;</span> ,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
663:     <span class="ruby-keyword kw">end</span>
664:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000560" class="method-detail">
        <a name="M000560"></a>

        <div class="method-heading">
          <a href="#M000560" class="method-signature">
          <span class="method-name">book_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000560-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000560-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 683</span>
683:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_delete</span>
684:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
685:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
686:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
687:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
688:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">save</span>
689:       
690:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">book_name!</span>=<span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">book_name!</span>=<span class="ruby-value str">&quot;&quot;</span>
691:         <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@book</span>.<span class="ruby-identifier">recevice_code</span>)
692:         <span class="ruby-ivar">@yea</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
693:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@book.recevice_code}/#{@book.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
694:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@book.recevice_code}/#{@book.book_name}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-value">1</span>
695:           <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">book_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
696:           <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">book_dat</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
697:           <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">book_name</span>=<span class="ruby-value str">&quot;&quot;</span>
698:           <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">save</span>
699:         <span class="ruby-keyword kw">end</span>
700:       <span class="ruby-keyword kw">end</span>
701:       
702:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
703:     <span class="ruby-keyword kw">else</span>
704:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
705:     <span class="ruby-keyword kw">end</span>
706:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_list&quot;</span>,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
707:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000564" class="method-detail">
        <a name="M000564"></a>

        <div class="method-heading">
          <a href="#M000564" class="method-signature">
          <span class="method-name">book_destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000564-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000564-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 773</span>
773:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_destroy</span>
774:     <span class="ruby-ivar">@doc</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
775:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">recevice_code</span>)
776:     <span class="ruby-ivar">@yea</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
777:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}/#{@doc.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
778:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}/#{@doc.book_name}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-value">1</span>
779:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
780:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_dat</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
781:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_name</span>=<span class="ruby-value str">&quot;&quot;</span>
782:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">save</span>
783:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除成功&quot;</span>
784:     <span class="ruby-keyword kw">else</span>
785:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除失败&quot;</span>
786:     <span class="ruby-keyword kw">end</span>
787:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_list&quot;</span>,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">p_id</span>
788:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000563" class="method-detail">
        <a name="M000563"></a>

        <div class="method-heading">
          <a href="#M000563" class="method-signature">
          <span class="method-name">book_down</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000563-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000563-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 766</span>
766:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_down</span>
767:     <span class="ruby-ivar">@doc</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
768:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">recevice_code</span>)
769:     <span class="ruby-ivar">@yea</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
770:     <span class="ruby-identifier">send_file</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}/#{@doc.book_name}&quot;</span>)
771:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000558" class="method-detail">
        <a name="M000558"></a>

        <div class="method-heading">
          <a href="#M000558" class="method-signature">
          <span class="method-name">book_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000558-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000558-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 666</span>
666:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_edit</span>
667:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
668:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000555" class="method-detail">
        <a name="M000555"></a>

        <div class="method-heading">
          <a href="#M000555" class="method-signature">
          <span class="method-name">book_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000555-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000555-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 639</span>
639:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_list</span>
640:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;p_id=#{params[:p_id]} and typ='0001' and used='Y'&quot;</span>
641:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
642:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000556" class="method-detail">
        <a name="M000556"></a>

        <div class="method-heading">
          <a href="#M000556" class="method-signature">
          <span class="method-name">book_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000556-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000556-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 644</span>
644:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_new</span>
645:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>()
646:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000559" class="method-detail">
        <a name="M000559"></a>

        <div class="method-heading">
          <a href="#M000559" class="method-signature">
          <span class="method-name">book_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000559-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000559-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 670</span>
670:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_update</span>
671:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
672:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
673:     <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
674:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:book</span>])
675:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
676:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_list&quot;</span>,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
677:     <span class="ruby-keyword kw">else</span>
678:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
679:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_edit&quot;</span> ,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
680:     <span class="ruby-keyword kw">end</span>
681:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000561" class="method-detail">
        <a name="M000561"></a>

        <div class="method-heading">
          <a href="#M000561" class="method-signature">
          <span class="method-name">book_upload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000561-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000561-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 709</span>
709:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_upload</span>
710:     <span class="ruby-ivar">@book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
711:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000562" class="method-detail">
        <a name="M000562"></a>

        <div class="method-heading">
          <a href="#M000562" class="method-signature">
          <span class="method-name">book_upload_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000562-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000562-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 713</span>
713:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">book_upload_do</span>
714:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>])
715:     <span class="ruby-comment cmt">#@sitting.book_num=@sitting.book_num + 1</span>
716:     <span class="ruby-ivar">@doc</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
717:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">recevice_code</span>)
718:     <span class="ruby-comment cmt">#########################################</span>
719:     <span class="ruby-ivar">@yea</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
720:     <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_u</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
721:     <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_dat</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
722: 
723:     <span class="ruby-comment cmt">#@doc.book_name=&quot;#{@doc.typ}_#{@doc.recevice_code}_#{@sitting.id}_#{@doc.id}.doc&quot;</span>
724:     
725:     <span class="ruby-identifier">utf8_to_gbk</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'gbk'</span>,<span class="ruby-value str">'utf-8'</span>)
726:     <span class="ruby-identifier">gbk_to_utf8</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)
727:     <span class="ruby-comment cmt">#f_name = params[&quot;filedata&quot;].original_filename</span>
728:     <span class="ruby-identifier">file</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>]   <span class="ruby-comment cmt">#获取文档，此处为tempfile类型的</span>
729:     <span class="ruby-identifier">file_arry</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>)
730:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file_arry</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
731:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_name</span>=<span class="ruby-node">&quot;#{@doc.typ}_#{@doc.recevice_code}_#{@sitting.id}_#{@doc.id}.&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>)[<span class="ruby-identifier">file_arry</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
732:     <span class="ruby-keyword kw">else</span>
733:       <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">book_name</span>=<span class="ruby-node">&quot;#{@doc.typ}_#{@doc.recevice_code}_#{@sitting.id}_#{@doc.id}&quot;</span>
734:     <span class="ruby-keyword kw">end</span>
735:     <span class="ruby-comment cmt">#设置文档保存的路径，自由设置</span>
736:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs&quot;</span>)
737:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/&quot;</span>)
738:     <span class="ruby-keyword kw">end</span>
739:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
740:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
741:     <span class="ruby-keyword kw">end</span>
742:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}&quot;</span>)
743:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}&quot;</span>)
744:     <span class="ruby-keyword kw">end</span>
745:     <span class="ruby-comment cmt">#读取文档的内容，目前不用编码转换即可正常显示，在存入数据库中时或许涉及到编码转换</span>
746:     <span class="ruby-keyword kw">begin</span>
747:       <span class="ruby-identifier">content</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>  <span class="ruby-comment cmt">#gbk_to_utf8.iconv</span>
748:       <span class="ruby-comment cmt">#新建同名文件，读取修改的文件内容用以覆盖源文件，注意路径要与读取的一致</span>
749:       <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@doc.recevice_code}/#{@doc.book_name}&quot;</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
750:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">content</span>)
751:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
752:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">empty?</span>
753:         <span class="ruby-ivar">@doc</span>.<span class="ruby-identifier">save</span>
754:         <span class="ruby-comment cmt">#@sitting.save</span>
755:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传成功&quot;</span>
756:       <span class="ruby-keyword kw">else</span>
757:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败&quot;</span>
758: 
759:       <span class="ruby-keyword kw">end</span>
760:     <span class="ruby-keyword kw">rescue</span>
761:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败！&quot;</span>
762:     <span class="ruby-keyword kw">end</span>
763:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;book_list&quot;</span>,<span class="ruby-identifier">:p_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_id</span>]
764:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000545" class="method-detail">
        <a name="M000545"></a>

        <div class="method-heading">
          <a href="#M000545" class="method-signature">
          <span class="method-name">hotel_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000545-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000545-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 531</span>
531:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_create</span>
532:     <span class="ruby-ivar">@arbitman_now</span>=<span class="ruby-constant">TbArbitmannow</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct tb_arbitmen.code as code ,tb_arbitmen.name as name from tb_arbitmen,tb_casearbitmen where tb_casearbitmen.recevice_code='#{session[:recevice_code]}' and  tb_arbitmen.code=tb_casearbitmen.arbitman order by tb_arbitmen.name&quot;</span>)
533:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hotel</span>])
534:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
535:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
536:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
537:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
538:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usestyle</span>=<span class="ruby-value str">&quot;0001&quot;</span>
539:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
540:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
541:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">save</span>
542:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
543:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;hotel_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
544:     <span class="ruby-keyword kw">else</span>
545:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
546:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;hotel_new&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
547:     <span class="ruby-keyword kw">end</span>
548:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000548" class="method-detail">
        <a name="M000548"></a>

        <div class="method-heading">
          <a href="#M000548" class="method-signature">
          <span class="method-name">hotel_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000548-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000548-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 568</span>
568:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_delete</span>
569:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
570:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
571:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
572:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
573:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">save</span>
574:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
575:     <span class="ruby-keyword kw">else</span>
576:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
577:     <span class="ruby-keyword kw">end</span>
578:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;hotel_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
579:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000546" class="method-detail">
        <a name="M000546"></a>

        <div class="method-heading">
          <a href="#M000546" class="method-signature">
          <span class="method-name">hotel_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000546-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000546-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 550</span>
550:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_edit</span>
551:     <span class="ruby-ivar">@arbitman_now</span>=<span class="ruby-constant">TbArbitmannow</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct tb_arbitmen.code as code ,tb_arbitmen.name as name from tb_arbitmen,tb_casearbitmen where tb_casearbitmen.recevice_code='#{session[:recevice_code]}' and  tb_arbitmen.code=tb_casearbitmen.arbitman order by tb_arbitmen.name&quot;</span>)
552:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
553:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000543" class="method-detail">
        <a name="M000543"></a>

        <div class="method-heading">
          <a href="#M000543" class="method-signature">
          <span class="method-name">hotel_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000543-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000543-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 517</span>
517:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_list</span>
518:      <span class="ruby-ivar">@state</span>={<span class="ruby-value str">&quot;&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;待定&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;入住&quot;</span>}
519:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;usestyle='0001' and sitting_id=#{params[:sitting_id]} and used='Y'&quot;</span>
520:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
521:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000544" class="method-detail">
        <a name="M000544"></a>

        <div class="method-heading">
          <a href="#M000544" class="method-signature">
          <span class="method-name">hotel_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000544-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000544-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 523</span>
523:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_new</span>
524:     <span class="ruby-comment cmt">#    @arbitman_now=TbArbitmannow.find_by_sql(&quot;select distinct tb_arbitmen.code as code ,tb_arbitmen.name as name from tb_arbitmen,tb_casearbitmen where tb_casearbitmen.recevice_code='#{session[:recevice_code]}' and  tb_arbitmen.code=tb_casearbitmen.arbitman order by tb_arbitmen.name&quot;)</span>
525:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">new</span>()
526:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
527:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value str">&quot;0003&quot;</span>
528:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">days</span>=<span class="ruby-value">2</span>
529:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000547" class="method-detail">
        <a name="M000547"></a>

        <div class="method-heading">
          <a href="#M000547" class="method-signature">
          <span class="method-name">hotel_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000547-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000547-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 555</span>
555:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">hotel_update</span>
556:     <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
557:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
558:     <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
559:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hotel</span>])
560:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
561:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;hotel_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
562:     <span class="ruby-keyword kw">else</span>
563:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
564:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;hotel_edit&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
565:     <span class="ruby-keyword kw">end</span>
566:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000539" class="method-detail">
        <a name="M000539"></a>

        <div class="method-heading">
          <a href="#M000539" class="method-signature">
          <span class="method-name">room_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000539-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000539-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 465</span>
465:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_create</span>
466:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:room</span>])
467:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
468:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
469:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
470:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
471:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">usestyle</span>=<span class="ruby-value str">&quot;0001&quot;</span>
472:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">userId</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]).<span class="ruby-identifier">name</span>
473:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
474:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
475:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">save</span>
476:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
477:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;room_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
478:     <span class="ruby-keyword kw">else</span>
479:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
480:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;room_new&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
481:     <span class="ruby-keyword kw">end</span>
482:      
483:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000542" class="method-detail">
        <a name="M000542"></a>

        <div class="method-heading">
          <a href="#M000542" class="method-signature">
          <span class="method-name">room_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000542-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000542-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 503</span>
503:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_delete</span>
504:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
505:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
506:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
507:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
508:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">save</span>
509:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
510:     <span class="ruby-keyword kw">else</span>
511:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
512:     <span class="ruby-keyword kw">end</span>
513:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;room_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
514:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000540" class="method-detail">
        <a name="M000540"></a>

        <div class="method-heading">
          <a href="#M000540" class="method-signature">
          <span class="method-name">room_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000540-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000540-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 485</span>
485:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_edit</span>
486:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
487:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000537" class="method-detail">
        <a name="M000537"></a>

        <div class="method-heading">
          <a href="#M000537" class="method-signature">
          <span class="method-name">room_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000537-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000537-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 455</span>
455:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_list</span>
456:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;usestyle='0001' and sitting_id=#{params[:sitting_id]} and used='Y'&quot;</span>
457:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
458:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000538" class="method-detail">
        <a name="M000538"></a>

        <div class="method-heading">
          <a href="#M000538" class="method-signature">
          <span class="method-name">room_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000538-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000538-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 460</span>
460:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_new</span>
461:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">new</span>()
462:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sittingdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
463:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000541" class="method-detail">
        <a name="M000541"></a>

        <div class="method-heading">
          <a href="#M000541" class="method-signature">
          <span class="method-name">room_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000541-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000541-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 489</span>
489:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">room_update</span>
490:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
491:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">userId</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]).<span class="ruby-identifier">name</span>
492:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
493:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
494:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:room</span>])
495:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
496:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;room_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
497:     <span class="ruby-keyword kw">else</span>
498:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
499:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;room_edit&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
500:     <span class="ruby-keyword kw">end</span>
501:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000523" class="method-detail">
        <a name="M000523"></a>

        <div class="method-heading">
          <a href="#M000523" class="method-signature">
          <span class="method-name">sitting_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000523-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000523-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 36</span>
 36:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_create</span>
 37:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>])
 38:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
 39:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
 40:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
 41:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
 42:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
 43:     <span class="ruby-ivar">@date_t</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
 44:     <span class="ruby-identifier">s</span>=<span class="ruby-value str">&quot;&quot;</span>
 45:     <span class="ruby-identifier">a</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:sittingdate</span>].<span class="ruby-identifier">to_date</span><span class="ruby-operator">-</span><span class="ruby-ivar">@date_t</span>
 46:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span><span class="ruby-operator">&lt;</span><span class="ruby-value">15</span>
 47:       <span class="ruby-identifier">s</span> = <span class="ruby-value str">&quot; 开庭时间与当前日期相比，必须大于15个日历日期&quot;</span>
 48:     <span class="ruby-keyword kw">end</span>
 49:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])
 50:     <span class="ruby-ivar">@use_time</span>={<span class="ruby-value str">&quot;08:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value str">&quot;08:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8.5</span>,<span class="ruby-value str">&quot;09:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value str">&quot;09:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9.5</span>,<span class="ruby-value str">&quot;10:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value str">&quot;10:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10.5</span>,<span class="ruby-value str">&quot;11:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11</span>,<span class="ruby-value str">&quot;11:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11.5</span>,<span class="ruby-value str">&quot;12:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>,
 51:       <span class="ruby-value str">&quot;12:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12.5</span>,<span class="ruby-value str">&quot;13:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13</span>,<span class="ruby-value str">&quot;13:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13.5</span>,<span class="ruby-value str">&quot;14:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14</span>,<span class="ruby-value str">&quot;14:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14.5</span>,<span class="ruby-value str">&quot;15:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15</span>,<span class="ruby-value str">&quot;15:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15.5</span>,
 52:       <span class="ruby-value str">&quot;16:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16</span>,<span class="ruby-value str">&quot;16:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16.5</span>,<span class="ruby-value str">&quot;17:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17</span>,<span class="ruby-value str">&quot;17:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17.5</span>,<span class="ruby-value str">&quot;18:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18</span>,<span class="ruby-value str">&quot;18:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18.5</span>,
 53:       <span class="ruby-value str">&quot;19:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19</span>,<span class="ruby-value str">&quot;19:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19.5</span>,<span class="ruby-value str">&quot;20:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>}
 54:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span> = <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:close_t</span>]] <span class="ruby-operator">-</span> <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:open_t</span>]]
 55:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
 56:       
 57:       <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">new</span>()
 58:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sittingdate</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingdate</span>
 59:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sittingplace</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingplace</span>
 60:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">usetime</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span>
 61:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">open_t</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">open_t</span>
 62:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">close_t</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">close_t</span>
 63:       
 64:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
 65:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
 66:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
 67:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">usestyle</span>=<span class="ruby-value str">&quot;0001&quot;</span>
 68:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">userId</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]).<span class="ruby-identifier">name</span>
 69:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
 70:       <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
 71:       
 72:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">save</span>
 73:         <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
 74:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
 75:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
 76:         <span class="ruby-keyword kw">end</span> 
 77:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
 78:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
 79: 
 80:           <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
 81:           <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
 82:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 83:             <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
 84:           <span class="ruby-keyword kw">else</span>
 85:             <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
 86:           <span class="ruby-keyword kw">end</span>
 87: 
 88:           <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
 89:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 90:             <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
 91:           <span class="ruby-keyword kw">else</span>
 92:             <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
 93:           <span class="ruby-keyword kw">end</span>
 94: 
 95:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
 96:           
 97:           <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>
 98:           <span class="ruby-comment cmt">#订房信息  2010-8-26 niell</span>
 99:           <span class="ruby-ivar">@arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select c.arbitman as code,a.name as name from tb_arbitmen as a,tb_casearbitmen as c where c.recevice_code=? and c.used='Y' and c.arbitman=a.code and a.used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
100:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbitman</span>
101:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_arbitman_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_used_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-value str">'0001'</span>
102:               <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">new</span>()
103:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
104:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
105:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
106:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>
107:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usestyle</span>=<span class="ruby-value str">&quot;0001&quot;</span>
108:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_used_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
109:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
110:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
111:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">arbitman</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>
112:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usedate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_usedate_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
113:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">rooms</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_rooms_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
114:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">days</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_days_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
115:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">descript</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_descript_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
116:               <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">save</span>
117:             <span class="ruby-keyword kw">end</span>
118:           <span class="ruby-keyword kw">end</span>
119:           <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">save</span>
120:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
121:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span>
122:         <span class="ruby-keyword kw">end</span>
123:       <span class="ruby-keyword kw">else</span>
124:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_new&quot;</span>
125:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span>
126:       <span class="ruby-keyword kw">end</span>
127:     <span class="ruby-keyword kw">else</span>
128:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
129:     <span class="ruby-keyword kw">end</span>
130:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000524" class="method-detail">
        <a name="M000524"></a>

        <div class="method-heading">
          <a href="#M000524" class="method-signature">
          <span class="method-name">sitting_create_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000524-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000524-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 132</span>
132:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_create_2</span>
133:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>])
134:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
135:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
136:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
137:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
138:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
139:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])
140:     <span class="ruby-ivar">@use_time</span>={<span class="ruby-value str">&quot;08:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value str">&quot;08:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8.5</span>,<span class="ruby-value str">&quot;09:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value str">&quot;09:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9.5</span>,<span class="ruby-value str">&quot;10:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value str">&quot;10:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10.5</span>,<span class="ruby-value str">&quot;11:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11</span>,<span class="ruby-value str">&quot;11:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11.5</span>,<span class="ruby-value str">&quot;12:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>,
141:       <span class="ruby-value str">&quot;12:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12.5</span>,<span class="ruby-value str">&quot;13:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13</span>,<span class="ruby-value str">&quot;13:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13.5</span>,<span class="ruby-value str">&quot;14:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14</span>,<span class="ruby-value str">&quot;14:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14.5</span>,<span class="ruby-value str">&quot;15:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15</span>,<span class="ruby-value str">&quot;15:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15.5</span>,
142:       <span class="ruby-value str">&quot;16:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16</span>,<span class="ruby-value str">&quot;16:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16.5</span>,<span class="ruby-value str">&quot;17:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17</span>,<span class="ruby-value str">&quot;17:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17.5</span>,<span class="ruby-value str">&quot;18:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18</span>,<span class="ruby-value str">&quot;18:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18.5</span>,
143:       <span class="ruby-value str">&quot;19:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19</span>,<span class="ruby-value str">&quot;19:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19.5</span>,<span class="ruby-value str">&quot;20:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>}
144:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span> = <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:close_t</span>]] <span class="ruby-operator">-</span> <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:open_t</span>]]
145:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
146:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
147:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
148:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
149:       <span class="ruby-keyword kw">end</span>
150:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
151:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
152: 
153:         <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
154:         <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
155:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
156:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
157:         <span class="ruby-keyword kw">else</span>
158:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
159:         <span class="ruby-keyword kw">end</span>
160: 
161:         <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
162:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
163:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
164:         <span class="ruby-keyword kw">else</span>
165:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
166:         <span class="ruby-keyword kw">end</span>
167:         <span class="ruby-comment cmt">#订房信息  2010-8-26 niell</span>
168:         <span class="ruby-ivar">@arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select c.arbitman as code,a.name as name from tb_arbitmen as a,tb_casearbitmen as c where c.recevice_code=? and c.used='Y' and c.arbitman=a.code and a.used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]])
169:         <span class="ruby-identifier">a</span> =<span class="ruby-value">0</span>
170:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">p</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbitman</span>
171:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_arbitman_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_used_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-value str">'0001'</span>
172:             <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">new</span>()
173:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
174:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
175:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
176:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>
177:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usestyle</span>=<span class="ruby-value str">&quot;0001&quot;</span>
178:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_used_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
179:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
180:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
181:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">arbitman</span> = <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>
182:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">usedate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_usedate_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
183:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">rooms</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_rooms_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
184:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">days</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_days_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
185:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">descript</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;name_descript_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">code</span>]
186:             <span class="ruby-ivar">@hotel</span>.<span class="ruby-identifier">save</span>
187:           <span class="ruby-keyword kw">end</span>
188:           <span class="ruby-identifier">a</span> = <span class="ruby-identifier">a</span> <span class="ruby-value">+1</span>
189:         <span class="ruby-keyword kw">end</span>
190: 
191:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
192:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
193:       <span class="ruby-keyword kw">else</span>
194:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_new&quot;</span>
195:       <span class="ruby-keyword kw">end</span>
196:     <span class="ruby-keyword kw">else</span>
197:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
198:     <span class="ruby-keyword kw">end</span>
199:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000529" class="method-detail">
        <a name="M000529"></a>

        <div class="method-heading">
          <a href="#M000529" class="method-signature">
          <span class="method-name">sitting_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000529-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000529-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 300</span>
300:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_delete</span>    
301:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
302:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
303:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
304:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
305:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>)
306:     <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">del_flow</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
307:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
308:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
309:     <span class="ruby-keyword kw">end</span>
310:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
311:       
312:       <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
313:       <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
314:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
315:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
316:       <span class="ruby-keyword kw">else</span>
317:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
318:       <span class="ruby-keyword kw">end</span>
319: 
320:       <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
321:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
322:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
323:       <span class="ruby-keyword kw">else</span>
324:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
325:       <span class="ruby-keyword kw">end</span>
326: 
327:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
328:       
329:       <span class="ruby-comment cmt">#删除相关仲裁庭使用信息</span>
330:       <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and sitting_id=?&quot;</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>])
331:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">room</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@room</span>
332:         <span class="ruby-identifier">room</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
333:         <span class="ruby-identifier">room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
334:         <span class="ruby-identifier">room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
335:         <span class="ruby-identifier">room</span>.<span class="ruby-identifier">save</span>
336:       <span class="ruby-keyword kw">end</span>
337:       
338:       <span class="ruby-comment cmt">#删除相关宾馆预订信息</span>
339:       <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and sitting_id=?&quot;</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>])
340:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">hotel</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@hotel</span>
341:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
342:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
343:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
344:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">save</span>
345:       <span class="ruby-keyword kw">end</span>
346:       
347:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
348:     <span class="ruby-keyword kw">else</span>
349:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
350:     <span class="ruby-keyword kw">end</span>
351:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
352:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000530" class="method-detail">
        <a name="M000530"></a>

        <div class="method-heading">
          <a href="#M000530" class="method-signature">
          <span class="method-name">sitting_delete_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000530-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000530-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 354</span>
354:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_delete_2</span>
355:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
356:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
357:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
358:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
359:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>)
360:     <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">del_flow</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0006'</span>)
361:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
362:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
363:     <span class="ruby-keyword kw">end</span>
364:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
365:       <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
366:       <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
367:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
368:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
369:       <span class="ruby-keyword kw">else</span>
370:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
371:       <span class="ruby-keyword kw">end</span>
372: 
373:       <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
374:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
375:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
376:       <span class="ruby-keyword kw">else</span>
377:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
378:       <span class="ruby-keyword kw">end</span>
379: 
380:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
381:       
382:       <span class="ruby-comment cmt">#删除相关宾馆预订信息</span>
383:       <span class="ruby-ivar">@hotel</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and sitting_id=?&quot;</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">id</span>])
384:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">hotel</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@hotel</span>
385:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
386:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
387:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
388:         <span class="ruby-identifier">hotel</span>.<span class="ruby-identifier">save</span>
389:       <span class="ruby-keyword kw">end</span>
390:       
391:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
392:     <span class="ruby-keyword kw">else</span>
393:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
394:     <span class="ruby-keyword kw">end</span>
395:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
396:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000525" class="method-detail">
        <a name="M000525"></a>

        <div class="method-heading">
          <a href="#M000525" class="method-signature">
          <span class="method-name">sitting_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000525-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000525-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 201</span>
201:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_edit</span>
202:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find_by_sitting_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
203:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
204:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000526" class="method-detail">
        <a name="M000526"></a>

        <div class="method-heading">
          <a href="#M000526" class="method-signature">
          <span class="method-name">sitting_edit_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000526-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000526-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 206</span>
206:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_edit_2</span>
207:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find_by_sitting_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
208:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
209:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000520" class="method-detail">
        <a name="M000520"></a>

        <div class="method-heading">
          <a href="#M000520" class="method-signature">
          <span class="method-name">sitting_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000520-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000520-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 3</span>
 3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_list</span>
 4:     <span class="ruby-ivar">@case</span>=<span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 5:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 6:     <span class="ruby-keyword kw">else</span>
 7:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>])
 8:       <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;recevice_code='#{session[:recevice_code]}' and used='Y'&quot;</span>
 9:       <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>) 
10:       <span class="ruby-ivar">@add_typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;本会&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;外地&quot;</span>}
11:     <span class="ruby-keyword kw">end</span>
12:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000521" class="method-detail">
        <a name="M000521"></a>

        <div class="method-heading">
          <a href="#M000521" class="method-signature">
          <span class="method-name">sitting_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000521-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000521-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 14</span>
14:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_new</span>
15:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">new</span>()
16:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">new</span>()
17:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
18:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sendrdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
19:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sendbdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
20:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">open_t</span> = <span class="ruby-value str">'09:30'</span>
21:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">close_t</span> = <span class="ruby-value str">'12:00'</span>
22:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">add_typ</span> = <span class="ruby-value str">'0001'</span>
23:     <span class="ruby-ivar">@finally_limit_dat</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">finally_limit_dat</span>
24:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000522" class="method-detail">
        <a name="M000522"></a>

        <div class="method-heading">
          <a href="#M000522" class="method-signature">
          <span class="method-name">sitting_new_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000522-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000522-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 25</span>
25:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_new_2</span>
26:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">new</span>()
27:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">new</span>()
28:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
29:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sendrdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
30:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sendbdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
31:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">open_t</span> = <span class="ruby-value str">'09:30'</span>
32:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">close_t</span> = <span class="ruby-value str">'12:00'</span>
33:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">add_typ</span> = <span class="ruby-value str">'0002'</span>
34:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000527" class="method-detail">
        <a name="M000527"></a>

        <div class="method-heading">
          <a href="#M000527" class="method-signature">
          <span class="method-name">sitting_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000527-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000527-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 211</span>
211:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_update</span>
212:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
213:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
214:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
215:     <span class="ruby-ivar">@use_time</span>={<span class="ruby-value str">&quot;08:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value str">&quot;08:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8.5</span>,<span class="ruby-value str">&quot;09:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value str">&quot;09:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9.5</span>,<span class="ruby-value str">&quot;10:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value str">&quot;10:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10.5</span>,<span class="ruby-value str">&quot;11:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11</span>,<span class="ruby-value str">&quot;11:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11.5</span>,<span class="ruby-value str">&quot;12:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>,
216:       <span class="ruby-value str">&quot;12:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12.5</span>,<span class="ruby-value str">&quot;13:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13</span>,<span class="ruby-value str">&quot;13:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13.5</span>,<span class="ruby-value str">&quot;14:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14</span>,<span class="ruby-value str">&quot;14:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14.5</span>,<span class="ruby-value str">&quot;15:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15</span>,<span class="ruby-value str">&quot;15:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15.5</span>,
217:       <span class="ruby-value str">&quot;16:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16</span>,<span class="ruby-value str">&quot;16:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16.5</span>,<span class="ruby-value str">&quot;17:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17</span>,<span class="ruby-value str">&quot;17:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17.5</span>,<span class="ruby-value str">&quot;18:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18</span>,<span class="ruby-value str">&quot;18:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18.5</span>,
218:       <span class="ruby-value str">&quot;19:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19</span>,<span class="ruby-value str">&quot;19:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19.5</span>,<span class="ruby-value str">&quot;20:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>}
219:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span> = <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:close_t</span>]] <span class="ruby-operator">-</span> <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:open_t</span>]]
220: 
221:     
222:     <span class="ruby-ivar">@room</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find_by_sitting_id</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
223:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sittingdate</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:sittingdate</span>]
224:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">sittingplace</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:sittingplace</span>]
225:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">usetime</span>= <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span>
226:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">open_t</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:open_t</span>]
227:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">close_t</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:close_t</span>]
228: 
229:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">userId</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]).<span class="ruby-identifier">name</span>
230:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
231:     <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
232:       
233:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@room</span>.<span class="ruby-identifier">save</span>
234:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>])
235:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
236: 
237:         <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>)
238:         <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
239:         <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
240:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
241:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
242:         <span class="ruby-keyword kw">else</span>
243:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
244:         <span class="ruby-keyword kw">end</span>
245: 
246:         <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
247:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
248:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
249:         <span class="ruby-keyword kw">else</span>
250:           <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
251:         <span class="ruby-keyword kw">end</span>
252: 
253:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
254: 
255:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
256:       <span class="ruby-keyword kw">end</span>
257:     <span class="ruby-keyword kw">else</span>
258:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
259:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_edit&quot;</span>
260:     <span class="ruby-keyword kw">end</span>
261:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000528" class="method-detail">
        <a name="M000528"></a>

        <div class="method-heading">
          <a href="#M000528" class="method-signature">
          <span class="method-name">sitting_update_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000528-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000528-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 263</span>
263:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sitting_update_2</span>
264:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
265:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
266:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
267:     <span class="ruby-ivar">@use_time</span>={<span class="ruby-value str">&quot;08:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8</span>,<span class="ruby-value str">&quot;08:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">8.5</span>,<span class="ruby-value str">&quot;09:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>,<span class="ruby-value str">&quot;09:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">9.5</span>,<span class="ruby-value str">&quot;10:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>,<span class="ruby-value str">&quot;10:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">10.5</span>,<span class="ruby-value str">&quot;11:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11</span>,<span class="ruby-value str">&quot;11:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">11.5</span>,<span class="ruby-value str">&quot;12:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12</span>,
268:       <span class="ruby-value str">&quot;12:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">12.5</span>,<span class="ruby-value str">&quot;13:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13</span>,<span class="ruby-value str">&quot;13:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">13.5</span>,<span class="ruby-value str">&quot;14:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14</span>,<span class="ruby-value str">&quot;14:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">14.5</span>,<span class="ruby-value str">&quot;15:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15</span>,<span class="ruby-value str">&quot;15:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">15.5</span>,
269:       <span class="ruby-value str">&quot;16:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16</span>,<span class="ruby-value str">&quot;16:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">16.5</span>,<span class="ruby-value str">&quot;17:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17</span>,<span class="ruby-value str">&quot;17:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">17.5</span>,<span class="ruby-value str">&quot;18:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18</span>,<span class="ruby-value str">&quot;18:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">18.5</span>,
270:       <span class="ruby-value str">&quot;19:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19</span>,<span class="ruby-value str">&quot;19:30&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">19.5</span>,<span class="ruby-value str">&quot;20:00&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value">20</span>}
271:     <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">usetime</span> = <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:close_t</span>]] <span class="ruby-operator">-</span> <span class="ruby-ivar">@use_time</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>][<span class="ruby-identifier">:open_t</span>]]
272:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting</span>])
273:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
274: 
275:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">recevice_code</span>)
276:       <span class="ruby-identifier">t_sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{@sitting.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate&quot;</span>)
277:       <span class="ruby-identifier">t_sitting_f</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">t_sitting</span>)
278:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_f</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
279:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-keyword kw">nil</span>
280:       <span class="ruby-keyword kw">else</span>
281:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_first</span>=<span class="ruby-identifier">t_sitting_f</span>.<span class="ruby-identifier">id</span>
282:       <span class="ruby-keyword kw">end</span>
283: 
284:       <span class="ruby-identifier">t_sitting_l</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">t_sitting</span>)
285:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t_sitting_l</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
286:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-keyword kw">nil</span>
287:       <span class="ruby-keyword kw">else</span>
288:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>=<span class="ruby-identifier">t_sitting_l</span>.<span class="ruby-identifier">id</span>
289:       <span class="ruby-keyword kw">end</span>
290: 
291:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
292: 
293:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_list&quot;</span>
294:     <span class="ruby-keyword kw">else</span>
295:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
296:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sitting_edit&quot;</span>
297:     <span class="ruby-keyword kw">end</span>
298:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000551" class="method-detail">
        <a name="M000551"></a>

        <div class="method-heading">
          <a href="#M000551" class="method-signature">
          <span class="method-name">sittingdelay_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000551-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000551-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 592</span>
592:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_create</span>
593:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sittingdelay</span>])
594:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code</span>]
595:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code</span>]
596:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code</span>]
597:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">sitting_id</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
598:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
599:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
600:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">save</span>
601:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
602:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdelay_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
603:     <span class="ruby-keyword kw">else</span>
604:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
605:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdelay_new&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
606:     <span class="ruby-keyword kw">end</span>
607:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000554" class="method-detail">
        <a name="M000554"></a>

        <div class="method-heading">
          <a href="#M000554" class="method-signature">
          <span class="method-name">sittingdelay_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000554-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000554-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 626</span>
626:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_delete</span>
627:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
628:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
629:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
630:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
631:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">save</span>
632:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
633:     <span class="ruby-keyword kw">else</span>
634:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
635:     <span class="ruby-keyword kw">end</span>
636:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdelay_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
637:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000552" class="method-detail">
        <a name="M000552"></a>

        <div class="method-heading">
          <a href="#M000552" class="method-signature">
          <span class="method-name">sittingdelay_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000552-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000552-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 609</span>
609:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_edit</span>
610:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
611:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000549" class="method-detail">
        <a name="M000549"></a>

        <div class="method-heading">
          <a href="#M000549" class="method-signature">
          <span class="method-name">sittingdelay_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000549-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000549-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 581</span>
581:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_list</span>
582:     <span class="ruby-ivar">@isdelay</span>={<span class="ruby-value str">'Y'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'是'</span>,<span class="ruby-value str">'N'</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">'否'</span>}
583:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;sitting_id=#{params[:sitting_id]} and used='Y'&quot;</span>
584:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
585:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000550" class="method-detail">
        <a name="M000550"></a>

        <div class="method-heading">
          <a href="#M000550" class="method-signature">
          <span class="method-name">sittingdelay_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000550-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000550-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 587</span>
587:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_new</span>
588:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">new</span>()
589:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">requestdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
590:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000553" class="method-detail">
        <a name="M000553"></a>

        <div class="method-heading">
          <a href="#M000553" class="method-signature">
          <span class="method-name">sittingdelay_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000553-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000553-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/sitting_controller.rb, line 613</span>
613:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">sittingdelay_update</span>
614:     <span class="ruby-ivar">@sittingdelay</span>=<span class="ruby-constant">TbSittingdelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
615:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
616:     <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
617:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sittingdelay</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sittingdelay</span>])
618:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
619:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdelay_list&quot;</span>,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
620:     <span class="ruby-keyword kw">else</span>
621:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
622:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdelay_edit&quot;</span> ,<span class="ruby-identifier">:sitting_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:sitting_id</span>]
623:     <span class="ruby-keyword kw">end</span>
624:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>