<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Remuneration11SetController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Remuneration11SetController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/remuneration11_set_controller_rb.html">
                app/controllers/remuneration11_set_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001116">changexs</a>&nbsp;&nbsp;
      <a href="#M001108">delete_1</a>&nbsp;&nbsp;
      <a href="#M001112">delete_2</a>&nbsp;&nbsp;
      <a href="#M001115">delete_3</a>&nbsp;&nbsp;
      <a href="#M001106">edit_1</a>&nbsp;&nbsp;
      <a href="#M001110">edit_2</a>&nbsp;&nbsp;
      <a href="#M001120">edit_4</a>&nbsp;&nbsp;
      <a href="#M001104">list</a>&nbsp;&nbsp;
      <a href="#M001105">list_1</a>&nbsp;&nbsp;
      <a href="#M001109">list_2</a>&nbsp;&nbsp;
      <a href="#M001113">list_3</a>&nbsp;&nbsp;
      <a href="#M001119">list_4</a>&nbsp;&nbsp;
      <a href="#M001117">report</a>&nbsp;&nbsp;
      <a href="#M001118">state_change</a>&nbsp;&nbsp;
      <a href="#M001107">update_1</a>&nbsp;&nbsp;
      <a href="#M001111">update_2</a>&nbsp;&nbsp;
      <a href="#M001114">update_3</a>&nbsp;&nbsp;
      <a href="#M001121">update_4</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001116" class="method-detail">
        <a name="M001116"></a>

        <div class="method-heading">
          <a href="#M001116" class="method-signature">
          <span class="method-name">changexs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改 仲裁庭报酬调整系数
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001116-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 327</span>
327:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">changexs</span>
328:     <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
329:     <span class="ruby-identifier">award_money</span>  = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>,  <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
330:     <span class="ruby-identifier">jixiao_money</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
331:     <span class="ruby-identifier">base_money</span>   = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
332: 
333:     <span class="ruby-identifier">xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
334:     <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">xishu</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:xs</span>][<span class="ruby-identifier">:xishu</span>]
335:     <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">remark</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:xs</span>][<span class="ruby-identifier">:remark</span>]
336:     
337:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">award_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">jixiao_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
338:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败，基本报酬、稿酬和绩效报酬都为0才允许修改！&quot;</span>
339:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list&quot;</span>
340:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">save</span>() 
341:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
342:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list&quot;</span>
343:     <span class="ruby-keyword kw">else</span>
344:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
345:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;lsit&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
346:     <span class="ruby-keyword kw">end</span>
347:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001108" class="method-detail">
        <a name="M001108"></a>

        <div class="method-heading">
          <a href="#M001108" class="method-signature">
          <span class="method-name">delete_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 报酬删除
当金额为零的时候是不可以删除的，<a
href="TbBonusPenalty.html">TbBonusPenalty</a>的del_set会将 view_num
的值减小1
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001108-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_1</span>
119:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>]
120:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
121:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
122:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>
123:     )
124:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
125:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
126:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
127:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>    = <span class="ruby-value">0</span>
128:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade</span>  = <span class="ruby-value str">&quot;&quot;</span>
129:       <span class="ruby-comment cmt"># remun.remark = &quot;&quot; 备注不能删，有可能是助理录入的</span>
130:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
131:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'gc_rmb'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_f</span>,<span class="ruby-value">0</span>)
132:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
133:       <span class="ruby-keyword kw">else</span>
134:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
135:       <span class="ruby-keyword kw">end</span>
136:     <span class="ruby-keyword kw">else</span>
137:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败,本案报酬已经发放！&quot;</span>
138:     <span class="ruby-keyword kw">end</span>
139:     <span class="ruby-comment cmt"># redirect_to :action=&gt;&quot;list_1&quot;, :yyy =&gt; yyy, :evaluate =&gt; params[:evaluate]</span>
140:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
141:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001112" class="method-detail">
        <a name="M001112"></a>

        <div class="method-heading">
          <a href="#M001112" class="method-signature">
          <span class="method-name">delete_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001112-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 201</span>
201:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_2</span>
202:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>]
203:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
204:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
205:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>
206:     )
207:     <span class="ruby-identifier">old_rmb</span> = <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>
208:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
209:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
210:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
211:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>    = <span class="ruby-value">0</span>
212:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade</span>  = <span class="ruby-value str">&quot;&quot;</span>
213:       <span class="ruby-comment cmt"># remun.remark = &quot;&quot; 备注不能删，有可能是助理录入的</span>
214: 
215:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
216:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>,<span class="ruby-identifier">old_rmb</span>,<span class="ruby-value">0</span>)
217:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
218:       <span class="ruby-keyword kw">else</span>
219:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
220:       <span class="ruby-keyword kw">end</span>
221:     <span class="ruby-keyword kw">else</span>
222:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败，本案报酬已经发放！&quot;</span>
223:     <span class="ruby-keyword kw">end</span>
224:     <span class="ruby-comment cmt"># redirect_to :controller=&gt;&quot;remuneration11_set&quot;, :action=&gt;&quot;list_2&quot;, :yyy =&gt; yyy, :evaluate =&gt; params[:evaluate]</span>
225:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
226:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001115" class="method-detail">
        <a name="M001115"></a>

        <div class="method-heading">
          <a href="#M001115" class="method-signature">
          <span class="method-name">delete_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001115-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 305</span>
305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_3</span>
306:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>] <span class="ruby-comment cmt"># 裁庭报酬金额</span>
307:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
308:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)
309:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
310:       <span class="ruby-comment cmt"># 删掉之前的基本报酬记录，且将 tb_bonus_penalty 表中对应记录的 zc_rmb 扣减</span>
311:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
312:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
313:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
314:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;zc_rmb&quot;</span>,<span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>)
315:       <span class="ruby-keyword kw">end</span>
316:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
317:     <span class="ruby-keyword kw">else</span>
318:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除失败&quot;</span>
319:     <span class="ruby-keyword kw">end</span>
320:     <span class="ruby-comment cmt">#redirect_to :action =&gt; &quot;list_3&quot;, :yyy =&gt; yyy</span>
321:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
322:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001106" class="method-detail">
        <a name="M001106"></a>

        <div class="method-heading">
          <a href="#M001106" class="method-signature">
          <span class="method-name">edit_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 评级
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001106-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 82</span>
82:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_1</span>
83:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
84:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001110" class="method-detail">
        <a name="M001110"></a>

        <div class="method-heading">
          <a href="#M001110" class="method-signature">
          <span class="method-name">edit_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价 修改页面准备
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001110-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 165</span>
165:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_2</span>
166:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
167:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001120" class="method-detail">
        <a name="M001120"></a>

        <div class="method-heading">
          <a href="#M001120" class="method-signature">
          <span class="method-name">edit_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬调整
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001120-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 572</span>
572:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_4</span>
573:     <span class="ruby-ivar">@remun</span>=<span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
574:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001104" class="method-detail">
        <a name="M001104"></a>

        <div class="method-heading">
          <a href="#M001104" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001104-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 3</span>
 3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 4:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 5:     <span class="ruby-ivar">@point</span> = <span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#提前结案的提示</span>
 6: 
 7:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span>
 8:       <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
 9:       <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">init</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>])
10:       <span class="ruby-ivar">@xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)
11: 
12:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">blank?</span>
13:       <span class="ruby-keyword kw">else</span>
14:         <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
15: 
16:         <span class="ruby-comment cmt"># 查询字典表中 仲裁庭报酬调整系数的选项值</span>
17:         <span class="ruby-ivar">@xishu</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9021' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
18: 
19:         <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
20:         <span class="ruby-comment cmt"># 如果当前案件只有一个仲裁员，说明是独任仲裁员</span>
21:         <span class="ruby-identifier">typ</span> = <span class="ruby-ivar">@casearbitman</span>.<span class="ruby-identifier">size</span> <span class="ruby-comment cmt"># 仲裁员类型</span>
22: 
23:         <span class="ruby-comment cmt"># 本请求  应交</span>
24:         <span class="ruby-comment cmt">#c1 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
25:         <span class="ruby-comment cmt"># 本请求  应退</span>
26:         <span class="ruby-comment cmt">#c2 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and state&lt;&gt;3&quot;) || 0</span>
27:         <span class="ruby-comment cmt"># 本请求  减退</span>
28:         <span class="ruby-comment cmt">#c3 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and state&lt;&gt;3&quot;) || 0</span>
29:         <span class="ruby-comment cmt"># 反请求  应交</span>
30:         <span class="ruby-comment cmt">#c4 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
31:         <span class="ruby-comment cmt"># 反请求  应退</span>
32:         <span class="ruby-comment cmt">#c5 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and state&lt;&gt;3&quot;) || 0</span>
33:         <span class="ruby-comment cmt"># 反请求  减退</span>
34:         <span class="ruby-comment cmt">#c6 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and state&lt;&gt;3&quot;) || 0</span>
35: 
36:         <span class="ruby-comment cmt"># 此处zcf1 应当是实收费用，而不是应收费！！！！！！</span>
37: 
38:         <span class="ruby-comment cmt"># 实交（本+反）</span>
39:         <span class="ruby-identifier">c7</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
40:         <span class="ruby-comment cmt"># 实退（本+反）</span>
41:         <span class="ruby-identifier">c8</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
42: 
43: 
44:         <span class="ruby-comment cmt"># 实收 = 实交 - 实退</span>
45:         <span class="ruby-identifier">c9</span> = <span class="ruby-identifier">c7</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8</span>
46: 
47: 
48:         <span class="ruby-comment cmt">#@zcf1 = (c1 - (c2 - c3)) + (c4 - (c5 - c6))      税前仲裁费 = 应收费 =  本请求应收费 + 反请求应收费； 应收费 = 应交 -（应退 - 减退）</span>
49:         <span class="ruby-ivar">@zcf1</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-identifier">c9</span>)
50:         <span class="ruby-ivar">@zcf2</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-ivar">@zcf1</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.945</span>)<span class="ruby-comment cmt">#.round   # 税后仲裁费</span>
51:         <span class="ruby-ivar">@zcf3</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-identifier">hds</span>(<span class="ruby-ivar">@zcf2</span>,<span class="ruby-identifier">typ</span>))<span class="ruby-comment cmt">#.round  # 报酬核定数</span>
52:         <span class="ruby-ivar">@tzxs</span> = <span class="ruby-identifier">tzxs</span>(<span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu</span>) <span class="ruby-comment cmt"># 仲裁庭报酬调整系数</span>
53:         <span class="ruby-ivar">@yyy</span>  = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-ivar">@zcf3</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@tzxs</span>)<span class="ruby-comment cmt">#.round</span>
54:         <span class="ruby-ivar">@jjj</span>   = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.55</span>)<span class="ruby-comment cmt">#.round</span>
55: 
56:         <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;yes&quot;</span>  <span class="ruby-comment cmt"># 是否计算稿酬和绩效报酬标记，yes：计算；no：不计算。如果是独任仲裁员案件，且仲裁费（税后）小于 20000，不需要计算</span>
57:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@zcf2</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">20000</span>
58:           <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;no&quot;</span>
59:         <span class="ruby-keyword kw">end</span>
60: 
61:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCasedelay</span>.<span class="ruby-identifier">find_by_recevice_code_and_used</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">&quot;Y&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">caseendbook_id_last!</span>=<span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span> <span class="ruby-operator">-</span> <span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">caseendbook_id_last</span>).<span class="ruby-identifier">decideDate</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>
62:           <span class="ruby-ivar">@point</span> = <span class="ruby-node">&quot;本案没有延期,而且提前#{@case.finally_limit_dat - TbCaseendbook.find(@case.caseendbook_id_last).decideDate}天结案&quot;</span>
63:         <span class="ruby-keyword kw">end</span>
64:         
65:       <span class="ruby-keyword kw">end</span>
66:     <span class="ruby-keyword kw">end</span>
67:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001105" class="method-detail">
        <a name="M001105"></a>

        <div class="method-heading">
          <a href="#M001105" class="method-signature">
          <span class="method-name">list_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作信息 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001105-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 72</span>
72:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_1</span>
73:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
74:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
75:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
76:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
77:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
78:     <span class="ruby-keyword kw">end</span>
79:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001109" class="method-detail">
        <a name="M001109"></a>

        <div class="method-heading">
          <a href="#M001109" class="method-signature">
          <span class="method-name">list_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001109-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 146</span>
146:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2</span>
147:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
148:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
149:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
150:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
151:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
152:     <span class="ruby-keyword kw">end</span>
153:     <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(
154:       <span class="ruby-node">&quot;select tb_arbitmen.code as code ,tb_arbitmen.name as name
155:        from tb_casearbitmen ,tb_arbitmen
156:        where tb_casearbitmen.recevice_code='#{session[:recevice_code_2]}' and tb_casearbitmen.used='Y'
157:              and tb_casearbitmen.arbitman=tb_arbitmen.code
158:        order by tb_arbitmen.name&quot;</span> )
159:     <span class="ruby-ivar">@rs1</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9023' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
160:     <span class="ruby-ivar">@rs2</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9024' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
161:     <span class="ruby-ivar">@rs3</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9025' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
162:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001113" class="method-detail">
        <a name="M001113"></a>

        <div class="method-heading">
          <a href="#M001113" class="method-signature">
          <span class="method-name">list_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001113-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 231</span>
231:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_3</span>
232:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
233:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
234:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
235:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
236:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
237:       <span class="ruby-ivar">@case_remun_state</span> = <span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]) <span class="ruby-comment cmt">#提交出纳状态 true：已提交  false：未提交</span>
238:       <span class="ruby-ivar">@paid</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt"># 状态发放  true：已发放  false：未发放</span>
239:       <span class="ruby-identifier">num</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt">#计数器 已发放个数</span>
240:       <span class="ruby-identifier">casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>)
241:       <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">man</span><span class="ruby-operator">|</span>
242:         <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{man.arbitman}' and used='Y' &quot;</span>)
243:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">bp</span>.<span class="ruby-identifier">blank?</span>
244:          <span class="ruby-identifier">num</span> = <span class="ruby-identifier">num</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">bp</span>.<span class="ruby-identifier">extend_code</span>.<span class="ruby-identifier">blank?</span>
245:         <span class="ruby-keyword kw">end</span>
246:       <span class="ruby-keyword kw">end</span>
247:       <span class="ruby-ivar">@paid</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
248:     <span class="ruby-keyword kw">end</span>
249:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001119" class="method-detail">
        <a name="M001119"></a>

        <div class="method-heading">
          <a href="#M001119" class="method-signature">
          <span class="method-name">list_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员总报酬列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001119-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 557</span>
557:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_4</span>
558:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
559:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
560:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
561:       <span class="ruby-ivar">@arbitman</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find_by_sql</span>(
562:         <span class="ruby-node">&quot;select b.*,a.arbitmantype from tb_bonus_penalties b
563:          left join tb_casearbitmen a on a.arbitman = b.p and a.used='Y'
564:          where b.recevice_code='#{session[:recevice_code_2]}' and a.recevice_code='#{session[:recevice_code_2]}' and b.used='Y' and b.typ='0001'
565:          order by a.arbitmantype
566:         &quot;</span>
567:       )
568:     <span class="ruby-keyword kw">end</span>
569:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001117" class="method-detail">
        <a name="M001117"></a>

        <div class="method-heading">
          <a href="#M001117" class="method-signature">
          <span class="method-name">report</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
报酬报表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001117-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 350</span>
350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">report</span>
351:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
352:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
353:     <span class="ruby-ivar">@xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)    
354:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">blank?</span>
355:       <span class="ruby-ivar">@remun_state</span>={<span class="ruby-value str">&quot;N&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;不发放&quot;</span>,<span class="ruby-value str">&quot;Y&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;提交出纳发放&quot;</span>}
356:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
357: 
358:       <span class="ruby-comment cmt"># 开庭次数</span>
359:       <span class="ruby-ivar">@sitting_times</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot; used = 'Y' AND recevice_code='#{ca_rc}'&quot;</span>);
360: 
361:       <span class="ruby-comment cmt"># 查询字典表中 仲裁庭报酬调整系数的选项值</span>
362:       <span class="ruby-ivar">@xishu</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9021' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
363: 
364:       <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
365:       <span class="ruby-comment cmt"># 如果当前案件只有一个仲裁员，说明是独任仲裁员</span>
366:       <span class="ruby-identifier">typ</span> = <span class="ruby-ivar">@casearbitman</span>.<span class="ruby-identifier">size</span> <span class="ruby-comment cmt"># 仲裁员类型</span>
367: 
368: <span class="ruby-comment cmt">#      # 本请求  应交</span>
369: <span class="ruby-comment cmt">#      c1 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
370: <span class="ruby-comment cmt">#      # 本请求  减交</span>
371: <span class="ruby-comment cmt">#      c8 = TbShouldCharge.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
372: <span class="ruby-comment cmt">#      # 本请求  应退</span>
373: <span class="ruby-comment cmt">#      c2 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
374: <span class="ruby-comment cmt">#      # 本请求  减退</span>
375: <span class="ruby-comment cmt">#      c3 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and (state = 4 or state = 2)&quot;) || 0</span>
376: <span class="ruby-comment cmt">#      # 反请求  应交</span>
377: <span class="ruby-comment cmt">#      c4 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
378: <span class="ruby-comment cmt">#      # 反请求  减交</span>
379: <span class="ruby-comment cmt">#      c9 = TbShouldCharge.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
380: <span class="ruby-comment cmt">#      # 反请求  应退</span>
381: <span class="ruby-comment cmt">#      c5 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
382: <span class="ruby-comment cmt">#      # 反请求  减退</span>
383: <span class="ruby-comment cmt">#      c6 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
384: <span class="ruby-comment cmt">#</span>
385: <span class="ruby-comment cmt">#      @zcf1 = (c1 - c8 - (c2 - c3)) + (c4 - c9 - (c5 - c6)) # 税前仲裁费 = 应收费 =  本请求应收费 + 反请求应收费； 应收费 = 应交 -（应退 - 减退）</span>
386:       
387:       <span class="ruby-comment cmt"># 实交（本+反）</span>
388:       <span class="ruby-identifier">c7</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
389:       <span class="ruby-comment cmt"># 实退（本+反）</span>
390:       <span class="ruby-identifier">c8</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
391: 
392: 
393:       <span class="ruby-comment cmt"># 实收 = 实交 - 实退</span>
394:       <span class="ruby-identifier">c9</span> = <span class="ruby-identifier">c7</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8</span>
395: 
396: 
397:       <span class="ruby-comment cmt">#@zcf1 = (c1 - (c2 - c3)) + (c4 - (c5 - c6))      税前仲裁费 = 应收费 =  本请求应收费 + 反请求应收费； 应收费 = 应交 -（应退 - 减退）</span>
398:       <span class="ruby-ivar">@zcf1</span> = <span class="ruby-identifier">c9</span>
399:       <span class="ruby-ivar">@zcf2</span> = (<span class="ruby-ivar">@zcf1</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.945</span>).<span class="ruby-identifier">round</span>   <span class="ruby-comment cmt"># 税后仲裁费</span>
400:       <span class="ruby-ivar">@zcf3</span> = <span class="ruby-identifier">hds</span>(<span class="ruby-ivar">@zcf2</span>,<span class="ruby-identifier">typ</span>).<span class="ruby-identifier">round</span>  <span class="ruby-comment cmt"># 报酬核定数</span>
401:       <span class="ruby-ivar">@tzxs</span> = <span class="ruby-identifier">tzxs</span>(<span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu</span>) <span class="ruby-comment cmt"># 仲裁庭报酬调整系数</span>
402:       <span class="ruby-ivar">@yyy</span>  = (<span class="ruby-ivar">@zcf3</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@tzxs</span>).<span class="ruby-identifier">round</span>
403:       <span class="ruby-ivar">@jjj</span>  = (<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.55</span>).<span class="ruby-identifier">round</span>
404:       
405:       <span class="ruby-ivar">@kkk</span>  = (<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.15</span>).<span class="ruby-identifier">round</span>     <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
406:       <span class="ruby-ivar">@lll</span>  = (<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span>      <span class="ruby-comment cmt"># 仲裁员绩效报酬</span>
407:       <span class="ruby-ivar">@aaa</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报酬  首席</span>
408:       <span class="ruby-ivar">@bbb</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报错  申请方</span>
409:       <span class="ruby-ivar">@ccc</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报酬  被申请方</span>
410: 
411: 
412: 
413: 
414:       <span class="ruby-ivar">@zcy1</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 完整裁决书         承担人</span>
415:       <span class="ruby-ivar">@zcy2</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭意见         承担人</span>
416:       <span class="ruby-ivar">@zcy3</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  承担人</span>
417: 
418:       <span class="ruby-ivar">@dj1</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 完整裁决书         等级</span>
419:       <span class="ruby-ivar">@dj2</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭意见         等级</span>
420:       <span class="ruby-ivar">@dj3</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  等级</span>
421: 
422:       <span class="ruby-ivar">@je1</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 完整裁决书         金额</span>
423:       <span class="ruby-ivar">@je2</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 仲裁庭意见         金额</span>
424:       <span class="ruby-ivar">@je3</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  金额</span>
425: 
426:       <span class="ruby-ivar">@jx1</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>).<span class="ruby-identifier">round</span>
427:       <span class="ruby-ivar">@jx2</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.25</span>).<span class="ruby-identifier">round</span>
428:       <span class="ruby-ivar">@jx3</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.25</span>).<span class="ruby-identifier">round</span>
429: 
430:       <span class="ruby-ivar">@dj4</span> = <span class="ruby-value str">&quot;&quot;</span>
431:       <span class="ruby-ivar">@dj5</span> = <span class="ruby-value str">&quot;&quot;</span>
432:       <span class="ruby-ivar">@dj6</span> = <span class="ruby-value str">&quot;&quot;</span>
433: 
434:       <span class="ruby-ivar">@je4</span> = <span class="ruby-value">0</span>
435:       <span class="ruby-ivar">@je5</span> = <span class="ruby-value">0</span>
436:       <span class="ruby-ivar">@je6</span> = <span class="ruby-value">0</span>
437: 
438:       <span class="ruby-ivar">@zje1</span> = <span class="ruby-value">0</span>
439:       <span class="ruby-ivar">@zje2</span> = <span class="ruby-value">0</span>
440:       <span class="ruby-ivar">@zje3</span> = <span class="ruby-value">0</span>  
441:       
442:       <span class="ruby-ivar">@zct</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭组成</span>
443:         
444:       <span class="ruby-ivar">@arbitmantype</span> = {<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;独&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;首&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申&quot;</span>,<span class="ruby-value str">&quot;0004&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被&quot;</span>}
445:       <span class="ruby-ivar">@arbit</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
446:         select tb_casearbitmen.arbitmantype as arbitmantype,tb_casearbitmen.arbitman as arbitman ,
447:                tb_arbitmen.name as name ,tb_dictionaries.data_text as arbitmansign
448:         from  tb_casearbitmen,tb_arbitmen,tb_dictionaries
449:         where tb_dictionaries.typ_code='0015' and tb_casearbitmen.recevice_code=#{@case.recevice_code} and
450:               tb_casearbitmen.arbitman=tb_arbitmen.code and
451:               tb_casearbitmen.arbitmansign=tb_dictionaries.data_val and
452:               tb_casearbitmen.used='Y' order by tb_casearbitmen.arbitmantype
453:         &quot;</span>)
454:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@arbit</span>.<span class="ruby-identifier">empty?</span>
455:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">arb</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbit</span>
456:           <span class="ruby-ivar">@zct</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@arbitmantype</span>[<span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">name</span>(<span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmansign</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>
457:           
458:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
459:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
460:             <span class="ruby-ivar">@aaa</span> = <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
461:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
462:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
463:             <span class="ruby-ivar">@bbb</span> =  <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
464:           <span class="ruby-keyword kw">else</span>
465:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
466:             <span class="ruby-ivar">@ccc</span> =  <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
467:           <span class="ruby-keyword kw">end</span>
468:         <span class="ruby-keyword kw">end</span>
469:         <span class="ruby-ivar">@zct</span> = <span class="ruby-ivar">@zct</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-ivar">@zct</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">30</span>)
470:       <span class="ruby-keyword kw">end</span>
471: 
472:       <span class="ruby-comment cmt"># 独任仲裁员案件，如果仲裁费（税后）少于20000，直接指定报酬为6000，报表页面不显示该项指。</span>
473:       <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;yes&quot;</span>
474:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@typ</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@zcf2</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">20000</span>
475:         <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;no&quot;</span>
476:       <span class="ruby-keyword kw">end</span>
477: 
478:       <span class="ruby-comment cmt"># 裁决书报酬</span>
479:       <span class="ruby-ivar">@r_a</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{ca_rc}'&quot;</span> )
480:       <span class="ruby-identifier">dj</span> = {<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;A  很好&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;B  较好&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;C  一般&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;D  差&quot;</span>}
481:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@r_a</span>
482:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
483:           <span class="ruby-ivar">@zcy1</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
484:           <span class="ruby-ivar">@dj1</span> = <span class="ruby-identifier">dj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
485:           <span class="ruby-ivar">@je1</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
486:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
487:           <span class="ruby-ivar">@zcy2</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
488:           <span class="ruby-ivar">@dj2</span> = <span class="ruby-identifier">dj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
489:           <span class="ruby-ivar">@je2</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
490:         <span class="ruby-keyword kw">else</span>
491:           <span class="ruby-ivar">@zcy3</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
492:           <span class="ruby-ivar">@dj3</span> = <span class="ruby-identifier">dj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
493:           <span class="ruby-ivar">@je3</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
494:         <span class="ruby-keyword kw">end</span>
495:       <span class="ruby-keyword kw">end</span>
496: 
497:       <span class="ruby-comment cmt"># 绩效报酬</span>
498:       <span class="ruby-ivar">@r_a</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{ca_rc}'&quot;</span>)
499:       <span class="ruby-identifier">jxdj</span> = {<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;A  100%&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;B  75%&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;C  50%&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;D  25%&quot;</span>, <span class="ruby-value str">&quot;0005&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;D  0%&quot;</span>}
500:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@r_a</span>
501:         <span class="ruby-identifier">man</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and arbitman='#{r.p_code}'&quot;</span> ) <span class="ruby-comment cmt">#used ='Y' and </span>
502:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
503:           <span class="ruby-ivar">@dj4</span> = <span class="ruby-identifier">jxdj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
504:           <span class="ruby-ivar">@je4</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
505:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
506:           <span class="ruby-ivar">@dj5</span> = <span class="ruby-identifier">jxdj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
507:           <span class="ruby-ivar">@je5</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
508:         <span class="ruby-keyword kw">else</span>
509:           <span class="ruby-ivar">@dj6</span> = <span class="ruby-identifier">jxdj</span>[<span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade</span>]
510:           <span class="ruby-ivar">@je6</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
511:         <span class="ruby-keyword kw">end</span>
512:       <span class="ruby-keyword kw">end</span>
513: 
514:       <span class="ruby-identifier">bonus</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find_by_sql</span>(
515:         <span class="ruby-node">&quot;select b.*,a.arbitmantype from tb_bonus_penalties b
516:          left join tb_casearbitmen a on a.arbitman = b.p and a.used='Y'
517:          where b.recevice_code='#{ca_rc}' and a.recevice_code='#{ca_rc}' and b.used='Y' and b.typ='0001'
518:          order by a.arbitmantype
519:         &quot;</span>
520:       )
521: 
522:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">bonus</span>
523:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
524:           <span class="ruby-ivar">@zje1</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
525:         <span class="ruby-keyword kw">elsif</span>  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
526:           <span class="ruby-ivar">@zje2</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
527:         <span class="ruby-keyword kw">else</span>
528:           <span class="ruby-ivar">@zje3</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
529:         <span class="ruby-keyword kw">end</span>
530:       <span class="ruby-keyword kw">end</span>
531: 
532:       <span class="ruby-comment cmt"># 时间</span>
533:       <span class="ruby-ivar">@t</span> = <span class="ruby-value str">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>
534:       <span class="ruby-identifier">rb</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc}&quot;</span>)
535:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">rb</span>.<span class="ruby-identifier">blank?</span>
536:         <span class="ruby-identifier">tim</span> = <span class="ruby-identifier">rb</span>.<span class="ruby-identifier">t2</span>
537:         <span class="ruby-ivar">@t</span> = <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">year</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;年&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">month</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;月&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">day</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;日&quot;</span>
538:       <span class="ruby-keyword kw">end</span>
539:     <span class="ruby-keyword kw">end</span>
540:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001118" class="method-detail">
        <a name="M001118"></a>

        <div class="method-heading">
          <a href="#M001118" class="method-signature">
          <span class="method-name">state_change</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
发放状态变更
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001118-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 543</span>
543:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">state_change</span>
544:     <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
545:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'N'</span>
546:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> = <span class="ruby-value str">'Y'</span>
547:     <span class="ruby-keyword kw">else</span>
548:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> = <span class="ruby-value str">'N'</span>
549:     <span class="ruby-keyword kw">end</span>
550:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
551:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;report&quot;</span>
552:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001107" class="method-detail">
        <a name="M001107"></a>

        <div class="method-heading">
          <a href="#M001107" class="method-signature">
          <span class="method-name">update_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 评价&amp;报酬录入
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001107-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 87</span>
 87:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_1</span>
 88:     <span class="ruby-identifier">evaluate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:evaluate</span>]
 89:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
 90:     <span class="ruby-identifier">kkk</span> = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.15</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
 91:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
 92:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>)
 93:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])<span class="ruby-comment cmt"># 如果该仲裁员的报酬还未发放且未提交才可以修改</span>
 94:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">evaluate</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;yes&quot;</span> <span class="ruby-comment cmt"># 如果是独任仲裁员案件，且仲裁费（税后）小于 20000，则只评价，不计算</span>
 95:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = (<span class="ruby-identifier">kkk</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cjsdj</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:grade</span>])).<span class="ruby-identifier">round</span>
 96:       <span class="ruby-keyword kw">else</span>
 97:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = <span class="ruby-value">0</span>
 98:       <span class="ruby-keyword kw">end</span>
 99:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
100:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
101:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
102:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'gc_rmb'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_f</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>)
103:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作成功&quot;</span>
104:         <span class="ruby-comment cmt">#redirect_to :action=&gt;&quot;list_1&quot;, :yyy =&gt; yyy, :evaluate =&gt; evaluate</span>
105:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
106:       <span class="ruby-keyword kw">else</span>
107:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作失败&quot;</span>
108:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>, <span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
109:       <span class="ruby-keyword kw">end</span>
110:     <span class="ruby-keyword kw">else</span>
111:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作失败，本案报酬已经发放！&quot;</span>
112:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
113:     <span class="ruby-keyword kw">end</span>
114:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001111" class="method-detail">
        <a name="M001111"></a>

        <div class="method-heading">
          <a href="#M001111" class="method-signature">
          <span class="method-name">update_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001111-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 170</span>
170:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_2</span>
171:     <span class="ruby-identifier">evaluate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:evaluate</span>]
172:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
173:     <span class="ruby-identifier">lll</span> = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
174:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
175:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>)
176:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]) <span class="ruby-comment cmt"># 如果该仲裁员的报酬还为发放才可以修改</span>
177:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">evaluate</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;yes&quot;</span> <span class="ruby-comment cmt"># 如果是独任仲裁员案件，且仲裁费（税后）小于 20000，则只评价，不计算</span>
178:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = (<span class="ruby-identifier">lll</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cjsdj</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:grade</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">jx</span>(<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>)).<span class="ruby-identifier">round</span>
179:       <span class="ruby-keyword kw">else</span>
180:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = <span class="ruby-value">0</span>
181:       <span class="ruby-keyword kw">end</span>
182:       
183:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
184:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
185:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
186:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_f</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>)
187:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
188:         <span class="ruby-comment cmt"># redirect_to :action =&gt; &quot;list_2&quot;, :id =&gt; params[:id], :yyy =&gt; yyy, :evaluate =&gt; evaluate</span>
189:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
190:       <span class="ruby-keyword kw">else</span>
191:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
192:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
193:       <span class="ruby-keyword kw">end</span>
194:     <span class="ruby-keyword kw">else</span>
195:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败，本案报酬已经发放！&quot;</span>
196:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
197:     <span class="ruby-keyword kw">end</span>
198:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001114" class="method-detail">
        <a name="M001114"></a>

        <div class="method-heading">
          <a href="#M001114" class="method-signature">
          <span class="method-name">update_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬录入
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001114-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 252</span>
252:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_3</span>
253:     <span class="ruby-identifier">zcf2</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:zcf2</span>].<span class="ruby-identifier">to_i</span>
254:     <span class="ruby-identifier">yyy</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
255:     <span class="ruby-identifier">jjj</span>   = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.55</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 仲裁员基本报酬</span>
256:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
257:     <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
258:     <span class="ruby-keyword kw">begin</span>
259:       <span class="ruby-comment cmt"># 计算每一位仲裁员的基本报酬</span>
260:       <span class="ruby-identifier">casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
261:       <span class="ruby-identifier">count</span> = <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">size</span>
262:       
263:       <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">man</span><span class="ruby-operator">|</span>
264:         
265:         <span class="ruby-identifier">rem</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">new</span>()
266:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">recevice_code</span>
267:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">case_code</span>
268:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">general_code</span>
269:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>        = <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitman</span>
270:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span>
271:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">&quot;0001&quot;</span>
272:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">u2</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
273:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">t2</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
274: 
275:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span> <span class="ruby-comment cmt"># 首席或独任</span>
276:           <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>     = (<span class="ruby-identifier">jjj</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>).<span class="ruby-identifier">round</span> <span class="ruby-comment cmt"># 首席或独任仲裁员报酬为 jjj（仲裁员基本报酬）的50%</span>
277:         <span class="ruby-keyword kw">else</span>
278:           <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>     = (<span class="ruby-identifier">jjj</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.25</span>).<span class="ruby-identifier">round</span> <span class="ruby-comment cmt"># 普通仲裁员报酬为 jjj（仲裁员基本报酬）的25%</span>
279:         <span class="ruby-keyword kw">end</span>
280: 
281:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">count</span> <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">zcf2</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-value">20000</span>
282:           <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span> = <span class="ruby-value">6000</span> <span class="ruby-comment cmt"># 税后仲裁费如果小于等于20000且是独任案件，直接指定报酬为 6000</span>
283:         <span class="ruby-keyword kw">end</span>
284: 
285:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">save</span>()
286: 
287:         <span class="ruby-comment cmt"># 在 delete_3中删除基本报酬的时候使用 del_set 方法会将 view_num 字段减 1，所以在创建的时候要先添加 然后再更新</span>
288:         <span class="ruby-comment cmt"># 添加基本报酬的时候要给 view_num 加1 ，但是添加稿酬或者绩效报酬的时候不应该改变 view_num 字段的值</span>
289:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>)
290:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>,<span class="ruby-value">0</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>)
291:       <span class="ruby-keyword kw">end</span>
292:     <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
293:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;===================================================================&quot;</span>
294:       <span class="ruby-identifier">puts</span> <span class="ruby-identifier">err</span>
295:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;===================================================================&quot;</span>
296:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]  = <span class="ruby-value str">&quot;修改失败&quot;</span>
297:     <span class="ruby-keyword kw">else</span>
298:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
299:     <span class="ruby-keyword kw">end</span>
300:     <span class="ruby-comment cmt">#render :action =&gt; &quot;list_3&quot;, :yyy =&gt; yyy</span>
301:      <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
302:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001121" class="method-detail">
        <a name="M001121"></a>

        <div class="method-heading">
          <a href="#M001121" class="method-signature">
          <span class="method-name">update_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001121-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration11_set_controller.rb, line 577</span>
577:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_4</span>
578:     <span class="ruby-ivar">@remun</span>=<span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
579:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">extend_code</span><span class="ruby-operator">==</span><span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
580:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
581:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
582:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
583:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
584:         <span class="ruby-comment cmt">#redirect_to :action=&gt;&quot;list_4&quot;</span>
585:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
586:       <span class="ruby-keyword kw">else</span>
587:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
588:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_4&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
589:       <span class="ruby-keyword kw">end</span>
590:     <span class="ruby-keyword kw">else</span>
591:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败，本案报酬已经发放！&quot;</span>
592:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
593:     <span class="ruby-keyword kw">end</span>
594:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>