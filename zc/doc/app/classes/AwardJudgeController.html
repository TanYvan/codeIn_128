<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: AwardJudgeController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">AwardJudgeController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/award_judge_controller_rb.html">
                app/controllers/award_judge_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
校核评价
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001888">judge_create</a>&nbsp;&nbsp;
      <a href="#M001891">judge_delete</a>&nbsp;&nbsp;
      <a href="#M001889">judge_edit</a>&nbsp;&nbsp;
      <a href="#M001886">judge_list</a>&nbsp;&nbsp;
      <a href="#M001887">judge_new</a>&nbsp;&nbsp;
      <a href="#M001890">judge_update</a>&nbsp;&nbsp;
      <a href="#M001885">list</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001888" class="method-detail">
        <a name="M001888"></a>

        <div class="method-heading">
          <a href="#M001888" class="method-signature">
          <span class="method-name">judge_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001888-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001888-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 219</span>
219:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_create</span>
220:     <span class="ruby-ivar">@a_case</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitmantype&quot;</span>)
221: 
222:     <span class="ruby-ivar">@judge</span>=<span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:judge</span>])
223:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
224:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
225:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
226:     <span class="ruby-identifier">i</span>=<span class="ruby-value">1</span>
227:     <span class="ruby-ivar">@a_case</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
228:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
229:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman1</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
230:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">i</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
231:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman2</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
232:       <span class="ruby-keyword kw">else</span>
233:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman3</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
234:       <span class="ruby-keyword kw">end</span>
235:       <span class="ruby-identifier">i</span>=<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
236:     <span class="ruby-keyword kw">end</span>
237:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">save</span>
238:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
239:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;judge_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
240:     <span class="ruby-keyword kw">else</span>
241:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
242:       <span class="ruby-identifier">render_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;judge_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
243:     <span class="ruby-keyword kw">end</span>
244:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001891" class="method-detail">
        <a name="M001891"></a>

        <div class="method-heading">
          <a href="#M001891" class="method-signature">
          <span class="method-name">judge_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001891-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001891-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 430</span>
430:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_delete</span>
431:     <span class="ruby-ivar">@judge</span>=<span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
432:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
433:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
434:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
435:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">save</span>
436:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
437:     <span class="ruby-keyword kw">else</span>
438:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
439:     <span class="ruby-keyword kw">end</span>
440:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;judge_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
441:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001889" class="method-detail">
        <a name="M001889"></a>

        <div class="method-heading">
          <a href="#M001889" class="method-signature">
          <span class="method-name">judge_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001889-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001889-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 246</span>
246:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_edit</span>
247: 
248:     <span class="ruby-ivar">@flag1</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示完整裁决书评价</span>
249:     <span class="ruby-ivar">@flag2</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示仲裁庭意见评价</span>
250:     <span class="ruby-ivar">@flag3</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示中间裁决、部分裁决评价</span>
251:     <span class="ruby-identifier">award</span> = <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y'&quot;</span>)
252:     <span class="ruby-identifier">awarddetail</span> = <span class="ruby-keyword kw">nil</span>
253:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">award</span>.<span class="ruby-identifier">blank?</span>
254:       <span class="ruby-identifier">awarddetail</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
255:         <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'typ,draftsman_typ,draftsman'</span>,
256:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and (typ='0002' or typ='0003' or typ='0005') &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
257:       )
258:     <span class="ruby-keyword kw">end</span>
259:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
260:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;系统未查询到裁决书制作信息！无法进行校核评价&quot;</span>
261:     <span class="ruby-keyword kw">else</span>
262:       <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
263:         <span class="ruby-ivar">@flag1</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
264:         <span class="ruby-ivar">@flag2</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
265:         <span class="ruby-ivar">@flag3</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0005&quot;</span>
266:       <span class="ruby-keyword kw">end</span>
267:     <span class="ruby-keyword kw">end</span>
268: 
269:     <span class="ruby-ivar">@judge</span>=<span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
270:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
271:     <span class="ruby-ivar">@case_code</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
272:     <span class="ruby-ivar">@c3</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>]).<span class="ruby-identifier">name</span>
273:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate!</span>=<span class="ruby-keyword kw">nil</span>
274:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
275:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
276:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
277:       <span class="ruby-ivar">@sdate4</span>=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span>
278:     <span class="ruby-keyword kw">else</span>
279:       <span class="ruby-ivar">@sdate4</span>=<span class="ruby-value str">&quot;&quot;</span>
280:     <span class="ruby-keyword kw">end</span>
281:     <span class="ruby-ivar">@caseorg_date</span> = <span class="ruby-constant">TbCaseorg</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;used = 'Y' and recevice_code = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
282:     <span class="ruby-ivar">@c5</span>=<span class="ruby-value str">&quot;&quot;</span>
283:     <span class="ruby-ivar">@caseorg_date</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
284:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">orgdate</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
285:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
286:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
287:       <span class="ruby-ivar">@caseorg_date1</span> = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;  &quot;</span>
288:       <span class="ruby-ivar">@c5</span>= <span class="ruby-ivar">@c5</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@caseorg_date1</span>
289:     <span class="ruby-keyword kw">end</span>
290:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat!</span>=<span class="ruby-keyword kw">nil</span>
291:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
292:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
293:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
294:       <span class="ruby-ivar">@c6</span>=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span>
295:     <span class="ruby-keyword kw">else</span>
296:       <span class="ruby-ivar">@c6</span>=<span class="ruby-value str">&quot;&quot;</span>
297:     <span class="ruby-keyword kw">end</span>
298:     <span class="ruby-ivar">@ampliation</span>=<span class="ruby-constant">TbCasedelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
299:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ampliation!</span>=<span class="ruby-keyword kw">nil</span>
300:       <span class="ruby-ivar">@c7</span>=<span class="ruby-value str">&quot;是&quot;</span>
301:     <span class="ruby-keyword kw">else</span>
302:       <span class="ruby-ivar">@c7</span>=<span class="ruby-value str">&quot;否&quot;</span>
303:     <span class="ruby-keyword kw">end</span>
304:     <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;&quot;</span>
305:     <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;&quot;</span>
306:     <span class="ruby-ivar">@award</span>=<span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
307:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award!</span>=<span class="ruby-keyword kw">nil</span>
308:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
309:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
310:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;一般裁决&quot;</span>
311:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span>
312:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
313:         <span class="ruby-identifier">arbit</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-ivar">@award</span>.<span class="ruby-identifier">arbiter</span>])
314:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;多数/首仲裁决        持少数意见的仲裁员：&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">arbit</span>.<span class="ruby-identifier">name</span>
315:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span>
316:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
317:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;和解裁决&quot;</span>
318:       <span class="ruby-keyword kw">else</span>
319:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;撤案决定书&quot;</span>
320:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;撤案&quot;</span>
321:       <span class="ruby-keyword kw">end</span>
322:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">advice</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
323:         <span class="ruby-ivar">@c23</span>=<span class="ruby-value str">&quot;有意见       具体意见：&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">remark</span>
324:       <span class="ruby-keyword kw">else</span>
325:         <span class="ruby-ivar">@c23</span>=<span class="ruby-value str">&quot;无意见&quot;</span>
326:       <span class="ruby-keyword kw">end</span>
327:     <span class="ruby-keyword kw">else</span>
328:       <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;撤案决定/完整裁决书&quot;</span>
329:       <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;&quot;</span>
330:     <span class="ruby-keyword kw">end</span>
331:     <span class="ruby-ivar">@c11</span>=<span class="ruby-value str">&quot;&quot;</span>
332:     <span class="ruby-ivar">@c12</span>=<span class="ruby-value str">&quot;&quot;</span>
333:     <span class="ruby-ivar">@c13</span>=<span class="ruby-value str">&quot;&quot;</span>
334:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and d.typ='0001'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
335:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
336:       <span class="ruby-ivar">@draftsman_code1</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
337:       <span class="ruby-ivar">@draftsman_code_1</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
338:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-comment cmt">#仲裁员</span>
339:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code1!</span>=<span class="ruby-keyword kw">nil</span>
340:           <span class="ruby-ivar">@c11</span>=<span class="ruby-ivar">@c11</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code1</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
341:         <span class="ruby-keyword kw">end</span>
342:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#助理</span>
343:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_1!</span>=<span class="ruby-keyword kw">nil</span>
344:           <span class="ruby-ivar">@c11</span>=<span class="ruby-ivar">@c11</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_1</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
345:         <span class="ruby-keyword kw">end</span>
346:       <span class="ruby-keyword kw">end</span>
347:     <span class="ruby-keyword kw">end</span>
348:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and d.typ='0002'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
349:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
350:       <span class="ruby-ivar">@draftsman_code2</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
351:       <span class="ruby-ivar">@draftsman_code_2</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
352:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
353:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code1!</span>=<span class="ruby-keyword kw">nil</span>
354:           <span class="ruby-ivar">@c12</span>=<span class="ruby-ivar">@c12</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code2</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
355:         <span class="ruby-keyword kw">end</span>
356:       <span class="ruby-keyword kw">else</span>
357:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_2!</span>=<span class="ruby-keyword kw">nil</span>
358:           <span class="ruby-ivar">@c12</span>=<span class="ruby-ivar">@c12</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_2</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
359:         <span class="ruby-keyword kw">end</span>
360:       <span class="ruby-keyword kw">end</span>
361:     <span class="ruby-keyword kw">end</span>
362:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and (d.typ='0003' or d.typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
363:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
364:       <span class="ruby-ivar">@draftsman_code3</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
365:       <span class="ruby-ivar">@draftsman_code_3</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
366:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
367:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code3!</span>=<span class="ruby-keyword kw">nil</span>
368:           <span class="ruby-ivar">@c13</span>=<span class="ruby-ivar">@c13</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code3</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
369:         <span class="ruby-keyword kw">end</span>
370:       <span class="ruby-keyword kw">else</span>
371:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_3!</span>=<span class="ruby-keyword kw">nil</span>
372:           <span class="ruby-ivar">@c13</span>=<span class="ruby-ivar">@c13</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_3</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
373:         <span class="ruby-keyword kw">end</span>
374:       <span class="ruby-keyword kw">end</span>
375:     <span class="ruby-keyword kw">end</span>
376:     <span class="ruby-comment cmt">#费用部分</span>
377:     <span class="ruby-comment cmt">#申请人  应收=应交- （应退 - 减退 ）</span>
378:     <span class="ruby-identifier">a_f1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
379:     <span class="ruby-identifier">a_f2</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
380:     <span class="ruby-identifier">a_f3</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
381:     <span class="ruby-identifier">a_f4</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
382:     <span class="ruby-identifier">af</span> = <span class="ruby-identifier">a_f1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">a_f2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a_f3</span>.<span class="ruby-identifier">to_i</span>)
383:     <span class="ruby-ivar">@c14</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">af</span>)
384:     <span class="ruby-ivar">@c17</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f4</span>)
385:     <span class="ruby-comment cmt">#被申请人  应收 、 实收</span>
386:     <span class="ruby-identifier">a_f1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
387:     <span class="ruby-identifier">a_f22</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
388:     <span class="ruby-identifier">a_f3</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
389:     <span class="ruby-identifier">a_f4</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
390:     <span class="ruby-identifier">af</span> = <span class="ruby-identifier">a_f1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">a_f22</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a_f3</span>.<span class="ruby-identifier">to_i</span>)
391:     <span class="ruby-ivar">@c15</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">af</span>)
392:     <span class="ruby-ivar">@c18</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f4</span>)
393: 
394:     <span class="ruby-identifier">c16</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
395:     <span class="ruby-ivar">@c16</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c16</span>)
396:     <span class="ruby-identifier">c19</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
397:     <span class="ruby-ivar">@c19</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c19</span>)
398:     <span class="ruby-comment cmt">#应退费用</span>
399:     <span class="ruby-ivar">@c20</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">a_f22</span>.<span class="ruby-identifier">to_i</span>)
400:     <span class="ruby-identifier">c21</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
401:     <span class="ruby-ivar">@c21</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c21</span>)
402:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001886" class="method-detail">
        <a name="M001886"></a>

        <div class="method-heading">
          <a href="#M001886" class="method-signature">
          <span class="method-name">judge_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
校核评价列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001886-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001886-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 46</span>
46:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_list</span>
47:     <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
48:     <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y' and u='#{session[:user_code]}'&quot;</span>
49:     <span class="ruby-ivar">@judge_pages</span>, <span class="ruby-ivar">@judge</span> = <span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:tb_award_judges</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
50:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001887" class="method-detail">
        <a name="M001887"></a>

        <div class="method-heading">
          <a href="#M001887" class="method-signature">
          <span class="method-name">judge_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001887-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001887-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 52</span>
 52:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_new</span>
 53: 
 54:     <span class="ruby-ivar">@flag1</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示完整裁决书评价</span>
 55:     <span class="ruby-ivar">@flag2</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示仲裁庭意见评价</span>
 56:     <span class="ruby-ivar">@flag3</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-comment cmt"># 是否显示中间裁决、部分裁决评价</span>
 57:     <span class="ruby-identifier">award</span> = <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y'&quot;</span>)
 58:     <span class="ruby-identifier">awarddetail</span> = <span class="ruby-keyword kw">nil</span>
 59:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">award</span>.<span class="ruby-identifier">blank?</span>
 60:       <span class="ruby-identifier">awarddetail</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 61:         <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'typ,draftsman_typ,draftsman'</span>,
 62:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and (typ='0002' or typ='0003' or typ='0005') &quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
 63:       )
 64:     <span class="ruby-keyword kw">end</span>
 65:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 66:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;系统未查询到裁决书制作信息！无法进行校核评价&quot;</span>
 67:     <span class="ruby-keyword kw">else</span>
 68:       <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
 69:         <span class="ruby-ivar">@flag1</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
 70:         <span class="ruby-ivar">@flag2</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
 71:         <span class="ruby-ivar">@flag3</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0005&quot;</span>
 72:       <span class="ruby-keyword kw">end</span>
 73:     <span class="ruby-keyword kw">end</span>
 74: 
 75:     <span class="ruby-ivar">@judge</span> = <span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">new</span>()
 76:     <span class="ruby-ivar">@case</span>  = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
 77:     <span class="ruby-ivar">@case_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
 78:     <span class="ruby-ivar">@c3</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>]).<span class="ruby-identifier">name</span>
 79: 
 80:     <span class="ruby-comment cmt"># 立案日期</span>
 81:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
 82:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
 83:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
 84:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
 85:       <span class="ruby-ivar">@sdate4</span> = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span>
 86:     <span class="ruby-keyword kw">else</span>
 87:       <span class="ruby-ivar">@sdate4</span> = <span class="ruby-value str">&quot;&quot;</span>
 88:     <span class="ruby-keyword kw">end</span>
 89: 
 90:     <span class="ruby-comment cmt"># 组庭日期</span>
 91:     <span class="ruby-ivar">@caseorg_date</span> = <span class="ruby-constant">TbCaseorg</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;used = 'Y' and recevice_code = ?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
 92:     <span class="ruby-ivar">@c5</span> = <span class="ruby-value str">&quot;&quot;</span>
 93:     <span class="ruby-ivar">@caseorg_date</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
 94:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">orgdate</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
 95:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>] = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
 96:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>] = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
 97:       <span class="ruby-ivar">@caseorg_date1</span> = <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;  &quot;</span>
 98:       <span class="ruby-ivar">@c5</span>= <span class="ruby-ivar">@c5</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@caseorg_date1</span>
 99:     <span class="ruby-keyword kw">end</span>
100: 
101:     <span class="ruby-comment cmt"># 审限日期</span>
102:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat!</span>=<span class="ruby-keyword kw">nil</span>
103:       <span class="ruby-identifier">arr_date</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
104:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
105:       <span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span>
106:       <span class="ruby-ivar">@c6</span>=<span class="ruby-identifier">arr_date</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_s</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;年&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">1</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;月&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">arr_date</span>[<span class="ruby-value">2</span>]<span class="ruby-operator">+</span><span class="ruby-value str">&quot;日&quot;</span>
107:     <span class="ruby-keyword kw">else</span>
108:       <span class="ruby-ivar">@c6</span>=<span class="ruby-value str">&quot;&quot;</span>
109:     <span class="ruby-keyword kw">end</span>
110: 
111:     <span class="ruby-comment cmt">#　审限是否延期</span>
112:     <span class="ruby-ivar">@ampliation</span>=<span class="ruby-constant">TbCasedelay</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
113:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ampliation!</span>=<span class="ruby-keyword kw">nil</span>
114:       <span class="ruby-ivar">@c7</span>=<span class="ruby-value str">&quot;是&quot;</span>
115:     <span class="ruby-keyword kw">else</span>
116:       <span class="ruby-ivar">@c7</span>=<span class="ruby-value str">&quot;否&quot;</span>
117:     <span class="ruby-keyword kw">end</span>
118:     
119:     <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;&quot;</span>
120:     <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;&quot;</span>
121:     <span class="ruby-ivar">@award</span>=<span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
122:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award!</span>=<span class="ruby-keyword kw">nil</span>
123:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
124:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
125:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;一般裁决&quot;</span>
126:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span>
127:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
128:         <span class="ruby-identifier">arbit</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-ivar">@award</span>.<span class="ruby-identifier">arbiter</span>])
129:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;多数/首仲裁决        持少数意见的仲裁员：&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">arbit</span>.<span class="ruby-identifier">name</span>
130:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">end_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span>
131:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;完整裁决书&quot;</span>
132:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;和解裁决&quot;</span>
133:       <span class="ruby-keyword kw">else</span>
134:         <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;撤案决定书&quot;</span>
135:         <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;撤案&quot;</span>
136:       <span class="ruby-keyword kw">end</span>
137:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">advice</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
138:         <span class="ruby-ivar">@c23</span>=<span class="ruby-value str">&quot;有意见       具体意见：&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@award</span>.<span class="ruby-identifier">remark</span>
139:       <span class="ruby-keyword kw">else</span>
140:         <span class="ruby-ivar">@c23</span>=<span class="ruby-value str">&quot;无意见&quot;</span>
141:       <span class="ruby-keyword kw">end</span>
142:     <span class="ruby-keyword kw">else</span>
143:       <span class="ruby-ivar">@c9</span>=<span class="ruby-value str">&quot;撤案决定/完整裁决书&quot;</span>
144:       <span class="ruby-ivar">@c22</span>=<span class="ruby-value str">&quot;&quot;</span>
145:     <span class="ruby-keyword kw">end</span>
146:     <span class="ruby-ivar">@c11</span>=<span class="ruby-value str">&quot;&quot;</span>
147:     <span class="ruby-ivar">@c12</span>=<span class="ruby-value str">&quot;&quot;</span>
148:     <span class="ruby-ivar">@c13</span>=<span class="ruby-value str">&quot;&quot;</span>
149:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and d.typ='0001'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
150:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
151:       <span class="ruby-ivar">@draftsman_code1</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
152:       <span class="ruby-ivar">@draftsman_code_1</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
153:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-comment cmt">#仲裁员</span>
154:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code1!</span>=<span class="ruby-keyword kw">nil</span>
155:           <span class="ruby-ivar">@c11</span>=<span class="ruby-ivar">@c11</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code1</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
156:         <span class="ruby-keyword kw">end</span>
157:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#助理</span>
158:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_1!</span>=<span class="ruby-keyword kw">nil</span>
159:           <span class="ruby-ivar">@c11</span>=<span class="ruby-ivar">@c11</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_1</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
160:         <span class="ruby-keyword kw">end</span>
161:       <span class="ruby-keyword kw">end</span>
162:     <span class="ruby-keyword kw">end</span>
163:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and d.typ='0002'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
164:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
165:       <span class="ruby-ivar">@draftsman_code2</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
166:       <span class="ruby-ivar">@draftsman_code_2</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
167:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
168:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code1!</span>=<span class="ruby-keyword kw">nil</span>
169:           <span class="ruby-ivar">@c12</span>=<span class="ruby-ivar">@c12</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code2</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
170:         <span class="ruby-keyword kw">end</span>
171:       <span class="ruby-keyword kw">else</span>
172:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_2!</span>=<span class="ruby-keyword kw">nil</span>
173:           <span class="ruby-ivar">@c12</span>=<span class="ruby-ivar">@c12</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_2</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
174:         <span class="ruby-keyword kw">end</span>
175:       <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-keyword kw">end</span>
177:     <span class="ruby-ivar">@award2</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;d.used='Y' and d.recevice_code=? and (d.typ='0003' or d.typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as d inner join tb_awards as aa on aa.recevice_code=d.recevice_code and aa.used='Y' and d.p_id=aa.id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.draftsman as draftsman,d.draftsman_typ as draftsman_typ&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;d.id desc&quot;</span>)
178:     <span class="ruby-ivar">@award2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
179:       <span class="ruby-ivar">@draftsman_code3</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
180:       <span class="ruby-ivar">@draftsman_code_3</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and code=?&quot;</span>,<span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman</span>])
181:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a</span>.<span class="ruby-identifier">draftsman_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
182:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code3!</span>=<span class="ruby-keyword kw">nil</span>
183:           <span class="ruby-ivar">@c13</span>=<span class="ruby-ivar">@c13</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code3</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
184:         <span class="ruby-keyword kw">end</span>
185:       <span class="ruby-keyword kw">else</span>
186:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@draftsman_code_3!</span>=<span class="ruby-keyword kw">nil</span>
187:           <span class="ruby-ivar">@c13</span>=<span class="ruby-ivar">@c13</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@draftsman_code_3</span>.<span class="ruby-identifier">name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
188:         <span class="ruby-keyword kw">end</span>
189:       <span class="ruby-keyword kw">end</span>
190:     <span class="ruby-keyword kw">end</span>
191:     <span class="ruby-comment cmt">#费用部分</span>
192:     <span class="ruby-comment cmt">#申请人  应收=应交- （应退 - 减退 ）</span>
193:     <span class="ruby-identifier">a_f1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
194:     <span class="ruby-identifier">a_f2</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
195:     <span class="ruby-identifier">a_f3</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
196:     <span class="ruby-identifier">a_f4</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0001' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
197:     <span class="ruby-identifier">af</span> = <span class="ruby-identifier">a_f1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">a_f2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a_f3</span>.<span class="ruby-identifier">to_i</span>)
198:     <span class="ruby-ivar">@c14</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">af</span>)
199:     <span class="ruby-ivar">@c17</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f4</span>)
200:     <span class="ruby-comment cmt">#被申请人  应收 、 实收</span>
201:     <span class="ruby-identifier">a_f1</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
202:     <span class="ruby-identifier">a_f22</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
203:     <span class="ruby-identifier">a_f3</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
204:     <span class="ruby-identifier">a_f4</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and payment='0002' and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
205:     <span class="ruby-identifier">af</span> = <span class="ruby-identifier">a_f1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> (<span class="ruby-identifier">a_f22</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">a_f3</span>.<span class="ruby-identifier">to_i</span>)
206:     <span class="ruby-ivar">@c15</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">af</span>)
207:     <span class="ruby-ivar">@c18</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f4</span>)
208: 
209:     <span class="ruby-identifier">c16</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
210:     <span class="ruby-ivar">@c16</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c16</span>)
211:     <span class="ruby-identifier">c19</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
212:     <span class="ruby-ivar">@c19</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c19</span>)
213:     <span class="ruby-comment cmt">#应退费用</span>
214:     <span class="ruby-ivar">@c20</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">a_f2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">a_f22</span>.<span class="ruby-identifier">to_i</span>)
215:     <span class="ruby-identifier">c21</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
216:     <span class="ruby-ivar">@c21</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">compart2</span>(<span class="ruby-identifier">c21</span>)
217:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001890" class="method-detail">
        <a name="M001890"></a>

        <div class="method-heading">
          <a href="#M001890" class="method-signature">
          <span class="method-name">judge_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001890-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001890-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 404</span>
404:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">judge_update</span>
405:     <span class="ruby-ivar">@judge</span>=<span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
406:     <span class="ruby-ivar">@a_case</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitmantype&quot;</span>)
407:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
408:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
409:     <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
410:     <span class="ruby-identifier">i</span>=<span class="ruby-value">1</span>
411:     <span class="ruby-ivar">@a_case</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
412:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">i</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
413:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman1</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
414:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">i</span><span class="ruby-operator">==</span><span class="ruby-value">2</span>
415:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman2</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
416:       <span class="ruby-keyword kw">else</span>
417:         <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">arbitman3</span> = <span class="ruby-identifier">a</span>.<span class="ruby-identifier">arbitman</span>
418:       <span class="ruby-keyword kw">end</span>
419:       <span class="ruby-identifier">i</span>=<span class="ruby-identifier">i</span><span class="ruby-operator">+</span><span class="ruby-value">1</span>
420:     <span class="ruby-keyword kw">end</span>
421:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@judge</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:judge</span>])
422:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
423:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;judge_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
424:     <span class="ruby-keyword kw">else</span>
425:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
426:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;judge_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
427:     <span class="ruby-keyword kw">end</span>
428:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001885" class="method-detail">
        <a name="M001885"></a>

        <div class="method-heading">
          <a href="#M001885" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
裁决书校核评价案件选择列表，按照未进行评价和已进行评价分类显示
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001885-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001885-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/award_judge_controller.rb, line 5</span>
 5:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 6:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
 7:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
 8:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;right(c.case_code,7) desc&quot;</span>
 9:     <span class="ruby-keyword kw">end</span>
10:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
11:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
12:       <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:lines</span>]
13:     <span class="ruby-keyword kw">end</span>
14:     <span class="ruby-comment cmt">#未进行裁决书校核评价  c.state &gt;= 4  包括归档案件</span>
15:     <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;
16:             SELECT
17:               c.recevice_code,c.receivedate,c.case_code,c.nowdate,c.aribitprog_num
18:             FROM
19:               tb_cases AS c, tb_check_staffs AS s
20:             WHERE
21:               c.used = 'Y' AND c.state &gt;= 4 AND
22:               c.recevice_code NOT IN (SELECT recevice_code FROM tb_award_judges WHERE used = 'Y' AND u = '#{session[:user_code]}')
23:               AND c.recevice_code = s.recevice_code AND s.used = 'Y' AND s.typ = '0001' AND s.staff = '#{session[:user_code]}' order by #{@order}
24:           &quot;</span>
25:     <span class="ruby-ivar">@case_pages</span>,<span class="ruby-ivar">@case</span>=<span class="ruby-identifier">paginate_by_sql</span>(<span class="ruby-constant">TbCase</span>,<span class="ruby-identifier">sql</span>,<span class="ruby-value">99999</span>) <span class="ruby-comment cmt">#要求不分页</span>
26:     <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;--------------------------------------&quot;</span>
27:     <span class="ruby-identifier">puts</span> <span class="ruby-identifier">sql</span>
28:     <span class="ruby-comment cmt">#已进行裁决书校核评价  c.state &gt;= 4  c.state &lt; 220</span>
29:     <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;
30:             SELECT
31:               c.recevice_code,c.receivedate,c.case_code,c.nowdate,c.aribitprog_num
32:             FROM
33:               tb_cases AS c,tb_check_staffs AS s
34:             WHERE
35:               c.used = 'Y' AND c.state &gt;= 4 AND c.state &lt; 220 AND
36:               c.recevice_code IN (SELECT recevice_code FROM tb_award_judges WHERE used = 'Y' AND u = '#{session[:user_code]}')
37:               AND c.recevice_code = s.recevice_code AND s.used = 'Y' AND s.typ = '0001' AND s.staff = '#{session[:user_code]}'
38:             ORDER BY
39:               #{@order}
40:          &quot;</span>
41:     <span class="ruby-ivar">@case2_pages</span>,<span class="ruby-ivar">@case2</span>=<span class="ruby-identifier">paginate_by_sql</span>(<span class="ruby-constant">TbCase</span>,<span class="ruby-identifier">sql</span>,<span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>)
42:     <span class="ruby-ivar">@num_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select c.recevice_code from tb_cases as c,tb_check_staffs as s where c.used='Y' and c.state&gt;=4  and c.state&lt;220 and c.recevice_code in (select recevice_code from tb_award_judges where used='Y' and u='#{session[:user_code]}') and c.recevice_code=s.recevice_code and s.used='Y' and s.typ='0001' and s.staff='#{session[:user_code]}' order by #{@order}&quot;</span>).<span class="ruby-identifier">length</span>
43:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>