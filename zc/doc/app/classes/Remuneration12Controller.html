<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Remuneration12Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Remuneration12Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/remuneration12_controller_rb.html">
                app/controllers/remuneration12_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000207">create_1</a>&nbsp;&nbsp;
      <a href="#M000208">create_1_all</a>&nbsp;&nbsp;
      <a href="#M000214">create_2</a>&nbsp;&nbsp;
      <a href="#M000211">delete_1</a>&nbsp;&nbsp;
      <a href="#M000217">delete_2</a>&nbsp;&nbsp;
      <a href="#M000209">edit_1</a>&nbsp;&nbsp;
      <a href="#M000215">edit_2</a>&nbsp;&nbsp;
      <a href="#M000204">list</a>&nbsp;&nbsp;
      <a href="#M000205">list_1</a>&nbsp;&nbsp;
      <a href="#M000212">list_2</a>&nbsp;&nbsp;
      <a href="#M000206">new_1</a>&nbsp;&nbsp;
      <a href="#M000213">new_2</a>&nbsp;&nbsp;
      <a href="#M000210">update_1</a>&nbsp;&nbsp;
      <a href="#M000216">update_2</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000207" class="method-detail">
        <a name="M000207"></a>

        <div class="method-heading">
          <a href="#M000207" class="method-signature">
          <span class="method-name">create_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 创建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000207-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000207-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_1</span>
30:     <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
31:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and typ='0001'
32:                       and p='#{params[:remun][:p_code]}' and used='Y' and extend_code&lt;&gt;''&quot;</span>
33:     ) <span class="ruby-comment cmt"># 当前案件session[:recevice_code_1] 当前仲裁员params[:remun][:p_code] 且 已经发放</span>
34: 
35:     <span class="ruby-comment cmt"># 不可以录入相同的记录</span>
36:     <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>]])
37:     <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>]])
38: 
39:     <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
40:       <span class="ruby-identifier">:all</span>,
41:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code_1]}'&quot;</span>,
42:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
43:     ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
44: 
45:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
46:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,与现有记录重复！&quot;</span>
47:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
48:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
49:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,该裁决书制作者另有他人！&quot;</span>
50:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
51:     <span class="ruby-keyword kw">else</span>
52:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># 该仲裁员报酬未发放  如果报酬已经发放则不可以创建</span>
53:         <span class="ruby-ivar">@remun</span>               = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
54:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
55:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
56:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
57:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">'0001'</span>
58:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
59:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
60:           <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">grade_xs</span> = <span class="ruby-value">100</span>
61:         <span class="ruby-keyword kw">else</span>
62:           <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">grade_xs</span> = <span class="ruby-value">0</span>
63:         <span class="ruby-keyword kw">end</span>
64:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
65:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
66:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
67:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
68:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
69:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
70:         <span class="ruby-keyword kw">else</span>
71:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
72:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_1&quot;</span>
73:         <span class="ruby-keyword kw">end</span>
74:       <span class="ruby-keyword kw">else</span>
75:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;本案件中该仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;如果有继续发放报酬的需求，请通过报酬奖励方式进行（报酬奖励模块大概在处长操作中）。&quot;</span>
76:       <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-keyword kw">end</span>
78:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000208" class="method-detail">
        <a name="M000208"></a>

        <div class="method-heading">
          <a href="#M000208" class="method-signature">
          <span class="method-name">create_1_all</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 批量创建
从裁决书报校核信息读取裁决书制作信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000208-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000208-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 81</span>
 81:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_1_all</span>
 82:     <span class="ruby-identifier">notice</span> = <span class="ruby-value str">&quot;&quot;</span>
 83:     <span class="ruby-comment cmt"># 查找所有的校核信息</span>
 84:     <span class="ruby-identifier">award</span> = <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>)
 85:     <span class="ruby-identifier">awarddetail</span> = <span class="ruby-keyword kw">nil</span>
 86:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">award</span>.<span class="ruby-identifier">blank?</span>
 87:       <span class="ruby-identifier">awarddetail</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
 88:         <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'typ,draftsman_typ,draftsman'</span>,
 89:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and (typ='0002' or typ='0003' or typ='0005') &quot;</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
 90:       )
 91:     <span class="ruby-keyword kw">end</span>
 92:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">awarddetail</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
 93:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;无法根据校核信息创建，请手工创建！&quot;</span>
 94:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
 95:     <span class="ruby-keyword kw">else</span>
 96:       <span class="ruby-identifier">type</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9022' and data_val&lt;&gt;'0000' and used='y'&quot;</span>) <span class="ruby-comment cmt"># 裁决书类型</span>
 97:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
 98:         <span class="ruby-identifier">:all</span>,
 99:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code]}'&quot;</span>,
100:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
101:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>] = <span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>; <span class="ruby-identifier">k</span>} <span class="ruby-comment cmt"># 仲裁员类型</span>
102: 
103:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">t</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">type</span>
104:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
105:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0002&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
106:         <span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0005&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
107:         <span class="ruby-identifier">ad</span> = <span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
108:           <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-node">&quot;recevice_code=? and used='Y' and p_id=? and draftsman_typ='0001' and typ='#{typ}'&quot;</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-identifier">award</span>.<span class="ruby-identifier">id</span>]
109:         )
110:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ad</span>.<span class="ruby-identifier">blank?</span>
111:           <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(
112:             <span class="ruby-identifier">:first</span>,
113:             <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and typ='0001'
114:                             and p='#{ad.draftsman}' and used='Y' and extend_code&lt;&gt;''&quot;</span>
115:           )
116:           <span class="ruby-comment cmt"># 不可以录入相同的记录</span>
117:           <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>,<span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>])
118:           <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y'&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>])
119: 
120:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
121:             <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;与现有记录重复；&lt;br/&gt;&quot;</span>
122:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
123:             <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;该裁决书制作者另有他人；&lt;br/&gt;&quot;</span>
124:           <span class="ruby-keyword kw">else</span>
125:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>  <span class="ruby-comment cmt"># 如果已经录入了金额或者已经发放则不可以修改</span>
126:               <span class="ruby-identifier">remun</span>               = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>
127:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span>          =  <span class="ruby-value str">'Y'</span>
128:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
129:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
130:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
131:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">'0001'</span>
132:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">data_val</span>
133:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>        = <span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>
134:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>]
135:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">remark</span>        = <span class="ruby-value str">&quot;&quot;</span>
136:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
137:                 <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade_xs</span> = <span class="ruby-value">100</span>
138:               <span class="ruby-keyword kw">else</span>
139:                 <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade_xs</span> = <span class="ruby-value">0</span>
140:               <span class="ruby-keyword kw">end</span>
141:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
142:               <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
143:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">save</span>()
144:                 <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">ad</span>.<span class="ruby-identifier">draftsman</span>)
145:               <span class="ruby-keyword kw">end</span>
146:             <span class="ruby-keyword kw">else</span>
147:               <span class="ruby-identifier">notice</span> = <span class="ruby-identifier">notice</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;&quot;</span>
148:             <span class="ruby-keyword kw">end</span>
149:           <span class="ruby-keyword kw">end</span>
150:         <span class="ruby-keyword kw">end</span>
151:       <span class="ruby-keyword kw">end</span>
152:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-identifier">notice</span>.<span class="ruby-identifier">blank?</span><span class="ruby-value">? </span><span class="ruby-value str">&quot;创建完成！&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-value str">&quot;由于以下原因，创建失败，请手工创建：&lt;br/&gt;&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">notice</span>
153:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_1&quot;</span>
154:     <span class="ruby-keyword kw">end</span>
155:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000214" class="method-detail">
        <a name="M000214"></a>

        <div class="method-heading">
          <a href="#M000214" class="method-signature">
          <span class="method-name">create_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 创建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000214-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000214-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 247</span>
247:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_2</span>
248:     <span class="ruby-identifier">extend</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(
249:       <span class="ruby-identifier">:first</span>,
250:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and
251:                       typ='0001' and p='#{params[:remun][:p_code]}' and
252:                       used='Y' and extend_code&lt;&gt;''&quot;</span>
253:     )
254: 
255:     <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
256:       <span class="ruby-identifier">:all</span>,
257:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code]}'&quot;</span>,
258:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
259:     ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
260: 
261:     <span class="ruby-identifier">rem</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and used='Y' and p_code=?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]])
262:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
263:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败,请勿重复录入！&quot;</span>
264:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_2&quot;</span>
265:     <span class="ruby-keyword kw">else</span>
266:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">extend</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
267:         <span class="ruby-ivar">@remun</span>               = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
268:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
269:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:case_code_1</span>]
270:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:general_code_1</span>]
271:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">&quot;0001&quot;</span>
272:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
273:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
274:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
275:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
276:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>,  <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
277:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
278:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
279:         <span class="ruby-keyword kw">else</span>
280:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
281:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;new_2&quot;</span>
282:         <span class="ruby-keyword kw">end</span>
283:       <span class="ruby-keyword kw">else</span>
284:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;本案件中该仲裁员的报酬已经发放完毕(发放编号为#{extend.extend_code})。&lt;br/&gt;如果有继续发放报酬的需求，请通过报酬奖励方式进行（报酬奖励模块大概在处长操作中）。&quot;</span>
285:       <span class="ruby-keyword kw">end</span>
286:     <span class="ruby-keyword kw">end</span>
287: 
288:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000211" class="method-detail">
        <a name="M000211"></a>

        <div class="method-heading">
          <a href="#M000211" class="method-signature">
          <span class="method-name">delete_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000211-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000211-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 200</span>
200:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_1</span>
201:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
202:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span><span class="ruby-operator">==</span><span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
203:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
204:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
205:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
206:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>(<span class="ruby-keyword kw">false</span>)
207:         <span class="ruby-comment cmt"># 删除的时候应当使用 del_set 方法，这样才可以将 view_mun 的值减 1</span>
208:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;gc_rmb&quot;</span>,<span class="ruby-value">0</span>)
209:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
210:       <span class="ruby-keyword kw">else</span>
211:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
212:       <span class="ruby-keyword kw">end</span>
213: 
214:     <span class="ruby-keyword kw">else</span>
215:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败,因为该报酬额已生成.&quot;</span>
216:     <span class="ruby-keyword kw">end</span>
217:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list_1&quot;</span>
218:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000217" class="method-detail">
        <a name="M000217"></a>

        <div class="method-heading">
          <a href="#M000217" class="method-signature">
          <span class="method-name">delete_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000217-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000217-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 318</span>
318:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_2</span>
319:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
320:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
321:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
322:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>   = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
323:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>   = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
324:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">save</span>
325:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>], <span class="ruby-value str">'0001'</span>, <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;zc_rmb&quot;</span>,<span class="ruby-value">0</span>)
326:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
327:       <span class="ruby-keyword kw">else</span>
328:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除失败&quot;</span>
329:       <span class="ruby-keyword kw">end</span>
330:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
331:     <span class="ruby-keyword kw">end</span>
332:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000209" class="method-detail">
        <a name="M000209"></a>

        <div class="method-heading">
          <a href="#M000209" class="method-signature">
          <span class="method-name">edit_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 修改
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000209-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000209-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 158</span>
158:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_1</span>
159:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
160:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000215" class="method-detail">
        <a name="M000215"></a>

        <div class="method-heading">
          <a href="#M000215" class="method-signature">
          <span class="method-name">edit_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 修改
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000215-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000215-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 291</span>
291:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_2</span>
292:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
293:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000204" class="method-detail">
        <a name="M000204"></a>

        <div class="method-heading">
          <a href="#M000204" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000204-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000204-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 4</span>
 4:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 5:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>]
 6:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 7:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
 8:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
 9:     <span class="ruby-keyword kw">end</span>
10:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000205" class="method-detail">
        <a name="M000205"></a>

        <div class="method-heading">
          <a href="#M000205" class="method-signature">
          <span class="method-name">list_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000205-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000205-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 13</span>
13:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_1</span>
14:     <span class="ruby-identifier">flash</span>.<span class="ruby-identifier">now</span> <span class="ruby-comment cmt"># 设置flash信息只在当前action有效，不带入到下个action</span>
15:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
16:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
17:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>])
18:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>
19:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
20:     <span class="ruby-keyword kw">end</span>
21:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000212" class="method-detail">
        <a name="M000212"></a>

        <div class="method-heading">
          <a href="#M000212" class="method-signature">
          <span class="method-name">list_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000212-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000212-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 223</span>
223:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2</span>
224:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
225:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
226:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>])
227:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_1]}' and used='Y'&quot;</span>
228:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
229:     <span class="ruby-keyword kw">end</span>
230:     <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(
231:       <span class="ruby-node">&quot;select tb_arbitmen.code as code ,tb_arbitmen.name as name
232:        from tb_casearbitmen ,tb_arbitmen
233:        where tb_casearbitmen.recevice_code='#{session[:recevice_code_1]}' and tb_casearbitmen.used='Y'
234:              and tb_casearbitmen.arbitman=tb_arbitmen.code
235:        order by tb_arbitmen.name&quot;</span> )
236:     <span class="ruby-ivar">@rs1</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9023' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
237:     <span class="ruby-ivar">@rs2</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9024' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
238:     <span class="ruby-ivar">@rs3</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9025' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
239:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000206" class="method-detail">
        <a name="M000206"></a>

        <div class="method-heading">
          <a href="#M000206" class="method-signature">
          <span class="method-name">new_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 新建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000206-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000206-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 24</span>
24:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_1</span>
25:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">new</span>()
26:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000213" class="method-detail">
        <a name="M000213"></a>

        <div class="method-heading">
          <a href="#M000213" class="method-signature">
          <span class="method-name">new_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 新建
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000213-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000213-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 242</span>
242:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_2</span>
243:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">new</span>()
244:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000210" class="method-detail">
        <a name="M000210"></a>

        <div class="method-heading">
          <a href="#M000210" class="method-signature">
          <span class="method-name">update_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——裁决书制作信息 更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000210-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000210-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 163</span>
163:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_1</span>
164:     <span class="ruby-identifier">rem1</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and p_code=? and typ=? and used='Y' and id&lt;&gt;?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
165:     <span class="ruby-identifier">rem2</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;recevice_code=? and typ=? and used='Y' and id&lt;&gt;?&quot;</span>,<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]])
166: 
167:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rem1</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
168:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败,与现有记录重复！&quot;</span>
169:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
170:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">rem2</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
171:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败,该裁决书制作者另有他人！&quot;</span>
172:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
173:     <span class="ruby-keyword kw">else</span>
174:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
175:         <span class="ruby-identifier">:all</span>,
176:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{session[:recevice_code_1]}'&quot;</span>,
177:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
178:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
179:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
180:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
181:         <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:arbitman_type</span>] = <span class="ruby-identifier">arbitman</span>[<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>]]
182:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
183:         <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
184:         <span class="ruby-identifier">p</span> = <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>
185:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
186:           <span class="ruby-comment cmt"># 修改裁决书信息的时候 需要更新 tb_bonus_penalty 表，否则tb_bonus_penalty的p字段不会改变</span>
187:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">p</span>)
188:           <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_1</span>],<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:p_code</span>])
189:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
190:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list_1&quot;</span>
191:         <span class="ruby-keyword kw">else</span>
192:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
193:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
194:         <span class="ruby-keyword kw">end</span>
195:       <span class="ruby-keyword kw">end</span>
196:     <span class="ruby-keyword kw">end</span>
197:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000216" class="method-detail">
        <a name="M000216"></a>

        <div class="method-heading">
          <a href="#M000216" class="method-signature">
          <span class="method-name">update_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬——绩效考评 更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000216-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000216-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_controller.rb, line 296</span>
296:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_2</span>
297:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
298:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
299:       <span class="ruby-identifier">arbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(
300:         <span class="ruby-identifier">:all</span>,
301:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{@remun.recevice_code}'&quot;</span>,
302:         <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;arbitman,arbitmantype&quot;</span>
303:       ).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>,<span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>[<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitman</span>]=<span class="ruby-identifier">v</span>.<span class="ruby-identifier">arbitmantype</span>;<span class="ruby-identifier">k</span>}
304:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u1</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
305:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t1</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
306:       <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:arbitman_type</span>] = <span class="ruby-identifier">arbitman</span>[<span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">p_code</span>]
307:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
308:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
309:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list_2&quot;</span>
310:       <span class="ruby-keyword kw">else</span>
311:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
312:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
313:       <span class="ruby-keyword kw">end</span>
314:     <span class="ruby-keyword kw">end</span>
315:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>