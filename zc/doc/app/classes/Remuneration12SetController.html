<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Remuneration12SetController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Remuneration12SetController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/remuneration12_set_controller_rb.html">
                app/controllers/remuneration12_set_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001282">changexs</a>&nbsp;&nbsp;
      <a href="#M001274">delete_1</a>&nbsp;&nbsp;
      <a href="#M001278">delete_2</a>&nbsp;&nbsp;
      <a href="#M001281">delete_3</a>&nbsp;&nbsp;
      <a href="#M001272">edit_1</a>&nbsp;&nbsp;
      <a href="#M001276">edit_2</a>&nbsp;&nbsp;
      <a href="#M001286">edit_4</a>&nbsp;&nbsp;
      <a href="#M001270">list</a>&nbsp;&nbsp;
      <a href="#M001271">list_1</a>&nbsp;&nbsp;
      <a href="#M001275">list_2</a>&nbsp;&nbsp;
      <a href="#M001279">list_3</a>&nbsp;&nbsp;
      <a href="#M001285">list_4</a>&nbsp;&nbsp;
      <a href="#M001283">report</a>&nbsp;&nbsp;
      <a href="#M001284">state_change</a>&nbsp;&nbsp;
      <a href="#M001273">update_1</a>&nbsp;&nbsp;
      <a href="#M001277">update_2</a>&nbsp;&nbsp;
      <a href="#M001280">update_3</a>&nbsp;&nbsp;
      <a href="#M001287">update_4</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001282" class="method-detail">
        <a name="M001282"></a>

        <div class="method-heading">
          <a href="#M001282" class="method-signature">
          <span class="method-name">changexs</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
修改 仲裁庭报酬调整系数
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001282-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001282-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 350</span>
350:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">changexs</span>
351:     <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
352:     <span class="ruby-identifier">award_money</span>  = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>,  <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
353:     <span class="ruby-identifier">jixiao_money</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
354:     <span class="ruby-identifier">base_money</span>   = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
355: 
356:     <span class="ruby-identifier">xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
357:     <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">xishu2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:xs</span>][<span class="ruby-identifier">:xishu2</span>]
358:     <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">remark</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:xs</span>][<span class="ruby-identifier">:remark</span>]
359: 
360:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">base_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">award_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">jixiao_money</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
361:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败，基本报酬、稿酬和绩效报酬都为0才允许修改！&quot;</span>
362:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list&quot;</span>
363:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">xs</span>.<span class="ruby-identifier">save</span>()
364:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
365:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list&quot;</span>
366:     <span class="ruby-keyword kw">else</span>
367:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
368:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;lsit&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
369:     <span class="ruby-keyword kw">end</span>
370:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001274" class="method-detail">
        <a name="M001274"></a>

        <div class="method-heading">
          <a href="#M001274" class="method-signature">
          <span class="method-name">delete_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 报酬删除
当金额为零的时候是不可以删除的，<a
href="TbBonusPenalty.html">TbBonusPenalty</a>的del_set会将 view_num
的值减小1
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001274-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001274-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 140</span>
140:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_1</span>
141:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>]
142:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
143:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
144:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>
145:     )
146:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
147:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
148:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
149:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>    = <span class="ruby-value">0</span>
150:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade</span>  = <span class="ruby-value str">&quot;&quot;</span>
151:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade_xs</span> = <span class="ruby-value">0</span>
152:       <span class="ruby-comment cmt"># remun.remark = &quot;&quot; 备注不能删，有可能是助理录入的</span>
153:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
154:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'gc_rmb'</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_f</span>,<span class="ruby-value">0</span>)
155:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
156:       <span class="ruby-keyword kw">else</span>
157:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
158:       <span class="ruby-keyword kw">end</span>
159:     <span class="ruby-keyword kw">else</span>
160:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败,本案报酬已经发放！&quot;</span>
161:     <span class="ruby-keyword kw">end</span>
162:     <span class="ruby-comment cmt"># redirect_to :action=&gt;&quot;list_1&quot;, :yyy =&gt; yyy, :evaluate =&gt; params[:evaluate]</span>
163:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
164:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001278" class="method-detail">
        <a name="M001278"></a>

        <div class="method-heading">
          <a href="#M001278" class="method-signature">
          <span class="method-name">delete_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001278-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001278-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 224</span>
224:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_2</span>
225:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>]
226:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
227:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
228:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>
229:     )
230:     <span class="ruby-identifier">old_rmb</span> = <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>
231:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
232:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>     = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
233:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>     = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
234:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>    = <span class="ruby-value">0</span>
235:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">grade</span>  = <span class="ruby-value str">&quot;&quot;</span>
236:       <span class="ruby-comment cmt"># remun.remark = &quot;&quot; 备注不能删，有可能是助理录入的</span>
237: 
238:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
239:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>,<span class="ruby-identifier">old_rmb</span>,<span class="ruby-value">0</span>)
240:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
241:       <span class="ruby-keyword kw">else</span>
242:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
243:       <span class="ruby-keyword kw">end</span>
244:     <span class="ruby-keyword kw">else</span>
245:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败，本案报酬已经发放！&quot;</span>
246:     <span class="ruby-keyword kw">end</span>
247:     <span class="ruby-comment cmt"># redirect_to :controller=&gt;&quot;remuneration11_set&quot;, :action=&gt;&quot;list_2&quot;, :yyy =&gt; yyy, :evaluate =&gt; params[:evaluate]</span>
248:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
249:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001281" class="method-detail">
        <a name="M001281"></a>

        <div class="method-heading">
          <a href="#M001281" class="method-signature">
          <span class="method-name">delete_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬删除
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001281-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001281-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 328</span>
328:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_3</span>
329:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>] <span class="ruby-comment cmt"># 裁庭报酬金额</span>
330:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
331:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)
332:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">size</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
333:       <span class="ruby-comment cmt"># 删掉之前的基本报酬记录，且将 tb_bonus_penalty 表中对应记录的 zc_rmb 扣减</span>
334:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">r</span><span class="ruby-operator">|</span>
335:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
336:         <span class="ruby-identifier">r</span>.<span class="ruby-identifier">save</span>
337:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">del_set</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">&quot;zc_rmb&quot;</span>,<span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>)
338:       <span class="ruby-keyword kw">end</span>
339:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除成功&quot;</span>
340:     <span class="ruby-keyword kw">else</span>
341:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;删除失败&quot;</span>
342:     <span class="ruby-keyword kw">end</span>
343:     <span class="ruby-comment cmt">#redirect_to :action =&gt; &quot;list_3&quot;, :yyy =&gt; yyy</span>
344:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
345:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001272" class="method-detail">
        <a name="M001272"></a>

        <div class="method-heading">
          <a href="#M001272" class="method-signature">
          <span class="method-name">edit_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 评级
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001272-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001272-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 102</span>
102:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_1</span>
103:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
104:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001276" class="method-detail">
        <a name="M001276"></a>

        <div class="method-heading">
          <a href="#M001276" class="method-signature">
          <span class="method-name">edit_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价 修改页面准备
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001276-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001276-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 188</span>
188:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_2</span>
189:     <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
190:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001286" class="method-detail">
        <a name="M001286"></a>

        <div class="method-heading">
          <a href="#M001286" class="method-signature">
          <span class="method-name">edit_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬调整
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001286-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001286-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 577</span>
577:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_4</span>
578:     <span class="ruby-ivar">@remun</span>=<span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
579:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001270" class="method-detail">
        <a name="M001270"></a>

        <div class="method-heading">
          <a href="#M001270" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001270-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001270-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 4</span>
 4:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 5:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 6:     <span class="ruby-ivar">@point</span> = <span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#提前结案的提示</span>
 7: 
 8:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span>
 9:       <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
10:       <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">init</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>])
11:       <span class="ruby-ivar">@xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)
12:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@xs</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
13:         <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu2</span>=<span class="ruby-value">1</span>
14:         <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">save</span>
15:       <span class="ruby-keyword kw">end</span>
16: 
17:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">blank?</span>
18:       <span class="ruby-keyword kw">else</span>
19:         <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
20: 
21:         <span class="ruby-comment cmt"># 查询字典表中 仲裁庭报酬调整系数的选项值</span>
22:         <span class="ruby-ivar">@xishu</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9021' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
23: 
24:         <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
25:         <span class="ruby-comment cmt"># 如果当前案件只有一个仲裁员，说明是独任仲裁员</span>
26:         <span class="ruby-identifier">typ</span> = <span class="ruby-ivar">@casearbitman</span>.<span class="ruby-identifier">size</span> <span class="ruby-comment cmt"># 仲裁员类型</span>
27: 
28:         <span class="ruby-comment cmt"># 本请求  应交</span>
29:         <span class="ruby-comment cmt">#c1 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
30:         <span class="ruby-comment cmt"># 本请求  应退</span>
31:         <span class="ruby-comment cmt">#c2 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and state&lt;&gt;3&quot;) || 0</span>
32:         <span class="ruby-comment cmt"># 本请求  减退</span>
33:         <span class="ruby-comment cmt">#c3 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and state&lt;&gt;3&quot;) || 0</span>
34:         <span class="ruby-comment cmt"># 反请求  应交</span>
35:         <span class="ruby-comment cmt">#c4 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
36:         <span class="ruby-comment cmt"># 反请求  应退</span>
37:         <span class="ruby-comment cmt">#c5 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and state&lt;&gt;3&quot;) || 0</span>
38:         <span class="ruby-comment cmt"># 反请求  减退</span>
39:         <span class="ruby-comment cmt">#c6 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and state&lt;&gt;3&quot;) || 0</span>
40: 
41:         <span class="ruby-comment cmt"># 此处zcf1 应当是实收费用，而不是应收费！！！！！！</span>
42: 
43:         <span class="ruby-comment cmt"># 实交（本+反）</span>
44:         <span class="ruby-identifier">c7</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
45:         <span class="ruby-identifier">c7_0001</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
46:         <span class="ruby-identifier">c7_0002</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
47:         <span class="ruby-comment cmt"># 实退（本+反）</span>
48:         <span class="ruby-identifier">c8</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
49:         <span class="ruby-identifier">c8_0001</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
50:         <span class="ruby-identifier">c8_0002</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
51: 
52:         <span class="ruby-comment cmt"># 实收 = 实交 - 实退</span>
53:         <span class="ruby-identifier">c9</span> = <span class="ruby-identifier">c7</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8</span>
54: 
55:         <span class="ruby-identifier">aribitprog</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>).<span class="ruby-identifier">aribitprog_num</span>
56:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0007'</span><span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select tb_should_charges.id from tb_should_charges,tb_charges where tb_should_charges.recevice_code='#{ca_rc}' and tb_should_charges.id=tb_charges.should_id and tb_should_charges.payment='0001' and ticket_typ='0001' and tb_should_charges.used='Y' and tb_charges.used='Y' and tb_charges.state=2&quot;</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select id from tb_parties where recevice_code='#{ca_rc}' and used='Y' and partytype=1 and left(area,3)&lt;&gt;'001'&quot;</span>).<span class="ruby-identifier">empty?</span>
57:           <span class="ruby-identifier">c_b</span> = <span class="ruby-identifier">c7_0001</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8_0001</span>
58:         <span class="ruby-keyword kw">else</span>
59:           <span class="ruby-identifier">c_b</span> = (<span class="ruby-identifier">c7_0001</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8_0001</span>) <span class="ruby-operator">*</span> (<span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-value">0</span><span class="ruby-value">.0672</span>)
60:         <span class="ruby-keyword kw">end</span>
61: 
62: 
63:         <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0007'</span><span class="ruby-operator">||</span> <span class="ruby-identifier">aribitprog</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select tb_should_charges.id from tb_should_charges,tb_charges where tb_should_charges.recevice_code='#{ca_rc}' and tb_should_charges.id=tb_charges.should_id and tb_should_charges.payment='0002' and ticket_typ='0001' and tb_should_charges.used='Y' and tb_charges.used='Y' and tb_charges.state=2&quot;</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span> <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select id from tb_parties where recevice_code='#{ca_rc}'  and used='Y' and partytype=2 and left(area,3)&lt;&gt;'001'&quot;</span>).<span class="ruby-identifier">empty?</span>
64:           <span class="ruby-identifier">c_f</span> = <span class="ruby-identifier">c7_0002</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8_0002</span>
65:         <span class="ruby-keyword kw">else</span>
66:           <span class="ruby-identifier">c_f</span> = (<span class="ruby-identifier">c7_0002</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8_0002</span>) <span class="ruby-operator">*</span> (<span class="ruby-value">1</span> <span class="ruby-operator">-</span> <span class="ruby-value">0</span><span class="ruby-value">.0672</span>)
67:         <span class="ruby-keyword kw">end</span>
68: 
69:         <span class="ruby-comment cmt">#@zcf1 = (c1 - (c2 - c3)) + (c4 - (c5 - c6))      税前仲裁费 = 应收费 =  本请求应收费 + 反请求应收费； 应收费 = 应交 -（应退 - 减退）</span>
70:         <span class="ruby-ivar">@zcf1</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-identifier">c9</span>)
71:         <span class="ruby-comment cmt">#@zcf2 = SysArg.round_2(@zcf1 * 0.944)#.round   # 税后仲裁费</span>
72:         <span class="ruby-ivar">@zcf2</span> = <span class="ruby-identifier">c_b</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c_f</span>
73:         <span class="ruby-ivar">@zcf3</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-identifier">hds</span>(<span class="ruby-ivar">@zcf2</span>,<span class="ruby-identifier">typ</span>))<span class="ruby-comment cmt">#.round  # 报酬核定数</span>
74:         <span class="ruby-ivar">@tzxs</span> = <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu2</span> <span class="ruby-comment cmt"># 仲裁庭报酬调整系数</span>
75:         <span class="ruby-ivar">@yyy</span>  = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-ivar">@zcf3</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@tzxs</span>)<span class="ruby-comment cmt">#.round</span>
76:         <span class="ruby-ivar">@jjj</span>   = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round_2</span>(<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.7</span>)<span class="ruby-comment cmt">#.round</span>
77: 
78:         <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;yes&quot;</span>  <span class="ruby-comment cmt"># 是否计算稿酬和绩效报酬标记，yes：计算；no：不计算。如果是独任仲裁员案件，且仲裁费（税后）小于 20000，不需要计算</span>
79:   <span class="ruby-comment cmt">#      if typ == 1 and @zcf2 &lt;= 20000</span>
80:   <span class="ruby-comment cmt">#        @evaluate = &quot;no&quot;</span>
81:   <span class="ruby-comment cmt">#      end</span>
82:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCasedelay</span>.<span class="ruby-identifier">find_by_recevice_code_and_used</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">&quot;Y&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">caseendbook_id_last!</span>=<span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">finally_limit_dat</span> <span class="ruby-operator">-</span> <span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">caseendbook_id_last</span>).<span class="ruby-identifier">decideDate</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-value">30</span>
83:           <span class="ruby-ivar">@point</span> = <span class="ruby-node">&quot;本案没有延期,而且提前#{@case.finally_limit_dat - TbCaseendbook.find(@case.caseendbook_id_last).decideDate}天结案&quot;</span>
84:         <span class="ruby-keyword kw">end</span>
85:       <span class="ruby-keyword kw">end</span>
86:     <span class="ruby-keyword kw">end</span>
87:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001271" class="method-detail">
        <a name="M001271"></a>

        <div class="method-heading">
          <a href="#M001271" class="method-signature">
          <span class="method-name">list_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作信息 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001271-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001271-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 92</span>
92:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_1</span>
93:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
94:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
95:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
96:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
97:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'id'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
98:     <span class="ruby-keyword kw">end</span>
99:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001275" class="method-detail">
        <a name="M001275"></a>

        <div class="method-heading">
          <a href="#M001275" class="method-signature">
          <span class="method-name">list_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价 列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001275-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001275-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 169</span>
169:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2</span>
170:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
171:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
172:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
173:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
174:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
175:     <span class="ruby-keyword kw">end</span>
176:     <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(
177:       <span class="ruby-node">&quot;select tb_arbitmen.code as code ,tb_arbitmen.name as name
178:        from tb_casearbitmen ,tb_arbitmen
179:        where tb_casearbitmen.recevice_code='#{session[:recevice_code_2]}' and tb_casearbitmen.used='Y'
180:              and tb_casearbitmen.arbitman=tb_arbitmen.code
181:        order by tb_arbitmen.name&quot;</span> )
182:     <span class="ruby-ivar">@rs1</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9023' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
183:     <span class="ruby-ivar">@rs2</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9024' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
184:     <span class="ruby-ivar">@rs3</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9025' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">inject</span>({}){<span class="ruby-operator">|</span><span class="ruby-identifier">f</span>,<span class="ruby-identifier">e</span><span class="ruby-operator">|</span> <span class="ruby-identifier">f</span>[<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_val</span>]=<span class="ruby-identifier">e</span>.<span class="ruby-identifier">data_text</span>;<span class="ruby-identifier">f</span>}
185:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001279" class="method-detail">
        <a name="M001279"></a>

        <div class="method-heading">
          <a href="#M001279" class="method-signature">
          <span class="method-name">list_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001279-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001279-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 254</span>
254:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_3</span>
255:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt">#当前办理案件</span>
256:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
257:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
258:       <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>
259:       <span class="ruby-ivar">@remun</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'arbitman_type'</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
260:       <span class="ruby-ivar">@case_remun_state</span> = <span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]) <span class="ruby-comment cmt">#提交出纳状态 true：已提交  false：未提交</span>
261:       <span class="ruby-ivar">@paid</span> = <span class="ruby-keyword kw">true</span> <span class="ruby-comment cmt"># 状态发放  true：已发放  false：未发放</span>
262:       <span class="ruby-identifier">num</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt">#计数器 已发放个数</span>
263:       <span class="ruby-identifier">casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and used='Y'&quot;</span>)
264:       <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">man</span><span class="ruby-operator">|</span>
265:         <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{man.arbitman}' and used='Y' &quot;</span>)
266:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">bp</span>.<span class="ruby-identifier">blank?</span>
267:          <span class="ruby-identifier">num</span> = <span class="ruby-identifier">num</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">bp</span>.<span class="ruby-identifier">extend_code</span>.<span class="ruby-identifier">blank?</span>
268:         <span class="ruby-keyword kw">end</span>
269:       <span class="ruby-keyword kw">end</span>
270:       <span class="ruby-ivar">@paid</span> = <span class="ruby-keyword kw">false</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">num</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
271:     <span class="ruby-keyword kw">end</span>
272:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001285" class="method-detail">
        <a name="M001285"></a>

        <div class="method-heading">
          <a href="#M001285" class="method-signature">
          <span class="method-name">list_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员总报酬列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001285-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001285-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 562</span>
562:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_4</span>
563:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
564:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
565:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
566:       <span class="ruby-ivar">@arbitman</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find_by_sql</span>(
567:         <span class="ruby-node">&quot;select b.*,a.arbitmantype from tb_bonus_penalties b
568:          left join tb_casearbitmen a on a.arbitman = b.p and a.used='Y'
569:          where b.recevice_code='#{session[:recevice_code_2]}' and a.recevice_code='#{session[:recevice_code_2]}' and b.used='Y' and b.typ='0001'
570:          order by a.arbitmantype
571:         &quot;</span>
572:       )
573:     <span class="ruby-keyword kw">end</span>
574:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001283" class="method-detail">
        <a name="M001283"></a>

        <div class="method-heading">
          <a href="#M001283" class="method-signature">
          <span class="method-name">report</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
报酬报表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001283-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001283-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 373</span>
373:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">report</span>
374:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
375:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
376:     <span class="ruby-ivar">@xs</span> = <span class="ruby-constant">TbTzxs</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used = 'Y' and recevice_code = '#{ca_rc}'&quot;</span>)
377:     <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">ca_rc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">blank?</span>
378:       <span class="ruby-ivar">@remun_state</span>={<span class="ruby-value str">&quot;N&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;不发放&quot;</span>,<span class="ruby-value str">&quot;Y&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;提交出纳发放&quot;</span>}
379:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
380: 
381:       <span class="ruby-comment cmt"># 开庭次数</span>
382:       <span class="ruby-ivar">@sitting_times</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot; used = 'Y' AND recevice_code='#{ca_rc}'&quot;</span>);
383: 
384:       <span class="ruby-comment cmt"># 查询字典表中 仲裁庭报酬调整系数的选项值</span>
385:       <span class="ruby-ivar">@xishu</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;typ_code='9021' and state='Y' and used='Y'&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'data_val'</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
386: 
387:       <span class="ruby-ivar">@casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
388:       <span class="ruby-comment cmt"># 如果当前案件只有一个仲裁员，说明是独任仲裁员</span>
389:       <span class="ruby-identifier">typ</span> = <span class="ruby-ivar">@casearbitman</span>.<span class="ruby-identifier">size</span> <span class="ruby-comment cmt"># 仲裁员类型</span>
390: 
391: <span class="ruby-comment cmt">#      # 本请求  应交</span>
392: <span class="ruby-comment cmt">#      c1 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;)# || 0</span>
393: <span class="ruby-comment cmt">#      # 本请求  减交</span>
394: <span class="ruby-comment cmt">#      c8 = TbShouldCharge.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
395: <span class="ruby-comment cmt">#      # 本请求  应退</span>
396: <span class="ruby-comment cmt">#      c2 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
397: <span class="ruby-comment cmt">#      # 本请求  减退</span>
398: <span class="ruby-comment cmt">#      c3 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0001' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and (state = 4 or state = 2)&quot;) || 0</span>
399: <span class="ruby-comment cmt">#      # 反请求  应交</span>
400: <span class="ruby-comment cmt">#      c4 = TbShouldCharge.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
401: <span class="ruby-comment cmt">#      # 反请求  减交</span>
402: <span class="ruby-comment cmt">#      c9 = TbShouldCharge.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;) || 0</span>
403: <span class="ruby-comment cmt">#      # 反请求  应退</span>
404: <span class="ruby-comment cmt">#      c5 = TbShouldRefund.sum(&quot;rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
405: <span class="ruby-comment cmt">#      # 反请求  减退</span>
406: <span class="ruby-comment cmt">#      c6 = TbShouldRefund.sum(&quot;redu_rmb_money&quot;, :conditions =&gt; &quot;payment='0002' and (typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}' and (state = 4 or state = 2)&quot;) || 0</span>
407: <span class="ruby-comment cmt">#</span>
408: <span class="ruby-comment cmt">#      @zcf1 = (c1 - c8 - (c2 - c3)) + (c4 - c9 - (c5 - c6)) # 税前仲裁费 = 应收费 =  本请求应收费 + 反请求应收费； 应收费 = 应交 -（应退 - 减退）</span>
409:       <span class="ruby-comment cmt"># 实交（本+反）</span>
410:       <span class="ruby-identifier">c7</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;re_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
411:       <span class="ruby-comment cmt"># 实退（本+反）</span>
412:       <span class="ruby-identifier">c8</span> = (<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-value str">&quot;rmb_money - redu_rmb_money&quot;</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;(typ='0001' or typ='0004') and used='Y' and recevice_code='#{ca_rc}'  and  (state = 4 or state = 2)&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-value">0</span>).<span class="ruby-identifier">to_f</span>
413: 
414:       <span class="ruby-comment cmt"># 实收 = 实交 - 实退</span>
415:       <span class="ruby-identifier">c9</span> = <span class="ruby-identifier">c7</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">c8</span>
416:       <span class="ruby-ivar">@zcf1</span> = <span class="ruby-identifier">c9</span>
417:       <span class="ruby-ivar">@zcf2</span> = (<span class="ruby-ivar">@zcf1</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.944</span>).<span class="ruby-identifier">round</span>   <span class="ruby-comment cmt"># 税后仲裁费</span>
418:       <span class="ruby-ivar">@zcf3</span> = <span class="ruby-identifier">hds</span>(<span class="ruby-ivar">@zcf2</span>,<span class="ruby-identifier">typ</span>).<span class="ruby-identifier">round</span>  <span class="ruby-comment cmt"># 报酬核定数</span>
419:       <span class="ruby-ivar">@tzxs</span> = <span class="ruby-ivar">@xs</span>.<span class="ruby-identifier">xishu2</span> <span class="ruby-comment cmt"># 仲裁庭报酬调整系数</span>
420:       <span class="ruby-ivar">@yyy</span>  = (<span class="ruby-ivar">@zcf3</span> <span class="ruby-operator">*</span> <span class="ruby-ivar">@tzxs</span>).<span class="ruby-identifier">round</span>
421:       <span class="ruby-ivar">@jjj</span>  = (<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.7</span>).<span class="ruby-identifier">round</span>
422: 
423:       <span class="ruby-ivar">@kkk</span>  = (<span class="ruby-ivar">@yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span>     <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
424:       <span class="ruby-ivar">@lll</span>  = <span class="ruby-value">0</span><span class="ruby-comment cmt">#(@yyy * 0.3).round      # 仲裁员绩效报酬</span>
425:       <span class="ruby-ivar">@aaa</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报酬  首席</span>
426:       <span class="ruby-ivar">@bbb</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报错  申请方</span>
427:       <span class="ruby-ivar">@ccc</span>  = <span class="ruby-value">0</span>                       <span class="ruby-comment cmt"># 基本报酬  被申请方</span>
428: 
429: 
430:       <span class="ruby-ivar">@zcy1</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 完整裁决书         承担人</span>
431:       <span class="ruby-ivar">@zcy2</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭意见         承担人</span>
432:       <span class="ruby-ivar">@zcy3</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  承担人</span>
433: 
434:       <span class="ruby-ivar">@dj1</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 完整裁决书         等级</span>
435:       <span class="ruby-ivar">@dj2</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭意见         等级</span>
436:       <span class="ruby-ivar">@dj3</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  等级</span>
437: 
438:       <span class="ruby-ivar">@je1</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 完整裁决书         金额</span>
439:       <span class="ruby-ivar">@je2</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 仲裁庭意见         金额</span>
440:       <span class="ruby-ivar">@je3</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt"># 中间裁决、部分裁决  金额</span>
441: 
442:       <span class="ruby-ivar">@jx1</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.5</span>).<span class="ruby-identifier">round</span>
443:       <span class="ruby-ivar">@jx2</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.25</span>).<span class="ruby-identifier">round</span>
444:       <span class="ruby-ivar">@jx3</span> = (<span class="ruby-ivar">@lll</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.25</span>).<span class="ruby-identifier">round</span>
445: 
446:       <span class="ruby-ivar">@dj4</span> = <span class="ruby-value str">&quot;&quot;</span>
447:       <span class="ruby-ivar">@dj5</span> = <span class="ruby-value str">&quot;&quot;</span>
448:       <span class="ruby-ivar">@dj6</span> = <span class="ruby-value str">&quot;&quot;</span>
449: 
450:       <span class="ruby-ivar">@je4</span> = <span class="ruby-value">0</span>
451:       <span class="ruby-ivar">@je5</span> = <span class="ruby-value">0</span>
452:       <span class="ruby-ivar">@je6</span> = <span class="ruby-value">0</span>
453: 
454:       <span class="ruby-ivar">@zje1</span> = <span class="ruby-value">0</span>
455:       <span class="ruby-ivar">@zje2</span> = <span class="ruby-value">0</span>
456:       <span class="ruby-ivar">@zje3</span> = <span class="ruby-value">0</span>
457: 
458:       <span class="ruby-ivar">@zct</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 仲裁庭组成</span>
459: 
460:       <span class="ruby-ivar">@arbitmantype</span> = {<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;独&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;首&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申&quot;</span>,<span class="ruby-value str">&quot;0004&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被&quot;</span>}
461:       <span class="ruby-ivar">@arbit</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
462:         select tb_casearbitmen.arbitmantype as arbitmantype,tb_casearbitmen.arbitman as arbitman ,
463:                tb_arbitmen.name as name ,tb_dictionaries.data_text as arbitmansign
464:         from  tb_casearbitmen,tb_arbitmen,tb_dictionaries
465:         where tb_dictionaries.typ_code='0015' and tb_casearbitmen.recevice_code=#{@case.recevice_code} and
466:               tb_casearbitmen.arbitman=tb_arbitmen.code and
467:               tb_casearbitmen.arbitmansign=tb_dictionaries.data_val and
468:               tb_casearbitmen.used='Y' order by tb_casearbitmen.arbitmantype
469:         &quot;</span>)
470:       <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@arbit</span>.<span class="ruby-identifier">empty?</span>
471:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">arb</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbit</span>
472:           <span class="ruby-ivar">@zct</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@arbitmantype</span>[<span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span>] <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">name</span>(<span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmansign</span>) <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>
473: 
474:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
475:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
476:             <span class="ruby-ivar">@aaa</span> = <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
477:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
478:               <span class="ruby-ivar">@arbitman_typ</span> = <span class="ruby-value str">&quot;独任仲裁员&quot;</span>
479:             <span class="ruby-keyword kw">else</span>
480:               <span class="ruby-ivar">@arbitman_typ</span> = <span class="ruby-value str">&quot;首席仲裁员&quot;</span>
481:             <span class="ruby-keyword kw">end</span>
482:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
483:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
484:             <span class="ruby-ivar">@bbb</span> =  <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
485:           <span class="ruby-keyword kw">else</span>
486:             <span class="ruby-identifier">r_b</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc} and p_code='#{arb.arbitman}'&quot;</span> )
487:             <span class="ruby-ivar">@ccc</span> =  <span class="ruby-identifier">r_b</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-operator">?</span> <span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">r_b</span>.<span class="ruby-identifier">rmb</span>
488:           <span class="ruby-keyword kw">end</span>
489:         <span class="ruby-keyword kw">end</span>
490:         <span class="ruby-ivar">@zct</span> = <span class="ruby-ivar">@zct</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-ivar">@zct</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">-</span> <span class="ruby-value">30</span>)
491:       <span class="ruby-keyword kw">end</span>
492: 
493:       <span class="ruby-comment cmt"># 独任仲裁员案件，如果仲裁费（税后）少于20000，直接指定报酬为6000，报表页面不显示该项指。</span>
494:       <span class="ruby-ivar">@evaluate</span> = <span class="ruby-value str">&quot;yes&quot;</span>
495: <span class="ruby-comment cmt">#      if @typ == 1 and @zcf2 &lt;= 20000</span>
496: <span class="ruby-comment cmt">#        @evaluate = &quot;no&quot;</span>
497: <span class="ruby-comment cmt">#      end</span>
498: 
499:       <span class="ruby-comment cmt"># 裁决书报酬</span>
500:       <span class="ruby-ivar">@r_a</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{ca_rc}'&quot;</span> )
501:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">r</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@r_a</span>
502:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span>
503:           <span class="ruby-ivar">@zcy1</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
504:           <span class="ruby-ivar">@dj1</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade_xs</span>
505:           <span class="ruby-ivar">@je1</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
506:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">r</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
507:           <span class="ruby-ivar">@zcy2</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
508:           <span class="ruby-ivar">@dj2</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade_xs</span>
509:           <span class="ruby-ivar">@je2</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
510:         <span class="ruby-keyword kw">else</span>
511:           <span class="ruby-ivar">@zcy3</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">r</span>.<span class="ruby-identifier">p_code</span>).<span class="ruby-identifier">name</span>
512:           <span class="ruby-ivar">@dj3</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">grade_xs</span>
513:           <span class="ruby-ivar">@je3</span> = <span class="ruby-identifier">r</span>.<span class="ruby-identifier">rmb</span>
514:         <span class="ruby-keyword kw">end</span>
515:       <span class="ruby-keyword kw">end</span>
516: 
517:       <span class="ruby-identifier">bonus</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find_by_sql</span>(
518:         <span class="ruby-node">&quot;select b.*,a.arbitmantype from tb_bonus_penalties b
519:          left join tb_casearbitmen a on a.arbitman = b.p and a.used='Y'
520:          where b.recevice_code='#{ca_rc}' and a.recevice_code='#{ca_rc}' and b.used='Y' and b.typ='0001'
521:          order by a.arbitmantype
522:         &quot;</span>
523:       )
524: 
525:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">b</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">bonus</span>
526:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
527:           <span class="ruby-ivar">@zje1</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
528:         <span class="ruby-keyword kw">elsif</span>  <span class="ruby-identifier">b</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span>
529:           <span class="ruby-ivar">@zje2</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
530:         <span class="ruby-keyword kw">else</span>
531:           <span class="ruby-ivar">@zje3</span> = <span class="ruby-identifier">b</span>.<span class="ruby-identifier">zc_rmb</span><span class="ruby-operator">*</span>(<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">b</span>.<span class="ruby-identifier">gc_rmb</span>
532:         <span class="ruby-keyword kw">end</span>
533:       <span class="ruby-keyword kw">end</span>
534: 
535:       <span class="ruby-comment cmt"># 时间</span>
536:       <span class="ruby-ivar">@t</span> = <span class="ruby-value str">&quot;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&quot;</span>
537:       <span class="ruby-identifier">rb</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code=#{ca_rc}&quot;</span>)
538:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">rb</span>.<span class="ruby-identifier">blank?</span>
539:         <span class="ruby-identifier">tim</span> = <span class="ruby-identifier">rb</span>.<span class="ruby-identifier">t2</span>
540:         <span class="ruby-ivar">@t</span> = <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">year</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;年&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">month</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;月&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tim</span>.<span class="ruby-identifier">day</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;日&quot;</span>
541:       <span class="ruby-keyword kw">end</span>
542:     <span class="ruby-keyword kw">end</span>
543:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001284" class="method-detail">
        <a name="M001284"></a>

        <div class="method-heading">
          <a href="#M001284" class="method-signature">
          <span class="method-name">state_change</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
发放状态变更
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001284-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001284-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 546</span>
546:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">state_change</span>
547:     <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
548:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'N'</span>
549:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> = <span class="ruby-value str">'Y'</span>
550:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_dt</span>=<span class="ruby-constant">DateTime</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>
551:     <span class="ruby-keyword kw">else</span>
552:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_state</span> = <span class="ruby-value str">'N'</span>
553:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">remun_dt</span>=<span class="ruby-keyword kw">nil</span>
554:     <span class="ruby-keyword kw">end</span>
555:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
556:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;report&quot;</span>
557:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001273" class="method-detail">
        <a name="M001273"></a>

        <div class="method-heading">
          <a href="#M001273" class="method-signature">
          <span class="method-name">update_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
工时汇总 裁决书制作 评价&amp;报酬录入
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001273-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001273-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 107</span>
107:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_1</span>
108:     <span class="ruby-identifier">evaluate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:evaluate</span>]
109:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
110:     <span class="ruby-identifier">kkk</span> = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
111:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
112:     <span class="ruby-identifier">old_rmb</span> = <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>
113:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>)
114:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])<span class="ruby-comment cmt"># 如果该仲裁员的报酬还未发放且未提交才可以修改</span>
115:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">evaluate</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;yes&quot;</span> <span class="ruby-comment cmt"># 如果是独任仲裁员案件，且仲裁费（税后）小于 20000，则只评价，不计算</span>
116:        <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = (<span class="ruby-identifier">kkk</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:grade_xs</span>].<span class="ruby-identifier">to_f</span> <span class="ruby-operator">/</span> <span class="ruby-value">100</span>).<span class="ruby-identifier">round</span> <span class="ruby-comment cmt">#</span>
117:         <span class="ruby-comment cmt">#remun.rmb = (kkk * cjsdj(params[:remun][:grade])).round</span>
118:       <span class="ruby-keyword kw">else</span>
119:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = <span class="ruby-value">0</span>
120:       <span class="ruby-keyword kw">end</span>
121:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
122:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
123:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
124:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'gc_rmb'</span>, <span class="ruby-identifier">old_rmb</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>)
125:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作成功&quot;</span>
126:         <span class="ruby-comment cmt">#redirect_to :action=&gt;&quot;list_1&quot;, :yyy =&gt; yyy, :evaluate =&gt; evaluate</span>
127:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
128:       <span class="ruby-keyword kw">else</span>
129:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作失败,等级百分比应为数字型.&quot;</span>
130:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>, <span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
131:       <span class="ruby-keyword kw">end</span>
132:     <span class="ruby-keyword kw">else</span>
133:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;操作失败，本案报酬已经发放！&quot;</span>
134:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_1&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
135:     <span class="ruby-keyword kw">end</span>
136:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001277" class="method-detail">
        <a name="M001277"></a>

        <div class="method-heading">
          <a href="#M001277" class="method-signature">
          <span class="method-name">update_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员绩效报酬评价
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001277-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001277-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 193</span>
193:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_2</span>
194:     <span class="ruby-identifier">evaluate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:evaluate</span>]
195:     <span class="ruby-identifier">yyy</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
196:     <span class="ruby-identifier">lll</span> = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 撰写裁决书报酬</span>
197:     <span class="ruby-identifier">remun</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
198:     <span class="ruby-identifier">bp</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{session[:recevice_code_2]}' and typ='0001' and p='#{remun.p_code}' and used='Y' and extend_code=''&quot;</span>)
199:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">bp</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]) <span class="ruby-comment cmt"># 如果该仲裁员的报酬还为发放才可以修改</span>
200:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">evaluate</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;yes&quot;</span> <span class="ruby-comment cmt"># 如果是独任仲裁员案件，且仲裁费（税后）小于 20000，则只评价，不计算</span>
201:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = (<span class="ruby-identifier">lll</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">cjsdj</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>][<span class="ruby-identifier">:grade</span>]) <span class="ruby-operator">*</span> <span class="ruby-identifier">jx</span>(<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>)).<span class="ruby-identifier">round</span>
202:       <span class="ruby-keyword kw">else</span>
203:         <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span> = <span class="ruby-value">0</span>
204:       <span class="ruby-keyword kw">end</span>
205: 
206:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">u2</span>  = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
207:       <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">t2</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
208:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
209:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>],<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:old_rmb</span>].<span class="ruby-identifier">to_f</span>,<span class="ruby-identifier">remun</span>.<span class="ruby-identifier">rmb</span>)
210:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
211:         <span class="ruby-comment cmt"># redirect_to :action =&gt; &quot;list_2&quot;, :id =&gt; params[:id], :yyy =&gt; yyy, :evaluate =&gt; evaluate</span>
212:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
213:       <span class="ruby-keyword kw">else</span>
214:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
215:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
216:       <span class="ruby-keyword kw">end</span>
217:     <span class="ruby-keyword kw">else</span>
218:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败，本案报酬已经发放！&quot;</span>
219:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;edit_2&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>], <span class="ruby-identifier">:yyy</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">yyy</span>, <span class="ruby-identifier">:evaluate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">evaluate</span>
220:     <span class="ruby-keyword kw">end</span>
221:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001280" class="method-detail">
        <a name="M001280"></a>

        <div class="method-heading">
          <a href="#M001280" class="method-signature">
          <span class="method-name">update_3</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬 基本报酬录入
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001280-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001280-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 275</span>
275:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_3</span>
276:     <span class="ruby-identifier">zcf2</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:zcf2</span>].<span class="ruby-identifier">to_i</span>
277:     <span class="ruby-identifier">yyy</span>   = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:yyy</span>].<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 裁庭报酬金额</span>
278:     <span class="ruby-identifier">jjj</span>   = (<span class="ruby-identifier">yyy</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.7</span>).<span class="ruby-identifier">round</span>        <span class="ruby-comment cmt"># 仲裁员基本报酬</span>
279:     <span class="ruby-identifier">ca_rc</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>]
280:     <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ca_rc</span>)
281:     <span class="ruby-keyword kw">begin</span>
282:       <span class="ruby-comment cmt"># 计算每一位仲裁员的基本报酬</span>
283:       <span class="ruby-identifier">casearbitman</span> = <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{ca_rc}' and used='Y'&quot;</span>)
284:       <span class="ruby-identifier">count</span> = <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">size</span>
285: 
286:       <span class="ruby-identifier">casearbitman</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">man</span><span class="ruby-operator">|</span>
287: 
288:         <span class="ruby-identifier">rem</span> = <span class="ruby-constant">RemunerationBase</span>.<span class="ruby-identifier">new</span>()
289:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">recevice_code</span>
290:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">case_code</span>
291:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">general_code</span>
292:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>        = <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitman</span>
293:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">arbitman_type</span> = <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span>
294:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_typ</span>         = <span class="ruby-value str">&quot;0001&quot;</span>
295:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">u2</span>            = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
296:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">t2</span>            = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
297: 
298:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">man</span>.<span class="ruby-identifier">arbitmantype</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span> <span class="ruby-comment cmt"># 首席或独任</span>
299:           <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>     = (<span class="ruby-identifier">jjj</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.4</span>).<span class="ruby-identifier">round</span> <span class="ruby-comment cmt"># 首席或独任仲裁员报酬为 jjj（仲裁员基本报酬）的50%</span>
300:         <span class="ruby-keyword kw">else</span>
301:           <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>     = (<span class="ruby-identifier">jjj</span> <span class="ruby-operator">*</span> <span class="ruby-value">0</span><span class="ruby-value">.3</span>).<span class="ruby-identifier">round</span> <span class="ruby-comment cmt"># 普通仲裁员报酬为 jjj（仲裁员基本报酬）的25%</span>
302:         <span class="ruby-keyword kw">end</span>
303: 
304: <span class="ruby-comment cmt">#        if count == 1 and zcf2 &lt;= 20000</span>
305: <span class="ruby-comment cmt">#          rem.rmb = 6000 # 税后仲裁费如果小于等于20000且是独任案件，直接指定报酬为 6000</span>
306: <span class="ruby-comment cmt">#        end</span>
307: 
308:         <span class="ruby-identifier">rem</span>.<span class="ruby-identifier">save</span>()
309: 
310:         <span class="ruby-comment cmt"># 在 delete_3中删除基本报酬的时候使用 del_set 方法会将 view_num 字段减 1，所以在创建的时候要先添加 然后再更新</span>
311:         <span class="ruby-comment cmt"># 添加基本报酬的时候要给 view_num 加1 ，但是添加稿酬或者绩效报酬的时候不应该改变 view_num 字段的值</span>
312:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">add</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>)
313:         <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">up_set</span>(<span class="ruby-identifier">ca_rc</span>,<span class="ruby-value str">'0001'</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">p_code</span>,<span class="ruby-value str">'zc_rmb'</span>,<span class="ruby-value">0</span>,<span class="ruby-identifier">rem</span>.<span class="ruby-identifier">rmb</span>)
314:       <span class="ruby-keyword kw">end</span>
315:     <span class="ruby-keyword kw">rescue</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">err</span>
316:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;===================================================================&quot;</span>
317:       <span class="ruby-identifier">puts</span> <span class="ruby-identifier">err</span>
318:       <span class="ruby-identifier">puts</span> <span class="ruby-value str">&quot;===================================================================&quot;</span>
319:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]  = <span class="ruby-value str">&quot;修改失败&quot;</span>
320:     <span class="ruby-keyword kw">else</span>
321:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
322:     <span class="ruby-keyword kw">end</span>
323:     <span class="ruby-comment cmt">#render :action =&gt; &quot;list_3&quot;, :yyy =&gt; yyy</span>
324:      <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
325:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001287" class="method-detail">
        <a name="M001287"></a>

        <div class="method-heading">
          <a href="#M001287" class="method-signature">
          <span class="method-name">update_4</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员报酬更新
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001287-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001287-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/remuneration12_set_controller.rb, line 582</span>
582:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_4</span>
583:     <span class="ruby-ivar">@remun</span>=<span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
584:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">extend_code</span><span class="ruby-operator">==</span><span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-operator">!</span><span class="ruby-identifier">query_state</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:recevice_code_2</span>])
585:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
586:       <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
587:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remun</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:remun</span>])
588:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
589:         <span class="ruby-comment cmt">#redirect_to :action=&gt;&quot;list_4&quot;</span>
590:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
591:       <span class="ruby-keyword kw">else</span>
592:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
593:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_4&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
594:       <span class="ruby-keyword kw">end</span>
595:     <span class="ruby-keyword kw">else</span>
596:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败，本案报酬已经发放！&quot;</span>
597:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;&lt;script type='text/javascript'&gt;window.parent.location.reload();&lt;/script&gt;&quot;</span>
598:     <span class="ruby-keyword kw">end</span>
599:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>