<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: ExtendController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">ExtendController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/extend_controller_rb.html">
                app/controllers/extend_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000483">arbitman_sum</a>&nbsp;&nbsp;
      <a href="#M000470">edit_tax</a>&nbsp;&nbsp;
      <a href="#M000477">extend_do</a>&nbsp;&nbsp;
      <a href="#M000481">extend_do_1</a>&nbsp;&nbsp;
      <a href="#M000482">extend_do_2</a>&nbsp;&nbsp;
      <a href="#M000479">gxh</a>&nbsp;&nbsp;
      <a href="#M000484">gxh_arbitman_sum</a>&nbsp;&nbsp;
      <a href="#M000468">list</a>&nbsp;&nbsp;
      <a href="#M000474">list_1</a>&nbsp;&nbsp;
      <a href="#M000475">list_2</a>&nbsp;&nbsp;
      <a href="#M000476">list_2_a</a>&nbsp;&nbsp;
      <a href="#M000473">list_remote</a>&nbsp;&nbsp;
      <a href="#M000471">reset_tax</a>&nbsp;&nbsp;
      <a href="#M000478">search</a>&nbsp;&nbsp;
      <a href="#M000480">search_remote</a>&nbsp;&nbsp;
      <a href="#M000469">tax_count</a>&nbsp;&nbsp;
      <a href="#M000472">update_tax</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000483" class="method-detail">
        <a name="M000483"></a>

        <div class="method-heading">
          <a href="#M000483" class="method-signature">
          <span class="method-name">arbitman_sum</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
已发放报酬查询
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000483-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000483-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 852</span>
852:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">arbitman_sum</span>
853:     <span class="ruby-ivar">@date1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:date1</span>]
854:     <span class="ruby-ivar">@date2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:date2</span>]
855:     <span class="ruby-ivar">@arbitman_name</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:arbitman_name</span>]
856:     <span class="ruby-ivar">@case_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case_code</span>]
857:     <span class="ruby-ivar">@date1</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@date1</span>.<span class="ruby-identifier">blank?</span>
858:     <span class="ruby-ivar">@date2</span> = <span class="ruby-ivar">@date1</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@date2</span>.<span class="ruby-identifier">blank?</span>
859:     <span class="ruby-ivar">@bank_typ</span> = {}
860:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
861:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
862:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
863: 
864:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
865:     <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;p_name asc&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">blank?</span>
866: 
867:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
868:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
869:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
870:     <span class="ruby-keyword kw">end</span>
871: 
872:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and extend_date&gt;='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@date1</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@date1</span>.<span class="ruby-identifier">blank?</span>
873:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and extend_date&lt;='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@date2</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>   <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@date2</span>.<span class="ruby-identifier">blank?</span>
874:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and p_name='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@arbitman_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>   <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@arbitman_name</span>.<span class="ruby-identifier">blank?</span>
875:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and case_code like '%&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@case_code</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;%'&quot;</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@case_code</span>.<span class="ruby-identifier">blank?</span>
876:     
877:     <span class="ruby-ivar">@c</span>=<span class="ruby-value str">&quot; used='Y' and typ&lt;&gt;'5' and p_typ='0001' and t_extend_code &lt;&gt;''  &quot;</span>
878: 
879:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
880:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
881:       <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
882:     <span class="ruby-keyword kw">end</span>
883: 
884:     <span class="ruby-ivar">@tb_extends_p</span> = <span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@c</span>,<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;distinct p as p&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
885:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000470" class="method-detail">
        <a name="M000470"></a>

        <div class="method-heading">
          <a href="#M000470" class="method-signature">
          <span class="method-name">edit_tax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000470-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000470-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 71</span>
71:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_tax</span>
72:     <span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">set_tax</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mark</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:ynssde</span>])
73:     <span class="ruby-comment cmt">#@tax_a=TaxDetail.find(:first,:conditions=&gt;[&quot;name='合计_理论值' and mark=?&quot;, params[:mark]])</span>
74:     <span class="ruby-comment cmt">#@tax=TaxDetail.find(:all,:conditions=&gt;[&quot;name&lt;&gt;'合计_理论值' and mark=?&quot;,params[:mark]], :order =&gt; &quot;id&quot;)</span>
75:     <span class="ruby-ivar">@tax_a</span>=<span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;code='0000-0000' and mark=?&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mark</span>]])
76:     <span class="ruby-ivar">@tax</span>=<span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;code&lt;&gt;'0000-0000' and mark=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mark</span>]], <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id&quot;</span>)
77:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000477" class="method-detail">
        <a name="M000477"></a>

        <div class="method-heading">
          <a href="#M000477" class="method-signature">
          <span class="method-name">extend_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
转为待发放 非本单位人员 将
案件报酬（非本单位仲裁员）
页面选择的报酬转为代发放状态
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000477-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000477-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 222</span>
222:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extend_do</span>
223:     <span class="ruby-identifier">extend_code</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0005</span>  <span class="ruby-comment cmt">#新生成一个发放编号</span>
224:     <span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
225:     <span class="ruby-identifier">tax</span> = <span class="ruby-constant">Tax</span>.<span class="ruby-identifier">new</span>
226:     <span class="ruby-identifier">condi</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:condi</span>]
227: 
228:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
229:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">condi</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
230: 
231:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
232:         <span class="ruby-comment cmt">#存储发放编码相关信息</span>
233:         <span class="ruby-identifier">extend_c</span> = <span class="ruby-constant">TbExtendCode</span>.<span class="ruby-identifier">new</span>()
234:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">extend_code</span> = <span class="ruby-identifier">extend_code</span>
235:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
236:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">t</span> = <span class="ruby-identifier">t</span>
237:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">save</span>
238: 
239:         <span class="ruby-identifier">con</span> = <span class="ruby-identifier">condi</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>)
240:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
241:           <span class="ruby-identifier">exte</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;_&quot;</span>)
242:             <span class="ruby-identifier">typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">0</span>]    <span class="ruby-comment cmt"># typ 1：报酬 2：奖励 3：惩罚 4：办案其它报酬 5：出差补助</span>
243:             <span class="ruby-identifier">p_typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">1</span>]  <span class="ruby-comment cmt"># p_typ 0001:仲裁员   0002:办案助理   0003:校核人员   0004:员工</span>
244:             <span class="ruby-identifier">id_id</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>
245:             
246:             <span class="ruby-identifier">ttt</span>=<span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find_by_mark_and_name</span>(<span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span> ,<span class="ruby-value str">&quot;合计&quot;</span>)
247:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
248:               <span class="ruby-identifier">mark</span> = <span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span>
249:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0002'</span>
250:                 <span class="ruby-identifier">reward</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
251:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span> = <span class="ruby-value str">''</span>
252:                   <span class="ruby-identifier">ex</span> = <span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">new</span>()
253:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
254:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
255:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
256:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
257:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
258:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
259:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
260:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
261:                     <span class="ruby-identifier">tb_arbitman</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
262:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">name</span>
263:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_typ</span>
264:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankaccount</span>
265:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_code</span>
266:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankname</span>
267:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">id_card</span>
268:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">email</span>
269:                   <span class="ruby-keyword kw">else</span>
270:                     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
271:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
272:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_typ</span>
273:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankaccount</span>
274:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_code</span>
275:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankname</span>
276:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id_card</span>
277:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span>
278:                   <span class="ruby-keyword kw">end</span>
279:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">zc_rmb</span> <span class="ruby-operator">*</span> (<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">gc_rmb</span>).<span class="ruby-identifier">round</span>
280:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span> = <span class="ruby-identifier">tax</span>.<span class="ruby-identifier">get_tax_base_2</span>(<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>.<span class="ruby-identifier">round</span>)
281:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-identifier">ttt</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-comment cmt">#tax.get_tax_1(ex.should_rmb.to_i,'N') # 全部是非本单位仲裁员</span>
282:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>
283:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
284:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
285:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
286:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_detail_mark</span>=<span class="ruby-identifier">mark</span>
287:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
288:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
289:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
290:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
291:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
292:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
293:                 <span class="ruby-keyword kw">end</span>
294:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span>
295:                 <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
296:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span>
297:                   <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">new</span>()
298:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
299:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
300:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
301:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
302:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
303:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
304:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
305: 
306:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
307:                     <span class="ruby-identifier">tb_arbitman</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
308:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">name</span>
309:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_typ</span>
310:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankaccount</span>
311:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_code</span>
312:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankname</span>
313:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">id_card</span>
314:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">email</span>
315:                   <span class="ruby-keyword kw">else</span>
316:                     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
317:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
318:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_typ</span>
319:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankaccount</span>
320:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_code</span>
321:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankname</span>
322:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id_card</span>
323:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span>
324:                   <span class="ruby-keyword kw">end</span>
325: 
326:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">jh_rmb</span>.<span class="ruby-identifier">round</span>
327:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-identifier">tax</span>.<span class="ruby-identifier">get_tax_base</span>(<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>.<span class="ruby-identifier">round</span>)
328:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-identifier">ttt</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-comment cmt">#tax.get_tax(ex.should_rmb.round)</span>
329:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>
330:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
331:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
332:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
333:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_detail_mark</span>=<span class="ruby-identifier">mark</span>
334:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
335:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
336:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
337:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
338:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
339:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
340:                 <span class="ruby-keyword kw">end</span>
341:               <span class="ruby-keyword kw">end</span>
342:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'2'</span>
343:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbDeduction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
344:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span>
345:                 <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">new</span>()
346:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
347:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
348:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
349:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
350:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
351:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
352:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
353: 
354:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
355:                   <span class="ruby-identifier">tb_arbitman</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
356:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">name</span>
357:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_typ</span>
358:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankaccount</span>
359:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_code</span>
360:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankname</span>
361:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">id_card</span>
362:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">email</span>
363:                 <span class="ruby-keyword kw">else</span>
364:                   <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
365:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
366:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_typ</span>
367:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankaccount</span>
368:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_code</span>
369:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankname</span>
370:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id_card</span>
371:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span>
372:                 <span class="ruby-keyword kw">end</span>
373: 
374:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span>
375:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-value">0</span>
376:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-value">0</span>
377:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span>
378:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
379:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
380:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
381:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
382:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
383:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
384:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
385:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
386:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
387:               <span class="ruby-keyword kw">end</span>
388:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'3'</span>
389:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbDeduction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
390:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span>
391:                 <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">new</span>()
392:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
393:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
394:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
395:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
396:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
397:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
398:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
399: 
400:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
401:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
402:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
403:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
404:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
405:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
406:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
407:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
408:                 <span class="ruby-keyword kw">else</span>
409:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
410:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
411:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
412:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
413:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
414:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
415:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
416:                 <span class="ruby-keyword kw">end</span>
417: 
418:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">*</span> <span class="ruby-value">-1</span>
419:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-value">0</span>
420:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-value">0</span>
421:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">*</span> <span class="ruby-value">-1</span>
422:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
423:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
424:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
425:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
426:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
427:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
428:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
429:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
430:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
431:               <span class="ruby-keyword kw">end</span>
432:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'4'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'5'</span>
433:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbRemuneration23</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
434:               <span class="ruby-identifier">mark</span> = <span class="ruby-node">&quot;remuneration23_#{id_id}&quot;</span>
435:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span>
436:                 <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">new</span>()
437:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
438:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
439:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
440:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">ope_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
441:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
442:                 <span class="ruby-keyword kw">else</span>
443:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">end_code</span>
444:                 <span class="ruby-keyword kw">end</span>
445:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
446:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
447:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
448: 
449:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
450:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
451:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
452:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
453:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
454:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
455:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
456:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
457:                 <span class="ruby-keyword kw">else</span>
458:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
459:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
460:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
461:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
462:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
463:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
464:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
465:                 <span class="ruby-keyword kw">end</span>
466: 
467:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">should_rmb</span>
468:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">tax_base_rmb</span>
469:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">tax_rmb</span>
470:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_rmb</span>
471:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
472:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
473:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
474:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_detail_mark</span>=<span class="ruby-identifier">mark</span>
475:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
476:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
477:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
478:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
479:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
480:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
481:               <span class="ruby-keyword kw">end</span>
482:             <span class="ruby-keyword kw">end</span>
483:         }
484:       <span class="ruby-keyword kw">end</span>
485:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;转为待发放成功&quot;</span>
486:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'list'</span>
487: 
488:     <span class="ruby-keyword kw">end</span>
489: 
490:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000481" class="method-detail">
        <a name="M000481"></a>

        <div class="method-heading">
          <a href="#M000481" class="method-signature">
          <span class="method-name">extend_do_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
转为已发放 本单位人员
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000481-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000481-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 623</span>
623:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extend_do_1</span>
624:     <span class="ruby-identifier">extend_code</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0005_1</span>
625:     <span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
626:     <span class="ruby-identifier">condi</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:condi</span>]
627:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
628:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">condi</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
629: 
630:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
631:         <span class="ruby-comment cmt">#存储发放编码相关信息</span>
632:         <span class="ruby-identifier">extend_c</span> = <span class="ruby-constant">TbSelfExtendCode</span>.<span class="ruby-identifier">new</span>()
633:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">extend_code</span> = <span class="ruby-identifier">extend_code</span>
634:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
635:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">t</span> = <span class="ruby-identifier">t</span>
636:         <span class="ruby-identifier">extend_c</span>.<span class="ruby-identifier">save</span>
637: 
638:         <span class="ruby-identifier">con</span> = <span class="ruby-identifier">condi</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>)
639:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
640:           <span class="ruby-identifier">exte</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;_&quot;</span>)
641:             <span class="ruby-identifier">typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">0</span>]    <span class="ruby-comment cmt"># typ 1：报酬 2：奖励 3：惩罚 4：办案其它报酬 5：出差补助</span>
642:             <span class="ruby-identifier">p_typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">1</span>]  <span class="ruby-comment cmt"># p_typ 0001:仲裁员 0002：办案助理   0003：校核人员 0004：员工</span>
643:             <span class="ruby-identifier">id_id</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>
644:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
645:               <span class="ruby-identifier">mark</span> = <span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span>
646:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span>
647:                 <span class="ruby-identifier">reward</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
648:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">''</span>
649:                   <span class="ruby-identifier">ex</span> = <span class="ruby-constant">TbSelfExtend</span>.<span class="ruby-identifier">new</span>()
650:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
651:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
652:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span> = <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
653:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
654:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
655:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
656:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
657:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
658:                     <span class="ruby-identifier">tb_arbitman</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
659:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">name</span>
660:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_typ</span>
661:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankaccount</span>
662:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_code</span>
663:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankname</span>
664:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">id_card</span>
665:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">email</span>
666:                   <span class="ruby-keyword kw">else</span>
667:                     <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
668:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
669:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_typ</span>
670:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankaccount</span>
671:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_code</span>
672:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankname</span>
673:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id_card</span>
674:                     <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span>
675:                   <span class="ruby-keyword kw">end</span>
676:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">zc_rmb</span> <span class="ruby-operator">*</span> (<span class="ruby-value">1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">bonus</span><span class="ruby-operator">/</span><span class="ruby-value">100</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">penalty</span><span class="ruby-operator">/</span><span class="ruby-value">100</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">gc_rmb</span>).<span class="ruby-identifier">round</span>
677:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span> = <span class="ruby-value">0</span><span class="ruby-comment cmt"># tax.get_tax_base_1(ex.should_rmb.round)</span>
678:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span> = <span class="ruby-value">0</span> <span class="ruby-comment cmt">#ttt.rmb #tax.get_tax_1(ex.should_rmb.to_i,'N') # 本单位仲裁员不交税</span>
679:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>
680:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
681:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
682:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
683:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_detail_mark</span>=<span class="ruby-identifier">mark</span>
684:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
685:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
686:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
687:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
688:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
689:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;Y&quot;</span>
690:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
691:                   <span class="ruby-comment cmt">#reward.isextend = &quot;Y&quot;</span>
692:                   <span class="ruby-comment cmt">#reward.save</span>
693:                 <span class="ruby-keyword kw">end</span>
694:               <span class="ruby-keyword kw">end</span>
695:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'2'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'3'</span>
696:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbDeduction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
697:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">''</span>
698:                 <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbSelfExtend</span>.<span class="ruby-identifier">new</span>()
699:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
700:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
701:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
702:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
703:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
704:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
705:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
706:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
707:                   <span class="ruby-identifier">tb_arbitman</span> = <span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
708:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">name</span>
709:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_typ</span>
710:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankaccount</span>
711:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bank_code</span>
712:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">bankname</span>
713:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">id_card</span>
714:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">tb_arbitman</span>.<span class="ruby-identifier">email</span>
715:                 <span class="ruby-keyword kw">else</span>
716:                   <span class="ruby-identifier">user</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>)
717:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">name</span>
718:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_typ</span>
719:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankaccount</span>
720:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bank_code</span>
721:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">bankname</span>
722:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">id_card</span>
723:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-identifier">user</span>.<span class="ruby-identifier">email</span>
724:                 <span class="ruby-keyword kw">end</span>
725:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'3'</span>
726:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">*</span> <span class="ruby-value">-1</span>
727:                 <span class="ruby-keyword kw">else</span>
728:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span>
729:                 <span class="ruby-keyword kw">end</span>
730:                 
731:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-value">0</span>
732:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-value">0</span>
733:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">rmb</span>
734:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
735:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
736:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
737:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
738:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
739:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
740:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
741:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
742:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;Y&quot;</span>
743:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
744:                 <span class="ruby-comment cmt">#reward.isextend = &quot;Y&quot;</span>
745:                 <span class="ruby-comment cmt">#reward.save</span>
746:               <span class="ruby-keyword kw">end</span>
747:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'4'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'5'</span>
748:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbRemuneration23</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
749:               <span class="ruby-identifier">mark</span> = <span class="ruby-node">&quot;remuneration23_#{id_id}&quot;</span>
750:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">''</span>
751:                 <span class="ruby-identifier">ex</span>=<span class="ruby-constant">TbSelfExtend</span>.<span class="ruby-identifier">new</span>()
752:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>
753:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">case_code</span>
754:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">general_code</span>
755:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">ope_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
756:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">end_code</span>
757:                 <span class="ruby-keyword kw">else</span>
758:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">end_code</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">end_code</span>
759:                 <span class="ruby-keyword kw">end</span>
760:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-identifier">typ</span>
761:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-identifier">p_typ</span>
762:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>
763: 
764:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
765:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
766:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
767:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
768:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
769:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
770:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
771:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
772:                 <span class="ruby-keyword kw">else</span>
773:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">name</span>
774:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_typ</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_typ</span>
775:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_account</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankaccount</span>
776:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bank_code</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bank_code</span>
777:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">bankname</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">bankname</span>
778:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id_card</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">id_card</span>
779:                   <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">email</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">p</span>).<span class="ruby-identifier">email</span>
780:                 <span class="ruby-keyword kw">end</span>
781: 
782:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">should_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">should_rmb</span>
783:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_base_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">tax_base_rmb</span>
784:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">tax_rmb</span>
785:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_rmb</span>=<span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_rmb</span>
786:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
787:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
788:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">tax_detail_mark</span>=<span class="ruby-identifier">mark</span>
789:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
790:                 <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">save</span>
791:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_id</span>=<span class="ruby-identifier">ex</span>.<span class="ruby-identifier">id</span>
792:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-identifier">extend_code</span>
793:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
794:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_t</span>=<span class="ruby-identifier">t</span>
795:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;Y&quot;</span>
796:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
797:                 <span class="ruby-comment cmt">#reward.isextend = &quot;Y&quot;</span>
798:                 <span class="ruby-comment cmt">#reward.save</span>
799:               <span class="ruby-keyword kw">end</span>
800:             <span class="ruby-keyword kw">end</span>
801:         }
802:       <span class="ruby-keyword kw">end</span>
803:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;转为已发放成功&quot;</span>
804:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'list_1'</span>
805:     <span class="ruby-keyword kw">end</span>
806:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000482" class="method-detail">
        <a name="M000482"></a>

        <div class="method-heading">
          <a href="#M000482" class="method-signature">
          <span class="method-name">extend_do_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
转为未发放 本单位人员
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000482-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000482-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 809</span>
809:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">extend_do_2</span>
810:     <span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
811:     <span class="ruby-identifier">condi</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:condi</span>]
812:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
813:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">condi</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
814: 
815:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">condi</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
816:         <span class="ruby-comment cmt">#存储发放编码相关信息</span>
817:         <span class="ruby-identifier">con</span> = <span class="ruby-identifier">condi</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;,&quot;</span>)
818:         <span class="ruby-identifier">con</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">co</span><span class="ruby-operator">|</span>
819:           <span class="ruby-identifier">exte</span> = <span class="ruby-identifier">co</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;_&quot;</span>)
820:             <span class="ruby-identifier">typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">0</span>]    <span class="ruby-comment cmt"># typ 1：报酬 2：奖励 3：惩罚 4：办案其它报酬 5：出差补助</span>
821:             <span class="ruby-identifier">p_typ</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">1</span>]  <span class="ruby-comment cmt"># p_typ 0001:仲裁员 0002：办案助理   0003：校核人员 0004：员工</span>
822:             <span class="ruby-identifier">id_id</span> = <span class="ruby-identifier">exte</span>[<span class="ruby-value">2</span>].<span class="ruby-identifier">to_i</span>
823:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
824:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">p_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span>
825:                 <span class="ruby-identifier">reward</span> = <span class="ruby-constant">TbBonusPenalty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
826:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span> = <span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">'Y'</span>
827:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;&quot;</span>
828:                   <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
829:                 <span class="ruby-keyword kw">end</span>
830:               <span class="ruby-keyword kw">end</span>
831:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'2'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'3'</span>
832:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbDeduction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
833:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">'Y'</span>
834:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;&quot;</span>
835:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
836:               <span class="ruby-keyword kw">end</span>
837:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'4'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'5'</span>
838:               <span class="ruby-identifier">reward</span>=<span class="ruby-constant">TbRemuneration23</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">id_id</span>)
839:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">extend_code</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">'Y'</span>
840:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">isextend</span> = <span class="ruby-value str">&quot;&quot;</span>
841:                 <span class="ruby-identifier">reward</span>.<span class="ruby-identifier">save</span>
842:               <span class="ruby-keyword kw">end</span>
843:             <span class="ruby-keyword kw">end</span>
844:         }
845:       <span class="ruby-keyword kw">end</span>
846:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;转为已发放成功&quot;</span>
847:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'list_2'</span>
848:     <span class="ruby-keyword kw">end</span>
849:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000479" class="method-detail">
        <a name="M000479"></a>

        <div class="method-heading">
          <a href="#M000479" class="method-signature">
          <span class="method-name">gxh</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
已发放报酬查询
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000479-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000479-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 542</span>
542:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gxh</span>
543:     <span class="ruby-ivar">@bank_typ</span> = {}
544:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
545: 
546:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
547:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
548: 
549:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;search&quot;</span>
550:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'date'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'发放日期'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'发放编号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'p_name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
551:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'p_name'</span>]
552:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
553:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
554:       <span class="ruby-ivar">@page_lines</span> = <span class="ruby-value">20000000000</span>
555:     <span class="ruby-keyword kw">end</span>
556: 
557:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
558:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
559:       <span class="ruby-comment cmt">#@order=&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>
560:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;p_name asc,extend_date&quot;</span>
561:     <span class="ruby-keyword kw">end</span>
562: 
563:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:rmb_hant_search_1_word</span>]
564:     <span class="ruby-comment cmt">#@hant_search_1_text = params[:hant_search_1_text]</span>
565:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
566:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
567:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
568:     <span class="ruby-keyword kw">end</span>
569:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
570:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
571:     <span class="ruby-keyword kw">else</span>
572:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
573:     <span class="ruby-keyword kw">end</span>
574: 
575:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot; used='Y' and t_extend_code &lt;&gt;''  &quot;</span>
576:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
577:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
578:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
579:     <span class="ruby-keyword kw">end</span>
580:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>,<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct t_extend_code,p_typ,p,p_name,bank_account,bankname &quot;</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
581:     <span class="ruby-comment cmt">#@extend_pages,@tb_extends = paginate(:tb_extends,:conditions=&gt;c,:order=&gt;@order,:per_page=&gt;@page_lines.to_i)</span>
582:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000484" class="method-detail">
        <a name="M000484"></a>

        <div class="method-heading">
          <a href="#M000484" class="method-signature">
          <span class="method-name">gxh_arbitman_sum</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
已发放报酬查询
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000484-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000484-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 890</span>
890:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">gxh_arbitman_sum</span>
891:     <span class="ruby-ivar">@date1</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:date1</span>]
892:     <span class="ruby-ivar">@date2</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:date2</span>]
893:     <span class="ruby-ivar">@p</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p</span>]
894:     <span class="ruby-ivar">@case_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case_code</span>]
895:     <span class="ruby-ivar">@bank_typ</span> = {}
896:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
897: 
898:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
899:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
900: 
901:     <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;p_name asc&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">blank?</span>
902: 
903:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:rmb_hant_search_1_word</span>]
904:     <span class="ruby-comment cmt">#@hant_search_1_text = params[:hant_search_1_text]</span>
905:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
906:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
907:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
908:     <span class="ruby-keyword kw">end</span>
909:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
910:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
911:     <span class="ruby-keyword kw">else</span>
912:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
913:     <span class="ruby-keyword kw">end</span>
914: 
915:     <span class="ruby-ivar">@c</span>=<span class="ruby-value str">&quot; used='Y' and typ&lt;&gt;'5' and p_typ='0001' and t_extend_code &lt;&gt;'' &quot;</span>
916:     <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and extend_date&gt;='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@date1</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@date1</span>.<span class="ruby-identifier">blank?</span>
917:     <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and extend_date&lt;='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@date2</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>   <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@date2</span>.<span class="ruby-identifier">blank?</span>
918:     <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and p_name='&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@arbitman_name</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;'&quot;</span>   <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@arbitman_name</span>.<span class="ruby-identifier">blank?</span>
919:     <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; and case_code like '%&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@case_code</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;%'&quot;</span>  <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@case_code</span>.<span class="ruby-identifier">blank?</span>
920:     <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot; and p=#{@p}&quot;</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@p</span>.<span class="ruby-identifier">blank?</span>
921:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
922:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
923:       <span class="ruby-ivar">@c</span> = <span class="ruby-ivar">@c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
924:     <span class="ruby-keyword kw">end</span>
925:     <span class="ruby-ivar">@person</span> = <span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@c</span>,<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct p&quot;</span>)
926:     <span class="ruby-comment cmt">#@extend_pages,@tb_extends = paginate(:tb_extends,:conditions=&gt;c,:order=&gt;@order,:per_page=&gt;@page_lines.to_i)</span>
927:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000468" class="method-detail">
        <a name="M000468"></a>

        <div class="method-heading">
          <a href="#M000468" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
新案件报酬
显示除了本单位工作人员（助理、仲裁员、校核人员、其他员工）之外的其余仲裁员的报酬情况
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000468-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000468-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 5</span>
 5:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 6:     <span class="ruby-ivar">@bank_typ</span> = {}
 7:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
 8: 
 9:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
10:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
11: 
12:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list&quot;</span>
13:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'总案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
14:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'name'</span>]
15:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
16:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
17:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
18:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
19:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
20:     <span class="ruby-keyword kw">end</span>
21:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
22:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
23:     <span class="ruby-keyword kw">else</span>
24:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
25:     <span class="ruby-keyword kw">end</span>
26: 
27:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p_typ ='0001' and p not in (select code from tb_arbitmen where isunit='Y') &quot;</span>
28:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
29:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
30:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
31:     <span class="ruby-keyword kw">end</span>
32:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
33:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000474" class="method-detail">
        <a name="M000474"></a>

        <div class="method-heading">
          <a href="#M000474" class="method-signature">
          <span class="method-name">list_1</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
本单位报酬
只显示本单位工作人员（助理、仲裁员、校核人员、其他员工）的报酬，不用计算应纳税所得额、个税、营业税、营业税附加税
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000474-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000474-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 128</span>
128:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_1</span>
129:     <span class="ruby-ivar">@bank_typ</span> = {}
130:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
131: 
132:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
133:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
134: 
135:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list_1&quot;</span>
136:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'总案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
137:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'name'</span>]
138:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
139:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
140:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
141:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
142:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
143:     <span class="ruby-keyword kw">end</span>
144:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
145:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
146:     <span class="ruby-keyword kw">else</span>
147:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
148:     <span class="ruby-keyword kw">end</span>
149: 
150:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p not in (select code from tb_arbitmen where isunit='N')&quot;</span>
151:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
152:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
153:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
154:     <span class="ruby-keyword kw">end</span>
155:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
156:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000475" class="method-detail">
        <a name="M000475"></a>

        <div class="method-heading">
          <a href="#M000475" class="method-signature">
          <span class="method-name">list_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
本单位已发报酬
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000475-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000475-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 159</span>
159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2</span>
160:     <span class="ruby-ivar">@bank_typ</span> = {}
161:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
162: 
163:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
164:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
165: 
166:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list_2&quot;</span>
167:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'总案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
168:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'name'</span>]
169:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
170:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
171:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
172:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
173:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
174:     <span class="ruby-keyword kw">end</span>
175:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
176:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
177:     <span class="ruby-keyword kw">else</span>
178:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
179:     <span class="ruby-keyword kw">end</span>
180: 
181:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p not in (select code from tb_arbitmen where isunit='N') and isextend='Y' &quot;</span>
182:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
183:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
184:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
185:     <span class="ruby-keyword kw">end</span>
186:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
187:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000476" class="method-detail">
        <a name="M000476"></a>

        <div class="method-heading">
          <a href="#M000476" class="method-signature">
          <span class="method-name">list_2_a</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
本单位已发报酬导出
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000476-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000476-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_2_a</span>
191:     <span class="ruby-ivar">@bank_typ</span> = {}
192:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
193: 
194:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
195:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
196: 
197:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list_2_a&quot;</span>
198:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'总案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
199:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'name'</span>]
200:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
201:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
202:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
203:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
204:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
205:     <span class="ruby-keyword kw">end</span>
206:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
207:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
208:     <span class="ruby-keyword kw">else</span>
209:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
210:     <span class="ruby-keyword kw">end</span>
211: 
212:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p not in (select code from tb_arbitmen where isunit='N') and isextend='Y' &quot;</span>
213:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
214:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
215:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
216:     <span class="ruby-keyword kw">end</span>
217:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
218:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000473" class="method-detail">
        <a name="M000473"></a>

        <div class="method-heading">
          <a href="#M000473" class="method-signature">
          <span class="method-name">list_remote</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
新案件报酬页面导出当前查询的已发放报酬信息 Ajax
方式查询 导出 Excel 调用
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000473-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000473-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 96</span>
 96:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list_remote</span>
 97:     <span class="ruby-ivar">@bank_typ</span> = {}
 98:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
 99: 
100:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
101:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
102: 
103:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list&quot;</span>
104:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'总案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]]]
105:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'general_code'</span>,<span class="ruby-value str">'recevice_code'</span>]
106:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
107:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
108:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
109:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
110:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
111:     <span class="ruby-keyword kw">end</span>
112:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
113:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
114:     <span class="ruby-keyword kw">else</span>
115:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
116:     <span class="ruby-keyword kw">end</span>
117: 
118:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p_typ ='0001' and p not in (select code from tb_arbitmen where isunit='Y') &quot;</span>
119:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
120:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
121:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
122:     <span class="ruby-keyword kw">end</span>
123:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
124:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000471" class="method-detail">
        <a name="M000471"></a>

        <div class="method-heading">
          <a href="#M000471" class="method-signature">
          <span class="method-name">reset_tax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000471-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000471-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 79</span>
79:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">reset_tax</span>
80:     <span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">del_tax</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mark</span>])
81:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;重置成功&quot;</span>
82:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>, <span class="ruby-identifier">:hant_search_1_word=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>] ,<span class="ruby-identifier">:hant_search_1_text</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>], <span class="ruby-identifier">:search_condit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
83:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000478" class="method-detail">
        <a name="M000478"></a>

        <div class="method-heading">
          <a href="#M000478" class="method-signature">
          <span class="method-name">search</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
已发放报酬查询
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000478-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000478-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 493</span>
493:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search</span>
494:     <span class="ruby-ivar">@bank_typ</span> = {}
495:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
496: 
497:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
498:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
499: 
500:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;search&quot;</span>
501:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'date'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'发放日期'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'发放编号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'p_name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
502:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'p_name'</span>]
503:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
504:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
505:       <span class="ruby-ivar">@page_lines</span> = <span class="ruby-value">20</span>
506:     <span class="ruby-keyword kw">end</span>
507: 
508:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
509:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
510:       <span class="ruby-comment cmt">#@order=&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>
511:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;p_name asc,extend_date&quot;</span>
512:     <span class="ruby-keyword kw">end</span>
513: 
514:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
515:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
516:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
517:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
518:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
519:     <span class="ruby-keyword kw">end</span>
520:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
521:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
522:     <span class="ruby-keyword kw">else</span>
523:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
524:     <span class="ruby-keyword kw">end</span>
525: 
526:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot; used='Y' and t_extend_code &lt;&gt;''  &quot;</span>
527:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
528:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
529:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
530:     <span class="ruby-keyword kw">end</span>
531: 
532:     <span class="ruby-ivar">@extend_pages</span>,<span class="ruby-ivar">@tb_extends</span> = <span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:tb_extends</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>,<span class="ruby-identifier">:per_page=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>)
533:     <span class="ruby-ivar">@tax_detail_marks</span> = <span class="ruby-value str">&quot;''&quot;</span>
534:     <span class="ruby-ivar">@tb_extends</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">e</span><span class="ruby-operator">|</span>
535:       <span class="ruby-ivar">@tax_detail_marks</span> = <span class="ruby-ivar">@tax_detail_marks</span>  <span class="ruby-operator">+</span> <span class="ruby-node">&quot;,'#{e.tax_detail_mark}'&quot;</span>
536:     }
537: 
538: 
539:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000480" class="method-detail">
        <a name="M000480"></a>

        <div class="method-heading">
          <a href="#M000480" class="method-signature">
          <span class="method-name">search_remote</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
导出当前查询的已发放报酬信息 Ajax方式查询 导出 Excel
调用
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000480-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000480-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 585</span>
585:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">search_remote</span>
586:     <span class="ruby-ivar">@bank_typ</span> = {}
587:     <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='8201'&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">bbb</span><span class="ruby-operator">|</span>  <span class="ruby-ivar">@bank_typ</span>.<span class="ruby-identifier">merge!</span>({<span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_val</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">bbb</span>.<span class="ruby-identifier">data_text</span>})}
588: 
589:     <span class="ruby-ivar">@typ1</span> = {<span class="ruby-value str">&quot;0001&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;仲裁员&quot;</span>, <span class="ruby-value str">&quot;0002&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;助理&quot;</span>, <span class="ruby-value str">&quot;0003&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;校核人员&quot;</span>, <span class="ruby-value str">&quot;0004&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;员工&quot;</span>}
590:     <span class="ruby-ivar">@typ2</span> = {<span class="ruby-value str">&quot;1&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;报酬&quot;</span>, <span class="ruby-value str">&quot;2&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;奖励&quot;</span>, <span class="ruby-value str">&quot;3&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;扣减&quot;</span>, <span class="ruby-value str">&quot;4&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;办案其它报酬&quot;</span>, <span class="ruby-value str">&quot;5&quot;</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;出差补助合计&quot;</span>}
591: 
592:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;search_remote&quot;</span>
593:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'结案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'date'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'发放日期'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'发放编号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'p_name'</span>,<span class="ruby-value str">'姓名'</span>,<span class="ruby-value str">'text'</span>,[]]]
594:     <span class="ruby-ivar">@hant_search_1_list</span> = [<span class="ruby-value str">'case_code'</span>,<span class="ruby-value str">'end_code'</span>,<span class="ruby-value str">'extend_date'</span>,<span class="ruby-value str">'t_extend_code'</span>,<span class="ruby-value str">'p_name'</span>]
595: 
596:         <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
597:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
598:       <span class="ruby-comment cmt">#@order=&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>
599:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;p_name asc,extend_date&quot;</span>
600:     <span class="ruby-keyword kw">end</span>
601:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
602:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
603:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
604:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
605:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
606:     <span class="ruby-keyword kw">end</span>
607:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
608:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
609:     <span class="ruby-keyword kw">else</span>
610:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
611:     <span class="ruby-keyword kw">end</span>
612: 
613:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;used='Y'  and t_extend_code &lt;&gt;''  &quot;</span>
614:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
615:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
616:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
617:     <span class="ruby-keyword kw">end</span>
618: 
619:     <span class="ruby-ivar">@tb_extends</span> = <span class="ruby-constant">TbExtend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
620:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000469" class="method-detail">
        <a name="M000469"></a>

        <div class="method-heading">
          <a href="#M000469" class="method-signature">
          <span class="method-name">tax_count</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000469-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000469-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 35</span>
35:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">tax_count</span>
36:     <span class="ruby-identifier">hant_search_1_word</span>  = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
37:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
38:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
39:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
40:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
41:     <span class="ruby-keyword kw">end</span>
42:     <span class="ruby-ivar">@hant_search_1_r</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_r</span>]
43:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
44:     <span class="ruby-keyword kw">else</span>
45:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
46:     <span class="ruby-keyword kw">end</span>
47: 
48:     <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;extend_code='' and p_typ ='0001' and p not in (select code from tb_arbitmen where isunit='Y') &quot;</span>
49:     <span class="ruby-identifier">p</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
50:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
51:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
52:     <span class="ruby-keyword kw">end</span>
53:     <span class="ruby-ivar">@provide_p</span> = <span class="ruby-constant">VProvide</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;right(case_code,7) desc,p_typ,p,typ&quot;</span>)
54:     <span class="ruby-identifier">tax</span>=<span class="ruby-constant">Tax</span>.<span class="ruby-identifier">new</span>
55:     <span class="ruby-ivar">@provide_p</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">pp</span><span class="ruby-operator">|</span>
56:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;1&quot;</span>
57:         <span class="ruby-comment cmt">#@tax_a=TaxDetail.find(:first,:conditions=&gt;[&quot;name='合计_理论值' and mark=?&quot;, pp.typ + &quot;_&quot; + pp.p_typ + &quot;_&quot; + pp.id_id.to_s])</span>
58:         <span class="ruby-comment cmt">#@tax_b=TaxDetail.find(:first,:conditions=&gt;[&quot;name='合计' and mark=?&quot;, pp.typ + &quot;_&quot; + pp.p_typ + &quot;_&quot; + pp.id_id.to_s])</span>
59:         <span class="ruby-ivar">@tax_a</span>=<span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;code='0000-0000' and mark=?&quot;</span>, <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span>])
60:         <span class="ruby-ivar">@tax_b</span>=<span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;code='0000' and mark=?&quot;</span>, <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span>])
61:         <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@tax_a</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tax_b</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@tax_a</span>.<span class="ruby-identifier">rmb</span> <span class="ruby-operator">==</span><span class="ruby-ivar">@tax_b</span>.<span class="ruby-identifier">rmb</span>) <span class="ruby-operator">||</span> <span class="ruby-operator">!</span><span class="ruby-ivar">@tax_b</span>
62:           <span class="ruby-identifier">ynssde</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">round2f</span>(<span class="ruby-identifier">tax</span>.<span class="ruby-identifier">get_tax_base_2</span>(<span class="ruby-identifier">pp</span>.<span class="ruby-identifier">yf_rmb</span>))
63:           <span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">set_tax</span>(<span class="ruby-identifier">pp</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">p_typ</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">pp</span>.<span class="ruby-identifier">id_id</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">ynssde</span>)
64:         <span class="ruby-keyword kw">end</span>
65:       <span class="ruby-keyword kw">end</span>
66:     }
67:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;全部扣税计算完成&quot;</span>
68:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>, <span class="ruby-identifier">:hant_search_1_word=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>] ,<span class="ruby-identifier">:hant_search_1_text</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>], <span class="ruby-identifier">:search_condit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
69:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000472" class="method-detail">
        <a name="M000472"></a>

        <div class="method-heading">
          <a href="#M000472" class="method-signature">
          <span class="method-name">update_tax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000472-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000472-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/extend_controller.rb, line 85</span>
85:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_tax</span>
86:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tax</span> <span class="ruby-keyword kw">in</span> <span class="ruby-constant">TaxDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;code&lt;&gt;'0000-0000' and mark=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:mark</span>]])
87:      <span class="ruby-identifier">tax</span>.<span class="ruby-identifier">rmb</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">tax</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>].<span class="ruby-identifier">to_d</span>
88:      <span class="ruby-identifier">tax</span>.<span class="ruby-identifier">remark</span>= <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;remark_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">tax</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>]
89:      <span class="ruby-identifier">tax</span>.<span class="ruby-identifier">save</span>
90:     <span class="ruby-keyword kw">end</span>
91:     <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
92:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>, <span class="ruby-identifier">:hant_search_1_word=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>] ,<span class="ruby-identifier">:hant_search_1_text</span> =<span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>], <span class="ruby-identifier">:search_condit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
93:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>