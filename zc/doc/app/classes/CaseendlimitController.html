<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseendlimitController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseendlimitController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/caseendlimit_controller_rb.html">
                app/controllers/caseendlimit_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001836">detail</a>&nbsp;&nbsp;
      <a href="#M001837">final_do</a>&nbsp;&nbsp;
      <a href="#M001835">list</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001836" class="method-detail">
        <a name="M001836"></a>

        <div class="method-heading">
          <a href="#M001836" class="method-signature">
          <span class="method-name">detail</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
对案件行进终审检测，即使不通过也会显示【终审】按钮，可以进行终审操作。
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001836-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001836-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/caseendlimit_controller.rb, line 56</span>
 56:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">detail</span>
 57:     <span class="ruby-identifier">r0</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#受理日期</span>
 58:     <span class="ruby-identifier">r3</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#仲裁员</span>
 59:     <span class="ruby-identifier">r1</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#结案信息</span>
 60:     <span class="ruby-identifier">r2</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#交费情况</span>
 61:     <span class="ruby-identifier">r4</span>=<span class="ruby-value str">&quot;&quot;</span><span class="ruby-comment cmt">#立案日期不能大于组庭日期</span>
 62:     <span class="ruby-identifier">r5</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#组庭日期不能大于开庭日期</span>
 63:     <span class="ruby-identifier">r6</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#开庭日期不能大于结案日期</span>
 64:     <span class="ruby-identifier">r7</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#代理人所在单位不能为空</span>
 65:     <span class="ruby-identifier">r8</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#庭审笔录</span>
 66:     <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;&quot;</span>  <span class="ruby-comment cmt">#仲裁员评分</span>
 67:     <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#某些情况下必须有组庭信息</span>
 68:     <span class="ruby-comment cmt">#r10=&quot;&quot; 对应收款记录</span>
 69:     <span class="ruby-identifier">r11</span>=<span class="ruby-value str">&quot;&quot;</span>  <span class="ruby-comment cmt">#检查校核信息，若没填写不让终审</span>
 70:     <span class="ruby-identifier">r12</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未拆净的金额或者存在尚未对应的明细,要检测不通过</span>
 71:     <span class="ruby-identifier">r13</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未对应的明细，进行检测</span>
 72:     <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#案件合同没有上传</span>
 73:     <span class="ruby-identifier">r15</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt">#必须有新工时汇总信息，否则不能终审。</span>
 74:     <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;&quot;</span> <span class="ruby-comment cmt"># 如果有管辖权异议，那么必须上传管辖权决定，否则不能终审。</span>
 75:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
 76:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]<span class="ruby-operator">!=</span><span class="ruby-keyword kw">nil</span>
 77:       <span class="ruby-comment cmt">#当前案件</span>
 78:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
 79:       <span class="ruby-comment cmt">#立案日期或不受理日期</span>
 80:       <span class="ruby-ivar">@nowdate</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">nowdate</span>
 81:       <span class="ruby-comment cmt">#组庭信息</span>
 82:       <span class="ruby-ivar">@caseorg</span> = <span class="ruby-constant">TbCaseorg</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
 83:       <span class="ruby-comment cmt">#开庭信息</span>
 84:       <span class="ruby-ivar">@sitting</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
 85:       <span class="ruby-comment cmt">#结案信息</span>
 86:       <span class="ruby-ivar">@caseendbook</span> = <span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
 87: 
 88:       <span class="ruby-comment cmt">#判断是否有受理日期</span>
 89:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">accepttime</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 90:         <span class="ruby-identifier">r0</span> = <span class="ruby-value str">&quot;无受理日期；&quot;</span>
 91:       <span class="ruby-keyword kw">end</span>
 92: 
 93:       <span class="ruby-comment cmt">#判断案件合同是否上传</span>
 94:       <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and typ='0005' and used='Y'&quot;</span>)
 95: 
 96:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">empty?</span>
 97:         <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;案件合同未上传；&quot;</span>
 98:       <span class="ruby-keyword kw">else</span>
 99:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">f</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">file</span>
100:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span>
101:             <span class="ruby-identifier">r14</span> = <span class="ruby-value str">&quot;案件合同未上传；&quot;</span>
102:           <span class="ruby-keyword kw">end</span>
103:         <span class="ruby-keyword kw">end</span>
104:       <span class="ruby-keyword kw">end</span>
105: 
106:       <span class="ruby-comment cmt"># 判断是否有管辖权异议，有的话必须上传管辖权决定，否则不能终审。</span>
107:       <span class="ruby-identifier">jurisdiction</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
108:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">j</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">jurisdiction</span>
109:         <span class="ruby-identifier">jfile</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and typ='0006' and used='Y' and p_id='#{j.id}'&quot;</span>)
110:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">jfile</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-comment cmt"># 没有记录</span>
111:           <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;管辖权决定未上传；&quot;</span>
112:         <span class="ruby-keyword kw">else</span>
113:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">jf</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">jfile</span>
114:               <span class="ruby-identifier">r16</span> = <span class="ruby-value str">&quot;管辖权决定未上传；&quot;</span>  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">jf</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-comment cmt"># 有记录记录，但是文件没有上传。</span>
115:           <span class="ruby-keyword kw">end</span>
116:         <span class="ruby-keyword kw">end</span>
117:       <span class="ruby-keyword kw">end</span>
118: 
119: 
120:       <span class="ruby-comment cmt">#判断组庭信息是否正确，包括以下项目：</span>
121:       <span class="ruby-comment cmt">#  1 立案日期 &lt;= 组庭日期 &lt;= 开庭日期 &lt;= 结案日期；</span>
122:       <span class="ruby-comment cmt">#  2 存在，并且已经上传庭审笔录；</span>
123:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
124:         <span class="ruby-ivar">@orgdate</span> = <span class="ruby-ivar">@caseorg</span>.<span class="ruby-identifier">orgdate</span> <span class="ruby-comment cmt">#组庭日期</span>
125:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@nowdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@orgdate</span>
126:           <span class="ruby-identifier">r4</span> = <span class="ruby-value str">&quot;立案日期不能大于组庭日期；&quot;</span>
127:         <span class="ruby-keyword kw">end</span>
128:         <span class="ruby-comment cmt">#庭审笔录.如果是多次开庭，验证最后一次庭审笔录</span>
129:         <span class="ruby-ivar">@casebook</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,
130:                                   <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code = ? and typ = '0001' and book_name&lt;&gt;'' and p_id=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">sitting_id_last</span>]
131:                                  )
132:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sitting</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
133:           <span class="ruby-ivar">@sittingdate</span> = <span class="ruby-ivar">@sitting</span>.<span class="ruby-identifier">sittingdate</span> <span class="ruby-comment cmt">#开庭日期</span>
134:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@orgdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@casebook</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
135:             <span class="ruby-identifier">r5</span> = <span class="ruby-value str">&quot;组庭日期不能大于开庭日期；无庭审笔录；&quot;</span>
136:           <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@orgdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@casebook</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
137:             <span class="ruby-identifier">r5</span> = <span class="ruby-value str">&quot;组庭日期不能大于开庭日期；&quot;</span>
138:           <span class="ruby-keyword kw">end</span>
139: 
140:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseendbook</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span>
141:             <span class="ruby-ivar">@decideDate</span> = <span class="ruby-ivar">@caseendbook</span>.<span class="ruby-identifier">decideDate</span> <span class="ruby-comment cmt">#结案日期</span>
142:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sittingdate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-ivar">@decideDate</span>
143:               <span class="ruby-identifier">r6</span> = <span class="ruby-value str">&quot;开庭日期不能大于结案日期；&quot;</span>
144:             <span class="ruby-keyword kw">end</span>
145:           <span class="ruby-keyword kw">end</span>
146:           <span class="ruby-comment cmt">#庭审笔录</span>
147:           <span class="ruby-identifier">p_id</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and sittingdate=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@sittingdate</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>).<span class="ruby-identifier">id</span>
148:           <span class="ruby-ivar">@doc</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and p_id=? and typ='0001' and book_name&lt;&gt;''&quot;</span>,<span class="ruby-identifier">p_id</span>])
149:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@doc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
150:             <span class="ruby-identifier">r8</span> = <span class="ruby-value str">&quot;未上传庭审笔录；&quot;</span>
151:           <span class="ruby-keyword kw">end</span>
152:         <span class="ruby-keyword kw">end</span>
153:       <span class="ruby-keyword kw">end</span>
154: 
155:       <span class="ruby-comment cmt">#撤案类型案件可以没有仲裁员</span>
156:       <span class="ruby-comment cmt">#仲裁员类型 TbEvaluate（仲裁员评价表）</span>
157:       <span class="ruby-comment cmt">#arbitman_type  0001 独任； 0002 首席； 0003 申请方； 0004 被申请方；</span>
158: 
159:       <span class="ruby-comment cmt">#仲裁员评价</span>
160:       <span class="ruby-identifier">tb_ev1</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0001'</span>])
161:       <span class="ruby-identifier">tb_ev2</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0002'</span>])
162:       <span class="ruby-identifier">tb_ev3</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0003'</span>])
163:       <span class="ruby-identifier">tb_ev4</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_type=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0004'</span>])
164: 
165:       <span class="ruby-comment cmt">#仲裁员姓名</span>
166:       <span class="ruby-ivar">@ar0</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0001'</span>)
167:       <span class="ruby-ivar">@ar1</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0002'</span>)
168:       <span class="ruby-ivar">@ar2</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0003'</span>)
169:       <span class="ruby-ivar">@ar3</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">arbitrator</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0004'</span>)
170: 
171:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseendbook</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#没有结案信息</span>
172:         <span class="ruby-identifier">r1</span> = <span class="ruby-value str">&quot;没有结案信息；&quot;</span>
173:         <span class="ruby-comment cmt"># aribitprog_num 仲裁程序</span>
174:         <span class="ruby-comment cmt"># 0001 国内普通； 0002 国内简易； 0003 涉外普通； 0004 涉外简易；</span>
175:         <span class="ruby-comment cmt"># 0005 国内金融规则3人； 0006 国内金融规则1人； 0007 涉外金融规则3人； 0008 涉外金融规则1人</span>
176:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span> <span class="ruby-comment cmt"># 简易程序  1个仲裁员</span>
177:           <span class="ruby-comment cmt"># special_convention 特殊约定  0001 无特殊约定； 0002 简易程序约定3人仲裁庭； 0003 普通程序约定独任仲裁庭</span>
178:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任仲裁庭</span>
179:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
180:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
181:             <span class="ruby-keyword kw">else</span>
182:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
183:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
184:               <span class="ruby-keyword kw">end</span>
185:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
186:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
187:               <span class="ruby-keyword kw">end</span>
188:             <span class="ruby-keyword kw">end</span>
189:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 简易程序  约定三人仲裁庭</span>
190:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
191:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
192:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
193:               <span class="ruby-keyword kw">end</span>
194:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
195:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
196:               <span class="ruby-keyword kw">end</span>
197:             <span class="ruby-keyword kw">else</span>
198:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
199:             <span class="ruby-keyword kw">end</span>
200:           <span class="ruby-keyword kw">end</span>
201:         <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
202:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
203:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
204:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
205:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
206:               <span class="ruby-keyword kw">end</span>
207:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
208:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
209:               <span class="ruby-keyword kw">end</span>
210:             <span class="ruby-keyword kw">else</span>
211:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
212:             <span class="ruby-keyword kw">end</span>
213:           <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#普通程序约定独任仲裁庭</span>
214:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
215:               <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
216:             <span class="ruby-keyword kw">else</span>
217:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
218:                 <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
219:               <span class="ruby-keyword kw">end</span>
220:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
221:                 <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
222:               <span class="ruby-keyword kw">end</span>
223:             <span class="ruby-keyword kw">end</span>
224:           <span class="ruby-keyword kw">end</span>
225:         <span class="ruby-keyword kw">end</span>
226:       <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#有结案信息</span>
227:         <span class="ruby-comment cmt"># 结案信息 TbCaseendbook；</span>
228:         <span class="ruby-comment cmt"># 结案方式 endStyle （0001 一般裁决； 0002 和解裁决； 0003 撤案）</span>
229:         <span class="ruby-ivar">@sty</span> = <span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]]).<span class="ruby-identifier">endStyle</span>
230:         <span class="ruby-comment cmt">#案件裁决书信息</span>
231:         <span class="ruby-ivar">@book_name1</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and book_name!='' and book_typ=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@sty</span>])
232:         <span class="ruby-comment cmt">#获取裁决书信息中第一条记录</span>
233:         <span class="ruby-ivar">@book_name</span> = <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-ivar">@book_name1</span>)
234:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@book_name</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
235:           <span class="ruby-identifier">r1</span> = <span class="ruby-value str">&quot;没有裁决书；&quot;</span>
236:         <span class="ruby-keyword kw">end</span>
237:         <span class="ruby-ivar">@endStyle</span> = <span class="ruby-ivar">@caseendbook</span>.<span class="ruby-identifier">endStyle</span>
238:         <span class="ruby-comment cmt">#撤案结案类型的终审可以没有组庭 ; 撤案案件检查时，有仲裁员的，才检查有无评价；无仲裁员的，不检查评价</span>
239:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@endStyle!</span>=<span class="ruby-value str">'0003'</span>
240:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>
241:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任</span>
242:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
243:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
244:               <span class="ruby-keyword kw">else</span>
245:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
246:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
247:                 <span class="ruby-keyword kw">end</span>
248:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
249:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
250:                 <span class="ruby-keyword kw">end</span>
251:               <span class="ruby-keyword kw">end</span>
252:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#  简易程序约定三人仲裁庭</span>
253:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
254:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
255:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
256:                 <span class="ruby-keyword kw">end</span>
257:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
258:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
259:                 <span class="ruby-keyword kw">end</span>
260:               <span class="ruby-keyword kw">else</span>
261:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
262:               <span class="ruby-keyword kw">end</span>
263:             <span class="ruby-keyword kw">end</span>
264:           <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
265:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
266:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
267:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
268:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
269:                 <span class="ruby-keyword kw">end</span>
270:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
271:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
272:                 <span class="ruby-keyword kw">end</span>
273:               <span class="ruby-keyword kw">else</span>
274:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;仲裁员不够三个；&quot;</span>
275:               <span class="ruby-keyword kw">end</span>
276:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 普通程序约定独任仲裁庭</span>
277:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
278:                 <span class="ruby-identifier">r3</span> = <span class="ruby-value str">&quot;无仲裁员；&quot;</span>
279:               <span class="ruby-keyword kw">else</span>
280:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
281:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
282:                 <span class="ruby-keyword kw">end</span>
283:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
284:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
285:                 <span class="ruby-keyword kw">end</span>
286:               <span class="ruby-keyword kw">end</span>
287:             <span class="ruby-keyword kw">end</span>
288:           <span class="ruby-keyword kw">end</span>
289:           
290:           <span class="ruby-comment cmt"># 检查是否录入了新工时汇总信息</span>
291:           <span class="ruby-identifier">c</span> = <span class="ruby-node">&quot;recevice_code='#{@case.recevice_code}' and used='Y'&quot;</span>
292:           <span class="ruby-comment cmt">#@remun1 = RemunerationAward.find(:all, :conditions =&gt; c)</span>
293:           <span class="ruby-ivar">@remun2</span> = <span class="ruby-constant">RemunerationJixiao</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">c</span>)
294: 
295:           <span class="ruby-comment cmt">#r15 = &quot;没有录入裁决书制作信息，&quot; if @remun1.length == 0</span>
296:           <span class="ruby-comment cmt">#r15 = &quot;没有录入绩效评价信息；&quot; if @remun2.length == 0</span>
297:         <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#撤案 ##############################3</span>
298:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0008'</span>
299:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-comment cmt">#无特殊约定或约定独任</span>
300:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_ar</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-value str">&quot;&quot;</span>
301:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
302:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
303:                 <span class="ruby-keyword kw">end</span>
304:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
305:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
306:                 <span class="ruby-keyword kw">end</span>
307:               <span class="ruby-keyword kw">end</span>
308:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt">#简易程序约定三人仲裁庭</span>
309:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
310:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
311:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
312:                 <span class="ruby-keyword kw">end</span>
313:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
314:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
315:                 <span class="ruby-keyword kw">end</span>
316:               <span class="ruby-keyword kw">end</span>
317:             <span class="ruby-keyword kw">end</span>
318:           <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#普通案件</span>
319:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>  <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special_convention</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-comment cmt">#无特殊约定或约定三人仲裁庭</span>
320:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar1!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar2!</span>=<span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ar3!</span>=<span class="ruby-value str">&quot;&quot;</span>
321:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
322:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
323:                 <span class="ruby-keyword kw">end</span>
324:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev2</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev3</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tb_ev4</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
325:                   <span class="ruby-identifier">r9</span>=<span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
326:                 <span class="ruby-keyword kw">end</span>
327:               <span class="ruby-keyword kw">end</span>
328:             <span class="ruby-keyword kw">else</span> <span class="ruby-comment cmt"># 普通程序约定独任仲裁庭</span>
329:               <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ar0!</span>=<span class="ruby-value str">&quot;&quot;</span>
330:                 <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@caseorg</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
331:                   <span class="ruby-identifier">r10</span> = <span class="ruby-value str">&quot;没有组庭时间；&quot;</span>
332:                 <span class="ruby-keyword kw">end</span>
333:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_ev1</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
334:                   <span class="ruby-identifier">r9</span> = <span class="ruby-value str">&quot;无仲裁员评价；&quot;</span>
335:                 <span class="ruby-keyword kw">end</span>
336:               <span class="ruby-keyword kw">end</span>
337:             <span class="ruby-keyword kw">end</span>
338:           <span class="ruby-keyword kw">end</span>
339:         <span class="ruby-keyword kw">end</span>
340:       <span class="ruby-keyword kw">end</span>
341:       <span class="ruby-comment cmt">#无论结案（不管撤案、还是其他结案方式）、未结：有仲裁员则—评价、组庭信息。</span>
342: 
343:       <span class="ruby-comment cmt"># rmb_money 应收费用； redu_rmb_money减收费用； re_rmb_money 已收费用</span>
344:       <span class="ruby-comment cmt"># typ 费用类型</span>
345:       <span class="ruby-comment cmt">#   0001 案件收费（争议金额 为 0002 和 0003 之和）；</span>
346:       <span class="ruby-comment cmt">#   0002 立案费、受理费；</span>
347:       <span class="ruby-comment cmt">#   0003 仲裁费、处理费；</span>
348:       <span class="ruby-comment cmt">#   0004 案件收费（无明确争议金额 为 0005 和 0006 之和）；</span>
349:       <span class="ruby-comment cmt">#   0005 立案费/受理费（无明确争议金额）；</span>
350:       <span class="ruby-comment cmt">#   0006 仲裁费/处理费（无明确争议金额）；</span>
351:       <span class="ruby-comment cmt">#   0007 代收代支费用；</span>
352:       <span class="ruby-comment cmt">#   0008 仲裁员实际开支费；</span>
353: 
354:       <span class="ruby-comment cmt"># s1 应收费之和； s2 减收费用之和； s3 已收费用之和；</span>
355:       <span class="ruby-identifier">s1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
356:       <span class="ruby-identifier">s2</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:redu_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
357:       <span class="ruby-identifier">s3</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
358: 
359:       <span class="ruby-comment cmt">#应收费之和</span>
360:       <span class="ruby-ivar">@ccc</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{params[:recevice_code]}'&quot;</span>)
361:       
362:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@ccc</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@ccc</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
363:         <span class="ruby-identifier">r2</span> = <span class="ruby-value str">&quot;没有交费记录；&quot;</span>
364:       <span class="ruby-keyword kw">else</span>
365:         <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s3</span>.<span class="ruby-identifier">to_i</span>
366:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
367:           <span class="ruby-identifier">r2</span> = <span class="ruby-value str">&quot;有欠缴费用未交；&quot;</span>
368:         <span class="ruby-keyword kw">else</span><span class="ruby-comment cmt">#费用对应明细</span>
369:           <span class="ruby-identifier">s4</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and re_rmb_money=0 and recevice_code=? and (typ='0001' or typ='0004')&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
370:           <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span>(<span class="ruby-identifier">s4</span>.<span class="ruby-identifier">empty?</span>)
371:             <span class="ruby-identifier">r2</span> = <span class="ruby-value str">&quot;案件收费明细对应中存在为0的记录；&quot;</span>
372:           <span class="ruby-keyword kw">end</span>
373:           <span class="ruby-comment cmt">#2010-10-12 niell 存在尚未拆净的金额或者存在尚未对应的明细，进行检测</span>
374: <span class="ruby-comment cmt">#          s4 = TbShouldCharge.find(:first,:select=&gt;&quot;sum(rmb_money - re_rmb_money) as ss&quot;,:conditions=&gt;[&quot;used='Y' and recevice_code=? and (typ='0007' or typ='0008')&quot;,params[:recevice_code]]) #未对应的明细费用</span>
375:           <span class="ruby-identifier">s5</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y' and typ='b'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]]) <span class="ruby-comment cmt">#被拆分的原始收款总记录</span>
376:           <span class="ruby-identifier">s6</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and used='Y' and typ='c'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]]) <span class="ruby-comment cmt">#拆分后的收款记录</span>
377:           <span class="ruby-identifier">s</span> = <span class="ruby-identifier">s5</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">s6</span>.<span class="ruby-identifier">to_i</span>
378:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
379:             <span class="ruby-identifier">r12</span> = <span class="ruby-value str">&quot;存在尚未拆净的收款费用；&quot;</span>
380:           <span class="ruby-keyword kw">end</span>
381:           <span class="ruby-identifier">s4</span> = <span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and should_id=0 and state=2 and (typ='a' or typ='c') and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
382:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">s4</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
383:             <span class="ruby-identifier">r13</span> = <span class="ruby-value str">&quot;存在未对应的费用明细；&quot;</span>
384:           <span class="ruby-keyword kw">end</span>
385: <span class="ruby-comment cmt">#          if s4!=nil &amp;&amp; s4.ss.to_i&gt;0</span>
386: <span class="ruby-comment cmt">#            r13 = &quot;存在未对应的费用明细；&quot;</span>
387: <span class="ruby-comment cmt">#          end</span>
388:         <span class="ruby-keyword kw">end</span>
389:       <span class="ruby-keyword kw">end</span>
390: 
391:       <span class="ruby-comment cmt">#裁决书信息</span>
392:       <span class="ruby-ivar">@award</span> = <span class="ruby-constant">TbAward</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> [<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
393:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@award</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
394:         <span class="ruby-identifier">r11</span> = <span class="ruby-value str">&quot;请填写裁决书报校核信息；&quot;</span>
395:       <span class="ruby-keyword kw">end</span>
396:       
397:       <span class="ruby-comment cmt">#代理人所在单位</span>
398:       <span class="ruby-identifier">agent</span> = <span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and company=''&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
399:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">agent</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
400:         <span class="ruby-identifier">r7</span>=<span class="ruby-value str">&quot;代理人所在单位不能为空；&quot;</span>
401:       <span class="ruby-keyword kw">end</span>
402:       <span class="ruby-ivar">@r_mes</span> = <span class="ruby-identifier">r0</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r14</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r3</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r10</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r4</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r5</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r6</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r7</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r8</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r9</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r11</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r12</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r13</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r15</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">r16</span>
403: 
404:       <span class="ruby-comment cmt">#仲裁员实际开支费用: 当事人预缴仲裁员开支费用 - (助理录入)仲裁员实际开支、抹零数据</span>
405:       <span class="ruby-identifier">m_1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
406:       <span class="ruby-ivar">@shoud1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
407:       <span class="ruby-ivar">@should2</span>= <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:re_rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and typ='0008'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
408:       <span class="ruby-comment cmt">#出纳录入的仲裁员开支费用</span>
409:       <span class="ruby-comment cmt">#      @arbitspend=TbArbitmanSpend.sum(:rmb_money,:conditions=&gt;[&quot;used='Y' and recevice_code=?&quot;,params[:recevice_code]])</span>
410:       <span class="ruby-comment cmt">#助理录入的仲裁庭支出费用</span>
411:       <span class="ruby-comment cmt">#      @sroom = TbArbitcourtSpend.sum(:rmb_money,:conditions=&gt;[&quot;used='Y' and recevice_code=?&quot;,params[:recevice_code]])</span>
412:       <span class="ruby-ivar">@aribitprog_num</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span>
413:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0003'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0005'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0007'</span>
414:         <span class="ruby-identifier">as11</span>=<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_typ&lt;&gt;'0001'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
415:         <span class="ruby-identifier">as44</span>=<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
416:         <span class="ruby-identifier">as</span>=<span class="ruby-identifier">as11</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">as44</span>.<span class="ruby-identifier">to_i</span>
417:       <span class="ruby-keyword kw">else</span>
418:         <span class="ruby-identifier">as11</span>=<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and arbitman_typ='0001'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
419:         <span class="ruby-identifier">as44</span>=<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">sum</span>(<span class="ruby-identifier">:rmb_money</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=?&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
420:         <span class="ruby-identifier">as</span>=<span class="ruby-identifier">as11</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">as44</span>.<span class="ruby-identifier">to_i</span>
421:       <span class="ruby-keyword kw">end</span>
422:       <span class="ruby-comment cmt"># shoud1（已收仲裁员实际开支费用和） - should2（仲裁员开支应退费） - as（仲裁员支出+仲裁庭支出）</span>
423:       <span class="ruby-identifier">fe1</span> = <span class="ruby-ivar">@shoud1</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">as</span>
424: 
425:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">fe1!</span>=<span class="ruby-value">0</span>
426:         <span class="ruby-identifier">s1</span>=<span class="ruby-value str">&quot;仲裁员实际费用平衡表 结余不为0；&quot;</span>
427:       <span class="ruby-keyword kw">else</span>
428:         <span class="ruby-identifier">s1</span>=<span class="ruby-value str">&quot;&quot;</span>
429:       <span class="ruby-keyword kw">end</span>
430:       
431:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">m_1</span>.<span class="ruby-identifier">to_i!</span>=<span class="ruby-value">0</span>
432:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@shoud1</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
433:           <span class="ruby-identifier">s2</span> = <span class="ruby-value str">&quot;仲裁员实际开支费用没有交纳；&quot;</span>
434:         <span class="ruby-keyword kw">else</span>
435:           <span class="ruby-identifier">s2</span>=<span class="ruby-value str">&quot;&quot;</span>
436:         <span class="ruby-keyword kw">end</span>
437:       <span class="ruby-keyword kw">else</span>
438:         <span class="ruby-identifier">s2</span>=<span class="ruby-value str">&quot;&quot;</span>
439:       <span class="ruby-keyword kw">end</span>
440:       <span class="ruby-comment cmt">#当事人地区，如果存在“中国内地”输入项目，提示，不作为终审卡住条件</span>
441:       <span class="ruby-identifier">tb_party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:id</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;used='Y' and recevice_code=? and area='001'&quot;</span>,<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]])
442:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_party</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
443:         <span class="ruby-identifier">s3</span>=<span class="ruby-value str">&quot;当事人地区为中国内地，请明确其所在省份；&quot;</span>
444:       <span class="ruby-keyword kw">else</span>
445:         <span class="ruby-identifier">s3</span>=<span class="ruby-value str">&quot;&quot;</span>
446:       <span class="ruby-keyword kw">end</span>
447:       <span class="ruby-ivar">@m_fee</span>=<span class="ruby-identifier">s1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s2</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s3</span>
448:     <span class="ruby-keyword kw">end</span>
449:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001837" class="method-detail">
        <a name="M001837"></a>

        <div class="method-heading">
          <a href="#M001837" class="method-signature">
          <span class="method-name">final_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
点击终审按钮执行
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001837-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001837-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/caseendlimit_controller.rb, line 452</span>
452:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">final_do</span>
453:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0007'</span>)
454:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
455:       <span class="ruby-identifier">f</span> = <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">'0007'</span>)
456:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
457:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span> = <span class="ruby-identifier">f</span>
458:       <span class="ruby-keyword kw">end</span>
459:       <span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
460:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_date</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:dat</span>]
461:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
462:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">end_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
463: 
464:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
465:         <span class="ruby-identifier">a_p</span> = <span class="ruby-value str">&quot;final_tex&quot;</span>
466:       <span class="ruby-keyword kw">else</span>
467:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;终审操作失败！&quot;</span>
468:         <span class="ruby-identifier">a_p</span> = <span class="ruby-value str">&quot;list&quot;</span>
469:       <span class="ruby-keyword kw">end</span>
470:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">a_p</span>,
471:                   <span class="ruby-identifier">:r_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">recevice_code</span>,
472:                   <span class="ruby-identifier">:search_condit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],
473:                   <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
474:                   <span class="ruby-identifier">:page_lines</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>],
475:                   <span class="ruby-identifier">:hant_search_1_text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
476:     <span class="ruby-keyword kw">else</span>
477:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
478:     <span class="ruby-keyword kw">end</span>
479:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001835" class="method-detail">
        <a name="M001835"></a>

        <div class="method-heading">
          <a href="#M001835" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
显示所有助理的在办案件
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001835-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001835-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/caseendlimit_controller.rb, line 3</span>
 3:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 4:     <span class="ruby-ivar">@hant_search_1_page_name</span> = <span class="ruby-value str">&quot;list&quot;</span>
 5: 
 6:     <span class="ruby-ivar">@clerk</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot; used = 'Y' &quot;</span>,<span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span><span class="ruby-value str">'code,name'</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">u</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">u</span>.<span class="ruby-identifier">code</span>,<span class="ruby-identifier">u</span>.<span class="ruby-identifier">name</span>]}
 7:     <span class="ruby-ivar">@hant_search_1</span> = [[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'tb_cases_case_code'</span>,<span class="ruby-value str">'立案号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'tb_parties_partyname'</span>,<span class="ruby-value str">'当事人名称'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'tb_parties_partytype'</span>,<span class="ruby-value str">'当事人类型'</span>,<span class="ruby-value str">'select'</span>,[[<span class="ruby-value">1</span>,<span class="ruby-value str">'申请人'</span>],[<span class="ruby-value">2</span>,<span class="ruby-value str">'被申请人'</span>]]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'tb_cases_clerk'</span>,<span class="ruby-value str">'办案助理'</span>,<span class="ruby-value str">'select'</span>,<span class="ruby-ivar">@clerk</span>]]
 8: 
 9:     <span class="ruby-ivar">@order</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
10:     <span class="ruby-ivar">@order</span> = <span class="ruby-value str">&quot;right(tb_cases_case_code,7) desc&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span>.<span class="ruby-identifier">blank?</span>
11: 
12:     <span class="ruby-ivar">@page_lines</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
13:     <span class="ruby-ivar">@page_lines</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:lines</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">blank?</span>
14: 
15:     <span class="ruby-identifier">hant_search_1_word</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
16: 
17:     <span class="ruby-ivar">@search_condit</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>] <span class="ruby-operator">||</span> <span class="ruby-value str">''</span>
18: 
19:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>]
20:     <span class="ruby-ivar">@hant_search_1_text</span> = <span class="ruby-value str">&quot;所有&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_text</span>].<span class="ruby-identifier">blank?</span>
21:     
22:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
23:     <span class="ruby-keyword kw">else</span>
24:       <span class="ruby-ivar">@search_condit</span>= <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
25:     <span class="ruby-keyword kw">end</span>
26:     
27:     <span class="ruby-identifier">c</span> = <span class="ruby-value str">&quot;tb_cases_state &gt;= 4 and tb_cases_state &lt; 100  and tb_cases_used = 'Y'&quot;</span>
28: 
29:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
30:     
31:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit!</span>= <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
32:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
33:     <span class="ruby-keyword kw">end</span>
34: 
35:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
36:       <span class="ruby-ivar">@search_condit</span> = <span class="ruby-value str">&quot;&quot;</span>
37:     <span class="ruby-keyword kw">end</span>
38: 
39:     <span class="ruby-ivar">@state</span> = {<span class="ruby-value">-1</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;重审&quot;</span>, <span class="ruby-value">1</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;咨询&quot;</span>, <span class="ruby-value">4</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;立案&quot;</span>, <span class="ruby-value">5</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;组庭&quot;</span>, <span class="ruby-value">6</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;开庭&quot;</span>, <span class="ruby-value">100</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;终审&quot;</span>, <span class="ruby-value">150</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;归档申请&quot;</span>}
40:     
41:     <span class="ruby-identifier">sql</span> = <span class="ruby-node">&quot;select distinct tb_cases_state as state,
42:                 tb_cases_recevice_code as recevice_code,
43:                 tb_cases_case_code as case_code,
44:                 tb_cases_nowdate as nowdate,
45:                 tb_cases_clerk as clerk,
46:                 tb_cases_aribitprotprog_num as aribitprog_num
47:            from v_case_query1_list1s
48:            where #{c}
49:            order by #{@order}&quot;</span>
50:     <span class="ruby-ivar">@ca</span> = <span class="ruby-constant">VCaseQuery1List1</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-identifier">sql</span>)
51:     <span class="ruby-ivar">@case_pages</span>,<span class="ruby-ivar">@case_4</span> = <span class="ruby-identifier">paginate_by_sql</span>(<span class="ruby-constant">VCaseQuery1List1</span>,<span class="ruby-identifier">sql</span>,<span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>)
52:     
53:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>