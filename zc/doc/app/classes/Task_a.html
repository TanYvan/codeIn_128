<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Task_a</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Task_a</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/models/task_a_rb.html">
                app/models/task_a.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                Object
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
To change this template, choose Tools | Templates and open the template in
the editor.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000136">get_party_1</a>&nbsp;&nbsp;
      <a href="#M000101">t_1</a>&nbsp;&nbsp;
      <a href="#M000109">t_10</a>&nbsp;&nbsp;
      <a href="#M000111">t_11</a>&nbsp;&nbsp;
      <a href="#M000112">t_12</a>&nbsp;&nbsp;
      <a href="#M000113">t_13</a>&nbsp;&nbsp;
      <a href="#M000114">t_14</a>&nbsp;&nbsp;
      <a href="#M000115">t_15</a>&nbsp;&nbsp;
      <a href="#M000116">t_16</a>&nbsp;&nbsp;
      <a href="#M000117">t_17</a>&nbsp;&nbsp;
      <a href="#M000118">t_18</a>&nbsp;&nbsp;
      <a href="#M000119">t_19</a>&nbsp;&nbsp;
      <a href="#M000102">t_2</a>&nbsp;&nbsp;
      <a href="#M000120">t_20</a>&nbsp;&nbsp;
      <a href="#M000121">t_21</a>&nbsp;&nbsp;
      <a href="#M000122">t_22</a>&nbsp;&nbsp;
      <a href="#M000123">t_23</a>&nbsp;&nbsp;
      <a href="#M000124">t_24</a>&nbsp;&nbsp;
      <a href="#M000125">t_25</a>&nbsp;&nbsp;
      <a href="#M000126">t_25_by_arbitman</a>&nbsp;&nbsp;
      <a href="#M000127">t_25_by_recevice_code</a>&nbsp;&nbsp;
      <a href="#M000128">t_26</a>&nbsp;&nbsp;
      <a href="#M000129">t_27</a>&nbsp;&nbsp;
      <a href="#M000130">t_28</a>&nbsp;&nbsp;
      <a href="#M000131">t_29</a>&nbsp;&nbsp;
      <a href="#M000103">t_3</a>&nbsp;&nbsp;
      <a href="#M000132">t_30</a>&nbsp;&nbsp;
      <a href="#M000133">t_31</a>&nbsp;&nbsp;
      <a href="#M000104">t_4</a>&nbsp;&nbsp;
      <a href="#M000105">t_5</a>&nbsp;&nbsp;
      <a href="#M000106">t_6</a>&nbsp;&nbsp;
      <a href="#M000107">t_7</a>&nbsp;&nbsp;
      <a href="#M000108">t_8</a>&nbsp;&nbsp;
      <a href="#M000134">t_800</a>&nbsp;&nbsp;
      <a href="#M000110">t_9</a>&nbsp;&nbsp;
      <a href="#M000135">t_911</a>&nbsp;&nbsp;
      <a href="#M000099">t_a</a>&nbsp;&nbsp;
      <a href="#M000100">t_b</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000136" class="method-detail">
        <a name="M000136"></a>

        <div class="method-heading">
          <a href="#M000136" class="method-signature">
          <span class="method-name">get_party_1</span><span class="method-args">(recevice_code)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000136-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000136-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 3159</span>
3159:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_party_1</span>(<span class="ruby-identifier">recevice_code</span>)
3160:     <span class="ruby-identifier">partys</span>=<span class="ruby-value str">&quot;&quot;</span>
3161:     <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;recevice_code=? and partytype=? and used='Y'&quot;</span>,<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value">1</span>]).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
3162:       <span class="ruby-identifier">partys</span> = <span class="ruby-identifier">partys</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;,&quot;</span>
3163:     }
3164:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partys</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">&quot;&quot;</span>
3165:       <span class="ruby-identifier">partys</span> = <span class="ruby-identifier">partys</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-identifier">partys</span>.<span class="ruby-identifier">length</span><span class="ruby-operator">-</span><span class="ruby-value">1</span>)
3166:     <span class="ruby-keyword kw">end</span>
3167:     <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">partys</span>
3168:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000101" class="method-detail">
        <a name="M000101"></a>

        <div class="method-heading">
          <a href="#M000101" class="method-signature">
          <span class="method-name">t_1</span><span class="method-args">(et_before,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000101-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000101-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task_a.rb, line 247</span>
247:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_1</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
248:     <span class="ruby-comment cmt">#1:收费被助理确认以后,直接提醒处长指定一名助理办案,2工作日后仍未指定的,提醒到秘书长处。</span>
249:     <span class="ruby-comment cmt">#直接提醒处长指定一名助理办案</span>
250:     <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and check_dt&gt;='#{et_before}' and check_dt&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;check_dt&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
251:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
252:       <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
253:       <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-value str">''</span>
254:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
255:           <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
256:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
257:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
258:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
259:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
260:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>= <span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} 1&quot;</span>
261:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;案件咨询流水号:#{@tsc.recevice_code},案件已收费请指定办案助理。&quot;</span>
262:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
263:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
264:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
265:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
266:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
267:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
268:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
269:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
270:               <span class="ruby-keyword kw">end</span>
271:             <span class="ruby-keyword kw">end</span>
272:           <span class="ruby-keyword kw">end</span>
273:         <span class="ruby-keyword kw">end</span>
274:       <span class="ruby-keyword kw">end</span>
275:     <span class="ruby-keyword kw">end</span>
276:     <span class="ruby-comment cmt">#2个工作日后仍未指定的,提醒到秘书长处</span>
277:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
278:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
279:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
280:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
281:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
282:       <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and check_dt&gt;='#{wwdd} 00:00:01' and check_dt&lt;'#{wwdd2} 00:00:01'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;check_dt&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
283:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
284:         <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
285:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-value str">''</span>
286:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
287:             <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0002'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
288:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
289:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
290:                 <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
291:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
292:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} 2&quot;</span>
293:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;案件咨询流水号:#{@tsc.recevice_code},案件已收费请指定办案助理。&quot;</span>
294:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
295:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
296:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
297:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
298:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
299:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
300:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
301:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
302:                 <span class="ruby-keyword kw">end</span>
303:               <span class="ruby-keyword kw">end</span>
304:             <span class="ruby-keyword kw">end</span>
305:           <span class="ruby-keyword kw">end</span>
306:         <span class="ruby-keyword kw">end</span>
307:       <span class="ruby-keyword kw">end</span>
308:     <span class="ruby-keyword kw">end</span>
309:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000109" class="method-detail">
        <a name="M000109"></a>

        <div class="method-heading">
          <a href="#M000109" class="method-signature">
          <span class="method-name">t_10</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000109-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000109-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1485</span>
1485:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_10</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1486:     <span class="ruby-comment cmt">### 10: 当支出超过收入,即结余为负数时,需要提醒补收费用。每天只提醒一次（提醒到助理）</span>
1487:     <span class="ruby-comment cmt">#t_10(et_before,et_now_t,et_now)</span>
1488:     <span class="ruby-comment cmt">#代收代支费用支出</span>
1489:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbExpendDetail</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,case_code,recevice_code&quot;</span>)
1490:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1491:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1492:         <span class="ruby-identifier">condi</span>=<span class="ruby-node">&quot;dt1='#{Date.today.to_s}' and ( (reason_id like '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends%') )&quot;</span>
1493:         <span class="ruby-identifier">should_charge</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_charges where used='Y' and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1494:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1495:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1496:         <span class="ruby-keyword kw">else</span>
1497:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-identifier">should_charge</span>.<span class="ruby-identifier">re_rmb_money</span>
1498:         <span class="ruby-keyword kw">end</span>
1499:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1500:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1501:         <span class="ruby-keyword kw">end</span>
1502: 
1503:         <span class="ruby-identifier">should_refund</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_refunds where used='Y' and state=2 and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1504:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1505:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1506:         <span class="ruby-keyword kw">else</span>
1507:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-identifier">should_refund</span>.<span class="ruby-identifier">re_rmb_money</span>
1508:         <span class="ruby-keyword kw">end</span>
1509:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1510:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1511:         <span class="ruby-keyword kw">end</span>
1512: 
1513:         <span class="ruby-identifier">expend_detail</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbExpendDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_expend_details where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1514:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1515:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1516:         <span class="ruby-keyword kw">else</span>
1517:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-identifier">expend_detail</span>.<span class="ruby-identifier">rmb_money</span>
1518:         <span class="ruby-keyword kw">end</span>
1519:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1520:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1521:         <span class="ruby-keyword kw">end</span>
1522: 
1523:         <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitman_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1524:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1525:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1526:         <span class="ruby-keyword kw">else</span>
1527:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-identifier">arbitman_spend</span>.<span class="ruby-identifier">rmb_money</span>
1528:         <span class="ruby-keyword kw">end</span>
1529:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1530:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1531:         <span class="ruby-keyword kw">end</span>
1532: 
1533:         <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitcourt_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1534:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1535:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1536:         <span class="ruby-keyword kw">else</span>
1537:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-identifier">arbitcourt_spend</span>.<span class="ruby-identifier">rmb_money</span>
1538:         <span class="ruby-keyword kw">end</span>
1539:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1540:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1541:         <span class="ruby-keyword kw">end</span>
1542: 
1543:         <span class="ruby-identifier">other_spends</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbOtherSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_other_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1544:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1545:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1546:         <span class="ruby-keyword kw">else</span>
1547:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-identifier">other_spends</span>.<span class="ruby-identifier">rmb_money</span>
1548:         <span class="ruby-keyword kw">end</span>
1549:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1550:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1551:         <span class="ruby-keyword kw">end</span>
1552: 
1553:         <span class="ruby-identifier">cre</span>=<span class="ruby-identifier">should_charge</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">should_refund</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">expend_detail</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitman_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitcourt_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">other_spends</span>
1554: 
1555:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cre</span><span class="ruby-operator">&lt;</span><span class="ruby-value">0</span>
1556:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">condi</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1557:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1558:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1559:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details-#{c.id} 1&quot;</span>
1560:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},费用超支。收费:#{should_charge},退费:#{should_refund},花费:#{expend_detail + arbitman_spend + arbitcourt_spend + other_spends}&quot;</span>
1561:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1562:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1563:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1564:             <span class="ruby-keyword kw">else</span>
1565:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1566:             <span class="ruby-keyword kw">end</span>
1567:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1568:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1569:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1570:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1571:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1572:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1573:             <span class="ruby-keyword kw">end</span>
1574:           <span class="ruby-keyword kw">end</span>
1575:         <span class="ruby-keyword kw">end</span>
1576:       <span class="ruby-keyword kw">end</span>
1577:     <span class="ruby-keyword kw">end</span>
1578: 
1579:     <span class="ruby-comment cmt">#仲裁员费用支出</span>
1580: 
1581:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,case_code,recevice_code&quot;</span>)
1582:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1583:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1584:         <span class="ruby-identifier">condi</span>=<span class="ruby-node">&quot;dt1='#{Date.today.to_s}' and ( (reason_id like '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends%') )&quot;</span>
1585:         <span class="ruby-identifier">should_charge</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_charges where used='Y' and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1586:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1587:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1588:         <span class="ruby-keyword kw">else</span>
1589:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-identifier">should_charge</span>.<span class="ruby-identifier">re_rmb_money</span>
1590:         <span class="ruby-keyword kw">end</span>
1591:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1592:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1593:         <span class="ruby-keyword kw">end</span>
1594: 
1595:         <span class="ruby-identifier">should_refund</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_refunds where used='Y' and state=2 and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1596:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1597:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1598:         <span class="ruby-keyword kw">else</span>
1599:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-identifier">should_refund</span>.<span class="ruby-identifier">re_rmb_money</span>
1600:         <span class="ruby-keyword kw">end</span>
1601:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1602:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1603:         <span class="ruby-keyword kw">end</span>
1604: 
1605:         <span class="ruby-identifier">expend_detail</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbExpendDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_expend_details where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1606:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1607:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1608:         <span class="ruby-keyword kw">else</span>
1609:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-identifier">expend_detail</span>.<span class="ruby-identifier">rmb_money</span>
1610:         <span class="ruby-keyword kw">end</span>
1611:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1612:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1613:         <span class="ruby-keyword kw">end</span>
1614: 
1615:         <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitman_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1616:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1617:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1618:         <span class="ruby-keyword kw">else</span>
1619:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-identifier">arbitman_spend</span>.<span class="ruby-identifier">rmb_money</span>
1620:         <span class="ruby-keyword kw">end</span>
1621:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1622:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1623:         <span class="ruby-keyword kw">end</span>
1624: 
1625:         <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitcourt_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1626:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1627:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1628:         <span class="ruby-keyword kw">else</span>
1629:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-identifier">arbitcourt_spend</span>.<span class="ruby-identifier">rmb_money</span>
1630:         <span class="ruby-keyword kw">end</span>
1631:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1632:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1633:         <span class="ruby-keyword kw">end</span>
1634: 
1635:         <span class="ruby-identifier">other_spends</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbOtherSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_other_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1636:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1637:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1638:         <span class="ruby-keyword kw">else</span>
1639:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-identifier">other_spends</span>.<span class="ruby-identifier">rmb_money</span>
1640:         <span class="ruby-keyword kw">end</span>
1641:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1642:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1643:         <span class="ruby-keyword kw">end</span>
1644: 
1645:         <span class="ruby-identifier">cre</span>=<span class="ruby-identifier">should_charge</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">should_refund</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">expend_detail</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitman_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitcourt_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">other_spends</span>
1646: 
1647:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cre</span><span class="ruby-operator">&lt;</span><span class="ruby-value">0</span>
1648:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">condi</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1649:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1650:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1651:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends-#{c.id} 1&quot;</span>
1652:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},费用超支。收费:#{should_charge},退费:#{should_refund},花费:#{expend_detail + arbitman_spend + arbitcourt_spend + other_spends}&quot;</span>
1653:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1654:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1655:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1656:             <span class="ruby-keyword kw">else</span>
1657:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1658:             <span class="ruby-keyword kw">end</span>
1659:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1660:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1661:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1662:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1663:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1664:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1665:             <span class="ruby-keyword kw">end</span>
1666:           <span class="ruby-keyword kw">end</span>
1667:         <span class="ruby-keyword kw">end</span>
1668:       <span class="ruby-keyword kw">end</span>
1669:     <span class="ruby-keyword kw">end</span>
1670: 
1671:     <span class="ruby-comment cmt">#仲裁庭费用支出</span>
1672: 
1673:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,case_code,recevice_code&quot;</span>)
1674:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1675:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1676:         <span class="ruby-identifier">condi</span>=<span class="ruby-node">&quot;dt1='#{Date.today.to_s}' and ( (reason_id like '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends%') )&quot;</span>
1677:         <span class="ruby-identifier">should_charge</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_charges where used='Y' and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003'  and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1678:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1679:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1680:         <span class="ruby-keyword kw">else</span>
1681:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-identifier">should_charge</span>.<span class="ruby-identifier">re_rmb_money</span>
1682:         <span class="ruby-keyword kw">end</span>
1683:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1684:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1685:         <span class="ruby-keyword kw">end</span>
1686: 
1687:         <span class="ruby-identifier">should_refund</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_refunds where used='Y' and state=2 and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}'&quot;</span>))
1688:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1689:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1690:         <span class="ruby-keyword kw">else</span>
1691:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-identifier">should_refund</span>.<span class="ruby-identifier">re_rmb_money</span>
1692:         <span class="ruby-keyword kw">end</span>
1693:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1694:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1695:         <span class="ruby-keyword kw">end</span>
1696: 
1697:         <span class="ruby-identifier">expend_detail</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbExpendDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_expend_details where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1698:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1699:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1700:         <span class="ruby-keyword kw">else</span>
1701:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-identifier">expend_detail</span>.<span class="ruby-identifier">rmb_money</span>
1702:         <span class="ruby-keyword kw">end</span>
1703:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1704:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1705:         <span class="ruby-keyword kw">end</span>
1706: 
1707:         <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitman_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1708:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1709:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1710:         <span class="ruby-keyword kw">else</span>
1711:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-identifier">arbitman_spend</span>.<span class="ruby-identifier">rmb_money</span>
1712:         <span class="ruby-keyword kw">end</span>
1713:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1714:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1715:         <span class="ruby-keyword kw">end</span>
1716: 
1717:         <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitcourt_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1718:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1719:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1720:         <span class="ruby-keyword kw">else</span>
1721:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-identifier">arbitcourt_spend</span>.<span class="ruby-identifier">rmb_money</span>
1722:         <span class="ruby-keyword kw">end</span>
1723:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1724:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1725:         <span class="ruby-keyword kw">end</span>
1726: 
1727:         <span class="ruby-identifier">other_spends</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbOtherSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_other_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1728:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1729:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1730:         <span class="ruby-keyword kw">else</span>
1731:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-identifier">other_spends</span>.<span class="ruby-identifier">rmb_money</span>
1732:         <span class="ruby-keyword kw">end</span>
1733:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1734:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1735:         <span class="ruby-keyword kw">end</span>
1736: 
1737:         <span class="ruby-identifier">cre</span>=<span class="ruby-identifier">should_charge</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">should_refund</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">expend_detail</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitman_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitcourt_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">other_spends</span>
1738: 
1739:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cre</span><span class="ruby-operator">&lt;</span><span class="ruby-value">0</span>
1740:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">condi</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1741:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1742:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1743:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends-#{c.id} 1&quot;</span>
1744:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},费用超支。收费:#{should_charge},退费:#{should_refund},花费:#{expend_detail + arbitman_spend + arbitcourt_spend + other_spends}&quot;</span>
1745:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1746:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1747:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1748:             <span class="ruby-keyword kw">else</span>
1749:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1750:             <span class="ruby-keyword kw">end</span>
1751:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1752:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1753:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1754:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1755:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1756:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1757:             <span class="ruby-keyword kw">end</span>
1758:           <span class="ruby-keyword kw">end</span>
1759:         <span class="ruby-keyword kw">end</span>
1760:       <span class="ruby-keyword kw">end</span>
1761:     <span class="ruby-keyword kw">end</span>
1762: 
1763:     <span class="ruby-comment cmt">#其它费用支出</span>
1764: 
1765:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbOtherSpend</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,case_code,recevice_code&quot;</span>)
1766:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1767:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1768:         <span class="ruby-identifier">condi</span>=<span class="ruby-node">&quot;dt1='#{Date.today.to_s}' and ( (reason_id like '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_expend_details%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitman_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_arbitcourt_spends%') or (reason_id like  '#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends%') )&quot;</span>
1769:         <span class="ruby-identifier">should_charge</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_charges where used='Y' and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006'  and recevice_code='#{c.recevice_code}'&quot;</span>))
1770:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1771:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1772:         <span class="ruby-keyword kw">else</span>
1773:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-identifier">should_charge</span>.<span class="ruby-identifier">re_rmb_money</span>
1774:         <span class="ruby-keyword kw">end</span>
1775:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_charge</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1776:           <span class="ruby-identifier">should_charge</span>=<span class="ruby-value">0</span>
1777:         <span class="ruby-keyword kw">end</span>
1778: 
1779:         <span class="ruby-identifier">should_refund</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(re_rmb_money) as re_rmb_money from tb_should_refunds where used='Y' and state=2 and typ&lt;&gt;'0001' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003'  and  typ&lt;&gt;'0004' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006'  and recevice_code='#{c.recevice_code}'&quot;</span>))
1780:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1781:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1782:         <span class="ruby-keyword kw">else</span>
1783:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-identifier">should_refund</span>.<span class="ruby-identifier">re_rmb_money</span>
1784:         <span class="ruby-keyword kw">end</span>
1785:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">should_refund</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1786:           <span class="ruby-identifier">should_refund</span>=<span class="ruby-value">0</span>
1787:         <span class="ruby-keyword kw">end</span>
1788: 
1789:         <span class="ruby-identifier">expend_detail</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbExpendDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_expend_details where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1790:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1791:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1792:         <span class="ruby-keyword kw">else</span>
1793:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-identifier">expend_detail</span>.<span class="ruby-identifier">rmb_money</span>
1794:         <span class="ruby-keyword kw">end</span>
1795:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">expend_detail</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1796:           <span class="ruby-identifier">expend_detail</span>=<span class="ruby-value">0</span>
1797:         <span class="ruby-keyword kw">end</span>
1798: 
1799:         <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitmanSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitman_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1800:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1801:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1802:         <span class="ruby-keyword kw">else</span>
1803:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-identifier">arbitman_spend</span>.<span class="ruby-identifier">rmb_money</span>
1804:         <span class="ruby-keyword kw">end</span>
1805:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitman_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1806:           <span class="ruby-identifier">arbitman_spend</span>=<span class="ruby-value">0</span>
1807:         <span class="ruby-keyword kw">end</span>
1808: 
1809:         <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbArbitcourtSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_arbitcourt_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1810:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1811:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1812:         <span class="ruby-keyword kw">else</span>
1813:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-identifier">arbitcourt_spend</span>.<span class="ruby-identifier">rmb_money</span>
1814:         <span class="ruby-keyword kw">end</span>
1815:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">arbitcourt_spend</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1816:           <span class="ruby-identifier">arbitcourt_spend</span>=<span class="ruby-value">0</span>
1817:         <span class="ruby-keyword kw">end</span>
1818: 
1819:         <span class="ruby-identifier">other_spends</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbOtherSpend</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select sum(rmb_money) as rmb_money from tb_other_spends where used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>))
1820:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1821:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1822:         <span class="ruby-keyword kw">else</span>
1823:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-identifier">other_spends</span>.<span class="ruby-identifier">rmb_money</span>
1824:         <span class="ruby-keyword kw">end</span>
1825:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">other_spends</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1826:           <span class="ruby-identifier">other_spends</span>=<span class="ruby-value">0</span>
1827:         <span class="ruby-keyword kw">end</span>
1828: 
1829:         <span class="ruby-identifier">cre</span>=<span class="ruby-identifier">should_charge</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">should_refund</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">expend_detail</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitman_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">arbitcourt_spend</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">other_spends</span>
1830: 
1831:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">cre</span><span class="ruby-operator">&lt;</span><span class="ruby-value">0</span>
1832:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">condi</span>).<span class="ruby-identifier">empty?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1833:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1834:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1835:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_other_spends-#{c.id} 1&quot;</span>
1836:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},费用超支。收费:#{should_charge},退费:#{should_refund},花费:#{expend_detail + arbitman_spend + arbitcourt_spend + other_spends}&quot;</span>
1837:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1838:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1839:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1840:             <span class="ruby-keyword kw">else</span>
1841:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1842:             <span class="ruby-keyword kw">end</span>
1843:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1844:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1845:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1846:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1847:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1848:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1849:             <span class="ruby-keyword kw">end</span>
1850:           <span class="ruby-keyword kw">end</span>
1851:         <span class="ruby-keyword kw">end</span>
1852:       <span class="ruby-keyword kw">end</span>
1853:     <span class="ruby-keyword kw">end</span>
1854:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000111" class="method-detail">
        <a name="M000111"></a>

        <div class="method-heading">
          <a href="#M000111" class="method-signature">
          <span class="method-name">t_11</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000111-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000111-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1882</span>
1882:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_11</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1883:     <span class="ruby-comment cmt">### 11: 退费申请经助理输入后,报秘书处长审批,审批后信息到出纳工作提醒中。</span>
1884:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state=4 and check2_dt&gt;='#{et_before}' and check2_dt&lt;'#{et_now}' and check_dt is NULL&quot;</span>)
1885:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1886:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0004'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1887:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1888:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1889:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_should_refunds-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1890:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1891:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1892:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_should_refunds-#{c.id} 1&quot;</span>
1893:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},新增退费信息,请确认。&quot;</span>
1894:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1895:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1896:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1897:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1898:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1899:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1900:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1901:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1902:             <span class="ruby-keyword kw">end</span>
1903:           <span class="ruby-keyword kw">end</span>
1904:         <span class="ruby-keyword kw">end</span>
1905:       <span class="ruby-keyword kw">end</span>
1906:     <span class="ruby-keyword kw">end</span>
1907:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000112" class="method-detail">
        <a name="M000112"></a>

        <div class="method-heading">
          <a href="#M000112" class="method-signature">
          <span class="method-name">t_12</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000112-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000112-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1909</span>
1909:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_12</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1910:     <span class="ruby-comment cmt">### 12: 开庭前2个工作日,提示助理,短信通知的仲裁员。生成开庭短信提醒（仲裁员，当事人，代理人）</span>
1911:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1912:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&gt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date asc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
1913:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1914:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&gt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date asc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
1915:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1916:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and sittingdate&gt;'#{wwdd2}' and sittingdate&lt;='#{wwdd}'&quot;</span>)
1917:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1918:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1919:           <span class="ruby-identifier">sitting</span>=<span class="ruby-identifier">c</span>
1920:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_sittings-#{c.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1921:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1922:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1923:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_sittings-#{c.id} 2&quot;</span>
1924:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},两个工作日后开庭,提醒短信通知仲裁员。&quot;</span>
1925:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/sms_alert2/list?recevice_code=#{c.recevice_code}&quot;</span>
1926:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1927:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1928:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1929:             <span class="ruby-keyword kw">else</span>
1930:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1931:             <span class="ruby-keyword kw">end</span>
1932:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1933:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1934:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1935:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1936:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1937:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1938:             <span class="ruby-keyword kw">end</span>
1939:           <span class="ruby-keyword kw">end</span>
1940:           <span class="ruby-comment cmt">####################################################################################</span>
1941:           <span class="ruby-identifier">clerk</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1942:           <span class="ruby-comment cmt">### 短信至仲裁员</span>
1943:           <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-%'&quot;</span>)
1944:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
1945:             <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
1946:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
1947:               <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
1948:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1949:                 <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
1950:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1951:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
1952:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
1953:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0001&quot;</span>
1954:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>
1955:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">name</span>
1956:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">mobiletel</span>
1957:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
1958:                   <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
1959:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
1960:                 <span class="ruby-keyword kw">else</span>
1961:                   <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
1962:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
1963:                     <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
1964:                   <span class="ruby-keyword kw">end</span>
1965:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
1966:                 <span class="ruby-keyword kw">end</span>
1967:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
1968:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
1969:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
1970:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1971:                   <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
1972:                 <span class="ruby-keyword kw">end</span>
1973:               <span class="ruby-keyword kw">end</span>
1974:             <span class="ruby-keyword kw">end</span>
1975:           <span class="ruby-keyword kw">end</span>
1976: 
1977:           <span class="ruby-comment cmt">### 短信至当事人</span>
1978:           <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-%'&quot;</span>)
1979:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
1980:             <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
1981:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
1982:               <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
1983:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1984:                 <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
1985:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1986:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
1987:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
1988:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0005&quot;</span>
1989:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
1990:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">partyname</span>
1991:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
1992:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
1993:                   <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
1994:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
1995:                 <span class="ruby-keyword kw">else</span>
1996:                   <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
1997:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
1998:                     <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
1999:                   <span class="ruby-keyword kw">end</span>
2000:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2001:                 <span class="ruby-keyword kw">end</span>
2002:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2003:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2004:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2005:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2006:                   <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2007:                 <span class="ruby-keyword kw">end</span>
2008:               <span class="ruby-keyword kw">end</span>
2009:             <span class="ruby-keyword kw">end</span>
2010:           <span class="ruby-keyword kw">end</span>
2011: 
2012:           <span class="ruby-comment cmt">### 短信至代理人</span>
2013:           <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-%'&quot;</span>)
2014:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
2015:             <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
2016:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2017:               <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2018:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2019:                 <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2020:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2021:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2022:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2023:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0006&quot;</span>
2024:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
2025:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">name</span>
2026:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
2027:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2028:                   <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2029:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2030:                 <span class="ruby-keyword kw">else</span>
2031:                   <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2032:                   <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2033:                     <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2034:                   <span class="ruby-keyword kw">end</span>
2035:                   <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2036:                 <span class="ruby-keyword kw">end</span>
2037:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2038:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2039:                 <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2040:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2041:                   <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2042:                 <span class="ruby-keyword kw">end</span>
2043:               <span class="ruby-keyword kw">end</span>
2044:             <span class="ruby-keyword kw">end</span>
2045:           <span class="ruby-keyword kw">end</span>
2046:           <span class="ruby-comment cmt">####################################################################################</span>
2047:         <span class="ruby-keyword kw">end</span>
2048:       <span class="ruby-keyword kw">end</span>
2049:     <span class="ruby-keyword kw">end</span>
2050:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000113" class="method-detail">
        <a name="M000113"></a>

        <div class="method-heading">
          <a href="#M000113" class="method-signature">
          <span class="method-name">t_13</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000113-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000113-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2052</span>
2052:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_13</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2053:     <span class="ruby-comment cmt">### 发文报批后立刻提示审批人进行审批</span>
2054:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDocApproval</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(state=0 or state=-1) and call_t&gt;='#{et_before}' and call_t&lt;'#{et_now}' &quot;</span>)
2055:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
2056:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
2057:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{c.a_u} tb_doc_approvals-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2058:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2059:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2060:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{c.a_u} tb_doc_approvals-#{c.id} 1&quot;</span>
2061:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;提醒审批发文。立案号:#{TbCase.find_by_recevice_code(c.recevice_code).case_code},文件流水号:#{c.file_code},发文编号:#{c.send_code},申请人:#{User.find_by_code(c.call_u).name}。&quot;</span>
2062:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2063:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">a_u</span>
2064:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2065:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2066:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2067:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2068:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
2069:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2070:           <span class="ruby-keyword kw">end</span>
2071:         <span class="ruby-keyword kw">end</span>
2072:       <span class="ruby-keyword kw">end</span>
2073:     <span class="ruby-keyword kw">end</span>
2074:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000114" class="method-detail">
        <a name="M000114"></a>

        <div class="method-heading">
          <a href="#M000114" class="method-signature">
          <span class="method-name">t_14</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000114-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000114-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2076</span>
2076:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_14</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2077:     <span class="ruby-comment cmt">### 出纳收款后提醒助理进行确认</span>
2078:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state=1 and typ='a' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}' &quot;</span>)
2079:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
2080:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0003' or duty_code='0004' &quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2081:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
2082:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2083:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{ud.user_code} tb_charges-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2084:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2085:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2086:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{ud.user_code} tb_charges-#{c.id} 1&quot;</span>
2087:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;新增收款信息。收款号:#{c.code},付款人名称:#{c.p},付款时间:#{c.c_dt.to_s(:db)},金额:￥#{c.rmb_money}。&quot;</span>
2088:             <span class="ruby-ivar">@ccc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct tb_cases.case_code as case_code,tb_cases.recevice_code as recevice_code,tb_cases.state as state,tb_cases.clerk as clerk,tb_cases.clerk_2 as clerk_2 from tb_should_charges,tb_cases where tb_cases.state&gt;=1 and tb_cases.state&lt;100 and tb_cases.state&lt;&gt;3 and tb_should_charges.recevice_code=tb_cases.recevice_code and tb_should_charges.used='Y' and tb_cases.used='Y' and tb_should_charges.typ&lt;&gt;'0002' and tb_should_charges.typ&lt;&gt;'0003' and tb_should_charges.typ&lt;&gt;'0005' and tb_should_charges.typ&lt;&gt;'0006' and tb_should_charges.re_rmb_money=0 and (tb_should_charges.rmb_money - tb_should_charges.redu_rmb_money)=#{c.rmb_money} order by tb_cases.recevice_code&quot;</span>)
2089:             <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-ivar">@ccc</span>.<span class="ruby-identifier">empty?</span>
2090:               <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;&lt;br/&gt;与以下案件应收款信息基本相符:&lt;br/&gt;&quot;</span>
2091:             <span class="ruby-keyword kw">end</span>
2092:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ccc</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ccc</span>
2093:               <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">ccc</span>.<span class="ruby-identifier">recevice_code</span>)
2094:               <span class="ruby-keyword kw">if</span>  (<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">4</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state!</span>=<span class="ruby-value">1</span> ) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">==</span><span class="ruby-value">1</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">210</span>)) <span class="ruby-operator">||</span> (<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">&gt;=</span><span class="ruby-value">4</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span> <span class="ruby-operator">-</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">accepttime</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">210</span>))
2095:               <span class="ruby-keyword kw">else</span>
2096:                 <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;立案号:#{ccc.case_code},&quot;</span>
2097:                 <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;咨询流水号:#{ccc.recevice_code},&quot;</span>
2098:                 <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ccc</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">ccc</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-keyword kw">nil</span>
2099:                   <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;办案助理:#{User.find_by_code(ccc.clerk).name}。&quot;</span>
2100:                 <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">ccc</span>.<span class="ruby-identifier">clerk_2!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">ccc</span>.<span class="ruby-identifier">clerk_2!</span>=<span class="ruby-keyword kw">nil</span>
2101:                   <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;咨询助理:#{User.find_by_code(ccc.clerk_2).name}。&quot;</span>
2102:                 <span class="ruby-keyword kw">end</span>
2103:               <span class="ruby-keyword kw">end</span>
2104:             <span class="ruby-keyword kw">end</span>
2105:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2106:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;/charge_correspondence/charge_list&quot;</span>
2107:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2108:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2109:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2110:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2111:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2112:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2113:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2114:           <span class="ruby-keyword kw">end</span>
2115:         <span class="ruby-keyword kw">end</span>
2116:       <span class="ruby-keyword kw">end</span>
2117:     <span class="ruby-keyword kw">end</span>
2118:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000115" class="method-detail">
        <a name="M000115"></a>

        <div class="method-heading">
          <a href="#M000115" class="method-signature">
          <span class="method-name">t_15</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000115-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000115-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2120</span>
2120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_15</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2121:     <span class="ruby-comment cmt">### 助理确认收款明细后,提醒出纳</span>
2122:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbChargeCorr</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}' &quot;</span>)
2123:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
2124:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0004'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2125:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
2126:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2127:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{ud.user_code} tb_charge_corrs-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2128:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2129:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2130:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{ud.user_code} tb_charge_corrs-#{c.id} 1&quot;</span>
2131:             <span class="ruby-identifier">tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_charge_id</span>)
2132:             <span class="ruby-identifier">tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">charge_id</span>)
2133:             <span class="ruby-identifier">contents</span>=<span class="ruby-value str">&quot;收款记录对应信息如下:&lt;br/&gt;&quot;</span>
2134:             <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;收款号:#{tc.code}&quot;</span>
2135:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'c'</span>
2136:               <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;(拆分)&quot;</span>
2137:             <span class="ruby-keyword kw">end</span>
2138:             <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;,付款人名称:#{tc.p},金额:￥#{tc.rmb_money}&quot;</span>
2139:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'c'</span>
2140:               <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;(拆分)&quot;</span>
2141:             <span class="ruby-keyword kw">end</span>
2142:             <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot;。&lt;br/&gt;&quot;</span>
2143:             <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;立案号:#{tsc.case_code},咨询流水号:#{tsc.recevice_code},收款类型:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0031' and data_val='#{tsc.typ}'&quot;).data_text}&quot;</span>
2144:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2145:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2146:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2147:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2148:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2149:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2150:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2151:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2152:           <span class="ruby-keyword kw">end</span>
2153:         <span class="ruby-keyword kw">end</span>
2154:       <span class="ruby-keyword kw">end</span>
2155:     <span class="ruby-keyword kw">end</span>
2156:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000116" class="method-detail">
        <a name="M000116"></a>

        <div class="method-heading">
          <a href="#M000116" class="method-signature">
          <span class="method-name">t_16</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000116-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000116-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2158</span>
2158:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_16</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2159:     <span class="ruby-comment cmt">### 助理确认收款明细到【案件收费】后,检查案件是否已经立案,如果未立案则提醒到处长,</span>
2160:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbChargeCorr</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}' &quot;</span>)
2161:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
2162:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2163:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
2164:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2165:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{ud.user_code} tb_charge_corrs-#{c.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2166:             <span class="ruby-identifier">tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_charge_id</span>)
2167:             <span class="ruby-comment cmt">#tc=TbCharge.find(c.charge_id)</span>
2168:             <span class="ruby-identifier">case_1</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">tsc</span>.<span class="ruby-identifier">recevice_code</span>)
2169:             <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">case_1</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
2170:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2171:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2172:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{ud.user_code} tb_charge_corrs-#{c.id} 2&quot;</span>
2173:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案提醒。案件咨询流水号:#{tsc.recevice_code}。&quot;</span>
2174:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">case_1</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">case_1</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-keyword kw">nil</span>
2175:                 <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;办案助理:#{User.find_by_code(case_1.clerk).name}。&quot;</span>
2176:               <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">case_1</span>.<span class="ruby-identifier">clerk_2!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">case_1</span>.<span class="ruby-identifier">clerk_2!</span>=<span class="ruby-keyword kw">nil</span>
2177:                 <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;咨询助理:#{User.find_by_code(case_1.clerk_2).name}。&quot;</span>
2178:               <span class="ruby-keyword kw">end</span>
2179:               <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;应收案件收费:￥#{tsc.rmb_money}。&quot;</span>
2180:               <span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span><span class="ruby-operator">+</span><span class="ruby-node">&quot;实收:￥#{tsc.re_rmb_money}。&quot;</span>
2181:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2182:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2183:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2184:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2185:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2186:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2187:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2188:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2189:             <span class="ruby-keyword kw">end</span>
2190:           <span class="ruby-keyword kw">end</span>
2191:         <span class="ruby-keyword kw">end</span>
2192:       <span class="ruby-keyword kw">end</span>
2193:     <span class="ruby-keyword kw">end</span>
2194:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000117" class="method-detail">
        <a name="M000117"></a>

        <div class="method-heading">
          <a href="#M000117" class="method-signature">
          <span class="method-name">t_17</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000117-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000117-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2196</span>
2196:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_17</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2197:     <span class="ruby-comment cmt">### 发开庭通知的时候，判断是否有欠缴费用，如果有则提醒</span>
2198:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and (typ_code='0026' or typ_code='0027' or typ_code='0030' or typ_code='0031' or typ_code='0032' or typ_code='0033') and t&gt;='#{et_before}' and t&lt;'#{et_now}' &quot;</span>)
2199:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
2200:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
2201:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{c.u} tb_docs-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2202:           <span class="ruby-identifier">ccc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>)
2203:           <span class="ruby-identifier">sss</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">count</span>(<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and typ&lt;&gt;'0002' and typ&lt;&gt;'0003' and typ&lt;&gt;'0005' and typ&lt;&gt;'0006' and recevice_code='#{c.recevice_code}' and (rmb_money  - redu_rmb_money - re_rmb_money)&gt;0&quot;</span>)
2204:           <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">ccc</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">ccc</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-identifier">sss!</span>=<span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sss!</span>=<span class="ruby-value">0</span>)
2205:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2206:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2207:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{c.u} tb_docs-#{c.id} 1&quot;</span>
2208:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ccc</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">ccc</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
2209:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;交费提醒，立案号:#{TbCase.find_by_recevice_code(c.recevice_code).case_code},咨询流水号:#{c.recevice_code},已经创建开庭通知书，但是还没有交费记录。&quot;</span>
2210:             <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">sss!</span>=<span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sss!</span>=<span class="ruby-value">0</span>
2211:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;交费提醒，立案号:#{TbCase.find_by_recevice_code(c.recevice_code).case_code},咨询流水号:#{c.recevice_code},已经创建开庭通知书，但是还有欠缴费用未交。&quot;</span>
2212:             <span class="ruby-keyword kw">end</span>
2213:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2214:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2215:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">u</span>
2216:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2217:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2218:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2219:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2220:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2221:           <span class="ruby-keyword kw">end</span>
2222:         <span class="ruby-keyword kw">end</span>
2223:       <span class="ruby-keyword kw">end</span>
2224:     <span class="ruby-keyword kw">end</span>
2225:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000118" class="method-detail">
        <a name="M000118"></a>

        <div class="method-heading">
          <a href="#M000118" class="method-signature">
          <span class="method-name">t_18</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000118-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000118-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2227</span>
2227:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_18</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2228:     <span class="ruby-comment cmt">### 每年年初去修改仲裁员的年龄</span>
2229:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
2230:       <span class="ruby-ivar">@arbit</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
2231:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">arb</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbit</span>
2232:         <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">age</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">year</span><span class="ruby-operator">-</span><span class="ruby-identifier">arb</span>.<span class="ruby-identifier">birthday</span>.<span class="ruby-identifier">year</span>
2233:         <span class="ruby-identifier">arb</span>.<span class="ruby-identifier">save</span>
2234:       <span class="ruby-keyword kw">end</span>
2235:     <span class="ruby-keyword kw">end</span>
2236:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000119" class="method-detail">
        <a name="M000119"></a>

        <div class="method-heading">
          <a href="#M000119" class="method-signature">
          <span class="method-name">t_19</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000119-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000119-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2238</span>
2238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_19</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2239: 
2240:     <span class="ruby-comment cmt">### 立案后提醒到出纳，某发票号已对应到案件</span>
2241:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and nowdate_t&gt;='#{et_before}' and nowdate_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;nowdate_t&quot;</span>)
2242:     <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0004'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2243:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
2244:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2245:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;case_nowdate_t #{ud.user_code} #{c.recevice_code} #{c.nowdate_t.to_s(:db)}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2246:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2247:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2248:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;case_nowdate_t #{ud.user_code} #{c.recevice_code} #{c.nowdate_t.to_s(:db)}&quot;</span>
2249:           <span class="ruby-ivar">@charge</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and typ&lt;&gt;'c' and recevice_code='#{c.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
2250:           <span class="ruby-identifier">ccc</span>=<span class="ruby-value str">''</span>
2251:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ch</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@charge</span>
2252:             <span class="ruby-identifier">ccc</span>=<span class="ruby-value str">&quot;发票号:&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">ch</span>.<span class="ruby-identifier">code</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot;  &quot;</span>
2253:           <span class="ruby-keyword kw">end</span>
2254:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">ccc</span> <span class="ruby-operator">+</span> <span class="ruby-node">&quot;，立案号为:#{c.case_code}&quot;</span>
2255:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2256:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2257:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2258:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2259:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2260:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2261:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2262:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2263:           <span class="ruby-keyword kw">end</span>
2264:         <span class="ruby-keyword kw">end</span>
2265:       <span class="ruby-keyword kw">end</span>
2266:     <span class="ruby-keyword kw">end</span>
2267: 
2268:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000102" class="method-detail">
        <a name="M000102"></a>

        <div class="method-heading">
          <a href="#M000102" class="method-signature">
          <span class="method-name">t_2</span><span class="method-args">(et_before,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000102-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000102-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task_a.rb, line 311</span>
311:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_2</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
312:     <span class="ruby-comment cmt">### 2:处长指定办案人员后,直接提醒办案人员发出仲裁通知,2工作日之后仍未发出的,提醒到处长处。</span>
313:     <span class="ruby-comment cmt">#直接提醒办案人员发出仲裁通知</span>
314:     <span class="ruby-comment cmt">#方式一:先检查交款记录</span>
315:     <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and check_dt&gt;='#{et_before}' and check_dt&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;check_dt&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
316:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
317:       <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
318:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span>  <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
319:         <span class="ruby-ivar">@tcc</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>))
320:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tcc!</span>=<span class="ruby-keyword kw">nil</span>
321:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}' and (typ_code='0005' or typ_code='0006' or typ_code='0007' or typ_code='0008' or typ_code='0009' or typ_code='0010' or typ_code='0011' or typ_code='0012')&quot;</span>).<span class="ruby-identifier">empty?</span>
322:             <span class="ruby-comment cmt">#if Remind.find_by_reason_id(&quot;#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 1&quot;)==nil</span>
323:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;reason_id like '#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-%tb_clerkchanges-%1'&quot;</span>).<span class="ruby-identifier">empty?</span>
324:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
325:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
326:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 1&quot;</span>
327:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{@tsc.case_code},案件咨询流水号:#{@tsc.recevice_code},提醒发仲裁通知,【发文】中发【仲裁通知】。&quot;</span>
328:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/case_doc/list?recevice_code=#{@tsc.recevice_code}&quot;</span>
329:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
330:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
331:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
332:               <span class="ruby-keyword kw">else</span>
333:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
334:               <span class="ruby-keyword kw">end</span>
335:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
336:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
337:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
338:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
339:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
340:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
341:               <span class="ruby-keyword kw">end</span>
342:             <span class="ruby-keyword kw">end</span>
343:           <span class="ruby-keyword kw">end</span>
344:         <span class="ruby-keyword kw">end</span>
345:       <span class="ruby-keyword kw">end</span>
346:     <span class="ruby-keyword kw">end</span>
347:     <span class="ruby-comment cmt">#方式二:先检查助理更换记录</span>
348:     <span class="ruby-ivar">@tcc_1</span>=<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;t&gt;='#{et_before}' and t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct recevice_code as recevice_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
349:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tcc_1</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tcc_1</span>
350:       <span class="ruby-ivar">@tcc</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{tcc_1.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>))
351:       <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and clerk&lt;&gt;'' and recevice_code='#{@tcc.recevice_code}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
352:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
353:         <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
354:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span>  (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span>  <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
355:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}' and (typ_code='0005' or typ_code='0006' or typ_code='0007' or typ_code='0008' or typ_code='0009' or typ_code='0010' or typ_code='0011' or typ_code='0012')&quot;</span>).<span class="ruby-identifier">empty?</span>
356:             <span class="ruby-comment cmt">#if Remind.find_by_reason_id(&quot;#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 1&quot;)==nil</span>
357:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;reason_id like '#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-%tb_clerkchanges-%1'&quot;</span>).<span class="ruby-identifier">empty?</span>
358:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
359:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
360:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{@tsc.recevice_code} #{TbCase.find_by_recevice_code(@tsc.recevice_code).clerk} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 1&quot;</span>
361:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{@tsc.case_code},案件咨询流水号:#{@tsc.recevice_code},提醒发仲裁通知,【发文】中发【仲裁通知】。&quot;</span>
362:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/case_doc/list?recevice_code=#{@tsc.recevice_code}&quot;</span>
363:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
364:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
365:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
366:               <span class="ruby-keyword kw">else</span>
367:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
368:               <span class="ruby-keyword kw">end</span>
369:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
370:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
371:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
372:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
373:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
374:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
375:               <span class="ruby-keyword kw">end</span>
376:             <span class="ruby-keyword kw">end</span>
377:           <span class="ruby-keyword kw">end</span>
378:         <span class="ruby-keyword kw">end</span>
379:       <span class="ruby-keyword kw">end</span>
380:     <span class="ruby-keyword kw">end</span>
381:     <span class="ruby-comment cmt">#2个工作日后仍发仲裁通知,提醒到处长。方式一:先检查交款记录</span>
382:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
383:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
384:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
385:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
386:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
387:       <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and check_dt&gt;='#{wwdd} 00:00:01' and check_dt&lt;'#{wwdd2} 00:00:01'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;check_dt&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
388:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
389:         <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
390:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
391:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
392:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span><span class="ruby-operator">==</span><span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
393:             <span class="ruby-ivar">@tcc</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>))
394:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tcc!</span>=<span class="ruby-keyword kw">nil</span>
395:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}' and (typ_code='0005' or typ_code='0006' or typ_code='0007' or typ_code='0008' or typ_code='0009' or typ_code='0010' or typ_code='0011' or typ_code='0012')&quot;</span>).<span class="ruby-identifier">empty?</span>
396:                 <span class="ruby-comment cmt">#if Remind.find_by_reason_id(&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 2&quot;)==nil</span>
397:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;reason_id like '#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-%tb_clerkchanges-%2'&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
398:                   <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
399:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
400:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>= <span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 2&quot;</span>
401:                   <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>)
402:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;助理:#{User.find_by_code(@case.clerk).name}，立案号:#{@case.case_code},案件咨询流水号:#{@tsc.recevice_code},提醒发仲裁通知,【发文】中【仲裁通知】。&quot;</span>
403:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
404:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
405:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
406:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
407:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
408:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
409:                   <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
410:                     <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
411:                   <span class="ruby-keyword kw">end</span>
412:                 <span class="ruby-keyword kw">end</span>
413:               <span class="ruby-keyword kw">end</span>
414:             <span class="ruby-keyword kw">end</span>
415:           <span class="ruby-keyword kw">end</span>
416:         <span class="ruby-keyword kw">end</span>
417:       <span class="ruby-keyword kw">end</span>
418:     <span class="ruby-keyword kw">end</span>
419:     <span class="ruby-comment cmt">#2个工作日后仍未指定的,提醒到处长。方式二:先检查助理更换记录</span>
420:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
421:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
422:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
423:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
424:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
425:       <span class="ruby-ivar">@tcc_1</span>=<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;t&gt;='#{wwdd} 00:00:01' and t&lt;'#{wwdd2} 00:00:01'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct recevice_code as recevice_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>)
426:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">tcc_1</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tcc_1</span>
427:         <span class="ruby-ivar">@tcc</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{tcc_1.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id desc&quot;</span>))
428:         <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;(typ='a' or typ='c') and used='Y' and state=2 and should_id&lt;&gt;0 and clerk&lt;&gt;'' and recevice_code='#{@tcc.recevice_code}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct should_id as should_id&quot;</span>)
429:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
430:           <span class="ruby-ivar">@tsc</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">should_id</span>)
431:           <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
432:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
433:             <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span> <span class="ruby-keyword kw">and</span> (<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0004'</span>) <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">re_rmb_money!</span>=<span class="ruby-value">0</span>
434:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{@tsc.recevice_code}' and (typ_code='0005' or typ_code='0006' or typ_code='0007' or typ_code='0008' or typ_code='0009' or typ_code='0010' or typ_code='0011' or typ_code='0012')&quot;</span>).<span class="ruby-identifier">empty?</span>
435:                 <span class="ruby-comment cmt">#if Remind.find_by_reason_id(&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 2&quot;)==nil</span>
436:                 <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;reason_id like '#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-%tb_clerkchanges-%2'&quot;</span>).<span class="ruby-identifier">empty?</span>
437:                   <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
438:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
439:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{@tsc.recevice_code} #{ud.user_code} tb_should_charges-#{@tsc.id} tb_clerkchanges-#{@tcc.id} 2&quot;</span>
440:                   <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>)
441:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;助理:#{User.find_by_code(@case.clerk).name}，立案号:#{@case.case_code},案件咨询流水号:#{@tsc.recevice_code},提醒发仲裁通知,【发文】中发【仲裁通知】。&quot;</span>
442:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
443:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
444:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
445:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
446:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
447:                   <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
448:                   <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@tsc</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
449:                     <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
450:                   <span class="ruby-keyword kw">end</span>
451:                 <span class="ruby-keyword kw">end</span>
452:               <span class="ruby-keyword kw">end</span>
453:             <span class="ruby-keyword kw">end</span>
454:           <span class="ruby-keyword kw">end</span>
455:         <span class="ruby-keyword kw">end</span>
456:       <span class="ruby-keyword kw">end</span>
457:     <span class="ruby-keyword kw">end</span>
458:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000120" class="method-detail">
        <a name="M000120"></a>

        <div class="method-heading">
          <a href="#M000120" class="method-signature">
          <span class="method-name">t_20</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000120-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000120-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2270</span>
2270:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_20</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2271: 
2272:     <span class="ruby-comment cmt">### 立案后提醒到处长，提醒处长有案件立案，办案助理是谁</span>
2273:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and nowdate_t&gt;='#{et_before}' and nowdate_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;nowdate_t&quot;</span>)
2274:     <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2275:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
2276:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2277:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;cz case_nowdate_t #{ud.user_code} #{c.recevice_code} #{c.nowdate_t.to_s(:db)}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2278:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2279:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2280:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;cz case_nowdate_t #{ud.user_code} #{c.recevice_code} #{c.nowdate_t.to_s(:db)}&quot;</span>
2281:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;已立案提醒，立案号为:#{c.case_code}，办案助理:#{User.find_by_code(c.clerk).name},咨询流水号:#{c.recevice_code}&quot;</span>
2282:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2283:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2284:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2285:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2286:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2287:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2288:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2289:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2290:           <span class="ruby-keyword kw">end</span>
2291:         <span class="ruby-keyword kw">end</span>
2292:       <span class="ruby-keyword kw">end</span>
2293:     <span class="ruby-keyword kw">end</span>
2294: 
2295:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000121" class="method-detail">
        <a name="M000121"></a>

        <div class="method-heading">
          <a href="#M000121" class="method-signature">
          <span class="method-name">t_21</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000121-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000121-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2297</span>
2297:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_21</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2298:     <span class="ruby-comment cmt">### 21: 删除一年前的提醒信息</span>
2299:     <span class="ruby-identifier">limit_date_360</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">months_ago</span>(<span class="ruby-value">12</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2300:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2301:       <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-node">&quot;dt1&lt;'#{limit_date_360}'&quot;</span>)
2302:     <span class="ruby-keyword kw">end</span>
2303:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000122" class="method-detail">
        <a name="M000122"></a>

        <div class="method-heading">
          <a href="#M000122" class="method-signature">
          <span class="method-name">t_22</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000122-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000122-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2305</span>
2305:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_22</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2306:     <span class="ruby-comment cmt">### 22: 案件结案后，半年后，提示填写执行情况</span>
2307:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2308:       <span class="ruby-comment cmt">#limit_date_180=et_now_t.months_ago(6).to_date.to_s(:db)</span>
2309:       <span class="ruby-identifier">limit_date</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-operator">-</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">'1011'</span>).<span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_i</span>
2310:       <span class="ruby-identifier">limit_date</span>=<span class="ruby-identifier">limit_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2311:       <span class="ruby-ivar">@endbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and decideDate='#{limit_date}'&quot;</span>)
2312:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">endbook</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@endbook</span>
2313:         <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">endbook</span>.<span class="ruby-identifier">recevice_code</span>)
2314:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">runstyle</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2315:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2316:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2317:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;zl caseendbook #{@case.clerk} #{@case.recevice_code}&quot;</span>
2318:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号为:#{@case.case_code}，请填写执行情况&quot;</span>
2319:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/case_p/select_3/#{@case.id}?act_r=show_implement&amp;contr_r=wind_up_case&quot;</span>
2320:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2321:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
2322:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2323:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2324:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2325:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2326:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2327:         <span class="ruby-keyword kw">end</span>
2328:       <span class="ruby-keyword kw">end</span>
2329:     <span class="ruby-keyword kw">end</span>
2330:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000123" class="method-detail">
        <a name="M000123"></a>

        <div class="method-heading">
          <a href="#M000123" class="method-signature">
          <span class="method-name">t_23</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000123-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000123-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2332</span>
2332:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_23</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2333:     <span class="ruby-comment cmt">### 生成短信提醒信息，提醒开庭信息(仲裁员、当事人、代理人)</span>
2334:     <span class="ruby-comment cmt">#1：检查开庭记录</span>
2335:     <span class="ruby-ivar">@sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y'  and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;u_t&quot;</span>)
2336:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">sitting</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@sitting</span>
2337:       <span class="ruby-identifier">clerk</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
2338:       <span class="ruby-comment cmt">### 短信至仲裁员</span>
2339:       <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-%'&quot;</span>)
2340:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
2341:         <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
2342:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2343:           <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
2344:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2345:             <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2346:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2347:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2348:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
2349:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0001&quot;</span>
2350:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>
2351:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">name</span>
2352:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">mobiletel</span>
2353:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2354:               <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2355:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2356:             <span class="ruby-keyword kw">else</span>
2357:               <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2358:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2359:                 <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2360:               <span class="ruby-keyword kw">end</span>
2361:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2362:             <span class="ruby-keyword kw">end</span>
2363:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2364:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2365:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2366:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2367:               <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2368:             <span class="ruby-keyword kw">end</span>
2369:           <span class="ruby-keyword kw">end</span>
2370:         <span class="ruby-keyword kw">end</span>
2371:       <span class="ruby-keyword kw">end</span>
2372: 
2373:       <span class="ruby-comment cmt">### 短信至当事人</span>
2374:       <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-%'&quot;</span>)
2375:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
2376:         <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
2377:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2378:           <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
2379:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2380:             <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2381:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2382:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2383:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
2384:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0005&quot;</span>
2385:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
2386:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">partyname</span>
2387:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
2388:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2389:               <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2390:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2391:             <span class="ruby-keyword kw">else</span>
2392:               <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2393:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2394:                 <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2395:               <span class="ruby-keyword kw">end</span>
2396:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2397:             <span class="ruby-keyword kw">end</span>
2398:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2399:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2400:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2401:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2402:               <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2403:             <span class="ruby-keyword kw">end</span>
2404:           <span class="ruby-keyword kw">end</span>
2405:         <span class="ruby-keyword kw">end</span>
2406:       <span class="ruby-keyword kw">end</span>
2407: 
2408:       <span class="ruby-comment cmt">### 短信至代理人</span>
2409:       <span class="ruby-ivar">@sms_a</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and content_id like '%-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-%'&quot;</span>)
2410:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@sms_a</span>.<span class="ruby-identifier">empty?</span>
2411:         <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{sitting.recevice_code}'&quot;</span>)
2412:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2413:           <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2414:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2415:             <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2416:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2417:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2418:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2419:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0006&quot;</span>
2420:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
2421:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">name</span>
2422:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
2423:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2424:               <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2425:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2426:             <span class="ruby-keyword kw">else</span>
2427:               <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2428:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2429:                 <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2430:               <span class="ruby-keyword kw">end</span>
2431:               <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2432:             <span class="ruby-keyword kw">end</span>
2433:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2434:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2435:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2436:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2437:               <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2438:             <span class="ruby-keyword kw">end</span>
2439:           <span class="ruby-keyword kw">end</span>
2440:         <span class="ruby-keyword kw">end</span>
2441:       <span class="ruby-keyword kw">end</span>
2442: 
2443:     <span class="ruby-keyword kw">end</span>
2444:     <span class="ruby-comment cmt">#2：检查仲裁员分配记录</span>
2445:     <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
2446:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2447:       <span class="ruby-identifier">sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{ca.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate desc&quot;</span>)
2448:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting!</span>=<span class="ruby-keyword kw">nil</span>
2449:         <span class="ruby-identifier">clerk</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
2450:         <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
2451:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2452:           <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2453:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2454:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2455:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0001-arbitman-#{ca.arbitman}&quot;</span>
2456:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0001&quot;</span>
2457:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>
2458:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">name</span>
2459:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-constant">TbArbitman</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">arbitman</span>).<span class="ruby-identifier">mobiletel</span>
2460:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2461:             <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2462:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2463:           <span class="ruby-keyword kw">else</span>
2464:             <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2465:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2466:               <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2467:             <span class="ruby-keyword kw">end</span>
2468:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2469:           <span class="ruby-keyword kw">end</span>
2470:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2471:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2472:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2473:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2474:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2475:           <span class="ruby-keyword kw">end</span>
2476:         <span class="ruby-keyword kw">end</span>
2477:       <span class="ruby-keyword kw">end</span>
2478:     <span class="ruby-keyword kw">end</span>
2479:     <span class="ruby-comment cmt">#3：检查当事人信息</span>
2480:     <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
2481:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2482:       <span class="ruby-identifier">sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{ca.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate desc&quot;</span>)
2483:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting!</span>=<span class="ruby-keyword kw">nil</span>
2484:         <span class="ruby-identifier">clerk</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
2485:         <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
2486:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2487:           <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2488:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2489:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2490:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0005-party-#{ca.id}&quot;</span>
2491:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0005&quot;</span>
2492:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
2493:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">partyname</span>
2494:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
2495:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2496:             <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2497:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2498:           <span class="ruby-keyword kw">else</span>
2499:             <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2500:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2501:               <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2502:             <span class="ruby-keyword kw">end</span>
2503:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2504:           <span class="ruby-keyword kw">end</span>
2505:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2506:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2507:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2508:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2509:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2510:           <span class="ruby-keyword kw">end</span>
2511:         <span class="ruby-keyword kw">end</span>
2512:       <span class="ruby-keyword kw">end</span>
2513:     <span class="ruby-keyword kw">end</span>
2514:     <span class="ruby-comment cmt">#4：检查代理人信息</span>
2515:     <span class="ruby-ivar">@ca</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
2516:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ca</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ca</span>
2517:       <span class="ruby-identifier">sitting</span>=<span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{ca.recevice_code}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sittingdate desc&quot;</span>)
2518:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting!</span>=<span class="ruby-keyword kw">nil</span>
2519:         <span class="ruby-identifier">clerk</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
2520:         <span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2521:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">find_by_content_id</span>(<span class="ruby-identifier">content_id</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2522:           <span class="ruby-ivar">@sms</span>=<span class="ruby-constant">TbSmsAlert</span>.<span class="ruby-identifier">new</span>
2523:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2524:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0002'</span>
2525:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">content_id</span>=<span class="ruby-node">&quot;#{clerk}-sitting-#{sitting.recevice_code}-#{sitting.id}-0006-agent-#{ca.id}&quot;</span>
2526:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_typ</span>=<span class="ruby-value str">&quot;0006&quot;</span>
2527:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>
2528:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">p_name</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">name</span>
2529:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">mobiletel</span>=<span class="ruby-identifier">ca</span>.<span class="ruby-identifier">mobiletel</span>
2530:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">add_typ</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span>
2531:             <span class="ruby-identifier">zct</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0023'  and  data_val='#{sitting.sittingplace}'&quot;</span>).<span class="ruby-identifier">data_text</span>
2532:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2533:           <span class="ruby-keyword kw">else</span>
2534:             <span class="ruby-identifier">ktd</span>=<span class="ruby-value str">&quot;&quot;</span>
2535:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code!</span>=<span class="ruby-keyword kw">nil</span>
2536:               <span class="ruby-identifier">ktd</span>=<span class="ruby-constant">Region</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">area_code</span>).<span class="ruby-identifier">name</span>
2537:             <span class="ruby-keyword kw">end</span>
2538:             <span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;华南国际经济贸易仲裁委员会开庭通知：#{sitting.case_code}号案件，开庭时间：#{sitting.sittingdate.to_s(:db)}日 #{sitting.open_t}时。办案助理:#{User.find_by_code(clerk).name}&quot;</span>
2539:           <span class="ruby-keyword kw">end</span>
2540:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-identifier">contents</span>
2541:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">send_state</span>=<span class="ruby-value">100</span>
2542:           <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">c_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
2543:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">sitting</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
2544:             <span class="ruby-ivar">@sms</span>.<span class="ruby-identifier">save</span>
2545:           <span class="ruby-keyword kw">end</span>
2546:         <span class="ruby-keyword kw">end</span>
2547:       <span class="ruby-keyword kw">end</span>
2548:     <span class="ruby-keyword kw">end</span>
2549: 
2550:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000124" class="method-detail">
        <a name="M000124"></a>

        <div class="method-heading">
          <a href="#M000124" class="method-signature">
          <span class="method-name">t_24</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000124-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000124-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2552</span>
2552:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_24</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2553:     <span class="ruby-comment cmt">### 24:每天检查前一天操作的结案记录（以操作时间为准），结案的裁决或撤案是否已经上传了裁决书或者撤案书。如果没有上传，则提醒到制作裁决者（创建该案件结案信息的人）。</span>
2554:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2555:       <span class="ruby-identifier">limit_date_1</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2556:       <span class="ruby-ivar">@endbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and u_t&gt;='#{limit_date_1} 00:00:01' and u_t&lt;='#{limit_date_1} 23:59:59'&quot;</span>)
2557:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">endbook</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@endbook</span>
2558:         <span class="ruby-ivar">@case_book</span>=<span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and typ='0002' and recevice_code='#{endbook.recevice_code}'&quot;</span>)
2559:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case_book</span>.<span class="ruby-identifier">empty?</span>
2560:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook #{endbook.u} #{endbook.recevice_code} #{endbook.id} case_book&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2561:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2562:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2563:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook #{endbook.u} #{endbook.recevice_code} #{endbook.id} case_book&quot;</span>
2564:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号为:#{endbook.case_code}，请上传裁决书或者撤案书&quot;</span>
2565:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
2566:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2567:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">endbook</span>.<span class="ruby-identifier">u</span>
2568:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2569:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2570:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2571:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2572:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2573:           <span class="ruby-keyword kw">end</span>
2574:         <span class="ruby-keyword kw">end</span>
2575:       <span class="ruby-keyword kw">end</span>
2576:     <span class="ruby-keyword kw">end</span>
2577:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000125" class="method-detail">
        <a name="M000125"></a>

        <div class="method-heading">
          <a href="#M000125" class="method-signature">
          <span class="method-name">t_25</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁员人案统计
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000125-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000125-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2581</span>
2581:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_25</span>()
2582:     <span class="ruby-comment cmt">### 25:每天生成仲裁员人案统计表</span>
2583:     <span class="ruby-identifier">et_now</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2584:     <span class="ruby-constant">ReportArbitmanCase</span>.<span class="ruby-identifier">delete_all</span>()
2585:     <span class="ruby-ivar">@arbitman_case</span> = <span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code is not null&quot;</span>, <span class="ruby-identifier">:group=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
2586:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbitman_case</span>
2587:       <span class="ruby-ivar">@arbitmancase</span>=<span class="ruby-constant">ReportArbitmanCase</span>.<span class="ruby-identifier">new</span>()
2588:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">tim</span>=<span class="ruby-identifier">et_now</span>
2589:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">code</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>
2590:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">name</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span>
2591: 
2592:       <span class="ruby-comment cmt"># 在办案件数量</span>
2593:       <span class="ruby-identifier">a1</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(c.recevice_code)) as cn from tb_cases as c,tb_casearbitmen as ca where c.used='Y' and c.state&gt;=4 and c.state&lt;100 and c.caseendbook_id_first is null and c.recevice_code=ca.recevice_code and ca.used='Y' and ca.arbitman='#{c.code}'&quot;</span>)
2594:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a1</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">a1</span>).<span class="ruby-identifier">cn</span>
2595:       
2596:       <span class="ruby-comment cmt">#已结案件数量</span>
2597:       <span class="ruby-identifier">a2</span> = <span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as n_l&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2598:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a2</span> = <span class="ruby-identifier">a2</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a2</span>.<span class="ruby-identifier">n_l</span>.<span class="ruby-identifier">to_i</span>
2599: 
2600:       <span class="ruby-comment cmt"># 性别、手机、电话、传真</span>
2601:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">sex</span>       = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">sex</span>
2602:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">mobiletel</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">mobiletel</span>
2603:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">telh</span>      = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">telh</span>
2604:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">fax</span>       = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">fax</span>
2605: 
2606:       <span class="ruby-comment cmt">#  仲裁员评价（助理评价）</span>
2607:       <span class="ruby-identifier">sc</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
2608:         select sum(e.score) as scores,count(distinct e.recevice_code) as e_n
2609:         from tb_evaluates as e,tb_cases as c
2610:         where e.used='Y' and e.arbitman='#{c.code}' and
2611:               e.recevice_code=c.recevice_code and c.used='Y' and
2612:               c.state&gt;=4 and c.caseendbook_id_first is not null&quot;</span>
2613:       )
2614:       <span class="ruby-identifier">sc_1</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">scores</span>   <span class="ruby-comment cmt"># 仲裁员评价 所有案件的总分</span>
2615:       <span class="ruby-identifier">sc_2</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">e_n</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 仲裁员评价 所有案件的数量</span>
2616:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sc_2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
2617:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">score</span> = (<span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sc_2</span><span class="ruby-operator">*</span><span class="ruby-value">100</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">sc_2</span>
2618:       <span class="ruby-keyword kw">end</span>
2619:       
2620:       <span class="ruby-comment cmt">#校核评价</span>
2621:       <span class="ruby-identifier">sc2</span> = <span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
2622:         SELECT avg(score)AS scores, recevice_code
2623:         FROM    tb_award_judges
2624:         WHERE used = 'Y' AND (arbitman1='#{c.code}' or arbitman2='#{c.code}' or arbitman3='#{c.code}')
2625:         GROUP BY recevice_code
2626:       &quot;</span>)
2627: 
2628:       <span class="ruby-identifier">sc_1</span> = <span class="ruby-value">0</span>
2629:       <span class="ruby-identifier">sc_2</span> = <span class="ruby-identifier">sc2</span>.<span class="ruby-identifier">size</span>
2630:       <span class="ruby-identifier">sc2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
2631:         <span class="ruby-identifier">sc_1</span> = <span class="ruby-identifier">sc_1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">scores</span>.<span class="ruby-identifier">to_f</span>
2632:       <span class="ruby-keyword kw">end</span>
2633:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sc_1</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sc_2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
2634:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">score2</span> = <span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">to_f</span><span class="ruby-operator">/</span><span class="ruby-identifier">sc_2</span>
2635:       <span class="ruby-keyword kw">end</span>
2636:       
2637:       <span class="ruby-comment cmt">#已结案件中，担任首席/独任的总数（A类) #################################</span>
2638:       <span class="ruby-identifier">a_a</span>=<span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as nl&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null and (arbitmantype='0001' or arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2639:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a_a!</span>=<span class="ruby-keyword kw">nil</span>
2640:         <span class="ruby-identifier">a_a</span>=<span class="ruby-identifier">a_a</span>.<span class="ruby-identifier">nl</span>
2641:       <span class="ruby-keyword kw">else</span>
2642:         <span class="ruby-identifier">a_a</span>=<span class="ruby-value">0</span>
2643:       <span class="ruby-keyword kw">end</span>
2644:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_a</span>=<span class="ruby-identifier">a_a</span>
2645:       <span class="ruby-identifier">j_ad</span>=<span class="ruby-value">0</span>
2646:       <span class="ruby-comment cmt">#A类：起草裁决书的数量</span>
2647:       <span class="ruby-identifier">award</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(a.recevice_code)) as ac from tb_award_details as a,v_arbitman_cases as cc,tb_awards as aw where a.used='Y' and a.draftsman_typ='0001' and a.draftsman='#{c.code}' and (a.typ='0003' or a.typ='0004') and a.recevice_code=aw.recevice_code and aw.used='Y' and a.p_id=aw.id and aw.recevice_code=cc.recevice_code and a.draftsman=cc.code and cc.state&gt;=4 and cc.caseendbook_id_first is not null and (cc.arbitmantype='0001' or cc.arbitmantype='0002')&quot;</span>)
2648:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">awa</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">award</span>
2649:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awa!</span>=<span class="ruby-keyword kw">nil</span>
2650:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_b</span>=<span class="ruby-identifier">awa</span>.<span class="ruby-identifier">ac</span>
2651:           <span class="ruby-identifier">j_ad</span>=<span class="ruby-identifier">j_ad</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">awa</span>.<span class="ruby-identifier">ac</span>.<span class="ruby-identifier">to_i</span>
2652:         <span class="ruby-keyword kw">end</span>
2653:       <span class="ruby-keyword kw">end</span>
2654:       <span class="ruby-comment cmt">#A类：延期裁决案件的数量</span>
2655:       <span class="ruby-identifier">delays</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(tb_casedelays.recevice_code)) as ac from tb_cases,tb_casearbitmen,tb_casedelays where tb_casedelays.used='Y' and tb_casedelays.recevice_code=tb_cases.recevice_code and tb_cases.used='Y' and tb_cases.state&gt;=4
2656:            and tb_cases.caseendbook_id_first is not null and tb_cases.recevice_code=tb_casearbitmen.recevice_code and tb_casearbitmen.used='Y' and tb_casearbitmen.arbitman='#{c.code}' and (tb_casearbitmen.arbitmantype='0001' or tb_casearbitmen.arbitmantype='0002')&quot;</span>)
2657:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">delays</span>
2658:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d!</span>=<span class="ruby-keyword kw">nil</span>
2659:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_c</span>=<span class="ruby-identifier">d</span>.<span class="ruby-identifier">ac</span>
2660:         <span class="ruby-keyword kw">end</span>
2661:       <span class="ruby-keyword kw">end</span>
2662:       <span class="ruby-comment cmt">#A类：被申请回避的次数</span>
2663:       <span class="ruby-identifier">tb_evalate</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(e.recevice_code)) as ad&quot;</span>,<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as e inner join v_arbitman_cases as va on e.arbitman=va.code and e.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and (va.arbitmantype='0001' or va.arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;e.used='Y' and e.arbitman=?&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2664:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_evalate!</span>=<span class="ruby-keyword kw">nil</span>
2665:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_d</span>=<span class="ruby-identifier">tb_evalate</span>.<span class="ruby-identifier">ad</span>
2666:       <span class="ruby-keyword kw">end</span>
2667:       <span class="ruby-comment cmt">#A类：平均结案时间</span>
2668:       <span class="ruby-identifier">tb_caseendbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;s.used='Y'&quot;</span>],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;as s inner join v_arbitman_cases as va on s.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and va.code='#{c.code}' and (va.arbitmantype='0001' or va.arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sum(datediff(s.decideDate,va.nowdate)) as dat,count(distinct(s.recevice_code)) as aa&quot;</span>)
2669:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook!</span>=<span class="ruby-keyword kw">nil</span>
2670:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
2671:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_e</span>=<span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">dat</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">/</span><span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span>
2672:         <span class="ruby-keyword kw">end</span>
2673:       <span class="ruby-keyword kw">end</span>
2674:       <span class="ruby-comment cmt">#B类    ###################################</span>
2675:       <span class="ruby-identifier">b_a</span>=<span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as nl&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null and (arbitmantype='0003' or arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2676:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_a!</span>=<span class="ruby-keyword kw">nil</span>
2677:         <span class="ruby-identifier">b_a</span>=<span class="ruby-identifier">b_a</span>.<span class="ruby-identifier">nl</span>
2678:       <span class="ruby-keyword kw">else</span>
2679:         <span class="ruby-identifier">b_a</span>=<span class="ruby-value">0</span>
2680:       <span class="ruby-keyword kw">end</span>
2681:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_a</span>=<span class="ruby-identifier">b_a</span>
2682:       <span class="ruby-comment cmt">#B类：起草裁决书的数量</span>
2683:       <span class="ruby-identifier">award</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(a.recevice_code) as ac from tb_award_details as a,v_arbitman_cases as cc,tb_awards as aw where a.used='Y' and a.draftsman_typ='0001' and a.draftsman='#{c.code}' and (a.typ='0003' or a.typ='0004') and a.recevice_code=aw.recevice_code and aw.used='Y' and a.p_id=aw.id and aw.recevice_code=cc.recevice_code and a.draftsman=cc.code and cc.state&gt;=4 and cc.caseendbook_id_first is not null and (cc.arbitmantype='0003' or cc.arbitmantype='0004')&quot;</span>)
2684:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">awa2</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">award</span>
2685:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awa2!</span>=<span class="ruby-keyword kw">nil</span>
2686:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_b</span>=<span class="ruby-identifier">awa2</span>.<span class="ruby-identifier">ac</span>
2687:           <span class="ruby-identifier">j_ad</span>=<span class="ruby-identifier">j_ad</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">awa2</span>.<span class="ruby-identifier">ac</span>.<span class="ruby-identifier">to_i</span>
2688:         <span class="ruby-keyword kw">end</span>
2689:       <span class="ruby-keyword kw">end</span>
2690:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">ad</span>=<span class="ruby-identifier">j_ad</span>
2691:       <span class="ruby-comment cmt">#B类：延期裁决案件的数量</span>
2692:       <span class="ruby-identifier">delays</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(tb_casedelays.recevice_code)) as ac from tb_cases,tb_casearbitmen,tb_casedelays where tb_casedelays.used='Y' and tb_casedelays.recevice_code=tb_cases.recevice_code and tb_cases.used='Y' and tb_cases.state&gt;=4 and tb_cases.caseendbook_id_first is not null
2693:           and tb_cases.caseendbook_id_first is not null and tb_cases.recevice_code=tb_casearbitmen.recevice_code and tb_casearbitmen.used='Y' and tb_casearbitmen.arbitman='#{c.code}' and (tb_casearbitmen.arbitmantype='0003' or tb_casearbitmen.arbitmantype='0004')&quot;</span>)
2694:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">d_1</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">delays</span>
2695:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d_1!</span>=<span class="ruby-keyword kw">nil</span>
2696:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_c</span>=<span class="ruby-identifier">d_1</span>.<span class="ruby-identifier">ac</span>
2697:         <span class="ruby-keyword kw">end</span>
2698:       <span class="ruby-keyword kw">end</span>
2699:       <span class="ruby-comment cmt">#B类：被申请回避的次数</span>
2700:       <span class="ruby-identifier">tb_evalate</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(e.recevice_code)) as ad&quot;</span>,<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as e inner join v_arbitman_cases as va on e.arbitman=va.code and e.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and (va.arbitmantype='0003' or va.arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;e.used='Y' and e.arbitman=?&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2701:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_evalate!</span>=<span class="ruby-keyword kw">nil</span>
2702:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_d</span>=<span class="ruby-identifier">tb_evalate</span>.<span class="ruby-identifier">ad</span>
2703:       <span class="ruby-keyword kw">end</span>
2704:       <span class="ruby-comment cmt">#B类：平均结案时间</span>
2705:       <span class="ruby-identifier">tb_caseendbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;s.used='Y'&quot;</span>],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;as s inner join v_arbitman_cases as va on s.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and va.code='#{c.code}' and (va.arbitmantype='0003' or va.arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sum(datediff(s.decideDate,va.nowdate)) as dat,count(distinct(s.recevice_code)) as aa&quot;</span>)
2706:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook!</span>=<span class="ruby-keyword kw">nil</span>
2707:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
2708:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_e</span>=<span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">dat</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">/</span><span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span>
2709:         <span class="ruby-keyword kw">end</span>
2710:       <span class="ruby-keyword kw">end</span>
2711: 
2712:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">save</span>
2713:     <span class="ruby-keyword kw">end</span>
2714:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000126" class="method-detail">
        <a name="M000126"></a>

        <div class="method-heading">
          <a href="#M000126" class="method-signature">
          <span class="method-name">t_25_by_arbitman</span><span class="method-args">(code)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
被<a href="TbArbitman.html">TbArbitman</a>模型调用
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000126-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000126-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2717</span>
2717:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_25_by_arbitman</span>(<span class="ruby-identifier">code</span>)
2718:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;t_25_by_arbitman start #{Time.now.to_s(:db)}&quot;</span>
2719:     <span class="ruby-identifier">et_now</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2720:     <span class="ruby-constant">ReportArbitmanCase</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-node">&quot;code='#{code}'&quot;</span>)
2721:     <span class="ruby-ivar">@arbitman_case</span> = <span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;code='#{code}'&quot;</span> ,<span class="ruby-identifier">:group=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
2722:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbitman_case</span>
2723:       <span class="ruby-ivar">@arbitmancase</span>=<span class="ruby-constant">ReportArbitmanCase</span>.<span class="ruby-identifier">new</span>()
2724:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">tim</span>=<span class="ruby-identifier">et_now</span>
2725:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">code</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>
2726:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">name</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">name</span>
2727: 
2728:       <span class="ruby-comment cmt"># 在办案件数量</span>
2729:       <span class="ruby-identifier">a1</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(c.recevice_code)) as cn from tb_cases as c,tb_casearbitmen as ca where c.used='Y' and c.state&gt;=4 and c.state&lt;100 and c.caseendbook_id_first is null and c.recevice_code=ca.recevice_code and ca.used='Y' and ca.arbitman='#{c.code}'&quot;</span>)
2730:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a1</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_first_record</span>(<span class="ruby-identifier">a1</span>).<span class="ruby-identifier">cn</span>
2731: 
2732:       <span class="ruby-comment cmt">#已结案件数量</span>
2733:       <span class="ruby-identifier">a2</span> = <span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as n_l&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2734:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a2</span> = <span class="ruby-identifier">a2</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-value">? </span><span class="ruby-value">0</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">a2</span>.<span class="ruby-identifier">n_l</span>.<span class="ruby-identifier">to_i</span>
2735: 
2736:       <span class="ruby-comment cmt"># 性别、手机、电话、传真</span>
2737:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">sex</span>       = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">sex</span>
2738:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">mobiletel</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">mobiletel</span>
2739:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">telh</span>      = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">telh</span>
2740:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">fax</span>       = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">fax</span>
2741: 
2742:       <span class="ruby-comment cmt">#  仲裁员评价（助理评价）</span>
2743:       <span class="ruby-identifier">sc</span> = <span class="ruby-constant">TbEvaluate</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
2744:         select sum(e.score) as scores,count(distinct e.recevice_code) as e_n
2745:         from tb_evaluates as e,tb_cases as c
2746:         where e.used='Y' and e.arbitman='#{c.code}' and
2747:               e.recevice_code=c.recevice_code and c.used='Y' and
2748:               c.state&gt;=4 and c.caseendbook_id_first is not null&quot;</span>
2749:       )
2750:       <span class="ruby-identifier">sc_1</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">scores</span>   <span class="ruby-comment cmt"># 仲裁员评价 所有案件的总分</span>
2751:       <span class="ruby-identifier">sc_2</span> = <span class="ruby-identifier">sc</span>.<span class="ruby-identifier">first</span>.<span class="ruby-identifier">e_n</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-comment cmt"># 仲裁员评价 所有案件的数量</span>
2752:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sc_2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
2753:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">score</span> = (<span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">to_i</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">sc_2</span><span class="ruby-operator">*</span><span class="ruby-value">100</span>)<span class="ruby-operator">/</span><span class="ruby-identifier">sc_2</span>
2754:       <span class="ruby-keyword kw">end</span>
2755: 
2756:       <span class="ruby-comment cmt">#校核评价</span>
2757:       <span class="ruby-identifier">sc2</span> = <span class="ruby-constant">TbAwardJudge</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;
2758:         SELECT avg(score)AS scores, recevice_code
2759:         FROM    tb_award_judges
2760:         WHERE used = 'Y' AND (arbitman1='#{c.code}' or arbitman2='#{c.code}' or arbitman3='#{c.code}')
2761:         GROUP BY recevice_code
2762:       &quot;</span>)
2763: 
2764:       <span class="ruby-identifier">sc_1</span> = <span class="ruby-value">0</span>
2765:       <span class="ruby-identifier">sc_2</span> = <span class="ruby-identifier">sc2</span>.<span class="ruby-identifier">size</span>
2766:       <span class="ruby-identifier">sc2</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
2767:         <span class="ruby-identifier">sc_1</span> = <span class="ruby-identifier">sc_1</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">scores</span>.<span class="ruby-identifier">to_f</span>
2768:       <span class="ruby-keyword kw">end</span>
2769:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sc_1</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">sc_2</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
2770:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">score2</span> = <span class="ruby-identifier">sc_1</span>.<span class="ruby-identifier">to_f</span><span class="ruby-operator">/</span><span class="ruby-identifier">sc_2</span>
2771:       <span class="ruby-keyword kw">end</span>
2772: 
2773:       <span class="ruby-comment cmt">#已结案件中，担任首席/独任的总数（A类) #################################</span>
2774:       <span class="ruby-identifier">a_a</span>=<span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as nl&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null and (arbitmantype='0001' or arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2775:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">a_a!</span>=<span class="ruby-keyword kw">nil</span>
2776:         <span class="ruby-identifier">a_a</span>=<span class="ruby-identifier">a_a</span>.<span class="ruby-identifier">nl</span>
2777:       <span class="ruby-keyword kw">else</span>
2778:         <span class="ruby-identifier">a_a</span>=<span class="ruby-value">0</span>
2779:       <span class="ruby-keyword kw">end</span>
2780:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_a</span>=<span class="ruby-identifier">a_a</span>
2781:       <span class="ruby-identifier">j_ad</span>=<span class="ruby-value">0</span>
2782:       <span class="ruby-comment cmt">#A类：起草裁决书的数量</span>
2783:       <span class="ruby-identifier">award</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(a.recevice_code)) as ac from tb_award_details as a,v_arbitman_cases as cc,tb_awards as aw where a.used='Y' and a.draftsman_typ='0001' and a.draftsman='#{c.code}' and (a.typ='0003' or a.typ='0004') and a.recevice_code=aw.recevice_code and aw.used='Y' and a.p_id=aw.id and aw.recevice_code=cc.recevice_code and a.draftsman=cc.code and cc.state&gt;=4 and cc.caseendbook_id_first is not null and (cc.arbitmantype='0001' or cc.arbitmantype='0002')&quot;</span>)
2784:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">awa</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">award</span>
2785:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awa!</span>=<span class="ruby-keyword kw">nil</span>
2786:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_b</span>=<span class="ruby-identifier">awa</span>.<span class="ruby-identifier">ac</span>
2787:           <span class="ruby-identifier">j_ad</span>=<span class="ruby-identifier">j_ad</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">awa</span>.<span class="ruby-identifier">ac</span>.<span class="ruby-identifier">to_i</span>
2788:         <span class="ruby-keyword kw">end</span>
2789:       <span class="ruby-keyword kw">end</span>
2790:       <span class="ruby-comment cmt">#A类：延期裁决案件的数量</span>
2791:       <span class="ruby-identifier">delays</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(tb_casedelays.recevice_code)) as ac from tb_cases,tb_casearbitmen,tb_casedelays where tb_casedelays.used='Y' and tb_casedelays.recevice_code=tb_cases.recevice_code and tb_cases.used='Y' and tb_cases.state&gt;=4
2792:            and tb_cases.caseendbook_id_first is not null and tb_cases.recevice_code=tb_casearbitmen.recevice_code and tb_casearbitmen.used='Y' and tb_casearbitmen.arbitman='#{c.code}' and (tb_casearbitmen.arbitmantype='0001' or tb_casearbitmen.arbitmantype='0002')&quot;</span>)
2793:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">d</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">delays</span>
2794:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d!</span>=<span class="ruby-keyword kw">nil</span>
2795:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_c</span>=<span class="ruby-identifier">d</span>.<span class="ruby-identifier">ac</span>
2796:         <span class="ruby-keyword kw">end</span>
2797:       <span class="ruby-keyword kw">end</span>
2798:       <span class="ruby-comment cmt">#A类：被申请回避的次数</span>
2799:       <span class="ruby-identifier">tb_evalate</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(e.recevice_code)) as ad&quot;</span>,<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as e inner join v_arbitman_cases as va on e.arbitman=va.code and e.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and (va.arbitmantype='0001' or va.arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;e.used='Y' and e.arbitman=?&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2800:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_evalate!</span>=<span class="ruby-keyword kw">nil</span>
2801:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_d</span>=<span class="ruby-identifier">tb_evalate</span>.<span class="ruby-identifier">ad</span>
2802:       <span class="ruby-keyword kw">end</span>
2803:       <span class="ruby-comment cmt">#A类：平均结案时间</span>
2804:       <span class="ruby-identifier">tb_caseendbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;s.used='Y'&quot;</span>],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;as s inner join v_arbitman_cases as va on s.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and va.code='#{c.code}' and (va.arbitmantype='0001' or va.arbitmantype='0002')&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sum(datediff(s.decideDate,va.nowdate)) as dat,count(distinct(s.recevice_code)) as aa&quot;</span>)
2805:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook!</span>=<span class="ruby-keyword kw">nil</span>
2806:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
2807:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">a_e</span>=<span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">dat</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">/</span><span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span>
2808:         <span class="ruby-keyword kw">end</span>
2809:       <span class="ruby-keyword kw">end</span>
2810:       <span class="ruby-comment cmt">#B类    ###################################</span>
2811:       <span class="ruby-identifier">b_a</span>=<span class="ruby-constant">VArbitmanCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(recevice_code)) as nl&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;state&gt;=4 and code=? and caseendbook_id_first is not null and (arbitmantype='0003' or arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2812:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">b_a!</span>=<span class="ruby-keyword kw">nil</span>
2813:         <span class="ruby-identifier">b_a</span>=<span class="ruby-identifier">b_a</span>.<span class="ruby-identifier">nl</span>
2814:       <span class="ruby-keyword kw">else</span>
2815:         <span class="ruby-identifier">b_a</span>=<span class="ruby-value">0</span>
2816:       <span class="ruby-keyword kw">end</span>
2817:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_a</span>=<span class="ruby-identifier">b_a</span>
2818:       <span class="ruby-comment cmt">#B类：起草裁决书的数量</span>
2819:       <span class="ruby-identifier">award</span>=<span class="ruby-constant">TbAwardDetail</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(a.recevice_code) as ac from tb_award_details as a,v_arbitman_cases as cc,tb_awards as aw where a.used='Y' and a.draftsman_typ='0001' and a.draftsman='#{c.code}' and (a.typ='0003' or a.typ='0004') and a.recevice_code=aw.recevice_code and aw.used='Y' and a.p_id=aw.id and aw.recevice_code=cc.recevice_code and a.draftsman=cc.code and cc.state&gt;=4 and cc.caseendbook_id_first is not null and (cc.arbitmantype='0003' or cc.arbitmantype='0004')&quot;</span>)
2820:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">awa2</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">award</span>
2821:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">awa2!</span>=<span class="ruby-keyword kw">nil</span>
2822:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_b</span>=<span class="ruby-identifier">awa2</span>.<span class="ruby-identifier">ac</span>
2823:           <span class="ruby-identifier">j_ad</span>=<span class="ruby-identifier">j_ad</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">awa2</span>.<span class="ruby-identifier">ac</span>.<span class="ruby-identifier">to_i</span>
2824:         <span class="ruby-keyword kw">end</span>
2825:       <span class="ruby-keyword kw">end</span>
2826:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">ad</span>=<span class="ruby-identifier">j_ad</span>
2827:       <span class="ruby-comment cmt">#B类：延期裁决案件的数量</span>
2828:       <span class="ruby-identifier">delays</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select count(distinct(tb_casedelays.recevice_code)) as ac from tb_cases,tb_casearbitmen,tb_casedelays where tb_casedelays.used='Y' and tb_casedelays.recevice_code=tb_cases.recevice_code and tb_cases.used='Y' and tb_cases.state&gt;=4 and tb_cases.caseendbook_id_first is not null
2829:           and tb_cases.caseendbook_id_first is not null and tb_cases.recevice_code=tb_casearbitmen.recevice_code and tb_casearbitmen.used='Y' and tb_casearbitmen.arbitman='#{c.code}' and (tb_casearbitmen.arbitmantype='0003' or tb_casearbitmen.arbitmantype='0004')&quot;</span>)
2830:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">d_1</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">delays</span>
2831:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">d_1!</span>=<span class="ruby-keyword kw">nil</span>
2832:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_c</span>=<span class="ruby-identifier">d_1</span>.<span class="ruby-identifier">ac</span>
2833:         <span class="ruby-keyword kw">end</span>
2834:       <span class="ruby-keyword kw">end</span>
2835:       <span class="ruby-comment cmt">#B类：被申请回避的次数</span>
2836:       <span class="ruby-identifier">tb_evalate</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;count(distinct(e.recevice_code)) as ad&quot;</span>,<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;as e inner join v_arbitman_cases as va on e.arbitman=va.code and e.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and (va.arbitmantype='0003' or va.arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;e.used='Y' and e.arbitman=?&quot;</span>,<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>])
2837:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_evalate!</span>=<span class="ruby-keyword kw">nil</span>
2838:         <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_d</span>=<span class="ruby-identifier">tb_evalate</span>.<span class="ruby-identifier">ad</span>
2839:       <span class="ruby-keyword kw">end</span>
2840:       <span class="ruby-comment cmt">#B类：平均结案时间</span>
2841:       <span class="ruby-identifier">tb_caseendbook</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span>[<span class="ruby-value str">&quot;s.used='Y'&quot;</span>],<span class="ruby-identifier">:joins=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;as s inner join v_arbitman_cases as va on s.recevice_code=va.recevice_code and va.state&gt;=4 and va.caseendbook_id_first is not null and va.code='#{c.code}' and (va.arbitmantype='0003' or va.arbitmantype='0004')&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;sum(datediff(s.decideDate,va.nowdate)) as dat,count(distinct(s.recevice_code)) as aa&quot;</span>)
2842:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook!</span>=<span class="ruby-keyword kw">nil</span>
2843:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">&gt;</span><span class="ruby-value">0</span>
2844:           <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">b_e</span>=<span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">dat</span>.<span class="ruby-identifier">to_i</span><span class="ruby-operator">/</span><span class="ruby-identifier">tb_caseendbook</span>.<span class="ruby-identifier">aa</span>.<span class="ruby-identifier">to_i</span>
2845:         <span class="ruby-keyword kw">end</span>
2846:       <span class="ruby-keyword kw">end</span>
2847: 
2848:       <span class="ruby-ivar">@arbitmancase</span>.<span class="ruby-identifier">save</span>
2849:     <span class="ruby-keyword kw">end</span>
2850:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;t_25_by_arbitman end  #{Time.now.to_s(:db)}&quot;</span>
2851:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000127" class="method-detail">
        <a name="M000127"></a>

        <div class="method-heading">
          <a href="#M000127" class="method-signature">
          <span class="method-name">t_25_by_recevice_code</span><span class="method-args">(recevice_code)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
<a
href="Task_a.html#M000127">t_25_by_recevice_code</a>被以下模型调用
tb_casearbitmen <a href="TbEvaluate.html">TbEvaluate</a> <a
href="TbAwardJudge.html">TbAwardJudge</a> tb_award_details tb_awards
tb_casedelays tb_caseendbook
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000127-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000127-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2862</span>
2862:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_25_by_recevice_code</span>(<span class="ruby-identifier">recevice_code</span>)
2863:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;t_25_by_recevice_code start #{Time.now.to_s(:db)}&quot;</span>
2864:     <span class="ruby-identifier">et_now</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2865:     <span class="ruby-ivar">@arbitman_case</span> = <span class="ruby-constant">VArbitmanCaseAll</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{recevice_code}' and code is not null&quot;</span> ,<span class="ruby-identifier">:group=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
2866:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@arbitman_case</span>
2867:       <span class="ruby-constant">ReportArbitmanCase</span>.<span class="ruby-identifier">delete_all</span>(<span class="ruby-node">&quot;code='#{c.code}'&quot;</span>)
2868:       <span class="ruby-identifier">t_25_by_arbitman</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">code</span>)
2869:     <span class="ruby-keyword kw">end</span>
2870:     <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;t_25_by_recevice_code end #{Time.now.to_s(:db)}&quot;</span>
2871:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000128" class="method-detail">
        <a name="M000128"></a>

        <div class="method-heading">
          <a href="#M000128" class="method-signature">
          <span class="method-name">t_26</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000128-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000128-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2873</span>
2873:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_26</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2874:     <span class="ruby-comment cmt">### 26:每天检查咨询记录，把咨询有效期小于今天的咨询记录设置为历史咨询记录。</span>
2875:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2876:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state=1 and recevice_code_limit_dat&lt;'#{et_now.slice(0,10)}'&quot;</span>)
2877:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
2878:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
2879:           <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0002'</span>)
2880:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
2881:             <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
2882:           <span class="ruby-keyword kw">end</span>
2883:         <span class="ruby-keyword kw">end</span>
2884:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
2885:       <span class="ruby-keyword kw">end</span>
2886:     <span class="ruby-keyword kw">end</span>
2887:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000129" class="method-detail">
        <a name="M000129"></a>

        <div class="method-heading">
          <a href="#M000129" class="method-signature">
          <span class="method-name">t_27</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000129-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000129-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2889</span>
2889:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_27</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2890:     <span class="ruby-comment cmt">### 27:检查对应到案件的费用是否被对应到明细了，如果没对应则提醒到助理。</span>
2891:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2892:       <span class="ruby-identifier">limit_date_1</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">1</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2893:       <span class="ruby-ivar">@charge</span>=<span class="ruby-constant">TbCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and (typ='a' or typ='c') and state='2' and should_id=0 and check_dt&gt;='#{limit_date_1} 00:00:01' and check_dt&lt;='#{limit_date_1} 23:59:59'&quot;</span>)
2894:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">charge</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@charge</span>
2895:         <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">charge</span>.<span class="ruby-identifier">recevice_code</span>)
2896:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">&quot;&quot;</span>
2897:           <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
2898:         <span class="ruby-keyword kw">else</span>
2899:           <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>
2900:         <span class="ruby-keyword kw">end</span>
2901:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;charge #{clerk} #{charge.recevice_code} #{charge.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2902:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2903:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2904:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;charge #{clerk} #{charge.recevice_code} #{charge.id} 1&quot;</span>
2905:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号为:#{charge.case_code}，咨询流水号为：#{charge.recevice_code}，有一个金额为#{charge.rmb_money}RMB的收费记录未对应到明细，请进行明细对应。&quot;</span>
2906:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/charge_correspondence_detail/list?recevice_code=#{charge.recevice_code}&quot;</span>
2907:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2908:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">clerk</span>
2909:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2910:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2911:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2912:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2913:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2914:         <span class="ruby-keyword kw">end</span>
2915:       <span class="ruby-keyword kw">end</span>
2916:     <span class="ruby-keyword kw">end</span>
2917:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000130" class="method-detail">
        <a name="M000130"></a>

        <div class="method-heading">
          <a href="#M000130" class="method-signature">
          <span class="method-name">t_28</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000130-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000130-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2919</span>
2919:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_28</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2920:     <span class="ruby-comment cmt">### 立案后未组庭案件15,20,30天提醒助理，45,60,90,120天提醒助理和处长。</span>
2921:     <span class="ruby-comment cmt">### 立案后未组庭案件15,20,30天提醒助理</span>
2922:     <span class="ruby-identifier">do_remind</span> = <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-comment cmt"># 一天只运行一次</span>
2923:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_remind</span>
2924:       <span class="ruby-comment cmt">### 立案后未组庭案件15,20,30天提醒助理</span>
2925:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'recevice_code,case_code,nowdate,clerk'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;state=4 and caseorg_id_first is null and caseendbook_id_first is null and (nowdate='#{et_now_t.ago(3600 * 24 * 15).to_date.to_s(:db)}' or nowdate='#{et_now_t.ago(3600 * 24 * 20).to_date.to_s(:db)}' or nowdate='#{et_now_t.ago(3600 * 24 * 30).to_date.to_s(:db)}')&quot;</span>)
2926:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
2927:         <span class="ruby-ivar">@remin</span> = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2928:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">'Y'</span>
2929:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{c.clerk} zctz #{et_now.slice(0,10)}&quot;</span>
2930:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span> = <span class="ruby-node">&quot;#{c.case_code}案(申请人:#{get_party_1(c.recevice_code)})，助理:#{User.find_by_code(c.clerk).name},尚未组庭。如需延期提醒，请使用[确定延期]功能。&quot;</span>
2931:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2932:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
2933:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span> = <span class="ruby-value">1</span>
2934:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-value str">'0001'</span>
2935:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span> = <span class="ruby-value str">'system'</span>
2936:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2937:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2938:       <span class="ruby-keyword kw">end</span>
2939: 
2940:       <span class="ruby-comment cmt">### 立案后未组庭案件45,60,90,120天提醒助理和处长。</span>
2941:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'recevice_code,case_code,nowdate,clerk'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;state=4 and caseorg_id_first is null and caseendbook_id_first is null and (nowdate='#{et_now_t.ago(3600 * 24 * 45).to_date.to_s(:db)}' or nowdate='#{et_now_t.ago(3600 * 24 * 60).to_date.to_s(:db)}' or nowdate='#{et_now_t.ago(3600 * 24 * 90).to_date.to_s(:db)}' or nowdate='#{et_now_t.ago(3600 * 24 * 120).to_date.to_s(:db)}')&quot;</span>)
2942:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
2943:         <span class="ruby-ivar">@remin</span> = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2944:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">'Y'</span>
2945:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{c.clerk} zctz #{et_now.slice(0,10)}&quot;</span>
2946:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span> = <span class="ruby-node">&quot;#{c.case_code}案(申请人:#{get_party_1(c.recevice_code)})，助理:#{User.find_by_code(c.clerk).name},尚未组庭。如需延期提醒，请使用[确定延期]功能。&quot;</span>
2947:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2948:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
2949:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span> = <span class="ruby-value">1</span>
2950:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-value str">'0001'</span>
2951:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span> = <span class="ruby-value str">'system'</span>
2952:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2953:         <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2954: 
2955:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
2956:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
2957:           <span class="ruby-ivar">@remin</span> = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2958:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">'Y'</span>
2959:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} zctz #{et_now.slice(0,10)}&quot;</span>
2960:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span> = <span class="ruby-node">&quot;#{c.case_code}案(申请人:#{get_party_1(c.recevice_code)})，助理:#{User.find_by_code(c.clerk).name},尚未组庭。如需延期提醒，请使用[确定延期]功能。&quot;</span>
2961:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2962:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span> = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
2963:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span> = <span class="ruby-value">1</span>
2964:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-value str">'0001'</span>
2965:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span> = <span class="ruby-value str">'system'</span>
2966:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2967:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2968:         <span class="ruby-keyword kw">end</span>
2969:       <span class="ruby-keyword kw">end</span>
2970:     <span class="ruby-keyword kw">end</span>
2971:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000131" class="method-detail">
        <a name="M000131"></a>

        <div class="method-heading">
          <a href="#M000131" class="method-signature">
          <span class="method-name">t_29</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000131-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000131-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 2973</span>
2973:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_29</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
2974:     <span class="ruby-comment cmt">### 29:结案10天后提醒助理该案件未归档,20天提醒到处长。</span>
2975:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
2976:       <span class="ruby-identifier">limit_date_1</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">10</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
2977:       <span class="ruby-ivar">@end_book</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and decideDate='#{limit_date_1}'&quot;</span>)
2978:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">end_book</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@end_book</span>
2979:         <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">end_book</span>.<span class="ruby-identifier">recevice_code</span>)
2980:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">&quot;&quot;</span>
2981:           <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
2982:         <span class="ruby-keyword kw">else</span>
2983:           <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>
2984:         <span class="ruby-keyword kw">end</span>
2985:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">file_receive_u</span>.<span class="ruby-identifier">blank?</span>
2986:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook29 #{clerk} #{end_book.recevice_code} #{end_book.id} 10&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
2987:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
2988:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
2989:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook29 #{clerk} #{end_book.recevice_code} #{end_book.id} 10&quot;</span>
2990:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;#{@case.case_code}案，已于#{end_book.decideDate}结案,结案已经10天,请助理#{User.find_by_code(@case.clerk).name}提交案卷.&quot;</span>
2991:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
2992:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
2993:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">clerk</span>
2994:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
2995:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
2996:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
2997:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
2998:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
2999:           <span class="ruby-keyword kw">end</span>
3000:         <span class="ruby-keyword kw">end</span>
3001:       <span class="ruby-keyword kw">end</span>
3002: 
3003:       <span class="ruby-identifier">n</span>=<span class="ruby-value">80</span>
3004:       <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">n</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>
3005:         <span class="ruby-identifier">limit_date</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">10</span>  <span class="ruby-operator">*</span> <span class="ruby-identifier">n</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
3006:         <span class="ruby-ivar">@end_book</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and decideDate='#{limit_date}'&quot;</span>)
3007:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">end_book</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@end_book</span>
3008:           <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">end_book</span>.<span class="ruby-identifier">recevice_code</span>)
3009:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">&quot;&quot;</span>
3010:             <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
3011:           <span class="ruby-keyword kw">else</span>
3012:             <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>
3013:           <span class="ruby-keyword kw">end</span>
3014:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">file_receive_u</span>.<span class="ruby-identifier">blank?</span>
3015:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook29 #{clerk} #{end_book.recevice_code} #{end_book.id} #{10*n}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
3016:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
3017:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
3018:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook29 #{clerk} #{end_book.recevice_code} #{end_book.id} #{10*n}&quot;</span>
3019:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;#{@case.case_code}案，已于#{end_book.decideDate}结案,结案已经#{10 * n}天,请助理#{User.find_by_code(@case.clerk).name}提交案卷.&quot;</span>
3020:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
3021:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
3022:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">clerk</span>
3023:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
3024:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
3025:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
3026:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
3027:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
3028:             <span class="ruby-keyword kw">end</span>
3029:             
3030:             <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
3031:             <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
3032:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook29 #{ud.user_code} #{end_book.recevice_code} #{end_book.id} #{10*n}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
3033:                 <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
3034:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
3035:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook29 #{ud.user_code} #{end_book.recevice_code} #{end_book.id} #{10*n}&quot;</span>
3036:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;#{@case.case_code}案，已于#{end_book.decideDate}结案,结案已经#{10 * n}天,请助理#{User.find_by_code(@case.clerk).name}提交案卷.&quot;</span>
3037:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
3038:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
3039:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
3040:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
3041:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
3042:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
3043:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
3044:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
3045:               <span class="ruby-keyword kw">end</span>
3046:             <span class="ruby-keyword kw">end</span>
3047:             
3048:           <span class="ruby-keyword kw">end</span>
3049:           
3050:         <span class="ruby-keyword kw">end</span>
3051:         <span class="ruby-identifier">n</span>= <span class="ruby-identifier">n</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
3052:       <span class="ruby-keyword kw">end</span>
3053:     <span class="ruby-keyword kw">end</span>
3054:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000103" class="method-detail">
        <a name="M000103"></a>

        <div class="method-heading">
          <a href="#M000103" class="method-signature">
          <span class="method-name">t_3</span><span class="method-args">(et_before,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
仲裁庭回避申请相关提醒： 1
在仲裁庭回避里面输入收到回避申请的日期。
——系统进行判断,如果5天后没有输入起草回避决定草稿的时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。
2 输入起草回避决定草稿的时间。
——系统进行判断,如果2天后没有输入C中的草稿完成时间,则提醒。提醒后1个工作日仍未完成的,提醒到处长处。
3 输入回避决定草稿完成时间。
——系统进行判断,如果5天后没有输入D中的回避决定报总会时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。
4 输入回避决定报总会时间。 ——提醒程序结束。
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000103-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000103-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task_a.rb, line 469</span>
469:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_3</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
470:     <span class="ruby-comment cmt"># 1 仲裁庭回避申请日期距现在5个工作日</span>
471:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
472:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
473:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
474:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
475:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
476:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and remind=1 and  requestdate&gt;='#{wwdd}' and  requestdate&lt;'#{wwdd2}' and senddate is NULL&quot;</span>)
477:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
478:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
479:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
480:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
481:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
482:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
483:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
484:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 1&quot;</span>
485:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒仲裁员回避申请转交给对方当事人和仲裁庭,【仲裁员回避记录】中录入【转交给对方当事人和仲裁庭时间】。&quot;</span>
486:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
487:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
488:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
489:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
490:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
491:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
492:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
493:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
494:               <span class="ruby-keyword kw">end</span>
495:             <span class="ruby-keyword kw">end</span>
496:           <span class="ruby-keyword kw">end</span>
497:         <span class="ruby-keyword kw">end</span>
498:       <span class="ruby-keyword kw">end</span>
499:     <span class="ruby-keyword kw">end</span>
500:     <span class="ruby-comment cmt">#在仲裁员回避里面输入收到回避申请的日期。系统进行判断,如果5个工作日后没有输入起草回避决定草稿的时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。</span>
501:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
502:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">5</span>)
503:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
504:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">4</span>)
505:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
506:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and remind=1  and requestdate&gt;='#{wwdd}'  and requestdate&lt;'#{wwdd2}' and draftingdate is NULL&quot;</span>)
507:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
508:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
509:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
510:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
511:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
512:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 2&quot;</span>
513:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒起草仲裁员回避决定草稿,【仲裁员回避中】输入【起草回避决定草稿时间】。&quot;</span>
514:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
515:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
516:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
517:             <span class="ruby-keyword kw">else</span>
518:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
519:             <span class="ruby-keyword kw">end</span>
520:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
521:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
522:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
523:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
524:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
525:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
526:             <span class="ruby-keyword kw">end</span>
527:           <span class="ruby-keyword kw">end</span>
528:         <span class="ruby-keyword kw">end</span>
529:       <span class="ruby-keyword kw">end</span>
530:     <span class="ruby-keyword kw">end</span>
531:     <span class="ruby-comment cmt">#5+2=7</span>
532:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
533:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">7</span>)
534:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
535:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">6</span>)
536:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
537:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y'  and remind=1 and requestdate&gt;='#{wwdd}' and requestdate&lt;'#{wwdd2}' and draftingdate is NULL&quot;</span>)
538:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
539:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
540:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
541:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
542:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 3&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
543:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
544:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
545:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 3&quot;</span>
546:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒起草仲裁员回避决定草稿,【仲裁员回避记录】中录入【起草回避决定草稿时间】。&quot;</span>
547:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
548:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
549:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
550:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
551:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
552:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
553:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
554:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
555:               <span class="ruby-keyword kw">end</span>
556:             <span class="ruby-keyword kw">end</span>
557:           <span class="ruby-keyword kw">end</span>
558:         <span class="ruby-keyword kw">end</span>
559:       <span class="ruby-keyword kw">end</span>
560:     <span class="ruby-keyword kw">end</span>
561:     <span class="ruby-comment cmt">#输入起草回避决定草稿的时间。系统进行判断,如果2个工作后没有输入回避决定草稿完成时间中的草稿完成时间,则提醒助理。提醒后1个工作日仍未完成的,提醒到处长处。</span>
562:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
563:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
564:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
565:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
566:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
567:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and remind=1  and draftingdate&gt;='#{wwdd}' and draftingdate&lt;'#{wwdd2}' and drafteddate is NULL&quot;</span>)
568:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
569:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
570:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 4&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
571:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
572:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
573:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 4&quot;</span>
574:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒完成仲裁员回避决定草稿,【仲裁员回避记录】中录入【完成回避决定草稿时间】。&quot;</span>
575:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
576:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
577:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
578:             <span class="ruby-keyword kw">else</span>
579:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
580:             <span class="ruby-keyword kw">end</span>
581:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
582:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
583:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
584:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
585:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
586:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
587:             <span class="ruby-keyword kw">end</span>
588:           <span class="ruby-keyword kw">end</span>
589:         <span class="ruby-keyword kw">end</span>
590:       <span class="ruby-keyword kw">end</span>
591:     <span class="ruby-keyword kw">end</span>
592:     <span class="ruby-comment cmt">#2+1=3</span>
593:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
594:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">3</span>)
595:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
596:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
597:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
598:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and remind=1  and draftingdate&gt;='#{wwdd}'  and draftingdate&lt;'#{wwdd2}' and drafteddate is NULL&quot;</span>)
599:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
600:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
601:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
602:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
603:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 5&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
604:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
605:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
606:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 5&quot;</span>
607:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒【仲裁员回避记录】中录入【完成回避决定草稿】。&quot;</span>
608:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
609:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
610:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
611:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
612:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
613:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
614:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
615:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
616:               <span class="ruby-keyword kw">end</span>
617:             <span class="ruby-keyword kw">end</span>
618:           <span class="ruby-keyword kw">end</span>
619:         <span class="ruby-keyword kw">end</span>
620:       <span class="ruby-keyword kw">end</span>
621:     <span class="ruby-keyword kw">end</span>
622:     <span class="ruby-comment cmt">#输入回避决定草稿完成时间。系统进行判断,如果5个工作后没有输入回避决定报总会时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。</span>
623: <span class="ruby-comment cmt">#    if et_now.slice(0,10)&gt;et_before.slice(0,10)</span>
624: <span class="ruby-comment cmt">#      wd=Workday.find(:all,:conditions=&gt;&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;,:order=&gt;&quot;date desc&quot;,:limit=&gt;5)</span>
625: <span class="ruby-comment cmt">#      wwdd=PubTool.new.get_last_record(wd).date</span>
626: <span class="ruby-comment cmt">#      wd2=Workday.find(:all,:conditions=&gt;&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;,:order=&gt;&quot;date desc&quot;,:limit=&gt;4)</span>
627: <span class="ruby-comment cmt">#      wwdd2=PubTool.new.get_last_record(wd2).date</span>
628: <span class="ruby-comment cmt">#      @te=TbEvite.find(:all,:conditions=&gt;&quot;used='Y' and remind=1  and drafteddate&gt;='#{wwdd}' and drafteddate&lt;'#{wwdd2}' and  reporteddate is NULL&quot;)</span>
629: <span class="ruby-comment cmt">#      if @te!=nil</span>
630: <span class="ruby-comment cmt">#        for c in @te</span>
631: <span class="ruby-comment cmt">#          if Remind.find_by_reason_id(&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 6&quot;)==nil</span>
632: <span class="ruby-comment cmt">#            @remin=Remind.new</span>
633: <span class="ruby-comment cmt">#            @remin.used='Y'</span>
634: <span class="ruby-comment cmt">#            @remin.reason_id=&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_evites-#{c.id} 6&quot;</span>
635: <span class="ruby-comment cmt">#            @remin.contents=&quot;立案号:#{c.case_code},提醒仲裁员回避决定上报总会,【仲裁员回避记录】中录入【回避决定上报总会时间】。&quot;</span>
636: <span class="ruby-comment cmt">#            @remin.dt1=Date.today</span>
637: <span class="ruby-comment cmt">#            if TbCase.find_by_recevice_code(c.recevice_code).clerk!=''</span>
638: <span class="ruby-comment cmt">#              @remin.uu=TbCase.find_by_recevice_code(c.recevice_code).clerk</span>
639: <span class="ruby-comment cmt">#            else</span>
640: <span class="ruby-comment cmt">#              @remin.uu=TbCase.find_by_recevice_code(c.recevice_code).clerk_2</span>
641: <span class="ruby-comment cmt">#            end</span>
642: <span class="ruby-comment cmt">#            @remin.state=1</span>
643: <span class="ruby-comment cmt">#            @remin.typ='0001'</span>
644: <span class="ruby-comment cmt">#            @remin.u='system'</span>
645: <span class="ruby-comment cmt">#            @remin.u_t=Time.now</span>
646: <span class="ruby-comment cmt">#            if TbCase.find_by_recevice_code(c.recevice_code).state&lt;200  and TbCase.find_by_recevice_code(c.recevice_code).stoped==0</span>
647: <span class="ruby-comment cmt">#              @remin.save</span>
648: <span class="ruby-comment cmt">#            end</span>
649: <span class="ruby-comment cmt">#          end</span>
650: <span class="ruby-comment cmt">#        end</span>
651: <span class="ruby-comment cmt">#      end</span>
652: <span class="ruby-comment cmt">#    end</span>
653:     <span class="ruby-comment cmt">#5+2=7</span>
654: <span class="ruby-comment cmt">#    if et_now.slice(0,10)&gt;et_before.slice(0,10)</span>
655: <span class="ruby-comment cmt">#      wd=Workday.find(:all,:conditions=&gt;&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;,:order=&gt;&quot;date desc&quot;,:limit=&gt;7)</span>
656: <span class="ruby-comment cmt">#      wwdd=PubTool.new.get_last_record(wd).date</span>
657: <span class="ruby-comment cmt">#      wd2=Workday.find(:all,:conditions=&gt;&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;,:order=&gt;&quot;date desc&quot;,:limit=&gt;6)</span>
658: <span class="ruby-comment cmt">#      wwdd2=PubTool.new.get_last_record(wd2).date</span>
659: <span class="ruby-comment cmt">#      @te=TbEvite.find(:all,:conditions=&gt;&quot;used='Y' and remind=1  and drafteddate&gt;='#{wwdd}' and drafteddate&lt;'#{wwdd2}' and reporteddate is NULL&quot;)</span>
660: <span class="ruby-comment cmt">#      if @te!=nil</span>
661: <span class="ruby-comment cmt">#        @ud=UserDuty.find(:all,:conditions=&gt;&quot;duty_code='0001'&quot;,:select=&gt;&quot;distinct user_code as user_code&quot;,:order=&gt;&quot;user_code&quot;)</span>
662: <span class="ruby-comment cmt">#        for c in @te</span>
663: <span class="ruby-comment cmt">#          for ud in @ud</span>
664: <span class="ruby-comment cmt">#            if Remind.find_by_reason_id(&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 7&quot;)==nil</span>
665: <span class="ruby-comment cmt">#              @remin=Remind.new</span>
666: <span class="ruby-comment cmt">#              @remin.used='Y'</span>
667: <span class="ruby-comment cmt">#              @remin.reason_id=&quot;#{c.recevice_code} #{ud.user_code} tb_evites-#{c.id} 7&quot;</span>
668: <span class="ruby-comment cmt">#              @remin.contents=&quot;立案号:#{c.case_code},提醒仲裁员回避决定上报总会,【仲裁员回避记录】中录入【回避决定上报总会】。&quot;</span>
669: <span class="ruby-comment cmt">#              @remin.dt1=Date.today</span>
670: <span class="ruby-comment cmt">#              @remin.uu=ud.user_code</span>
671: <span class="ruby-comment cmt">#              @remin.state=1</span>
672: <span class="ruby-comment cmt">#              @remin.typ='0001'</span>
673: <span class="ruby-comment cmt">#              @remin.u='system'</span>
674: <span class="ruby-comment cmt">#              @remin.u_t=Time.now</span>
675: <span class="ruby-comment cmt">#              if TbCase.find_by_recevice_code(c.recevice_code).state&lt;200  and TbCase.find_by_recevice_code(c.recevice_code).stoped==0</span>
676: <span class="ruby-comment cmt">#                @remin.save</span>
677: <span class="ruby-comment cmt">#              end</span>
678: <span class="ruby-comment cmt">#            end</span>
679: <span class="ruby-comment cmt">#          end</span>
680: <span class="ruby-comment cmt">#        end</span>
681: <span class="ruby-comment cmt">#      end</span>
682: <span class="ruby-comment cmt">#    end</span>
683:     <span class="ruby-comment cmt">#输入回避决定报总会时间。提醒程序结束。</span>
684: <span class="ruby-comment cmt">#    if et_now.slice(0,10)&gt;et_before.slice(0,10)</span>
685: <span class="ruby-comment cmt">#      @te=TbEvite.find(:all,:conditions=&gt;&quot;used='Y' and reporteddate&gt;='#{et_before.slice(0,10)}' and reporteddate&lt;'#{et_now.slice(0,10)}'&quot;)</span>
686: <span class="ruby-comment cmt">#      if @te!=nil</span>
687: <span class="ruby-comment cmt">#        for c in @te</span>
688: <span class="ruby-comment cmt">#          Remind.update_all(&quot;used='N'&quot;,&quot;reason_id like '#{c.recevice_code}%tb_evites-#{c.id}%'&quot;)</span>
689: <span class="ruby-comment cmt">#        end</span>
690: <span class="ruby-comment cmt">#      end</span>
691: <span class="ruby-comment cmt">#    end</span>
692:     <span class="ruby-comment cmt">#不提醒。提醒程序结束。</span>
693:     <span class="ruby-ivar">@tc</span>=<span class="ruby-constant">TbEvite</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and  remind=2 and remind_t&gt;='#{et_before}' and remind_t&lt;'#{et_now}'&quot;</span>)
694:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tc</span>
695:       <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;reason_id like '#{c.recevice_code}%tb_evites-#{c.id}%'&quot;</span>)
696:     <span class="ruby-keyword kw">end</span>
697: <span class="ruby-comment cmt">#    #不提醒。提醒程序结束。</span>
698: <span class="ruby-comment cmt">#    @tc=TbEvite.find(:all,:conditions=&gt;&quot;used='N' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;)</span>
699: <span class="ruby-comment cmt">#    for c in @tc</span>
700: <span class="ruby-comment cmt">#      Remind.update_all(&quot;used='N'&quot;,&quot;reason_id like '#{c.recevice_code}%tb_evites-#{c.id}%'&quot;)</span>
701: <span class="ruby-comment cmt">#    end</span>
702:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000132" class="method-detail">
        <a name="M000132"></a>

        <div class="method-heading">
          <a href="#M000132" class="method-signature">
          <span class="method-name">t_30</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000132-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000132-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 3056</span>
3056:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_30</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
3057:     <span class="ruby-comment cmt">### 30:对咨询案件，在创建咨询案件2天后，发出提醒给咨询案件的接待助理.</span>
3058:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
3059:       <span class="ruby-identifier">limit_date_1</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">2</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
3060:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state=1 and receivedate='#{limit_date_1}'&quot;</span>)
3061:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@case</span>
3062:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk_2!</span>=<span class="ruby-value str">&quot;&quot;</span>
3063:           <span class="ruby-identifier">clerk</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk_2</span>
3064:         <span class="ruby-keyword kw">else</span>
3065:           <span class="ruby-identifier">clerk</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
3066:         <span class="ruby-keyword kw">end</span>
3067:         <span class="ruby-identifier">party</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find_by_recevice_code_and_used_and_partytype</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">&quot;Y&quot;</span>,<span class="ruby-value">1</span>)
3068:         <span class="ruby-identifier">r</span> = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;case30 #{clerk} #{c.recevice_code} #{c.id}&quot;</span>)
3069:         <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">r</span>
3070:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
3071:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
3072:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;case30 #{clerk} #{c.recevice_code} #{c.id}&quot;</span>
3073:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;申请人：#{party.partyname if party}案，请确认已经向申请人发出受理通知。咨询接待助理：#{User.find_by_code(clerk).name}.&quot;</span>
3074:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
3075:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
3076:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">clerk</span>
3077:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
3078:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
3079:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
3080:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
3081:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
3082:         <span class="ruby-keyword kw">end</span>
3083:       <span class="ruby-keyword kw">end</span>
3084:     <span class="ruby-keyword kw">end</span>
3085:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000133" class="method-detail">
        <a name="M000133"></a>

        <div class="method-heading">
          <a href="#M000133" class="method-signature">
          <span class="method-name">t_31</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000133-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000133-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 3087</span>
3087:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_31</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
3088:     <span class="ruby-comment cmt">### 31:提醒增加：“XXX案，已于yyyy-mm-dd结案，结案已经XX天,请助理XXX提交材料报秘书处长核发仲裁员报酬。”同时提醒给助理和处长。检查设置：与2）的条件相同，即：2013-11-1之后结案（包括撤案）的、存在仲裁员的、结案后10天没有“处长确认日期”的案件，进行提醒。之后每5个工作日检查提醒一次，直到条件消失。</span>
3089:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
3090:       <span class="ruby-ivar">@end_book</span>=<span class="ruby-constant">TbCaseendbook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;decideDate&gt;'2013-11-01' and used='Y' and recevice_code in (select recevice_code from tb_cases where remun_state='N' and state&gt;=4) and mod(datediff('#{et_now}',decideDate),5)=0&quot;</span>)
3091:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">end_book</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@end_book</span>
3092:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCasearbitman</span>.<span class="ruby-identifier">find_by_recevice_code_and_used</span>(<span class="ruby-identifier">end_book</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'Y'</span>)
3093:           <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">end_book</span>.<span class="ruby-identifier">recevice_code</span>)
3094:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">&quot;&quot;</span>
3095:             <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
3096:           <span class="ruby-keyword kw">else</span>
3097:             <span class="ruby-identifier">clerk</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>
3098:           <span class="ruby-keyword kw">end</span>
3099:           <span class="ruby-identifier">ttt</span>= <span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">to_date</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">end_book</span>.<span class="ruby-identifier">decideDate</span>
3100:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook31 #{clerk} #{end_book.recevice_code} #{end_book.id} #{ttt}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
3101:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
3102:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
3103:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook31 #{clerk} #{end_book.recevice_code} #{end_book.id} #{ttt}&quot;</span>
3104:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;#{@case.case_code}案，已#{end_book.decideDate.to_s(:db)}于结案，结案已经#{ttt}天,请助理#{User.find_by_code(@case.clerk).name}提交材料报秘书处长核发仲裁员报酬。&quot;</span>
3105:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
3106:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
3107:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">clerk</span>
3108:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
3109:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
3110:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
3111:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
3112:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
3113:           <span class="ruby-keyword kw">end</span>
3114: 
3115:           <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
3116:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
3117:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;caseendbook31 #{ud.user_code} #{end_book.recevice_code} #{end_book.id} #{ttt}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
3118:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
3119:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
3120:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;caseendbook31 #{ud.user_code} #{end_book.recevice_code} #{end_book.id} #{ttt}&quot;</span>
3121:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;#{@case.case_code}案，已#{end_book.decideDate.to_s(:db)}于结案，结案已经#{ttt}天,请助理#{User.find_by_code(@case.clerk).name}提交材料报秘书处长核发仲裁员报酬。&quot;</span>
3122:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-value str">&quot;&quot;</span>
3123:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
3124:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
3125:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
3126:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
3127:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
3128:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
3129:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
3130:             <span class="ruby-keyword kw">end</span>
3131:           <span class="ruby-keyword kw">end</span>
3132:         <span class="ruby-keyword kw">end</span>
3133:       <span class="ruby-keyword kw">end</span>
3134:     <span class="ruby-keyword kw">end</span>
3135:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000104" class="method-detail">
        <a name="M000104"></a>

        <div class="method-heading">
          <a href="#M000104" class="method-signature">
          <span class="method-name">t_4</span><span class="method-args">(et_before,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
管辖权异议相关的提醒 1
在管辖权异议界面输入收到管辖权异议申请的日期。
——系统进行判断,如果5天后没有输入B中的起草管辖权决定草稿的时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。
2 输入起草管辖权决定草稿的时间。
——系统进行判断,如果2天后没有输入C中的草稿完成时间,则提醒。提醒后1个工作日仍未完成的,提醒到处长处。
3 输入管辖权决定草稿完成时间。
——系统进行判断,如果5天后没有输入D中的管辖权决定报总会时间,则提醒。提醒后2个工作日仍未完成的,提醒到处长处。
4 输入回避决定报总会时间。 ——提醒程序结束。
</p>
<p>
在管辖权异议申请界面可以设置取消提醒功能,要求输入原因才能取消提醒并记录。request_date
比如有些案子是当时就可以确定有管辖权的,在收到申请以后就答复当事人了,不需要进行下面的流程。
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000104-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000104-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task_a.rb, line 716</span>
716:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_4</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
717:     <span class="ruby-identifier">workday7</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">7</span>) <span class="ruby-comment cmt"># 今天前的第7个工作日</span>
718:     <span class="ruby-identifier">workday6</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">6</span>) <span class="ruby-comment cmt"># 今天前的第6个工作日</span>
719:     <span class="ruby-identifier">workday5</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">5</span>) <span class="ruby-comment cmt"># 今天前的第5个工作日</span>
720:     <span class="ruby-identifier">workday4</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">4</span>) <span class="ruby-comment cmt"># 今天前的第4个工作日</span>
721:     <span class="ruby-identifier">workday3</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">3</span>) <span class="ruby-comment cmt"># 今天前的第3个工作日</span>
722:     <span class="ruby-identifier">workday2</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">2</span>) <span class="ruby-comment cmt"># 今天前的第2个工作日</span>
723:     <span class="ruby-identifier">workday1</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">1</span>) <span class="ruby-comment cmt"># 今天前的第1个工作日</span>
724: 
725:     <span class="ruby-identifier">do_remind</span> = <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-comment cmt"># 一天只运行一次</span>
726: 
727:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_remind</span>
728:       <span class="ruby-identifier">te_request_54</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
729:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and remind=1 and  request_date&gt;='#{workday5}' and request_date&lt; '#{workday4}' and idea_date is NULL&quot;</span>
730:       ) <span class="ruby-comment cmt"># 管辖权异议申请日期据现在 5 个工作日，此时还 未录入草稿起草日期（还未开始起草）</span>
731:       
732: 
733:       <span class="ruby-identifier">te_request_76</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
734:         <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and remind=1 and  request_date&gt;='#{workday7}' and  request_date&lt;'#{workday6}' and idea_date is NULL&quot;</span>
735:       ) <span class="ruby-comment cmt"># 管辖权异议申请日期据现在 7 个工作日，此时还 未录入草稿起草日期（还未开始起草）</span>
736: 
737:       <span class="ruby-identifier">te_idea_21</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(
738:         <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and remind=1 and  idea_date&gt;='#{workday2}' and  idea_date&lt;'#{workday1}' and check_date is NULL&quot;</span>
739:       ) <span class="ruby-comment cmt">#起草草稿日期据现在 2个工作日， 此时还未录入草稿完成时间</span>
740: 
741:       <span class="ruby-identifier">te_idea_32</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(
742:         <span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and remind=1 and  idea_date&gt;='#{workday3}' and  idea_date&lt;'#{workday2}' and check_date is NULL&quot;</span>
743:       ) <span class="ruby-comment cmt">#  起草草稿日期据现在3个工作日 ， 此时还未录入草稿完成时间</span>
744: 
745: <span class="ruby-comment cmt">#      te_check_54 = TbJurisdiction.find(:all,</span>
746: <span class="ruby-comment cmt">#        :conditions =&gt; &quot;used='Y' and remind=1 and  check_date&gt;='#{workday5}' and  check_date&lt;'#{workday4}' and draft_date is NULL&quot;</span>
747: <span class="ruby-comment cmt">#      ) #  草稿完成时间据现在 5个工作日，此时还未录入草稿报总会日期</span>
748: 
749: <span class="ruby-comment cmt">#      te_check_76 = TbJurisdiction.find(:all,</span>
750: <span class="ruby-comment cmt">#        :conditions =&gt; &quot;used='Y' and remind=1 and  check_date&gt;='#{workday7}' and  check_date&lt;'#{workday6}' and draft_date is NULL&quot;</span>
751: <span class="ruby-comment cmt">#      ) # 草稿完成时间据现在 7个工作日，此时还未录入草稿报总会日期</span>
752: 
753:       <span class="ruby-comment cmt">#具有处长职务的用户</span>
754:       <span class="ruby-identifier">user_duty</span> = <span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;duty_code='0001'&quot;</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;distinct user_code&quot;</span>,<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;user_code&quot;</span>)
755:       <span class="ruby-comment cmt">#15个工作日之后没输入决定完成时间的要提醒到助理和处长，之后每5个工作日提醒一次，提醒20次。</span>
756:       (<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-value">20</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">n</span><span class="ruby-operator">|</span>
757:         <span class="ruby-identifier">w_start</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">15</span> <span class="ruby-operator">+</span> <span class="ruby-value">5</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">n</span>)
758:         <span class="ruby-identifier">w_end</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">15</span> <span class="ruby-operator">+</span> <span class="ruby-value">5</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">n</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>)
759:         <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and remind=1 and  request_date&gt;='#{w_start}' and request_date&lt; '#{w_end}' and decide_date is NULL&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
760:           <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk,clerk_2'</span>)
761:           <span class="ruby-identifier">current_party</span>=<span class="ruby-value str">&quot;&quot;</span>
762:           <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{c.recevice_code}' and partytype=1 and used='Y'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,partyname&quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>
763:             <span class="ruby-identifier">current_party</span> = <span class="ruby-identifier">current_party</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span>
764:           }
765: 
766:           <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{current_case.clerk} tb_jurisdictions-#{c.id} #{w_start}&quot;</span>
767:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
768:             <span class="ruby-identifier">remin</span>= <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
769:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
770:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
771:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;#{c.case_code}号案，助理：#{User.find_by_code(current_case.clerk).name}，申请人：#{current_party}，请填写管辖权决定作出日期。&quot;</span>
772:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
773:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk</span>
774:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
775:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
776:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
777:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
778:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
779:           <span class="ruby-keyword kw">end</span>
780:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">user_duty</span>
781:            <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_jurisdictions-#{c.id} #{w_start}&quot;</span>
782:            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
783:              <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
784:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
785:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
786:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;#{c.case_code}号案，助理：#{User.find_by_code(current_case.clerk).name}，申请人：#{current_party}，请填写管辖权决定作出日期。&quot;</span>
787:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
788:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
789:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
790:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
791:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
792:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
793:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
794:            <span class="ruby-keyword kw">end</span>
795:          <span class="ruby-keyword kw">end</span>
796:         }
797:       }
798: 
799:       <span class="ruby-comment cmt">#记录录入当天提醒到处长</span>
800:       <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and u_t&gt;='#{et_before.slice(0,10)} 00:00:00' and used='Y' and remind=1 &quot;</span>).<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
801:          <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk,clerk_2'</span>)
802:          <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">user_duty</span>
803:            <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_jurisdictions-#{c.id} 100&quot;</span>
804:            <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
805:              <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
806:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
807:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
808:              <span class="ruby-identifier">request_date_ary</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">request_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>).<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;-&quot;</span>)
809:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;#{c.case_code}号案，助理：#{User.find_by_code(current_case.clerk).name}，今天录入管辖权异议，管辖权异议提出日期：#{request_date_ary[0]}年#{request_date_ary[1]}月#{request_date_ary[2]}日。&quot;</span>
810:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
811:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
812:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
813:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
814:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
815:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
816:              <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
817:            <span class="ruby-keyword kw">end</span>
818:          <span class="ruby-keyword kw">end</span>
819:       }
820: 
821:       <span class="ruby-comment cmt">#管辖权异议申请日期据现在5个工作日，但任然没有输入起草管辖权决定草稿的时间,则提醒给助理。</span>
822:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te_request_54</span>
823:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk,clerk_2'</span>)
824:         <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{current_case.clerk} tb_jurisdictions-#{c.id} 1&quot;</span>
825:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
826:           <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
827:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
828:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
829:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号:#{c.case_code},提醒起草管辖权决定草稿,【管辖权异议申请】中输入【起草草稿的时间】。&quot;</span>
830:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
831:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk_2</span> <span class="ruby-comment cmt">#提醒给助理，如果没有助理，提醒给该案件的咨询助理。</span>
832:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span> <span class="ruby-comment cmt">#状态：未确认</span>
833:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span> <span class="ruby-comment cmt">#提醒类型：普通提醒</span>
834:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span> <span class="ruby-comment cmt">#操作人：系统</span>
835:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
836:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
837:         <span class="ruby-keyword kw">end</span>
838:       <span class="ruby-keyword kw">end</span>
839: 
840:       <span class="ruby-comment cmt"># 提醒后2个工作日仍未录入草稿起草日期的,提醒给处长</span>
841:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te_request_76</span>
842:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk'</span>)
843:         <span class="ruby-comment cmt"># 如果案件已经终止或者已经被存档，则不进行提醒。</span>
844:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
845:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">user_duty</span>
846:             <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_jurisdictions-#{c.id} 2&quot;</span>
847:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
848:               <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
849:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
850:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
851:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号:#{c.case_code},提醒起草管辖权决定草稿,【管辖权异议申请】中输入【起草草稿的时间】。办案助理:#{User.find_by_code(current_case.clerk).name}&quot;</span>
852:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
853:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
854:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
855:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
856:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
857:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
858:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
859:             <span class="ruby-keyword kw">end</span>
860:           <span class="ruby-keyword kw">end</span>
861:         <span class="ruby-keyword kw">end</span>
862:       <span class="ruby-keyword kw">end</span>
863: 
864:       <span class="ruby-comment cmt">#输入起草草稿的时间。如果2个工作日后没有 录入草稿完成时间,则提醒给助理。</span>
865:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te_idea_21</span>
866:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk,clerk_2'</span>)
867:         <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{current_case.clerk} tb_jurisdictions-#{c.id} 3&quot;</span>
868:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
869:           <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
870:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
871:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
872:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号:#{c.case_code},提醒完成管辖权决定草稿,【管辖权异议申请】中输入【草稿完成时间】。办案助理:#{User.find_by_code(current_case.clerk).name}&quot;</span>
873:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
874:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk_2</span>
875:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
876:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
877:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
878:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
879:           <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
880:         <span class="ruby-keyword kw">end</span>
881:       <span class="ruby-keyword kw">end</span>
882: 
883:       <span class="ruby-comment cmt">#提醒后1个工作日仍未录入草稿完成时间的,提醒给处长</span>
884:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te_idea_32</span>
885:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'state,stoped,clerk'</span>)
886:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
887:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">user_duty</span>
888:             <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_jurisdictions-#{c.id} 4&quot;</span>
889:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
890:               <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
891:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      =<span class="ruby-value str">'Y'</span>
892:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
893:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号:#{c.case_code},提醒完成管辖权决定草稿,【管辖权异议申请】中输入【草稿完成时间】。办案助理:#{User.find_by_code(current_case.clerk).name}&quot;</span>
894:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
895:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
896:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
897:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
898:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
899:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
900:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
901:             <span class="ruby-keyword kw">end</span>
902:           <span class="ruby-keyword kw">end</span>
903:         <span class="ruby-keyword kw">end</span>
904:       <span class="ruby-keyword kw">end</span>
905: 
906:       <span class="ruby-comment cmt">#草稿完成时间距现在5个工作日，任然没有输入报总会时间,则提醒助理。</span>
907: <span class="ruby-comment cmt">#      for c in te_check_54</span>
908: <span class="ruby-comment cmt">#        current_case = TbCase.find_by_recevice_code(c.recevice_code, :select =&gt; 'state,stoped,clerk,clerk2')</span>
909: <span class="ruby-comment cmt">#        reason_id = &quot;#{c.recevice_code} #{current_case.clerk} tb_jurisdictions-#{c.id} 5&quot;</span>
910: <span class="ruby-comment cmt">#        if current_case.state &lt; 200  and current_case.stoped == 0 and Remind.find_by_reason_id(reason_id) == nil</span>
911: <span class="ruby-comment cmt">#          remin           = Remind.new</span>
912: <span class="ruby-comment cmt">#          remin.used      = 'Y'</span>
913: <span class="ruby-comment cmt">#          remin.reason_id = reason_id</span>
914: <span class="ruby-comment cmt">#          remin.contents  = &quot;立案号:#{c.case_code},提醒管辖权异议草稿报总会,【管辖权异议申请】中输入【草稿报总会日期】。&quot;</span>
915: <span class="ruby-comment cmt">#          remin.dte1      = Date.today</span>
916: <span class="ruby-comment cmt">#          remin.uu        = current_case.clerk || current_case.clerk_2</span>
917: <span class="ruby-comment cmt">#          remin.state     = 1</span>
918: <span class="ruby-comment cmt">#          remin.typ       = '0001'</span>
919: <span class="ruby-comment cmt">#          remin.u         = 'system'</span>
920: <span class="ruby-comment cmt">#          remin.u_t       = Time.now</span>
921: <span class="ruby-comment cmt">#          remin.save</span>
922: <span class="ruby-comment cmt">#        end</span>
923: <span class="ruby-comment cmt">#      end</span>
924: 
925:       <span class="ruby-comment cmt">#提醒后2个工作日，任然没有输入报总会时间,则提醒给处长。</span>
926: <span class="ruby-comment cmt">#      for c in te_check_76</span>
927: <span class="ruby-comment cmt">#        current_case = TbCase.find_by_recevice_code(c.recevice_code, :select =&gt; 'state,stoped,clerk,clerk2')</span>
928: <span class="ruby-comment cmt">#        for ud in user_duty</span>
929: <span class="ruby-comment cmt">#          reason_id = &quot;#{c.recevice_code} #{ud.user_code} tb_jurisdictions-#{c.id} 6&quot;</span>
930: <span class="ruby-comment cmt">#          if current_case.state &lt; 200  and current_case.stoped == 0 and Remind.find_by_reason_id(reason_id) == nil</span>
931: <span class="ruby-comment cmt">#            remin           = Remind.new</span>
932: <span class="ruby-comment cmt">#            remin.used      = 'Y'</span>
933: <span class="ruby-comment cmt">#            remin.reason_id = reason_id</span>
934: <span class="ruby-comment cmt">#            remin.contents  = &quot;立案号:#{c.case_code},提醒管辖权异议草稿报总会,【管辖权异议申请】中输入【草稿报总会日期】。办案助理:#{User.find_by_code(current_case.clerk).name}&quot;</span>
935: <span class="ruby-comment cmt">#            remin.dt1       = Date.today</span>
936: <span class="ruby-comment cmt">#            remin.uu        = ud.user_code</span>
937: <span class="ruby-comment cmt">#            remin.state     = 1</span>
938: <span class="ruby-comment cmt">#            remin.typ       = '0001'</span>
939: <span class="ruby-comment cmt">#            remin.u         = 'system'</span>
940: <span class="ruby-comment cmt">#            remin.u_t       = Time.now</span>
941: <span class="ruby-comment cmt">#            remin.save</span>
942: <span class="ruby-comment cmt">#          end</span>
943: <span class="ruby-comment cmt">#        end</span>
944: <span class="ruby-comment cmt">#      end</span>
945: 
946:       <span class="ruby-comment cmt">#输入回避决定报总会时间。提醒程序结束。</span>
947: <span class="ruby-comment cmt">#      @te = TbJurisdiction.find(:all, :conditions =&gt; &quot;used='Y' and draft_date&gt;='#{et_before.slice(0,10)}' and draft_date&lt;'#{et_now.slice(0,10)}'&quot;)</span>
948: <span class="ruby-comment cmt">#      for c in @te</span>
949: <span class="ruby-comment cmt">#        #Remind.update_all(&quot;used='N'&quot;,&quot;reason_id like '#{c.recevice_code}%tb_jurisdictions-#{c.id}%'&quot;)</span>
950: <span class="ruby-comment cmt">#      end</span>
951:     <span class="ruby-keyword kw">end</span>
952: 
953:     <span class="ruby-comment cmt">#对于状态为不提醒的，变更为提醒程序结束，used='N' 。</span>
954:     <span class="ruby-identifier">tc</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='Y' and  remind=2 and remind_t&gt;='#{et_before}' and remind_t&lt;'#{et_now}'&quot;</span>)
955:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">tc</span>
956:       <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;reason_id like '#{c.recevice_code}%tb_jurisdictions-#{c.id}%'&quot;</span>)
957:     <span class="ruby-keyword kw">end</span>
958: 
959:     <span class="ruby-comment cmt">#不提醒。提醒程序结束。</span>
960:     <span class="ruby-identifier">tc</span> = <span class="ruby-constant">TbJurisdiction</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;registrar&lt;&gt;'0002' and used='N' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
961:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">tc</span>
962:       <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;reason_id like '#{c.recevice_code}%tb_jurisdictions-#{c.id}%'&quot;</span>)
963:     <span class="ruby-keyword kw">end</span>
964:     <span class="ruby-comment cmt"># 一点思考：</span>
965:     <span class="ruby-comment cmt"># 这么做提醒的话，需要提醒服务每天都运行，这样才不会漏掉，</span>
966:     <span class="ruby-comment cmt">#否则如果一个案件录入的异议申请日期是8个工作日之前的，那么就不会进行任何提醒了！！</span>
967:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000105" class="method-detail">
        <a name="M000105"></a>

        <div class="method-heading">
          <a href="#M000105" class="method-signature">
          <span class="method-name">t_5</span><span class="method-args">(et_before,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
开庭相关提醒
说明：助理应在组庭后3个工作日内与仲裁庭联系商定开庭日期,并在开庭日期确定后1个工作日内发出开庭通知,3工作日后仍未确定开庭日期的,提醒到处长处。
检查案件,组庭日期后3日内是否有开庭记录,如果没有开庭记录则要提醒到处长。开庭日期确定后1个工作日是发开庭通知的时间,要提醒助理。
组庭日期后3日内是否有开庭记录,如果没有开庭记录则要提醒到处长
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000105-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000105-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 973</span>
 973:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_5</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 974:     <span class="ruby-identifier">workday3</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">3</span>) <span class="ruby-comment cmt"># 今天前的第3个工作日</span>
 975:     <span class="ruby-identifier">workday2</span> = <span class="ruby-constant">Workday</span>.<span class="ruby-identifier">before_day</span>(<span class="ruby-value">2</span>) <span class="ruby-comment cmt"># 今天前的第2个工作日</span>
 976:     <span class="ruby-identifier">do_remind</span> = <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>) <span class="ruby-comment cmt"># 一天只运行一次</span>
 977: 
 978:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_remind</span>
 979:       <span class="ruby-identifier">te</span> = <span class="ruby-constant">TbCaseorg</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and orgdate&gt;='#{workday3}' and orgdate&lt;'#{workday2}'&quot;</span>)
 980:       <span class="ruby-identifier">ud</span> = <span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;duty_code='0001'&quot;</span>, <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>, <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;user_code&quot;</span>)
 981: 
 982:       <span class="ruby-comment cmt"># 如果超过组庭日期3个工作日内没有录入开庭信息则提醒给处长。</span>
 983:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te</span>
 984:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
 985:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and recevice_code='#{c.recevice_code}'&quot;</span>).<span class="ruby-identifier">empty?</span>
 986:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">ud</span>
 987:             <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_caseorgs-#{c.id} 1&quot;</span>
 988:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
 989:               <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
 990:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
 991:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
 992:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号:#{c.case_code},提醒开庭,确定开庭日期,录入【开庭信息】。办案助理:#{User.find_by_code(current_case.clerk).name}&quot;</span>
 993:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
 994:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
 995:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
 996:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
 997:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
 998:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
 999:               <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
1000:             <span class="ruby-keyword kw">end</span>
1001:           <span class="ruby-keyword kw">end</span>
1002:         <span class="ruby-keyword kw">end</span>
1003:       <span class="ruby-keyword kw">end</span>
1004:     <span class="ruby-keyword kw">end</span>
1005:     <span class="ruby-comment cmt">#开庭日期确定后1个工作日是发开庭通知的时间,要提醒助理。</span>
1006:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">do_remind</span>
1007:       <span class="ruby-identifier">te</span> = <span class="ruby-constant">TbSitting</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and u_t&gt;='#{et_before.slice(0,10)} 00:00:01' and u_t&lt;'#{et_now.slice(0,10)} 00:00:01'&quot;</span>)
1008:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-identifier">te</span>
1009:         <span class="ruby-identifier">current_case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
1010:         <span class="ruby-identifier">flag</span> = <span class="ruby-constant">TbDoc</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,
1011:                   <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;recevice_code='#{c.recevice_code}' and (typ_code='0026' or
1012:                                   typ_code='0027' or typ_code='0030' or typ_code='0031' or
1013:                                   typ_code='0032' or typ_code='0033' or typ_code='00271' or
1014:                                   typ_code='002902' or typ_code='003102' )&quot;</span>
1015:                 ).<span class="ruby-identifier">empty?</span>
1016:         <span class="ruby-comment cmt">#or typ_code='002903' or typ_code='002904' or  typ_code='003101'  or typ_code='003103'</span>
1017:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">flag</span>
1018:           <span class="ruby-identifier">reason_id</span> = <span class="ruby-node">&quot;#{c.recevice_code} #{current_case.clerk} tb_sittings-#{c.id} 1&quot;</span>
1019:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">state</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">stoped</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-identifier">reason_id</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
1020:             <span class="ruby-identifier">remin</span>           = <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1021:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">used</span>      = <span class="ruby-value str">'Y'</span>
1022:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">reason_id</span> = <span class="ruby-identifier">reason_id</span>
1023:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">contents</span>  = <span class="ruby-node">&quot;立案号：#{c.case_code},提醒发开庭通知,【发文】中发【开庭通知】。&quot;</span>
1024:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">url</span>       = <span class="ruby-node">&quot;/case_doc/list?recevice_code=#{c.recevice_code}&quot;</span>
1025:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">dt1</span>       = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1026:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">uu</span>        = <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk_2</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">current_case</span>.<span class="ruby-identifier">clerk</span>
1027:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">state</span>     = <span class="ruby-value">1</span>
1028:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">typ</span>       = <span class="ruby-value str">'0001'</span>
1029:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u</span>         = <span class="ruby-value str">'system'</span>
1030:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">u_t</span>       = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1031:             <span class="ruby-identifier">remin</span>.<span class="ruby-identifier">save</span>
1032:           <span class="ruby-keyword kw">end</span>
1033:         <span class="ruby-keyword kw">end</span>
1034:       <span class="ruby-keyword kw">end</span>
1035:     <span class="ruby-keyword kw">end</span>
1036:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000106" class="method-detail">
        <a name="M000106"></a>

        <div class="method-heading">
          <a href="#M000106" class="method-signature">
          <span class="method-name">t_6</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000106-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000106-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1038</span>
1038:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_6</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1039:     <span class="ruby-comment cmt">### 6:决定审计、鉴定或评估的,仲裁助理在3个工作日内联系有关专业机构,如果仍未联系,则提醒到处长处。在收到有关专业机构的报价之日起10个工作日内商定仲裁庭,确定具体的专业机构和有关报价；10个工作日内仍未确定,提醒到处长处。</span>
1040:     <span class="ruby-comment cmt">#决定审计、鉴定或评估的,仲裁助理在3个工作日内联系有关专业机构,如果仍未联系,则提醒到处长处。</span>
1041:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1042:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">3</span>)
1043:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1044:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
1045:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1046:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDetection</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and arbitral_decision_t&gt;='#{wwdd}' and arbitral_decision_t&lt;'#{wwdd2}' and contact_organization_t is NULL&quot;</span>)
1047:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1048:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1049:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1050:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1051:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1052:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1053:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1054:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 1&quot;</span>
1055:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒联系检测机构,【检测信息记录】中填入【联系机构的时间】。&quot;</span>
1056:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1057:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1058:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1059:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1060:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1061:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1062:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1063:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1064:               <span class="ruby-keyword kw">end</span>
1065:             <span class="ruby-keyword kw">end</span>
1066:           <span class="ruby-keyword kw">end</span>
1067:         <span class="ruby-keyword kw">end</span>
1068:       <span class="ruby-keyword kw">end</span>
1069:     <span class="ruby-keyword kw">end</span>
1070:     <span class="ruby-comment cmt">#在收到有关专业机构的报价之日起10个工作日内商定仲裁庭,确定具体的专业机构和有关报价；10个工作日内仍未确定,提醒到处长处。</span>
1071:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1072:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">10</span>)
1073:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1074:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">9</span>)
1075:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1076:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDetection</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and organization_price_t&gt;='#{wwdd}'  and organization_price_t&lt;'#{wwdd2}' and definite_org_t is NULL&quot;</span>)
1077:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1078:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1079:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1080:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1081:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1082:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1083:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1084:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 2&quot;</span>
1085:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒确定检测机构,【检测信息记录】中填入【确定机构时间】。&quot;</span>
1086:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1087:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1088:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1089:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1090:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1091:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1092:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1093:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1094:               <span class="ruby-keyword kw">end</span>
1095:             <span class="ruby-keyword kw">end</span>
1096:           <span class="ruby-keyword kw">end</span>
1097:         <span class="ruby-keyword kw">end</span>
1098:       <span class="ruby-keyword kw">end</span>
1099:     <span class="ruby-keyword kw">end</span>
1100:     <span class="ruby-comment cmt">#专业机构和报价确定后,仲裁助理在2个工作日内将有关情况报秘书处处长审批（如果未报审批则提醒助理）。</span>
1101:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1102:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
1103:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1104:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
1105:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1106:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDetection</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and definite_org_t&gt;='#{wwdd}' and definite_org_t&lt;'#{wwdd2}' and send_pproval_t is NULL&quot;</span>)
1107:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1108:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1109:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_detections-#{c.id} 3&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1110:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1111:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1112:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_detections-#{c.id} 3&quot;</span>
1113:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒把检测有关情况报处长审批,【检测信息记录】中录入【送交审批时间】。&quot;</span>
1114:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1115:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1116:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1117:             <span class="ruby-keyword kw">else</span>
1118:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1119:             <span class="ruby-keyword kw">end</span>
1120:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1121:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1122:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1123:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1124:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1125:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1126:             <span class="ruby-keyword kw">end</span>
1127:           <span class="ruby-keyword kw">end</span>
1128:         <span class="ruby-keyword kw">end</span>
1129:       <span class="ruby-keyword kw">end</span>
1130:     <span class="ruby-keyword kw">end</span>
1131:     <span class="ruby-comment cmt">#在批准后2个工作日内将报价等事项书面通知有关当事人（如果未通知则提醒助理）。</span>
1132:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1133:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
1134:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1135:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">1</span>)
1136:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1137:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDetection</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and pproval_t&gt;='#{wwdd}' and pproval_t&lt;'#{wwdd2}'  and trans_party_t is NULL&quot;</span>)
1138:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1139:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1140:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_detections-#{c.id} 4&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1141:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1142:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1143:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_detections-#{c.id} 4&quot;</span>
1144:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒将报价等事项书面通知有关当事人,【检测信息记录】中录入【转给当事人的时间】。&quot;</span>
1145:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1146:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1147:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1148:             <span class="ruby-keyword kw">else</span>
1149:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1150:             <span class="ruby-keyword kw">end</span>
1151:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1152:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1153:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1154:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1155:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1156:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1157:             <span class="ruby-keyword kw">end</span>
1158:           <span class="ruby-keyword kw">end</span>
1159:         <span class="ruby-keyword kw">end</span>
1160:       <span class="ruby-keyword kw">end</span>
1161:     <span class="ruby-keyword kw">end</span>
1162:     <span class="ruby-comment cmt">#在收到当事人预缴的全部费用后3个工作日内,仲裁助理应办妥分会与专业机构之间签订委托协议书的事宜（是否就是签约）,3个工作日内仍未签约的,提醒到处长处。</span>
1163:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1164:       <span class="ruby-identifier">wd</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">3</span>)
1165:       <span class="ruby-identifier">wwdd</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd</span>).<span class="ruby-identifier">date</span>
1166:       <span class="ruby-identifier">wd2</span>=<span class="ruby-constant">Workday</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;isworkday=1 and date&lt;'#{et_now.slice(0,10)}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;date desc&quot;</span>,<span class="ruby-identifier">:limit=</span><span class="ruby-operator">&gt;</span><span class="ruby-value">2</span>)
1167:       <span class="ruby-identifier">wwdd2</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_last_record</span>(<span class="ruby-identifier">wd2</span>).<span class="ruby-identifier">date</span>
1168:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbDetection</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and fees_received_t&gt;='#{wwdd}' and fees_received_t&lt;'#{wwdd2}'  and agency_contract_t is NULL&quot;</span>)
1169:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1170:         <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0001'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1171:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1172:           <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1173:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 5&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1174:               <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1175:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1176:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_detections-#{c.id} 5&quot;</span>
1177:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},提醒与检测机构签约,【检测信息记录】中录入【和机构签约时间】。&quot;</span>
1178:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1179:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1180:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1181:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1182:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1183:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1184:               <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1185:                 <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1186:               <span class="ruby-keyword kw">end</span>
1187:             <span class="ruby-keyword kw">end</span>
1188:           <span class="ruby-keyword kw">end</span>
1189:         <span class="ruby-keyword kw">end</span>
1190:       <span class="ruby-keyword kw">end</span>
1191:     <span class="ruby-keyword kw">end</span>
1192:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000107" class="method-detail">
        <a name="M000107"></a>

        <div class="method-heading">
          <a href="#M000107" class="method-signature">
          <span class="method-name">t_7</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000107-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000107-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1194</span>
1194:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_7</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1195:     <span class="ruby-comment cmt">### 7:开庭中仲裁庭使用信息中新建和删除的时候进行提示前台，订房信息新建和删除时候提示前台,案件合议中案件庭使用信息中新建和删除的时候进行提示前台，</span>
1196:     <span class="ruby-comment cmt">### 仲裁庭开庭使用情况提醒到前台</span>
1197:     <span class="ruby-comment cmt">#判断新建的仲裁庭开庭使用情况</span>
1198:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;usestyle='0001' and used='Y' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1199:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">true</span>
1200:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1201:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1202:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1203:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1204:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1205:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1206:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 1&quot;</span>
1207:             <span class="ruby-identifier">arbitroom_info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁
1208:               庭:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0023' and data_val='#{c.sittingplace}' and data_val&lt;&gt;'0000'&quot;).data_text}
1209:               &lt;br&gt;使用类型:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0028'  and  data_val='#{c.usestyle}' and data_val&lt;&gt;'0000'&quot;).data_text}&lt;br&gt;
1210:               时间:#{c.sittingdate.to_s(:db)} #{c.open_t}-#{c.close_t}&lt;br&gt;时长:#{c.usetime}小时&quot;</span>
1211:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},增加了仲裁庭使用信息,#{arbitroom_info}。&quot;</span>
1212:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1213:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1214:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1215:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1216:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1217:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1218:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1219:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1220:             <span class="ruby-keyword kw">end</span>
1221:           <span class="ruby-keyword kw">end</span>
1222:         <span class="ruby-keyword kw">end</span>
1223:       <span class="ruby-keyword kw">end</span>
1224:     <span class="ruby-keyword kw">end</span>
1225: 
1226:     <span class="ruby-comment cmt">#判断删除的仲裁庭开庭使用情况</span>
1227: 
1228:     <span class="ruby-ivar">@tm</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;usestyle='0001' and used='N' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1229:     <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@tm</span>
1230:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1231:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1232:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 7&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1233:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1234:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1235:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 7&quot;</span>
1236:           <span class="ruby-identifier">arbitroom_info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁
1237:           庭:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0023' and data_val='#{c.sittingplace}' and data_val&lt;&gt;'0000'&quot;).data_text}
1238:           &lt;br&gt;使用类型:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0028'  and  data_val='#{c.usestyle}' and data_val&lt;&gt;'0000'&quot;).data_text}&lt;br&gt;
1239:           时间:#{c.sittingdate.to_s(:db)} #{c.open_t}-#{c.close_t}&lt;br&gt;时长:#{c.usetime}小时&quot;</span>
1240:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},减少了仲裁庭使用信息,#{arbitroom_info}。&quot;</span>
1241:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1242:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1243:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1244:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1245:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1246:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1247:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1248:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1249:           <span class="ruby-keyword kw">end</span>
1250:         <span class="ruby-keyword kw">end</span>
1251:       <span class="ruby-keyword kw">end</span>
1252:     <span class="ruby-keyword kw">end</span>
1253: 
1254:     <span class="ruby-comment cmt">### 合议庭合议使用情况，提醒到前台。</span>
1255:     <span class="ruby-comment cmt">#判断合议庭的新建情况</span>
1256:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;usestyle='0002' and used='Y'  and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1257:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">!=</span><span class="ruby-keyword kw">true</span>
1258:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1259:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1260:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1261:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 4&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1262:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1263:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1264:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 4&quot;</span>
1265:             <span class="ruby-identifier">arbitroom_info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁
1266:               庭:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0023' and data_val='#{c.sittingplace}' and data_val&lt;&gt;'0000'&quot;).data_text}
1267:               &lt;br&gt;使用类型:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0028'  and  data_val='#{c.usestyle}' and data_val&lt;&gt;'0000'&quot;).data_text}&lt;br&gt;
1268:               时间:#{c.sittingdate.to_s(:db)} #{c.open_t}-#{c.close_t}&lt;br&gt;时长:#{c.usetime}小时&quot;</span>
1269:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},增加了仲裁庭使用信息,#{arbitroom_info}。&quot;</span>
1270:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1271:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1272:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1273:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1274:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1275:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1276:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1277:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1278:             <span class="ruby-keyword kw">end</span>
1279:           <span class="ruby-keyword kw">end</span>
1280:         <span class="ruby-keyword kw">end</span>
1281:       <span class="ruby-keyword kw">end</span>
1282:     <span class="ruby-keyword kw">end</span>
1283: 
1284:     <span class="ruby-comment cmt">#判断合议庭的删除情况</span>
1285:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbitroom</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;usestyle='0002' and used='N' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1286:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">true</span>
1287:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1288:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1289:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1290:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 5&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1291:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1292:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1293:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbitrooms-#{c.id} 5&quot;</span>
1294:             <span class="ruby-identifier">arbitroom_info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁
1295:               庭:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0023' and data_val='#{c.sittingplace}' and data_val&lt;&gt;'0000'&quot;).data_text}
1296:               &lt;br&gt;使用类型:#{TbDictionary.find(:first,:conditions=&gt;&quot;typ_code='0028'  and  data_val='#{c.usestyle}' and data_val&lt;&gt;'0000'&quot;).data_text}&lt;br&gt;
1297:               时间:#{c.sittingdate.to_s(:db)} #{c.open_t}-#{c.close_t}&lt;br&gt;时长:#{c.usetime}小时&quot;</span>
1298:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},减少了仲裁庭使用信息,#{arbitroom_info}。&quot;</span>
1299:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1300:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1301:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1302:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1303:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1304:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1305:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1306:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1307:             <span class="ruby-keyword kw">end</span>
1308:           <span class="ruby-keyword kw">end</span>
1309:         <span class="ruby-keyword kw">end</span>
1310:       <span class="ruby-keyword kw">end</span>
1311:     <span class="ruby-keyword kw">end</span>
1312: 
1313:     <span class="ruby-comment cmt">### 仲裁员预订酒店的情况提醒到前台</span>
1314:     <span class="ruby-comment cmt"># 判断订房信息新建记录</span>
1315:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;state='0003' and usestyle='0001' and used='Y'  and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1316:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">true</span>
1317:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1318:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1319:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1320:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbithotels-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1321:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1322:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1323:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbithotels-#{c.id} 1&quot;</span>
1324:             <span class="ruby-identifier">info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁员:#{TbArbitman.find_by_code(c.arbitman).name}&lt;br&gt;入住日期:#{c.usedate}&lt;br&gt;房间数量:#{c.rooms}&lt;br&gt;住宿天数:#{c.days}&lt;br&gt;详细信息:#{c.descript}&quot;</span>
1325:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},增加了订房信息,#{info}。&quot;</span>
1326:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1327:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1328:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1329:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1330:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1331:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1332:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1333:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1334:             <span class="ruby-keyword kw">end</span>
1335:           <span class="ruby-keyword kw">end</span>
1336:         <span class="ruby-keyword kw">end</span>
1337:       <span class="ruby-keyword kw">end</span>
1338:     <span class="ruby-keyword kw">end</span>
1339: 
1340:     <span class="ruby-comment cmt"># 判断订房信息删除记录</span>
1341:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbArbithotel</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;state='0003' and usestyle='0001' and used='N'  and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1342:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">true</span>
1343:       <span class="ruby-ivar">@ud</span>=<span class="ruby-constant">UserDuty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;duty_code='0005'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;distinct user_code as user_code&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;user_code&quot;</span>)
1344:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1345:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">ud</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@ud</span>
1346:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbithotels-#{c.id} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1347:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1348:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1349:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{ud.user_code} tb_arbithotels-#{c.id} 2&quot;</span>
1350:             <span class="ruby-identifier">info</span>=<span class="ruby-node">&quot;预订人:#{User.find_by_code(c.u).name}&lt;br&gt;仲裁员:#{TbArbitman.find_by_code(c.arbitman).name}&lt;br&gt;入住日期:#{c.usedate}&lt;br&gt;房间数量:#{c.rooms}&lt;br&gt;住宿天数:#{c.days}&lt;br&gt;详细信息:#{c.descript}&quot;</span>
1351:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},减少了订房信息,#{info}。&quot;</span>
1352:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1353:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">ud</span>.<span class="ruby-identifier">user_code</span>
1354:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1355:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1356:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1357:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1358:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1359:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1360:             <span class="ruby-keyword kw">end</span>
1361:           <span class="ruby-keyword kw">end</span>
1362:         <span class="ruby-keyword kw">end</span>
1363:       <span class="ruby-keyword kw">end</span>
1364:     <span class="ruby-keyword kw">end</span>
1365: 
1366: 
1367:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000108" class="method-detail">
        <a name="M000108"></a>

        <div class="method-heading">
          <a href="#M000108" class="method-signature">
          <span class="method-name">t_8</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000108-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000108-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1369</span>
1369:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_8</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1370:     <span class="ruby-comment cmt">### 8: 审限到期前,系统提醒助理作出裁决。1个月,15天,5天,3天</span>
1371:     <span class="ruby-comment cmt">#提前1个月提醒</span>
1372:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1373:       <span class="ruby-identifier">limit_date_30</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">months_since</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
1374:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and state&lt;100 and caseendbook_id_first is null and finally_limit_dat='#{limit_date_30}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,recevice_code,case_code&quot;</span>)
1375:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1376:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1377:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1378:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1379:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1380:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 1&quot;</span>
1381:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},审限日期#{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s(:db)},请确认实际开支费用相关信息录入完成，并作出裁决。&quot;</span>
1382:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1383:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1384:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1385:             <span class="ruby-keyword kw">else</span>
1386:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1387:             <span class="ruby-keyword kw">end</span>
1388:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1389:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1390:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1391:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1392:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">caseendbook_id_first</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>   <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1393:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1394:             <span class="ruby-keyword kw">end</span>
1395:           <span class="ruby-keyword kw">end</span>
1396:         <span class="ruby-keyword kw">end</span>
1397:       <span class="ruby-keyword kw">end</span>
1398:     <span class="ruby-keyword kw">end</span>
1399:     <span class="ruby-comment cmt">#提前15天提醒</span>
1400:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1401:       <span class="ruby-identifier">limit_date_15</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">since</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">15</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
1402:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and state&lt;100 and caseendbook_id_first is null  and finally_limit_dat='#{limit_date_15}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,recevice_code,case_code&quot;</span>)
1403:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1404:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1405:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 2&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1406:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1407:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1408:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 2&quot;</span>
1409:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},审限日期#{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s(:db)},请确认实际开支费用相关信息录入完成，并作出裁决。&quot;</span>
1410:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1411:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1412:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1413:             <span class="ruby-keyword kw">else</span>
1414:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1415:             <span class="ruby-keyword kw">end</span>
1416:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1417:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1418:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1419:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1420:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">caseendbook_id_first</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1421:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1422:             <span class="ruby-keyword kw">end</span>
1423:           <span class="ruby-keyword kw">end</span>
1424:         <span class="ruby-keyword kw">end</span>
1425:       <span class="ruby-keyword kw">end</span>
1426:     <span class="ruby-keyword kw">end</span>
1427:     <span class="ruby-comment cmt">#提前5天提醒</span>
1428:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1429:       <span class="ruby-identifier">limit_date_5</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">since</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">5</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
1430:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and state&lt;100 and caseendbook_id_first is null  and finally_limit_dat='#{limit_date_5}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,recevice_code,case_code&quot;</span>)
1431:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1432:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1433:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 3&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1434:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1435:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1436:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 3&quot;</span>
1437:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},审限日期#{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s(:db)},提醒作出裁决。&quot;</span>
1438:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1439:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1440:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1441:             <span class="ruby-keyword kw">else</span>
1442:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1443:             <span class="ruby-keyword kw">end</span>
1444:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1445:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1446:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1447:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1448:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">caseendbook_id_first</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1449:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1450:             <span class="ruby-keyword kw">end</span>
1451:           <span class="ruby-keyword kw">end</span>
1452:         <span class="ruby-keyword kw">end</span>
1453:       <span class="ruby-keyword kw">end</span>
1454:     <span class="ruby-keyword kw">end</span>
1455:     <span class="ruby-comment cmt">#提前3天提醒</span>
1456:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
1457:       <span class="ruby-identifier">limit_date_3</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">since</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">3</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
1458:       <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and state&gt;=4 and state&lt;100 and caseendbook_id_first is null  and finally_limit_dat='#{limit_date_3}'&quot;</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id,recevice_code,case_code&quot;</span>)
1459:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1460:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1461:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 4&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1462:             <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1463:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1464:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{TbCase.find_by_recevice_code(c.recevice_code).clerk} tb_cases-finally_limit_dat-#{c.id} #{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s()} 4&quot;</span>
1465:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},审限日期#{TbCase.find_by_recevice_code(c.recevice_code).finally_limit_dat.to_s(:db)},提醒作出裁决。&quot;</span>
1466:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1467:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk!</span>=<span class="ruby-value str">''</span>
1468:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk</span>
1469:             <span class="ruby-keyword kw">else</span>
1470:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">clerk_2</span>
1471:             <span class="ruby-keyword kw">end</span>
1472:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1473:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1474:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1475:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1476:             <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">caseendbook_id_first</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">stoped</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
1477:               <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1478:             <span class="ruby-keyword kw">end</span>
1479:           <span class="ruby-keyword kw">end</span>
1480:         <span class="ruby-keyword kw">end</span>
1481:       <span class="ruby-keyword kw">end</span>
1482:     <span class="ruby-keyword kw">end</span>
1483:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000134" class="method-detail">
        <a name="M000134"></a>

        <div class="method-heading">
          <a href="#M000134" class="method-signature">
          <span class="method-name">t_800</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000134-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000134-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 3137</span>
3137:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_800</span>()
3138:     <span class="ruby-ivar">@ttt</span> = <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>, <span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;used='Y' and state=1 and a_state=0 and TIMESTAMPDIFF(DAY, u_t, now())&gt;365&quot;</span>)
3139:     <span class="ruby-ivar">@ttt</span>.<span class="ruby-identifier">each</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">c</span><span class="ruby-operator">|</span>
3140:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">a_state</span> = <span class="ruby-value">1</span>
3141:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
3142:     }
3143:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000110" class="method-detail">
        <a name="M000110"></a>

        <div class="method-heading">
          <a href="#M000110" class="method-signature">
          <span class="method-name">t_9</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000110-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000110-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 1856</span>
1856:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_9</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
1857:     <span class="ruby-comment cmt">### 9: 校核人员指定后,直接提醒校核人员进行校核评价</span>
1858:     <span class="ruby-ivar">@te</span>=<span class="ruby-constant">TbCheckStaff</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and typ='0001' and u_t&gt;='#{et_before}' and u_t&lt;'#{et_now}'&quot;</span>)
1859:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@te!</span>=<span class="ruby-keyword kw">nil</span>
1860:       <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">c</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@te</span>
1861:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">Remind</span>.<span class="ruby-identifier">find_by_reason_id</span>(<span class="ruby-node">&quot;#{c.recevice_code} #{c.staff} tb_check_staffs-#{c.id} 1&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
1862:           <span class="ruby-identifier">case_1</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
1863:           <span class="ruby-ivar">@remin</span>=<span class="ruby-constant">Remind</span>.<span class="ruby-identifier">new</span>
1864:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">'Y'</span>
1865:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">reason_id</span>=<span class="ruby-node">&quot;#{c.recevice_code} #{c.staff} tb_check_staffs-#{c.id} 1&quot;</span>
1866:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">contents</span>=<span class="ruby-node">&quot;立案号:#{c.case_code},请输入校核评价信息。办案助理:#{User.find_by_code(case_1.clerk).name}。&quot;</span>
1867:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">url</span>=<span class="ruby-node">&quot;/award_judge/judge_list?recevice_code=#{c.recevice_code}&quot;</span>
1868:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">dt1</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
1869:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">uu</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">staff</span>
1870:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">state</span>=<span class="ruby-value">1</span>
1871:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-value str">'0001'</span>
1872:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u</span>=<span class="ruby-value str">'system'</span>
1873:           <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
1874:           <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>).<span class="ruby-identifier">state</span><span class="ruby-operator">&lt;</span><span class="ruby-value">200</span>
1875:             <span class="ruby-ivar">@remin</span>.<span class="ruby-identifier">save</span>
1876:           <span class="ruby-keyword kw">end</span>
1877:         <span class="ruby-keyword kw">end</span>
1878:       <span class="ruby-keyword kw">end</span>
1879:     <span class="ruby-keyword kw">end</span>
1880:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000135" class="method-detail">
        <a name="M000135"></a>

        <div class="method-heading">
          <a href="#M000135" class="method-signature">
          <span class="method-name">t_911</span><span class="method-args">(et_before,et_now_t,et_now)</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000135-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000135-source">
<pre>
      <span class="ruby-comment cmt"># File app/models/task_a.rb, line 3145</span>
3145:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_911</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
3146:     <span class="ruby-comment cmt">### 备份数据库</span>
3147:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
3148:       <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;/usr/bin/mysqldump --skip-opt -q --create-options -R -uroot -proot zc &gt; /usr/local/zc_database_bak/zc_#{et_now.slice(0,10)}.sql&quot;</span>
3149:       <span class="ruby-identifier">del_e</span>=<span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">ago</span>(<span class="ruby-value">3600</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">7</span>).<span class="ruby-identifier">to_date</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
3150:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">del_e</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">8</span>,<span class="ruby-value">2</span>)<span class="ruby-operator">==</span><span class="ruby-value str">'01'</span>
3151:       <span class="ruby-keyword kw">else</span>
3152:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;/usr/local/zc_database_bak/zc_#{del_e}.sql&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
3153:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;/usr/local/zc_database_bak/zc_#{del_e}.sql&quot;</span>)
3154:       <span class="ruby-keyword kw">end</span>
3155:     <span class="ruby-keyword kw">end</span>
3156:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000099" class="method-detail">
        <a name="M000099"></a>

        <div class="method-heading">
          <a href="#M000099" class="method-signature">
          <span class="method-name">t_a</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000099-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000099-source">
<pre>
    <span class="ruby-comment cmt"># File app/models/task_a.rb, line 8</span>
 8:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_a</span>
 9:     <span class="ruby-identifier">t_b</span>
10:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000100" class="method-detail">
        <a name="M000100"></a>

        <div class="method-heading">
          <a href="#M000100" class="method-signature">
          <span class="method-name">t_b</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
def <a href="Task_a.html#M000100">t_b</a>
</p>
<pre>
  if @@task_state==0

    @@task_state=1

    @sys_2001 = SysArg.find_by_code('2001') #提醒服务最后运行时间
    et_before = @sys_2001.val
    et_now_t = Time.now
    et_now = et_now_t.to_s(:db)
    @sys_2001.val = et_now
    @sys_2001.save
    t_31(et_before,et_now_t,et_now)
  end
</pre>
<p>
end
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000100-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000100-source">
<pre>
     <span class="ruby-comment cmt"># File app/models/task_a.rb, line 27</span>
 27:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">t_b</span>
 28:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@@task_state</span><span class="ruby-operator">==</span><span class="ruby-value">0</span>
 29: 
 30:       <span class="ruby-ivar">@@task_state</span>=<span class="ruby-value">1</span>
 31: 
 32:       <span class="ruby-ivar">@sys_2001</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">'2001'</span>) <span class="ruby-comment cmt">#提醒服务最后运行时间</span>
 33:       <span class="ruby-identifier">et_before</span> = <span class="ruby-ivar">@sys_2001</span>.<span class="ruby-identifier">val</span>
 34:       <span class="ruby-identifier">et_now_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
 35:       <span class="ruby-identifier">et_now</span> = <span class="ruby-identifier">et_now_t</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-identifier">:db</span>)
 36:       <span class="ruby-ivar">@sys_2001</span>.<span class="ruby-identifier">val</span> = <span class="ruby-identifier">et_now</span>
 37:       <span class="ruby-ivar">@sys_2001</span>.<span class="ruby-identifier">save</span>
 38: 
 39:       <span class="ruby-comment cmt"># 1:收费被助理确认以后,直接提醒处长指定一名助理办案,2工作日后仍未指定的,提醒到秘书长处。</span>
 40:       <span class="ruby-keyword kw">begin</span>
 41:         <span class="ruby-identifier">t_1</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 42:       <span class="ruby-keyword kw">rescue</span>
 43:       <span class="ruby-keyword kw">end</span>
 44:       <span class="ruby-comment cmt"># 2:处长指定办案人员后,直接提醒办案人员发出仲裁通知,2工作日之后仍未发出的,提醒到处长处。</span>
 45:       <span class="ruby-keyword kw">begin</span>
 46:         <span class="ruby-identifier">t_2</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 47:       <span class="ruby-keyword kw">rescue</span>
 48:       <span class="ruby-keyword kw">end</span>
 49:       <span class="ruby-comment cmt"># 3：仲裁庭回避申请相关提醒</span>
 50:       <span class="ruby-keyword kw">begin</span>
 51:         <span class="ruby-identifier">t_3</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 52:       <span class="ruby-keyword kw">rescue</span>
 53:       <span class="ruby-keyword kw">end</span>
 54:       <span class="ruby-comment cmt"># 4:管辖权异议相关提醒</span>
 55:       <span class="ruby-keyword kw">begin</span>
 56:         <span class="ruby-identifier">t_4</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 57:       <span class="ruby-keyword kw">rescue</span>
 58:       <span class="ruby-keyword kw">end</span>
 59:       <span class="ruby-comment cmt"># 5:发开庭通知相关函的提醒</span>
 60:       <span class="ruby-keyword kw">begin</span>
 61:         <span class="ruby-identifier">t_5</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now</span>)
 62:       <span class="ruby-keyword kw">rescue</span>
 63:       <span class="ruby-keyword kw">end</span>
 64:       <span class="ruby-comment cmt">##########################################################################################################</span>
 65:       <span class="ruby-comment cmt"># 6:决定审计、鉴定或评估的,仲裁助理在3个工作日内联系有关专业机构,如果仍未联系,则提醒到处长处。在收到有关专业机构的报价之日起10个工作日内商定仲裁庭,确定具体的专业机构和有关报价；10个工作日内仍未确定,提醒到处长处。</span>
 66:       <span class="ruby-keyword kw">begin</span>
 67:         <span class="ruby-identifier">t_6</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 68:       <span class="ruby-keyword kw">rescue</span>
 69:       <span class="ruby-keyword kw">end</span>
 70:       <span class="ruby-comment cmt">##########################################################################################################</span>
 71:       <span class="ruby-comment cmt"># 7:开庭中仲裁庭使用信息中新建和删除的时候进行提示前台，订房信息新建和删除时候提示前台,案件合议中案件庭使用信息中新建和删除的时候进行提示前台，</span>
 72:       <span class="ruby-keyword kw">begin</span>
 73:         <span class="ruby-identifier">t_7</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 74:       <span class="ruby-keyword kw">rescue</span>
 75:       <span class="ruby-keyword kw">end</span>
 76:       <span class="ruby-comment cmt">##########################################################################################################</span>
 77:       <span class="ruby-comment cmt"># 8: 审限到期前,系统提醒助理作出裁决。1个月,15天,5天,3天</span>
 78:       <span class="ruby-keyword kw">begin</span>
 79:         <span class="ruby-identifier">t_8</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 80:       <span class="ruby-keyword kw">rescue</span>
 81:       <span class="ruby-keyword kw">end</span>
 82:       <span class="ruby-comment cmt">##########################################################################################################</span>
 83:       <span class="ruby-comment cmt"># 9: 校核人员指定后,直接提醒校核人员进行仲裁员评价</span>
 84:       <span class="ruby-keyword kw">begin</span>
 85:         <span class="ruby-identifier">t_9</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 86:       <span class="ruby-keyword kw">rescue</span>
 87:       <span class="ruby-keyword kw">end</span>
 88:       <span class="ruby-comment cmt">##########################################################################################################</span>
 89:       <span class="ruby-comment cmt"># 10: 当支出超过收入,即结余为负数时,需要提醒补收费用。每天只提醒一次（提醒到助理）</span>
 90:       <span class="ruby-keyword kw">begin</span>
 91:         <span class="ruby-identifier">t_10</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 92:       <span class="ruby-keyword kw">rescue</span>
 93:       <span class="ruby-keyword kw">end</span>
 94:       <span class="ruby-comment cmt">##########################################################################################################</span>
 95:       <span class="ruby-comment cmt"># 11: 退费申请经助理输入后,报秘书处长审批,审批后信息到出纳工作提醒中。</span>
 96:       <span class="ruby-keyword kw">begin</span>
 97:         <span class="ruby-identifier">t_11</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
 98:       <span class="ruby-keyword kw">rescue</span>
 99:       <span class="ruby-keyword kw">end</span>
100:       <span class="ruby-comment cmt">##########################################################################################################</span>
101:       <span class="ruby-comment cmt"># 12: 开庭前2个工作日,提示助理,短信通知的仲裁员。同时生成短信提醒信息，提醒仲裁员开庭信息,当事人，代理人</span>
102:       <span class="ruby-keyword kw">begin</span>
103:         <span class="ruby-identifier">t_12</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
104:       <span class="ruby-keyword kw">rescue</span>
105:       <span class="ruby-keyword kw">end</span>
106:       <span class="ruby-comment cmt">##########################################################################################################</span>
107:       <span class="ruby-comment cmt"># 13: 发文报批后立刻提示审批人进行审批</span>
108:       <span class="ruby-keyword kw">begin</span>
109:         <span class="ruby-identifier">t_13</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
110:       <span class="ruby-keyword kw">rescue</span>
111:       <span class="ruby-keyword kw">end</span>
112:       <span class="ruby-comment cmt">##########################################################################################################</span>
113:       <span class="ruby-comment cmt"># 14: 出纳收款后提醒助理进行确认</span>
114:       <span class="ruby-keyword kw">begin</span>
115:         <span class="ruby-identifier">t_14</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
116:       <span class="ruby-keyword kw">rescue</span>
117:       <span class="ruby-keyword kw">end</span>
118:       <span class="ruby-comment cmt">##########################################################################################################</span>
119:       <span class="ruby-comment cmt"># 15:助理确认收款明细后,提醒出纳</span>
120:       <span class="ruby-keyword kw">begin</span>
121:         <span class="ruby-identifier">t_15</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
122:       <span class="ruby-keyword kw">rescue</span>
123:       <span class="ruby-keyword kw">end</span>
124:       <span class="ruby-comment cmt">##########################################################################################################</span>
125:       <span class="ruby-comment cmt"># 16:助理确认收款明细到【案件收费】后,检查案件是否已经立案,如果未立案则提醒到处长,</span>
126:       <span class="ruby-keyword kw">begin</span>
127:         <span class="ruby-identifier">t_16</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
128:       <span class="ruby-keyword kw">rescue</span>
129:       <span class="ruby-keyword kw">end</span>
130:       <span class="ruby-comment cmt">##########################################################################################################</span>
131:       <span class="ruby-comment cmt"># 17：发开庭通知的时候，判断是否有欠缴费用，如果有则提醒</span>
132:       <span class="ruby-keyword kw">begin</span>
133:         <span class="ruby-identifier">t_17</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
134:       <span class="ruby-keyword kw">rescue</span>
135:       <span class="ruby-keyword kw">end</span>
136:       <span class="ruby-comment cmt">##########################################################################################################</span>
137:       <span class="ruby-comment cmt"># 18：年初计算更新仲裁员年龄</span>
138:       <span class="ruby-keyword kw">begin</span>
139:         <span class="ruby-identifier">t_18</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
140:       <span class="ruby-keyword kw">rescue</span>
141:       <span class="ruby-keyword kw">end</span>
142:       <span class="ruby-comment cmt">##########################################################################################################</span>
143:       <span class="ruby-comment cmt"># 19：立案后提醒到出纳，某发票号已对应到案件</span>
144:       <span class="ruby-keyword kw">begin</span>
145:         <span class="ruby-identifier">t_19</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
146:       <span class="ruby-keyword kw">rescue</span>
147:       <span class="ruby-keyword kw">end</span>
148:       <span class="ruby-comment cmt">##########################################################################################################</span>
149:       <span class="ruby-comment cmt"># 20：立案后提醒到处长，提醒处长有案件立案，办案助理是谁</span>
150:       <span class="ruby-keyword kw">begin</span>
151:         <span class="ruby-identifier">t_20</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
152:       <span class="ruby-keyword kw">rescue</span>
153:       <span class="ruby-keyword kw">end</span>
154:       <span class="ruby-comment cmt">##########################################################################################################</span>
155:       <span class="ruby-comment cmt"># 21：删除一年前的提醒信息</span>
156:       <span class="ruby-keyword kw">begin</span>
157:         <span class="ruby-identifier">t_21</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
158:       <span class="ruby-keyword kw">rescue</span>
159:       <span class="ruby-keyword kw">end</span>
160:       <span class="ruby-comment cmt">##########################################################################################################</span>
161:       <span class="ruby-comment cmt"># 22：案件结案后，N天后对未填写执行情况的案件，提示填写执行情况。</span>
162:       <span class="ruby-keyword kw">begin</span>
163:         <span class="ruby-identifier">t_22</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
164:       <span class="ruby-keyword kw">rescue</span>
165:       <span class="ruby-keyword kw">end</span>
166:       <span class="ruby-comment cmt">##########################################################################################################</span>
167:       <span class="ruby-comment cmt"># 23：生成短信提醒信息，提醒仲裁员开庭信息,当事人，代理人</span>
168:       <span class="ruby-comment cmt">#    begin</span>
169:       <span class="ruby-comment cmt">#      t_23(et_before,et_now_t,et_now)</span>
170:       <span class="ruby-comment cmt">#    rescue</span>
171:       <span class="ruby-comment cmt">#    end</span>
172:       <span class="ruby-comment cmt">##########################################################################################################</span>
173:       <span class="ruby-comment cmt"># 24：每天检查前一天操作的结案记录（以操作时间为准），结案的裁决或撤案是否已结上传了裁决书或者撤案书。如果没有上传，则提醒到制作裁决者（创建该案件结案信息的人）。</span>
174:       <span class="ruby-keyword kw">begin</span>
175:         <span class="ruby-identifier">t_24</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
176:       <span class="ruby-keyword kw">rescue</span>
177:       <span class="ruby-keyword kw">end</span>
178:       <span class="ruby-comment cmt">##########################################################################################################</span>
179:       <span class="ruby-comment cmt"># 25：每天生成仲裁员人案统计表。</span>
180:       <span class="ruby-keyword kw">begin</span>
181:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">et_now</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)<span class="ruby-operator">&gt;</span><span class="ruby-identifier">et_before</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">10</span>)
182:           <span class="ruby-identifier">t_25</span>()
183:         <span class="ruby-keyword kw">end</span>
184:       <span class="ruby-keyword kw">rescue</span>
185:       <span class="ruby-keyword kw">end</span>
186:       <span class="ruby-comment cmt">##########################################################################################################</span>
187:       <span class="ruby-comment cmt"># 26：每天检查咨询记录，把咨询有效期小于今天的咨询记录设置为历史咨询记录。</span>
188:       <span class="ruby-keyword kw">begin</span>
189:         <span class="ruby-identifier">t_26</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
190:       <span class="ruby-keyword kw">rescue</span>
191:       <span class="ruby-keyword kw">end</span>
192:       <span class="ruby-comment cmt">##########################################################################################################</span>
193:       <span class="ruby-comment cmt"># 27：检查对应到案件的费用是否被对应到明细了，如果没对应则提醒到助理。</span>
194:       <span class="ruby-keyword kw">begin</span>
195:         <span class="ruby-identifier">t_27</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
196:       <span class="ruby-keyword kw">rescue</span>
197:       <span class="ruby-keyword kw">end</span>
198:       <span class="ruby-comment cmt">##########################################################################################################</span>
199:       <span class="ruby-comment cmt"># 28: 案件发出仲裁通知</span>
200:       <span class="ruby-keyword kw">begin</span>
201:         <span class="ruby-identifier">t_28</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
202:       <span class="ruby-keyword kw">rescue</span>
203:       <span class="ruby-keyword kw">end</span>
204:       <span class="ruby-comment cmt">##########################################################################################################</span>
205:       <span class="ruby-comment cmt"># 29: 结案10天后提醒助理该案件未归档,20天提醒到处长</span>
206:       <span class="ruby-keyword kw">begin</span>
207:         <span class="ruby-identifier">t_29</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
208:       <span class="ruby-keyword kw">rescue</span>
209:       <span class="ruby-keyword kw">end</span>
210:       <span class="ruby-comment cmt">##########################################################################################################</span>
211:       <span class="ruby-comment cmt"># 30: 对咨询案件，在创建咨询案件2天后，发出提醒给咨询案件的接待助理</span>
212:       <span class="ruby-keyword kw">begin</span>
213:         <span class="ruby-identifier">t_30</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
214:       <span class="ruby-keyword kw">rescue</span>
215:       <span class="ruby-keyword kw">end</span>
216:       <span class="ruby-comment cmt">##########################################################################################################</span>
217:       <span class="ruby-comment cmt"># 31: 对咨询案件，在创建咨询案件2天后，发出提醒给咨询案件的接待助理</span>
218:       <span class="ruby-keyword kw">begin</span>
219:         <span class="ruby-identifier">t_31</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
220:       <span class="ruby-keyword kw">rescue</span>
221:       <span class="ruby-keyword kw">end</span>
222: 
223:       <span class="ruby-comment cmt">##########################################################################################################</span>
224:       <span class="ruby-comment cmt"># 32: 一年内未确认的待退费传入历史页面</span>
225:       <span class="ruby-keyword kw">begin</span>
226:         <span class="ruby-identifier">t_800</span>()
227:       <span class="ruby-keyword kw">rescue</span>
228:       <span class="ruby-keyword kw">end</span>
229: 
230:       <span class="ruby-comment cmt">##########################################################################################################</span>
231:       <span class="ruby-comment cmt"># 911：备份数据库</span>
232:       <span class="ruby-keyword kw">begin</span>
233:         <span class="ruby-identifier">t_911</span>(<span class="ruby-identifier">et_before</span>,<span class="ruby-identifier">et_now_t</span>,<span class="ruby-identifier">et_now</span>)
234:       <span class="ruby-keyword kw">rescue</span>
235:       <span class="ruby-keyword kw">end</span>
236:       <span class="ruby-comment cmt">##########################################################################################################</span>
237: 
238:       <span class="ruby-ivar">@@task_state</span>=<span class="ruby-value">0</span>
239: 
240:     <span class="ruby-keyword kw">else</span>
241: 
242:     <span class="ruby-keyword kw">end</span>
243: 
244:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>