<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseConsultation2Controller</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseConsultation2Controller</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/case_consultation2_controller_rb.html">
                app/controllers/case_consultation2_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
niell 2009-8-24 当前咨询案件
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M001566">a_list</a>&nbsp;&nbsp;
      <a href="#M001597">agent_create</a>&nbsp;&nbsp;
      <a href="#M001600">agent_delete</a>&nbsp;&nbsp;
      <a href="#M001598">agent_edit</a>&nbsp;&nbsp;
      <a href="#M001595">agent_list</a>&nbsp;&nbsp;
      <a href="#M001596">agent_new</a>&nbsp;&nbsp;
      <a href="#M001599">agent_update</a>&nbsp;&nbsp;
      <a href="#M001586">clerk_select</a>&nbsp;&nbsp;
      <a href="#M001585">clerk_select_list</a>&nbsp;&nbsp;
      <a href="#M001581">con_create</a>&nbsp;&nbsp;
      <a href="#M001584">con_delete</a>&nbsp;&nbsp;
      <a href="#M001582">con_edit</a>&nbsp;&nbsp;
      <a href="#M001579">con_list</a>&nbsp;&nbsp;
      <a href="#M001580">con_new</a>&nbsp;&nbsp;
      <a href="#M001583">con_update</a>&nbsp;&nbsp;
      <a href="#M001569">create</a>&nbsp;&nbsp;
      <a href="#M001591">create_amount</a>&nbsp;&nbsp;
      <a href="#M001572">delete</a>&nbsp;&nbsp;
      <a href="#M001594">delete_amount</a>&nbsp;&nbsp;
      <a href="#M001570">edit</a>&nbsp;&nbsp;
      <a href="#M001592">edit_amount</a>&nbsp;&nbsp;
      <a href="#M001589">edit_dispute_amount</a>&nbsp;&nbsp;
      <a href="#M001587">establishment</a>&nbsp;&nbsp;
      <a href="#M001588">establishment_no</a>&nbsp;&nbsp;
      <a href="#M001567">list</a>&nbsp;&nbsp;
      <a href="#M001568">new</a>&nbsp;&nbsp;
      <a href="#M001590">new_amount</a>&nbsp;&nbsp;
      <a href="#M001563">p_list</a>&nbsp;&nbsp;
      <a href="#M001560">p_set</a>&nbsp;&nbsp;
      <a href="#M001561">p_set_2</a>&nbsp;&nbsp;
      <a href="#M001575">party_create</a>&nbsp;&nbsp;
      <a href="#M001578">party_delete</a>&nbsp;&nbsp;
      <a href="#M001576">party_edit</a>&nbsp;&nbsp;
      <a href="#M001573">party_list</a>&nbsp;&nbsp;
      <a href="#M001574">party_new</a>&nbsp;&nbsp;
      <a href="#M001562">party_set</a>&nbsp;&nbsp;
      <a href="#M001577">party_update</a>&nbsp;&nbsp;
      <a href="#M001565">rate_set</a>&nbsp;&nbsp;
      <a href="#M001564">select_with_ajax</a>&nbsp;&nbsp;
      <a href="#M001571">update</a>&nbsp;&nbsp;
      <a href="#M001593">update_amount</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M001566" class="method-detail">
        <a name="M001566"></a>

        <div class="method-heading">
          <a href="#M001566" class="method-signature">
          <span class="method-name">a_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001566-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001566-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 67</span>
67:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">a_list</span>
68:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:company</span>]
69:     <span class="ruby-identifier">cov</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
70:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">company</span>)
71:     
72:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">strip!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">company</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
73:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct company,addr from tb_agents where company like '%#{company}%'  ORDER BY addr desc&quot;</span>)
74:     <span class="ruby-keyword kw">else</span>
75:       <span class="ruby-identifier">p</span>=<span class="ruby-keyword kw">nil</span>
76:     <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
78:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'a_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'a_l'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">p</span>
79:     <span class="ruby-keyword kw">end</span>
80:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001597" class="method-detail">
        <a name="M001597"></a>

        <div class="method-heading">
          <a href="#M001597" class="method-signature">
          <span class="method-name">agent_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001597-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001597-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 704</span>
704:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_create</span>
705:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
706:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
707:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
708:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
709:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
710:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
711:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
712:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
713:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
714:     <span class="ruby-keyword kw">else</span>
715:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
716:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
717:     <span class="ruby-keyword kw">end</span>
718:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001600" class="method-detail">
        <a name="M001600"></a>

        <div class="method-heading">
          <a href="#M001600" class="method-signature">
          <span class="method-name">agent_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001600-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001600-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 737</span>
737:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_delete</span>
738:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
739:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
740:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
741:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
742:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
743:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
744:     <span class="ruby-keyword kw">else</span>
745:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
746:     <span class="ruby-keyword kw">end</span>
747:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
748:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001598" class="method-detail">
        <a name="M001598"></a>

        <div class="method-heading">
          <a href="#M001598" class="method-signature">
          <span class="method-name">agent_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001598-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001598-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 719</span>
719:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_edit</span>
720:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
721:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001595" class="method-detail">
        <a name="M001595"></a>

        <div class="method-heading">
          <a href="#M001595" class="method-signature">
          <span class="method-name">agent_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
代理人##############################################
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001595-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001595-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 689</span>
689:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_list</span>
690: <span class="ruby-comment cmt">#    @isperson={1=&gt;&quot;是&quot;,2=&gt;&quot;否&quot;}</span>
691:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人方&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人方&quot;</span>}
692:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
693:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
694:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
695:     <span class="ruby-keyword kw">end</span>
696:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
697:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
698:       <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
699:     <span class="ruby-keyword kw">end</span>
700:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001596" class="method-detail">
        <a name="M001596"></a>

        <div class="method-heading">
          <a href="#M001596" class="method-signature">
          <span class="method-name">agent_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001596-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001596-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 701</span>
701:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_new</span>
702:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>()
703:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001599" class="method-detail">
        <a name="M001599"></a>

        <div class="method-heading">
          <a href="#M001599" class="method-signature">
          <span class="method-name">agent_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001599-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001599-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 722</span>
722:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_update</span>
723:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
724:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
725:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
726:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
727:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
728:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
729:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
730:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
731:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
732:     <span class="ruby-keyword kw">else</span>
733:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
734:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
735:     <span class="ruby-keyword kw">end</span>
736:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001586" class="method-detail">
        <a name="M001586"></a>

        <div class="method-heading">
          <a href="#M001586" class="method-signature">
          <span class="method-name">clerk_select</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
为案件选择办案助理
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001586-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001586-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 365</span>
365:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select</span>
366:     <span class="ruby-identifier">c</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>])
367:     <span class="ruby-identifier">old_clerk</span> = <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
368:     <span class="ruby-identifier">new_clerk</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
369:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
370: 
371:     <span class="ruby-comment cmt">#指定或者更换办案助理的时候需要更新助理变更信息表 tb_clerkchanges</span>
372:     <span class="ruby-identifier">tc</span> = <span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">new</span>()
373:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>]).<span class="ruby-identifier">recevice_code</span>
374:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">changedate</span> = <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
375:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">beforeclerk</span> = <span class="ruby-identifier">old_clerk</span>
376:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">afterclerk</span> = <span class="ruby-identifier">new_clerk</span>
377:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
378:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
379:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">falg</span> = <span class="ruby-value">0</span>
380: 
381:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">save</span>
382:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;仲裁助理指定成功&quot;</span>
383:     <span class="ruby-keyword kw">else</span>
384:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;仲裁助理指定失败&quot;</span>
385:     <span class="ruby-keyword kw">end</span>
386:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'1'</span>,<span class="ruby-identifier">:search_condit</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
387:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001585" class="method-detail">
        <a name="M001585"></a>

        <div class="method-heading">
          <a href="#M001585" class="method-signature">
          <span class="method-name">clerk_select_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
办案助理列表
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001585-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001585-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 354</span>
354:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select_list</span>
355:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0001&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Y&quot;</span> <span class="ruby-comment cmt">#处长职务</span>
356:       <span class="ruby-ivar">@clerks</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003'  )&quot;</span>)
357:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0003&quot;</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;Y&quot;</span> <span class="ruby-comment cmt">#助理职务</span>
358:       <span class="ruby-ivar">@clerks</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003' and user_code='#{session[:user_code]}')&quot;</span>)
359:     <span class="ruby-keyword kw">else</span>
360:       <span class="ruby-ivar">@clerks</span> = <span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  1=2&quot;</span>)
361:     <span class="ruby-keyword kw">end</span>
362:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001581" class="method-detail">
        <a name="M001581"></a>

        <div class="method-heading">
          <a href="#M001581" class="method-signature">
          <span class="method-name">con_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001581-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001581-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 308</span>
308:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_create</span>
309:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
310:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
311:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
312:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
313:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
314:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
315:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
316:     <span class="ruby-keyword kw">else</span>
317:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
318:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_new&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
319:     <span class="ruby-keyword kw">end</span>
320: 
321:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001584" class="method-detail">
        <a name="M001584"></a>

        <div class="method-heading">
          <a href="#M001584" class="method-signature">
          <span class="method-name">con_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001584-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001584-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 340</span>
340:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_delete</span>
341:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
342:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
343:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
344:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
345:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
346:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
347:     <span class="ruby-keyword kw">else</span>
348:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
349:     <span class="ruby-keyword kw">end</span>
350:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
351:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001582" class="method-detail">
        <a name="M001582"></a>

        <div class="method-heading">
          <a href="#M001582" class="method-signature">
          <span class="method-name">con_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001582-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001582-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 323</span>
323:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_edit</span>
324:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
325:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001579" class="method-detail">
        <a name="M001579"></a>

        <div class="method-heading">
          <a href="#M001579" class="method-signature">
          <span class="method-name">con_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
合同签订信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001579-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001579-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 292</span>
292:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_list</span>
293:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
294:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
295:     <span class="ruby-keyword kw">end</span>
296:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
297:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
298:       <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
299:     <span class="ruby-keyword kw">end</span>
300:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001580" class="method-detail">
        <a name="M001580"></a>

        <div class="method-heading">
          <a href="#M001580" class="method-signature">
          <span class="method-name">con_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001580-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001580-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 302</span>
302:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_new</span>
303:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>()
304:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">contractdate</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">acceptt</span>
305:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">pactname</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">casereason</span>
306:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001583" class="method-detail">
        <a name="M001583"></a>

        <div class="method-heading">
          <a href="#M001583" class="method-signature">
          <span class="method-name">con_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001583-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001583-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 327</span>
327:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_update</span>
328:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
329:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
330:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
331:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
332:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
333:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
334:     <span class="ruby-keyword kw">else</span>
335:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
336:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
337:     <span class="ruby-keyword kw">end</span>
338:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001569" class="method-detail">
        <a name="M001569"></a>

        <div class="method-heading">
          <a href="#M001569" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001569-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001569-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 123</span>
123:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
124:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
125:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
126:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
127:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
128:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code_limit_dat</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span> <span class="ruby-operator">+</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">&quot;1010&quot;</span>).<span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_i</span>
129:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0001</span>()
130:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
131:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
132:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
133:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
134:       <span class="ruby-keyword kw">end</span>
135:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
136:         <span class="ruby-comment cmt"># 如果创建成功，系统自动为申请人和被申请人分别创建案件应收费“当事人多交费用”，金额是 0</span>
137:         <span class="ruby-ivar">@should1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
138:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
139:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
140:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
141:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
142:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0001&quot;</span>
143:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
144:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
145:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
146:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
147:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
148:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">save</span>
149: 
150:         <span class="ruby-ivar">@should2</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
151:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
152:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
153:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
154:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
155:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0002&quot;</span>
156:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
157:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
158:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
159:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
160:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
161:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">save</span>
162: 
163:         <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
164:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;创建成功，咨询流水号:#{@case.recevice_code}&quot;</span>
165:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:typ</span>],<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
166:       <span class="ruby-keyword kw">else</span>
167:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
168:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
169:       <span class="ruby-keyword kw">end</span>
170:     <span class="ruby-keyword kw">else</span>
171:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
172:     <span class="ruby-keyword kw">end</span>
173:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001591" class="method-detail">
        <a name="M001591"></a>

        <div class="method-heading">
          <a href="#M001591" class="method-signature">
          <span class="method-name">create_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001591-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001591-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 558</span>
558:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_amount</span>
559:     <span class="ruby-ivar">@current_case</span>         = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
560:     <span class="ruby-ivar">@amount</span>               = <span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
561:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
562:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">case_code</span>
563:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">general_code</span>
564:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
565:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
566:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
567:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>      = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>.<span class="ruby-identifier">to_i</span>
568: 
569:     <span class="ruby-identifier">sum1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
570:     <span class="ruby-identifier">sum2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
571: 
572:     <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:spec</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;on&quot;</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum1</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum2</span>)
573:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败,减少争议金额不能大于原争议金额的总和！&quot;</span>
574:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
575:     <span class="ruby-keyword kw">else</span>
576:       
577:       <span class="ruby-identifier">old_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">1</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的立案费</span>
578:       <span class="ruby-identifier">old_arbitration_fee</span>  = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">2</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的仲裁费</span>
579: 
580:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
581:         <span class="ruby-ivar">@money</span> = <span class="ruby-constant">Money</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;used='Y'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
582:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">m</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@money</span>
583:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>] <span class="ruby-operator">!=</span> <span class="ruby-value str">'0'</span>
584:             <span class="ruby-ivar">@amount_detail</span> = <span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">new</span>()
585:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">parent_id</span> = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">id</span>
586:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
587:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">case_code</span> = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">case_code</span>
588:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">general_code</span> = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">general_code</span>
589:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">partytype</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
590:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
591:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>
592:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span>
593:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">amount_typ</span> = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">amount_typ</span>
594:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">dt</span> = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>
595:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">currency</span> = <span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>
596:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">f_money</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;f_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
597:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rate</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rate_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
598:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rmb_money</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
599:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">save</span>
600:           <span class="ruby-keyword kw">end</span>
601:         <span class="ruby-keyword kw">end</span>
602:         
603:         <span class="ruby-comment cmt">#调用是有方法的函数，在增加争议金额的时候进行应收或应退的增加</span>
604:         <span class="ruby-identifier">should_add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>,<span class="ruby-identifier">old_registration_fee</span>,<span class="ruby-identifier">old_arbitration_fee</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
605:         
606:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount</span>   = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
607:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
608:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
609:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">save</span>
610:           <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
611:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
612:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
613:                       <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
614:                       <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
615:         <span class="ruby-keyword kw">else</span>
616:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
617:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
618:                  <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
619:                  <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
620:         <span class="ruby-keyword kw">end</span>
621:       <span class="ruby-keyword kw">else</span>
622:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
623:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
624:                <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
625:                <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
626:       <span class="ruby-keyword kw">end</span>
627:     <span class="ruby-keyword kw">end</span>
628:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001572" class="method-detail">
        <a name="M001572"></a>

        <div class="method-heading">
          <a href="#M001572" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001572-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001572-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 205</span>
205:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>
206:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
207:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
208:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
209:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
210:     <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">del_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
211:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
212:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
213:     <span class="ruby-keyword kw">else</span>
214:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
215:     <span class="ruby-keyword kw">end</span>
216:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
217:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001594" class="method-detail">
        <a name="M001594"></a>

        <div class="method-heading">
          <a href="#M001594" class="method-signature">
          <span class="method-name">delete_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001594-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001594-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 663</span>
663:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_amount</span>
664:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
665:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
666:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
667:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
668:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
669:       <span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;parent_id=#{@amount.id}&quot;</span>)
670:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
671:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
672:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
673:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
674:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
675:       <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>)
676:       <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>) 
677:       <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
678:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
679:     <span class="ruby-keyword kw">else</span>
680:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
681:     <span class="ruby-keyword kw">end</span>
682:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
683:                 <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
684:                 <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
685:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001570" class="method-detail">
        <a name="M001570"></a>

        <div class="method-heading">
          <a href="#M001570" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
进入修改咨询案件页眉
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001570-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001570-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 176</span>
176:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
177:     <span class="ruby-comment cmt">#案件基本信息</span>
178:     <span class="ruby-ivar">@case</span>  = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
179:     <span class="ruby-comment cmt">#总会案件大类</span>
180:     <span class="ruby-ivar">@t_typ</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
181:     <span class="ruby-comment cmt">#案件类型大分类</span>
182:     <span class="ruby-ivar">@typ1</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
183:     <span class="ruby-comment cmt">#案件类型小分类</span>
184:     <span class="ruby-ivar">@typ2</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{@case.casetype_num}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
185:     <span class="ruby-comment cmt">#案件应收费用信息（用于判断是否可以立案，只有应收费用 rmb_money 不为0 才可以立案）</span>
186:     <span class="ruby-ivar">@placed</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{params[:recevice_code]}' and (typ='0001' or typ='0004') and re_rmb_money&lt;&gt;0&quot;</span>)
187:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001592" class="method-detail">
        <a name="M001592"></a>

        <div class="method-heading">
          <a href="#M001592" class="method-signature">
          <span class="method-name">edit_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001592-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001592-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 630</span>
630:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_amount</span>
631:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
632:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001589" class="method-detail">
        <a name="M001589"></a>

        <div class="method-heading">
          <a href="#M001589" class="method-signature">
          <span class="method-name">edit_dispute_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
关于争议金额的处理
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001589-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001589-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 451</span>
451:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_dispute_amount</span>
452:     <span class="ruby-ivar">@case</span>=<span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
453:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]<span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
454:     <span class="ruby-keyword kw">else</span>
455:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
456:       <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
457:       <span class="ruby-ivar">@typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;争议金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;追加争议金额&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;减少争议金额&quot;</span>}
458:       <span class="ruby-ivar">@amount_typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;明确金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;不明确金额&quot;</span>}
459:       <span class="ruby-ivar">@amount1</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y' and partytype=1&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
460:       <span class="ruby-ivar">@amount2</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used='Y' and partytype=2&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
461:       <span class="ruby-comment cmt">#申请人明确争议金额</span>
462:       <span class="ruby-ivar">@applicant_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
463:       <span class="ruby-comment cmt">#被申请人明确争议金额</span>
464:       <span class="ruby-ivar">@respondent_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
465:       <span class="ruby-comment cmt">#申请人不明确争议金额</span>
466:       <span class="ruby-ivar">@applicant_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
467:       <span class="ruby-comment cmt">#被申请人不明确争议金额</span>
468:       <span class="ruby-ivar">@respondent_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
469:       <span class="ruby-comment cmt">#申请人费用汇总</span>
470:       <span class="ruby-identifier">applicant_all</span> = <span class="ruby-ivar">@applicant_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_undefinites</span>
471:       <span class="ruby-comment cmt">#被申请人费用汇总</span>
472:       <span class="ruby-identifier">respondent_all</span> = <span class="ruby-ivar">@respondent_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_undefinites</span>
473:       <span class="ruby-comment cmt">#金融案件仲裁费/立案费</span>
474:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case!</span>=<span class="ruby-keyword kw">nil</span>
475:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0005&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0006&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0007&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0008&quot;</span>
476:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
477:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">applicant_all</span>)   <span class="ruby-comment cmt">#仲裁费</span>
478:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">applicant_all</span>)      <span class="ruby-comment cmt">#立案费</span>
479:           <span class="ruby-keyword kw">else</span>
480:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
481:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
482:           <span class="ruby-keyword kw">end</span>
483:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
484:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">respondent_all</span>)
485:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">respondent_all</span>)
486:           <span class="ruby-keyword kw">else</span>
487:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
488:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
489:           <span class="ruby-keyword kw">end</span>
490:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
491:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
492:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
493:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
494:       <span class="ruby-comment cmt">#涉外案件仲裁费/立案费</span>
495: 
496:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0004&quot;</span>
497:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
498:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">applicant_all</span>)   <span class="ruby-comment cmt">#仲裁费</span>
499:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">applicant_all</span>)      <span class="ruby-comment cmt">#立案费</span>
500:           <span class="ruby-keyword kw">else</span>
501:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
502:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
503:           <span class="ruby-keyword kw">end</span>
504:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
505:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">respondent_all</span>)
506:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">respondent_all</span>) 
507:           <span class="ruby-keyword kw">else</span>
508:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
509:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
510:           <span class="ruby-keyword kw">end</span>
511:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
512:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
513:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
514:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
515:       <span class="ruby-comment cmt">#国内案件受理费/处理费计算</span>
516:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
517:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
518:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">respondent_all</span>)
519:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">respondent_all</span>)
520:         <span class="ruby-keyword kw">else</span>
521:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
522:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
523:         <span class="ruby-keyword kw">end</span>
524:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
525:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">applicant_all</span>)
526:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">applicant_all</span>)
527:         <span class="ruby-keyword kw">else</span>
528:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>
529:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>
530:         <span class="ruby-keyword kw">end</span>
531:         <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
532:         <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
533:         <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
534:         <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
535:       <span class="ruby-keyword kw">end</span>
536:       <span class="ruby-ivar">@applicant_sum</span> = <span class="ruby-ivar">@applicant_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_processing_fee</span>
537:       <span class="ruby-ivar">@respondent_sum</span> = <span class="ruby-ivar">@respondent_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_processing_fee</span>
538:       <span class="ruby-keyword kw">end</span>
539:     <span class="ruby-keyword kw">end</span>
540:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001587" class="method-detail">
        <a name="M001587"></a>

        <div class="method-heading">
          <a href="#M001587" class="method-signature">
          <span class="method-name">establishment</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
立案
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001587-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001587-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 390</span>
390:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment</span>
391:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
392:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
393:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
394:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
395:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
396:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
397:         <span class="ruby-keyword kw">end</span>
398:         <span class="ruby-identifier">add_2</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0002</span>()
399:         <span class="ruby-comment cmt">#### 华南仲裁委个性化</span>
400:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0005'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span>
401:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN D&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
402:         <span class="ruby-keyword kw">else</span>
403:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
404:         <span class="ruby-keyword kw">end</span>
405:         <span class="ruby-comment cmt">####</span>
406:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0003</span>()
407:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
408:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
409: <span class="ruby-comment cmt">#        c.limit_dat=Workday.after_day(SysArg.find_by_code('1000').val.to_i)</span>
410: <span class="ruby-comment cmt">#        c.finally_limit_dat=c.limit_dat</span>
411: 
412:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
413:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
414:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已立案&quot;</span>
415:         <span class="ruby-keyword kw">else</span>
416:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件立案立案失败，如有问题请与软件供应商联系&quot;</span>
417:         <span class="ruby-keyword kw">end</span>
418:       <span class="ruby-keyword kw">end</span>
419:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
420:     <span class="ruby-keyword kw">else</span>
421:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
422:     <span class="ruby-keyword kw">end</span>
423:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001588" class="method-detail">
        <a name="M001588"></a>

        <div class="method-heading">
          <a href="#M001588" class="method-signature">
          <span class="method-name">establishment_no</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001588-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001588-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 425</span>
425:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment_no</span>
426:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
427:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
428:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
429:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
430:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
431:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
432:         <span class="ruby-keyword kw">end</span>
433:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
434:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
435:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
436:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
437:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已设置为不受理&quot;</span>
438:         <span class="ruby-keyword kw">else</span>
439:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件不受理，操作失败，如有问题请与软件供应商联系&quot;</span>
440:         <span class="ruby-keyword kw">end</span>
441:       <span class="ruby-keyword kw">end</span>
442:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
443: 
444:     <span class="ruby-keyword kw">else</span>
445:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
446:     <span class="ruby-keyword kw">end</span>
447:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001567" class="method-detail">
        <a name="M001567"></a>

        <div class="method-heading">
          <a href="#M001567" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
显示最新记录
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001567-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001567-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 83</span>
 83:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 84:     <span class="ruby-ivar">@typ</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:typ</span>] <span class="ruby-comment cmt">#typ 是什么意思？</span>
 85: 
 86:     <span class="ruby-comment cmt">#排序</span>
 87:     <span class="ruby-ivar">@order</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
 88:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
 89:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
 90:         <span class="ruby-ivar">@order</span> = <span class="ruby-value str">&quot;id desc&quot;</span>
 91:       <span class="ruby-keyword kw">else</span>
 92:         <span class="ruby-ivar">@order</span> = <span class="ruby-value str">&quot;recevice_code desc&quot;</span>
 93:       <span class="ruby-keyword kw">end</span>
 94:     <span class="ruby-keyword kw">end</span>
 95: 
 96:     <span class="ruby-comment cmt">#每页显示案件条数</span>
 97:     <span class="ruby-ivar">@page_lines</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
 98:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;&quot;</span>
 99:       <span class="ruby-ivar">@page_lines</span> = <span class="ruby-value">100000000</span>
100:     <span class="ruby-keyword kw">end</span>
101:     
102:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@typ</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
103: <span class="ruby-comment cmt">#      c=&quot;used='Y' and state=1 and recevice_code_limit_dat&gt;='#{Date.today}'&quot;</span>
104: <span class="ruby-comment cmt">#      @case=TbCase.find(:all,:conditions=&gt;c,:order=&gt;@order)</span>
105:       <span class="ruby-ivar">@case</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
106:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'1'</span>
107:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select * from tb_cases where u='#{session[:user_code]}' and used='Y' and state=1
108:                   and recevice_code_limit_dat&gt;='#{Date.today}'  order by id desc limit 1&quot;</span>)
109:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'2'</span>
110:       <span class="ruby-ivar">@case</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
111:     <span class="ruby-keyword kw">end</span>
112:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001568" class="method-detail">
        <a name="M001568"></a>

        <div class="method-heading">
          <a href="#M001568" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001568-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001568-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 114</span>
114:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
115:     <span class="ruby-ivar">@t_typ</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
116:     <span class="ruby-ivar">@typ1</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
117:     <span class="ruby-identifier">oopp</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val&quot;</span>)
118:     <span class="ruby-ivar">@typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{oopp.data_val}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
119:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>()
120:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>()
121:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001590" class="method-detail">
        <a name="M001590"></a>

        <div class="method-heading">
          <a href="#M001590" class="method-signature">
          <span class="method-name">new_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001590-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001590-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 542</span>
542:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_amount</span>
543:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>()
544:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
545:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">currency</span>=<span class="ruby-value str">'0001'</span>  <span class="ruby-comment cmt"># 币种</span>
546:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">f_money</span>=<span class="ruby-value">0</span>
547:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rate</span>=<span class="ruby-value">1</span>
548:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span>=<span class="ruby-value">0</span>
549:     <span class="ruby-ivar">@respondent</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(
550:       <span class="ruby-identifier">:all</span>,
551:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and partytype=2 and recevice_code='#{params[:recevice_code]}'&quot;</span>,
552:       <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id&quot;</span>,
553:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id,partyname&quot;</span>
554:     ).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span>]}.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,[<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>])
555:     <span class="ruby-comment cmt"># 当 @respondent.size 的值大于二的时候，说明有多个被申请人，此时才可以为多个被申请人录入各自的反请求争议金额</span>
556:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001563" class="method-detail">
        <a name="M001563"></a>

        <div class="method-heading">
          <a href="#M001563" class="method-signature">
          <span class="method-name">p_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面 Ajax 调用该方法查询当事人信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001563-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001563-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 29</span>
29:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_list</span>
30:     <span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partyname</span>]
31:     <span class="ruby-identifier">cov</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
32:     <span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">cov</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">partyname</span>)
33:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">partyname</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
34:       <span class="ruby-identifier">p_case</span> = <span class="ruby-constant">VParty</span>.<span class="ruby-identifier">find_by_sql</span>(
35:         <span class="ruby-node">&quot; select distinct partyname,recevice_code,case_code,nowdate,end_code,caseendbook_id_last,clerk,mobiletel,area,tel
36:           from  v_parties
37:           where partyname like '%#{partyname}%' order by tel desc&quot;</span>
38:       )
39:     <span class="ruby-keyword kw">else</span>
40:       <span class="ruby-identifier">p_case</span> = <span class="ruby-keyword kw">nil</span>
41:     <span class="ruby-keyword kw">end</span>
42: 
43:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
44:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'p_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'p_l'</span>, <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p_case</span>
45:     <span class="ruby-keyword kw">end</span>
46:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001560" class="method-detail">
        <a name="M001560"></a>

        <div class="method-heading">
          <a href="#M001560" class="method-signature">
          <span class="method-name">p_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Ajax方式调用该action，用于下拉菜单联动效果。
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001560-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001560-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 4</span>
 4:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set</span>
 5:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{params[:p_typ]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>)
 6:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
 7:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_casetype_num2'</span>
 8:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
 9:     <span class="ruby-keyword kw">end</span>
10:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001561" class="method-detail">
        <a name="M001561"></a>

        <div class="method-heading">
          <a href="#M001561" class="method-signature">
          <span class="method-name">p_set_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001561-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001561-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 12</span>
12:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set_2</span>
13:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select data_val,data_text from tb_dictionaries where used='Y' and state='Y' and typ_code = '0001' and data_val in (select app_code from charge_fun_detail where role_code=?  and used='Y')  order by ind,data_val&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_typ</span>]])
14:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
15:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_aribitprog_num'</span>
16:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set_2'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv_2'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
17:     <span class="ruby-keyword kw">end</span>
18:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001575" class="method-detail">
        <a name="M001575"></a>

        <div class="method-heading">
          <a href="#M001575" class="method-signature">
          <span class="method-name">party_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001575-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001575-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 238</span>
238:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_create</span>
239:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
240:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
241:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
242:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
243:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
244:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
245:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
246:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
247:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
248:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
249:     <span class="ruby-keyword kw">else</span>
250:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
251:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
252:     <span class="ruby-keyword kw">end</span>
253:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001578" class="method-detail">
        <a name="M001578"></a>

        <div class="method-heading">
          <a href="#M001578" class="method-signature">
          <span class="method-name">party_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001578-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001578-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 276</span>
276:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_delete</span>
277:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
278:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
279:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
280:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
281:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
282: 
283:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
284:     <span class="ruby-keyword kw">else</span>
285:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
286:     <span class="ruby-keyword kw">end</span>
287:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
288:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001576" class="method-detail">
        <a name="M001576"></a>

        <div class="method-heading">
          <a href="#M001576" class="method-signature">
          <span class="method-name">party_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001576-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001576-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 255</span>
255:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_edit</span>
256:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
257:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001573" class="method-detail">
        <a name="M001573"></a>

        <div class="method-heading">
          <a href="#M001573" class="method-signature">
          <span class="method-name">party_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
当事人操作
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001573-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001573-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_list</span>
222:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value str">&quot;1&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value str">&quot;2&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
223:     <span class="ruby-ivar">@isperson</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;是&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;否&quot;</span>}
224:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
225:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
226:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
227:     <span class="ruby-keyword kw">end</span>
228:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
229:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
230:       <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
231:     <span class="ruby-keyword kw">end</span>
232:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001574" class="method-detail">
        <a name="M001574"></a>

        <div class="method-heading">
          <a href="#M001574" class="method-signature">
          <span class="method-name">party_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001574-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001574-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 234</span>
234:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_new</span>
235:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>()
236:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001562" class="method-detail">
        <a name="M001562"></a>

        <div class="method-heading">
          <a href="#M001562" class="method-signature">
          <span class="method-name">party_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001562-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001562-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 20</span>
20:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_set</span>
21:     <span class="ruby-identifier">party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;partytype=#{params[:partytype]} and used='Y' and recevice_code='#{params[:recevice_code]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'partyname'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;partyname,id&quot;</span>)
22:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
23:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'agent_party_id'</span>
24:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'party_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'par'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">party</span>
25:     <span class="ruby-keyword kw">end</span>
26:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001577" class="method-detail">
        <a name="M001577"></a>

        <div class="method-heading">
          <a href="#M001577" class="method-signature">
          <span class="method-name">party_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001577-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001577-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 259</span>
259:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_update</span>
260:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
261:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
262:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
263:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
264:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
265:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
266:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
267:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
268:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
269:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
270:     <span class="ruby-keyword kw">else</span>
271:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
272:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
273:     <span class="ruby-keyword kw">end</span>
274:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001565" class="method-detail">
        <a name="M001565"></a>

        <div class="method-heading">
          <a href="#M001565" class="method-signature">
          <span class="method-name">rate_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001565-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001565-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 60</span>
60:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rate_set</span>
61:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
62:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'amount_rate'</span>
63:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'rate_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rate'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Money</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:money_code</span>]).<span class="ruby-identifier">rate</span>
64:     <span class="ruby-keyword kw">end</span>
65:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001564" class="method-detail">
        <a name="M001564"></a>

        <div class="method-heading">
          <a href="#M001564" class="method-signature">
          <span class="method-name">select_with_ajax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面Ajax调用该方法获得行业小分类信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001564-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001564-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 49</span>
49:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_with_ajax</span>
50:     <span class="ruby-identifier">profession_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:profession_id</span>]
51:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">profession_id</span>.<span class="ruby-identifier">blank?</span>
52:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='000dd'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
53:     <span class="ruby-keyword kw">else</span>
54:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='#{profession_id}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
55:     <span class="ruby-keyword kw">end</span>
56:     <span class="ruby-identifier">render</span>
57:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001571" class="method-detail">
        <a name="M001571"></a>

        <div class="method-heading">
          <a href="#M001571" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
咨询案件 修改
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001571-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001571-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 190</span>
190:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
191:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
192:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
193:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
194:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
195:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
196:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
197:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
198:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:typ=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'1'</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
199:     <span class="ruby-keyword kw">else</span>
200:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
201:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
202:     <span class="ruby-keyword kw">end</span>
203:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M001593" class="method-detail">
        <a name="M001593"></a>

        <div class="method-heading">
          <a href="#M001593" class="method-signature">
          <span class="method-name">update_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M001593-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M001593-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation2_controller.rb, line 634</span>
634:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_amount</span>
635:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
636:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
637:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
638:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
639:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
640:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
641:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
642:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
643:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
644:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
645:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
646:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
647:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
648:       <span class="ruby-keyword kw">else</span>
649:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
650:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
651:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
652:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
653:       <span class="ruby-keyword kw">end</span>
654:     <span class="ruby-keyword kw">else</span>
655:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
656:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
657:         <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
658:         <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
659:     <span class="ruby-keyword kw">end</span>
660: 
661:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>