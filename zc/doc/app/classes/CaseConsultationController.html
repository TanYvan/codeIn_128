<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: CaseConsultationController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">CaseConsultationController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../files/app/controllers/case_consultation_controller_rb.html">
                app/controllers/case_consultation_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">



   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M002302">a_list</a>&nbsp;&nbsp;
      <a href="#M002336">agent_create</a>&nbsp;&nbsp;
      <a href="#M002339">agent_delete</a>&nbsp;&nbsp;
      <a href="#M002337">agent_edit</a>&nbsp;&nbsp;
      <a href="#M002334">agent_list</a>&nbsp;&nbsp;
      <a href="#M002335">agent_new</a>&nbsp;&nbsp;
      <a href="#M002338">agent_update</a>&nbsp;&nbsp;
      <a href="#M002350">case_copy</a>&nbsp;&nbsp;
      <a href="#M002351">case_copy_do</a>&nbsp;&nbsp;
      <a href="#M002310">case_doc</a>&nbsp;&nbsp;
      <a href="#M002324">clerk_select</a>&nbsp;&nbsp;
      <a href="#M002323">clerk_select_list</a>&nbsp;&nbsp;
      <a href="#M002319">con_create</a>&nbsp;&nbsp;
      <a href="#M002322">con_delete</a>&nbsp;&nbsp;
      <a href="#M002320">con_edit</a>&nbsp;&nbsp;
      <a href="#M002317">con_list</a>&nbsp;&nbsp;
      <a href="#M002318">con_new</a>&nbsp;&nbsp;
      <a href="#M002321">con_update</a>&nbsp;&nbsp;
      <a href="#M002306">create</a>&nbsp;&nbsp;
      <a href="#M002330">create_amount</a>&nbsp;&nbsp;
      <a href="#M002309">delete</a>&nbsp;&nbsp;
      <a href="#M002333">delete_amount</a>&nbsp;&nbsp;
      <a href="#M002307">edit</a>&nbsp;&nbsp;
      <a href="#M002331">edit_amount</a>&nbsp;&nbsp;
      <a href="#M002328">edit_dispute_amount</a>&nbsp;&nbsp;
      <a href="#M002325">establishment</a>&nbsp;&nbsp;
      <a href="#M002326">establishment_no</a>&nbsp;&nbsp;
      <a href="#M002342">file_create</a>&nbsp;&nbsp;
      <a href="#M002345">file_delete</a>&nbsp;&nbsp;
      <a href="#M002349">file_destroy</a>&nbsp;&nbsp;
      <a href="#M002348">file_down</a>&nbsp;&nbsp;
      <a href="#M002343">file_edit</a>&nbsp;&nbsp;
      <a href="#M002340">file_list</a>&nbsp;&nbsp;
      <a href="#M002341">file_new</a>&nbsp;&nbsp;
      <a href="#M002344">file_update</a>&nbsp;&nbsp;
      <a href="#M002346">file_upload</a>&nbsp;&nbsp;
      <a href="#M002347">file_upload_do</a>&nbsp;&nbsp;
      <a href="#M002304">list</a>&nbsp;&nbsp;
      <a href="#M002305">new</a>&nbsp;&nbsp;
      <a href="#M002329">new_amount</a>&nbsp;&nbsp;
      <a href="#M002300">p_list</a>&nbsp;&nbsp;
      <a href="#M002297">p_set</a>&nbsp;&nbsp;
      <a href="#M002298">p_set_2</a>&nbsp;&nbsp;
      <a href="#M002313">party_create</a>&nbsp;&nbsp;
      <a href="#M002316">party_delete</a>&nbsp;&nbsp;
      <a href="#M002314">party_edit</a>&nbsp;&nbsp;
      <a href="#M002311">party_list</a>&nbsp;&nbsp;
      <a href="#M002312">party_new</a>&nbsp;&nbsp;
      <a href="#M002299">party_set</a>&nbsp;&nbsp;
      <a href="#M002315">party_update</a>&nbsp;&nbsp;
      <a href="#M002301">rate_set</a>&nbsp;&nbsp;
      <a href="#M002303">select_with_ajax</a>&nbsp;&nbsp;
      <a href="#M002327">set_case2</a>&nbsp;&nbsp;
      <a href="#M002308">update</a>&nbsp;&nbsp;
      <a href="#M002332">update_amount</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M002302" class="method-detail">
        <a name="M002302"></a>

        <div class="method-heading">
          <a href="#M002302" class="method-signature">
          <span class="method-name">a_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面 Ajax 调用该方法查询代理人所在单位信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002302-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002302-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 53</span>
53:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">a_list</span>
54:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:company</span>]
55:     <span class="ruby-identifier">cov</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
56:     <span class="ruby-identifier">company</span>=<span class="ruby-identifier">cov</span>.<span class="ruby-identifier">iconv</span>(<span class="ruby-identifier">company</span>)
57:     
58:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">company</span>.<span class="ruby-identifier">strip!</span>=<span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">company</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
59:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select distinct company,addr from tb_agents where company like '%#{company}%'  ORDER BY addr desc&quot;</span>)
60:     <span class="ruby-keyword kw">else</span>
61:       <span class="ruby-identifier">p</span>=<span class="ruby-keyword kw">nil</span>
62:     <span class="ruby-keyword kw">end</span>
63:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
64:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'a_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'a_l'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">p</span>
65:     <span class="ruby-keyword kw">end</span>
66:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002336" class="method-detail">
        <a name="M002336"></a>

        <div class="method-heading">
          <a href="#M002336" class="method-signature">
          <span class="method-name">agent_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002336-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002336-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 738</span>
738:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_create</span>
739:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
740:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
741:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
742:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
743:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
744:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
745:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
746:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
747:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
748:     <span class="ruby-keyword kw">else</span>
749:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
750:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
751:     <span class="ruby-keyword kw">end</span>
752:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002339" class="method-detail">
        <a name="M002339"></a>

        <div class="method-heading">
          <a href="#M002339" class="method-signature">
          <span class="method-name">agent_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002339-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002339-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 771</span>
771:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_delete</span>
772:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
773:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
774:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
775:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
776:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
777:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
778:     <span class="ruby-keyword kw">else</span>
779:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
780:     <span class="ruby-keyword kw">end</span>
781:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
782:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002337" class="method-detail">
        <a name="M002337"></a>

        <div class="method-heading">
          <a href="#M002337" class="method-signature">
          <span class="method-name">agent_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002337-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002337-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 753</span>
753:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_edit</span>
754:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
755:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002334" class="method-detail">
        <a name="M002334"></a>

        <div class="method-heading">
          <a href="#M002334" class="method-signature">
          <span class="method-name">agent_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
代理人##############################################
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002334-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002334-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 723</span>
723:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_list</span>
724: <span class="ruby-comment cmt">#    @isperson={1=&gt;&quot;是&quot;,2=&gt;&quot;否&quot;}</span>
725:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人方&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人方&quot;</span>}
726:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
727:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
728:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
729:     <span class="ruby-keyword kw">end</span>
730:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
731:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
732:       <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
733:     <span class="ruby-keyword kw">end</span>
734:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002335" class="method-detail">
        <a name="M002335"></a>

        <div class="method-heading">
          <a href="#M002335" class="method-signature">
          <span class="method-name">agent_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002335-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002335-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 735</span>
735:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_new</span>
736:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">new</span>()
737:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002338" class="method-detail">
        <a name="M002338"></a>

        <div class="method-heading">
          <a href="#M002338" class="method-signature">
          <span class="method-name">agent_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002338-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002338-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 756</span>
756:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">agent_update</span>
757:     <span class="ruby-ivar">@agent</span>=<span class="ruby-constant">TbAgent</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
758:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
759:     <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
760:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:agent</span>])
761:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">name</span>.<span class="ruby-identifier">strip</span>
762:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
763:       <span class="ruby-ivar">@agent</span>.<span class="ruby-identifier">save</span>
764:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
765:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
766:     <span class="ruby-keyword kw">else</span>
767:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
768:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;agent_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
769:     <span class="ruby-keyword kw">end</span>
770:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002350" class="method-detail">
        <a name="M002350"></a>

        <div class="method-heading">
          <a href="#M002350" class="method-signature">
          <span class="method-name">case_copy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002350-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002350-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 923</span>
923:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">case_copy</span>
924:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
925:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002351" class="method-detail">
        <a name="M002351"></a>

        <div class="method-heading">
          <a href="#M002351" class="method-signature">
          <span class="method-name">case_copy_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002351-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002351-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 927</span>
927:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">case_copy_do</span>
928:     <span class="ruby-identifier">cp</span> = <span class="ruby-constant">CaseCopy</span>.<span class="ruby-identifier">new</span>
929:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
930:     <span class="ruby-identifier">i</span>=<span class="ruby-value">1</span>
931:     <span class="ruby-identifier">num</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:num</span>].<span class="ruby-identifier">to_i</span>
932:     <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">i</span><span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">num</span> <span class="ruby-keyword kw">do</span>
933:       <span class="ruby-identifier">recevice_code</span> = <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0001</span>();
934:       <span class="ruby-identifier">cp</span>.<span class="ruby-identifier">copy</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>])
935:       <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">recevice_code</span>, <span class="ruby-value str">'0001'</span>)
936:       <span class="ruby-identifier">i</span> = <span class="ruby-identifier">i</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>
937:     <span class="ruby-keyword kw">end</span>
938:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>
939:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002310" class="method-detail">
        <a name="M002310"></a>

        <div class="method-heading">
          <a href="#M002310" class="method-signature">
          <span class="method-name">case_doc</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002310-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002310-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 221</span>
221:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">case_doc</span>
222:     <span class="ruby-comment cmt">#发文session</span>
223: <span class="ruby-comment cmt">#    session[:case_code_4]=params[:case_code]</span>
224: <span class="ruby-comment cmt">#    session[:recevice_code]=params[:recevice_code]</span>
225: <span class="ruby-comment cmt">#    session[:general_code_4]=params[:general_code]</span>
226:     <span class="ruby-comment cmt">#链接到发文</span>
227:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:controller=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;case_doc&quot;</span>,<span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
228:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002324" class="method-detail">
        <a name="M002324"></a>

        <div class="method-heading">
          <a href="#M002324" class="method-signature">
          <span class="method-name">clerk_select</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002324-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002324-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 372</span>
372:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select</span>
373:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>])
374:     <span class="ruby-identifier">old_clerk</span>=<span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>
375:     <span class="ruby-identifier">new_clerk</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
376:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:clerk</span>]
377: 
378:     <span class="ruby-identifier">tc</span>=<span class="ruby-constant">TbClerkchange</span>.<span class="ruby-identifier">new</span>()
379:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:c_id</span>]).<span class="ruby-identifier">recevice_code</span>
380:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">changedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
381:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">beforeclerk</span>=<span class="ruby-identifier">old_clerk</span>
382:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">afterclerk</span>=<span class="ruby-identifier">new_clerk</span>
383:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
384:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
385:     <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">falg</span>=<span class="ruby-value">0</span>
386: 
387:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">tc</span>.<span class="ruby-identifier">save</span>
388:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;仲裁助理指定成功&quot;</span>
389:     <span class="ruby-keyword kw">else</span>
390:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;仲裁助理指定失败&quot;</span>
391:     <span class="ruby-keyword kw">end</span>
392: 
393:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
394:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002323" class="method-detail">
        <a name="M002323"></a>

        <div class="method-heading">
          <a href="#M002323" class="method-signature">
          <span class="method-name">clerk_select_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002323-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002323-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 361</span>
361:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clerk_select_list</span>
362:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0001&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
363:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003'  )&quot;</span>)
364:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0003&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
365:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-node">&quot;select code ,name from users where  users.used='Y' and users.states='Y' and  users.code in (select user_code from user_duties where duty_code='0003' and user_code='#{session[:user_code]}')&quot;</span>)
366:     <span class="ruby-keyword kw">else</span>
367:       <span class="ruby-ivar">@clerks</span>=<span class="ruby-constant">User</span>.<span class="ruby-identifier">find_by_sql</span>(<span class="ruby-value str">&quot;select code ,name from users where  1=2&quot;</span>)
368:     <span class="ruby-keyword kw">end</span>
369: 
370:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002319" class="method-detail">
        <a name="M002319"></a>

        <div class="method-heading">
          <a href="#M002319" class="method-signature">
          <span class="method-name">con_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002319-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002319-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 316</span>
316:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_create</span>
317:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
318:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
319:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
320:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
321:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
322:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
323:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
324:     <span class="ruby-keyword kw">else</span>
325:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
326:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_new&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
327:     <span class="ruby-keyword kw">end</span>
328: 
329:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002322" class="method-detail">
        <a name="M002322"></a>

        <div class="method-heading">
          <a href="#M002322" class="method-signature">
          <span class="method-name">con_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002322-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002322-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 348</span>
348:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_delete</span>
349:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
350:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
351:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
352:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
353:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">save</span>
354:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
355:     <span class="ruby-keyword kw">else</span>
356:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
357:     <span class="ruby-keyword kw">end</span>
358:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
359:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002320" class="method-detail">
        <a name="M002320"></a>

        <div class="method-heading">
          <a href="#M002320" class="method-signature">
          <span class="method-name">con_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002320-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002320-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 331</span>
331:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_edit</span>
332:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
333:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002317" class="method-detail">
        <a name="M002317"></a>

        <div class="method-heading">
          <a href="#M002317" class="method-signature">
          <span class="method-name">con_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
代理人
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002317-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002317-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 300</span>
300:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_list</span>
301:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
302:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
303:     <span class="ruby-keyword kw">end</span>
304:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
305:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
306:       <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{params[:recevice_code]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;id&quot;</span>)
307:     <span class="ruby-keyword kw">end</span>
308:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002318" class="method-detail">
        <a name="M002318"></a>

        <div class="method-heading">
          <a href="#M002318" class="method-signature">
          <span class="method-name">con_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002318-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002318-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 310</span>
310:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_new</span>
311:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">new</span>()
312:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">contractdate</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">acceptt</span>
313:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">pactname</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]).<span class="ruby-identifier">casereason</span>
314:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002321" class="method-detail">
        <a name="M002321"></a>

        <div class="method-heading">
          <a href="#M002321" class="method-signature">
          <span class="method-name">con_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002321-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002321-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 335</span>
335:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">con_update</span>
336:     <span class="ruby-ivar">@con</span>=<span class="ruby-constant">TbContractsign</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
337:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
338:     <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
339:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@con</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:con</span>])
340:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
341:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
342:     <span class="ruby-keyword kw">else</span>
343:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
344:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;con_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
345:     <span class="ruby-keyword kw">end</span>
346:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002306" class="method-detail">
        <a name="M002306"></a>

        <div class="method-heading">
          <a href="#M002306" class="method-signature">
          <span class="method-name">create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002306-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002306-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 126</span>
126:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create</span>
127:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
128:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk_2</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
129:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
130:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
131:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code_limit_dat</span>=<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span> <span class="ruby-operator">+</span> <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-value str">&quot;1010&quot;</span>).<span class="ruby-identifier">val</span>.<span class="ruby-identifier">to_i</span>
132:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0001</span>()
133:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
134:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
135:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
136:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
137:       <span class="ruby-keyword kw">end</span>
138:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
139:         <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;&quot;</span>
140:         <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>].<span class="ruby-identifier">blank?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">CaseApplySyn</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">create</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>], <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>])
141:           <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;____申请信息复制成功&quot;</span>
142:         <span class="ruby-keyword kw">else</span>
143:           <span class="ruby-identifier">apply_create</span> = <span class="ruby-value str">&quot;____申请信息复制失败!!!&quot;</span>
144:         <span class="ruby-keyword kw">end</span>
145:         <span class="ruby-comment cmt"># 如果创建成功，系统自动为申请人和被申请人分别创建案件应收费“当事人多交费用”，金额是 0</span>
146:         <span class="ruby-ivar">@should1</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
147:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
148:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
149:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
150:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
151:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0001&quot;</span>
152:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
153:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
154:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
155:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
156:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
157:         <span class="ruby-ivar">@should1</span>.<span class="ruby-identifier">save</span>
158: 
159:         <span class="ruby-ivar">@should2</span> = <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">new</span>
160:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>
161:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">case_code</span>
162:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">general_code</span>
163:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">typ</span>           = <span class="ruby-value str">&quot;0009&quot;</span>
164:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">payment</span>       = <span class="ruby-value str">&quot;0002&quot;</span>
165:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">rmb_money</span>     = <span class="ruby-value">0</span>
166:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">currency</span>      = <span class="ruby-value str">&quot;0001&quot;</span>
167:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">used</span>          = <span class="ruby-value str">'Y'</span>
168:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-value str">&quot;System&quot;</span>
169:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
170:         <span class="ruby-ivar">@should2</span>.<span class="ruby-identifier">save</span>
171: 
172:         <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
173:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;创建成功，咨询流水号:#{@case.recevice_code} #{apply_create}&quot;</span>
174:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
175:       <span class="ruby-keyword kw">else</span>
176:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
177:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
178:       <span class="ruby-keyword kw">end</span>
179:     <span class="ruby-keyword kw">else</span>
180:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
181:     <span class="ruby-keyword kw">end</span>
182:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002330" class="method-detail">
        <a name="M002330"></a>

        <div class="method-heading">
          <a href="#M002330" class="method-signature">
          <span class="method-name">create_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002330-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002330-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 594</span>
594:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_amount</span>
595:     <span class="ruby-ivar">@current_case</span>          = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
596:     <span class="ruby-ivar">@amount</span>               = <span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
597:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
598:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">case_code</span>     = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">case_code</span>
599:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">general_code</span>  = <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">general_code</span>
600:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>     = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
601:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>             = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
602:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>           = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
603:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>      = <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>.<span class="ruby-identifier">to_i</span>
604: 
605:     <span class="ruby-identifier">sum1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
606:     <span class="ruby-identifier">sum2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0001&quot;</span>)  <span class="ruby-operator">+</span> <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">partytype</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
607:     
608:     <span class="ruby-keyword kw">if</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:spec</span>] <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;on&quot;</span>  <span class="ruby-keyword kw">and</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum1</span>) <span class="ruby-keyword kw">or</span> (<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">and</span>  <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">sum2</span>)
609:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败,减少争议金额不能大于原争议金额的总和！&quot;</span>
610:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
611:     <span class="ruby-keyword kw">else</span>
612:       
613:       <span class="ruby-identifier">old_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">1</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的立案费</span>
614:       <span class="ruby-identifier">old_arbitration_fee</span>  = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_fee1</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>], <span class="ruby-value">2</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>], <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>) <span class="ruby-comment cmt"># 原来的仲裁费</span>
615: 
616:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
617:         <span class="ruby-ivar">@money</span>=<span class="ruby-constant">Money</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;used='Y'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;code&quot;</span>)
618:         <span class="ruby-keyword kw">for</span> <span class="ruby-identifier">m</span> <span class="ruby-keyword kw">in</span> <span class="ruby-ivar">@money</span>
619:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]<span class="ruby-operator">!=</span><span class="ruby-value str">'0'</span>
620:             <span class="ruby-ivar">@amount_detail</span>=<span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">new</span>()
621:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">parent_id</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">id</span>
622:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
623:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">case_code</span>
624:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">general_code</span>
625:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">partytype</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partytype</span>]
626:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
627:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>
628:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">typ</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">typ</span>
629:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">amount_typ</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">amount_typ</span>
630:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">dt</span>=<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>
631:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">currency</span>=<span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>
632:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">f_money</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;f_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
633:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rate</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rate_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
634:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">rmb_money</span>=<span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;rmb_money_&quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">m</span>.<span class="ruby-identifier">code</span>]
635:             <span class="ruby-ivar">@amount_detail</span>.<span class="ruby-identifier">save</span>
636:           <span class="ruby-keyword kw">end</span>
637:         <span class="ruby-keyword kw">end</span>
638:         
639:         <span class="ruby-comment cmt">#调用是有方法的函数，在增加争议金额的时候进行应收或应退的增加</span>
640:         <span class="ruby-identifier">should_add</span>(<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>],<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-ivar">@amount</span>,<span class="ruby-identifier">old_registration_fee</span>,<span class="ruby-identifier">old_arbitration_fee</span>,<span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">party_id</span>)
641:         
642:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount</span>   = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
643:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_1</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
644:         <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">amount_2</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
645:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@current_case</span>.<span class="ruby-identifier">save</span>
646:           <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
647:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
648:           <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
649:                       <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
650:                       <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
651:         <span class="ruby-keyword kw">else</span>
652:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
653:           <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
654:                  <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
655:                  <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
656:         <span class="ruby-keyword kw">end</span>
657:       <span class="ruby-keyword kw">else</span>
658:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
659:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;new_amount&quot;</span> ,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
660:                <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
661:                <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
662:       <span class="ruby-keyword kw">end</span>
663:     <span class="ruby-keyword kw">end</span>
664:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002309" class="method-detail">
        <a name="M002309"></a>

        <div class="method-heading">
          <a href="#M002309" class="method-signature">
          <span class="method-name">delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002309-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002309-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 207</span>
207:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete</span>
208:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
209:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
210:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
211:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
212:     <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">del_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0001'</span>)
213:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
214:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
215:     <span class="ruby-keyword kw">else</span>
216:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
217:     <span class="ruby-keyword kw">end</span>
218:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
219:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002333" class="method-detail">
        <a name="M002333"></a>

        <div class="method-heading">
          <a href="#M002333" class="method-signature">
          <span class="method-name">delete_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002333-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002333-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 699</span>
699:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_amount</span>
700:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
701:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
702:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
703:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
704:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">save</span>
705:       <span class="ruby-constant">TbCaseAmountDetail</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;parent_id=#{@amount.id}&quot;</span>)
706:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
707:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
708:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
709:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
710:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
711:       <span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>)
712:       <span class="ruby-constant">TbShouldRefund</span>.<span class="ruby-identifier">update_all</span>(<span class="ruby-value str">&quot;used='N'&quot;</span>,<span class="ruby-node">&quot;case_amount_id='#{@amount.id}'&quot;</span>) 
713:       <span class="ruby-constant">ChargeUp</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">up</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
714:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
715:     <span class="ruby-keyword kw">else</span>
716:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
717:     <span class="ruby-keyword kw">end</span>
718:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
719:                 <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
720:                 <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
721:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002307" class="method-detail">
        <a name="M002307"></a>

        <div class="method-heading">
          <a href="#M002307" class="method-signature">
          <span class="method-name">edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002307-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002307-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 184</span>
184:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit</span>
185:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
186:     <span class="ruby-ivar">@t_typ</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span> <span class="ruby-operator">+</span> <span class="ruby-value str">&quot; &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
187:     <span class="ruby-ivar">@typ1</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
188:     <span class="ruby-ivar">@typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{@case.casetype_num}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
189:     <span class="ruby-ivar">@placed</span>=<span class="ruby-constant">TbShouldCharge</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code='#{params[:recevice_code]}' and (typ='0001' or typ='0004') and re_rmb_money&lt;&gt;0&quot;</span>)
190:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002331" class="method-detail">
        <a name="M002331"></a>

        <div class="method-heading">
          <a href="#M002331" class="method-signature">
          <span class="method-name">edit_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002331-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002331-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 666</span>
666:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_amount</span>
667:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
668:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002328" class="method-detail">
        <a name="M002328"></a>

        <div class="method-heading">
          <a href="#M002328" class="method-signature">
          <span class="method-name">edit_dispute_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
关于争议金额的处理
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002328-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002328-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 479</span>
479:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">edit_dispute_amount</span>
480:     <span class="ruby-ivar">@case</span> = <span class="ruby-keyword kw">nil</span><span class="ruby-comment cmt">#当前办理案件</span>
481:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>] <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span>
482:     <span class="ruby-keyword kw">else</span>
483:       <span class="ruby-ivar">@case</span> = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
484:       <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
485:       <span class="ruby-ivar">@typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;争议金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;追加争议金额&quot;</span>,<span class="ruby-value str">&quot;0003&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;减少争议金额&quot;</span>}
486:       <span class="ruby-ivar">@amount_typ</span>={<span class="ruby-value str">&quot;0001&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;明确金额&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;不明确金额&quot;</span>}
487:       <span class="ruby-comment cmt"># @amount1 申请人争议金额; @amount2 被申请人争议金额</span>
488:       <span class="ruby-ivar">@amount1</span> = <span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used ='Y' and partytype=1&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
489:       <span class="ruby-ivar">@amount2</span> = <span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and used ='Y' and partytype=2&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>)
490: 
491:       <span class="ruby-comment cmt">#申请人明确争议金额</span>
492:       <span class="ruby-ivar">@applicant_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
493:       <span class="ruby-comment cmt">#被申请人明确争议金额</span>
494:       <span class="ruby-ivar">@respondent_definites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0001&quot;</span>)
495:       <span class="ruby-comment cmt">#申请人不明确争议金额</span>
496:       <span class="ruby-ivar">@applicant_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
497:       <span class="ruby-comment cmt">#被申请人不明确争议金额</span>
498:       <span class="ruby-ivar">@respondent_undefinites</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0002&quot;</span>)
499: 
500:       
501:       <span class="ruby-comment cmt"># 申请人争议金额汇总（明确 + 不明确）</span>
502:       <span class="ruby-identifier">applicant_all</span> = <span class="ruby-ivar">@applicant_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_undefinites</span>
503:       <span class="ruby-comment cmt">#被申请人争议金额汇总（明确 + 不明确）</span>
504:       <span class="ruby-identifier">respondent_all</span> = <span class="ruby-ivar">@respondent_definites</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_undefinites</span>
505: 
506:       <span class="ruby-comment cmt">#按照国内、涉外、金融三种类型计算案件收费</span>
507:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case!</span>=<span class="ruby-keyword kw">nil</span>
508:         <span class="ruby-comment cmt">#金融案件 仲裁费/立案费</span>
509:         <span class="ruby-comment cmt"># 0005 国内金融规则3人； 0006 国内金融规则1人； 0007 涉外金融规则3人； 0008 涉外金融规则1人</span>
510:         <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0005&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0006&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0007&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0008&quot;</span>
511:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
512:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">applicant_all</span>)   <span class="ruby-comment cmt">#仲裁费</span>
513:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">applicant_all</span>)  <span class="ruby-comment cmt">#立案费</span>
514:           <span class="ruby-keyword kw">else</span>
515:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
516:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
517:           <span class="ruby-keyword kw">end</span>
518:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
519:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_02</span>(<span class="ruby-identifier">respondent_all</span>)
520:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_03_01</span>(<span class="ruby-identifier">respondent_all</span>)
521:           <span class="ruby-keyword kw">else</span>
522:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
523:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
524:           <span class="ruby-keyword kw">end</span>
525:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
526:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
527:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
528:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
529:           
530:         <span class="ruby-comment cmt"># 涉外案件收 仲裁费/立案费： 0003 涉外普通； 0004 涉外简易；</span>
531:         <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0003&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0004&quot;</span>
532:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
533:             <span class="ruby-ivar">@applicant_arbitration_fee</span>  = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">applicant_all</span>)  <span class="ruby-comment cmt">#仲裁费</span>
534:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">applicant_all</span>)  <span class="ruby-comment cmt">#立案费</span>
535:           <span class="ruby-keyword kw">else</span>
536:             <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
537:             <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
538:           <span class="ruby-keyword kw">end</span>
539:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
540:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_02</span>(<span class="ruby-identifier">respondent_all</span>)
541:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_02_01</span>(<span class="ruby-identifier">respondent_all</span>) 
542:           <span class="ruby-keyword kw">else</span>
543:             <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
544:             <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
545:           <span class="ruby-keyword kw">end</span>
546:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#受理费</span>
547:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>             <span class="ruby-comment cmt">#处理费</span>
548:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
549:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
550: 
551:       <span class="ruby-comment cmt">#国内案件：收取受理费/处理费</span>
552:       <span class="ruby-keyword kw">elsif</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0001&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">aribitprog_num</span> <span class="ruby-operator">==</span> <span class="ruby-value str">&quot;0002&quot;</span>
553:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">respondent_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
554:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">respondent_all</span>)  <span class="ruby-comment cmt">#受理费</span>
555:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">respondent_all</span>)  <span class="ruby-comment cmt">#处理费</span>
556:         <span class="ruby-keyword kw">else</span>
557:           <span class="ruby-ivar">@respondent_litigation_fee</span> = <span class="ruby-value">0</span>
558:           <span class="ruby-ivar">@respondent_processing_fee</span> = <span class="ruby-value">0</span>
559:         <span class="ruby-keyword kw">end</span>
560:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">applicant_all</span> <span class="ruby-operator">!=</span> <span class="ruby-value">0</span>
561:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_01</span>(<span class="ruby-identifier">applicant_all</span>)
562:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_01_02</span>(<span class="ruby-identifier">applicant_all</span>)
563:         <span class="ruby-keyword kw">else</span>
564:           <span class="ruby-ivar">@applicant_litigation_fee</span> = <span class="ruby-value">0</span>
565:           <span class="ruby-ivar">@applicant_processing_fee</span> = <span class="ruby-value">0</span>
566:         <span class="ruby-keyword kw">end</span>
567:         <span class="ruby-ivar">@applicant_arbitration_fee</span> = <span class="ruby-value">0</span>
568:         <span class="ruby-ivar">@applicant_registration_fee</span> = <span class="ruby-value">0</span>
569:         <span class="ruby-ivar">@respondent_arbitration_fee</span> = <span class="ruby-value">0</span>
570:         <span class="ruby-ivar">@respondent_registration_fee</span> = <span class="ruby-value">0</span>
571:       <span class="ruby-keyword kw">end</span>
572:       <span class="ruby-ivar">@applicant_sum</span> = <span class="ruby-ivar">@applicant_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@applicant_processing_fee</span>
573:       <span class="ruby-ivar">@respondent_sum</span> = <span class="ruby-ivar">@respondent_arbitration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_registration_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_litigation_fee</span><span class="ruby-operator">+</span><span class="ruby-ivar">@respondent_processing_fee</span>
574:       <span class="ruby-keyword kw">end</span>
575:     <span class="ruby-keyword kw">end</span>
576:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002325" class="method-detail">
        <a name="M002325"></a>

        <div class="method-heading">
          <a href="#M002325" class="method-signature">
          <span class="method-name">establishment</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002325-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002325-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 396</span>
396:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment</span>
397:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
398:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
399:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0004'</span>)
400:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
401:       <span class="ruby-identifier">c</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
402:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
403:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
404:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
405:         <span class="ruby-keyword kw">end</span>
406:         <span class="ruby-identifier">add_2</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0002</span>()
407:         <span class="ruby-comment cmt">#### 华南仲裁委个性化</span>
408:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0001'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0002'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0005'</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">aribitprog_num</span><span class="ruby-operator">==</span><span class="ruby-value str">'0006'</span>
409:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN D&quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
410:         <span class="ruby-keyword kw">else</span>
411:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">case_code</span>=<span class="ruby-value str">&quot;SHEN &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">t_casetype_num</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">add_2</span>
412:         <span class="ruby-keyword kw">end</span>
413:         <span class="ruby-comment cmt">####</span>
414:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">general_code</span>=<span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">add_0003</span>()
415:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
416:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
417: 
418:         <span class="ruby-comment cmt">#c.limit_dat=Workday.after_day(SysArg.find_by_code('1000').val.to_i)</span>
419:         <span class="ruby-comment cmt">#c.finally_limit_dat=c.limit_dat</span>
420: 
421:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
422:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
423:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已立案&quot;</span>
424:         <span class="ruby-keyword kw">else</span>
425:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件立案立案失败，如有问题请与软件供应商联系&quot;</span>
426:         <span class="ruby-keyword kw">end</span>
427:       <span class="ruby-keyword kw">end</span>
428:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
429:     <span class="ruby-keyword kw">else</span>
430:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
431:     <span class="ruby-keyword kw">end</span>
432:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002326" class="method-detail">
        <a name="M002326"></a>

        <div class="method-heading">
          <a href="#M002326" class="method-signature">
          <span class="method-name">establishment_no</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002326-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002326-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 434</span>
434:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">establishment_no</span>
435:     <span class="ruby-identifier">c</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
436:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
437:     <span class="ruby-identifier">c</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
438:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">check</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
439:       <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0003'</span>)
440:       <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">clerk</span><span class="ruby-operator">==</span><span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
441:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
442:           <span class="ruby-identifier">c</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
443:         <span class="ruby-keyword kw">end</span>
444:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
445:         <span class="ruby-identifier">c</span>.<span class="ruby-identifier">nowdate_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
446:         <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">c</span>.<span class="ruby-identifier">save</span>
447:           <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-identifier">c</span>.<span class="ruby-identifier">recevice_code</span>)
448:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件已设置为不受理&quot;</span>
449:         <span class="ruby-keyword kw">else</span>
450:           <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件不受理，操作失败，如有问题请与软件供应商联系&quot;</span>
451:         <span class="ruby-keyword kw">end</span>
452:       <span class="ruby-keyword kw">end</span>
453:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
454: 
455:     <span class="ruby-keyword kw">else</span>
456:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;该操作违反了流程约束，请严格按办案流程填写案件信息！&quot;</span>
457:     <span class="ruby-keyword kw">end</span>
458:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002342" class="method-detail">
        <a name="M002342"></a>

        <div class="method-heading">
          <a href="#M002342" class="method-signature">
          <span class="method-name">file_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002342-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002342-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 796</span>
796:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_create</span>
797:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:file</span>])
798:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">recevice_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
799:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">typ</span> = <span class="ruby-value str">&quot;0005&quot;</span>
800:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
801:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
802:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
803:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建成功&quot;</span>
804:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
805:     <span class="ruby-keyword kw">else</span>
806:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;创建失败&quot;</span>
807:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;file_new&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
808:     <span class="ruby-keyword kw">end</span>
809:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002345" class="method-detail">
        <a name="M002345"></a>

        <div class="method-heading">
          <a href="#M002345" class="method-signature">
          <span class="method-name">file_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002345-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002345-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 828</span>
828:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_delete</span>
829:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
830:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">used</span> = <span class="ruby-value str">&quot;N&quot;</span>
831:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
832:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
833:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
834:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_name</span>.<span class="ruby-identifier">blank?</span>
835:         <span class="ruby-ivar">@yea</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
836:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{file.recevice_code}/#{file.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
837:         <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{file.recevice_code}/#{file.book_name}&quot;</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
838:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_u</span>    = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
839:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_dat</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
840:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-value str">&quot;&quot;</span>
841:           <span class="ruby-identifier">file</span>.<span class="ruby-identifier">save</span>
842:         <span class="ruby-keyword kw">end</span>
843:       <span class="ruby-keyword kw">end</span>
844: 
845:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
846:     <span class="ruby-keyword kw">else</span>
847:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
848:     <span class="ruby-keyword kw">end</span>
849:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
850:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002349" class="method-detail">
        <a name="M002349"></a>

        <div class="method-heading">
          <a href="#M002349" class="method-signature">
          <span class="method-name">file_destroy</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002349-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002349-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 907</span>
907:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_destroy</span>
908:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
909:     <span class="ruby-ivar">@yea</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>].<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
910:     <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>,<span class="ruby-value str">&quot;w+&quot;</span>){}
911:     <span class="ruby-keyword kw">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>)<span class="ruby-operator">==</span><span class="ruby-value">1</span>
912:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_u</span>    = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
913:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_dat</span>  = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
914:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-value str">&quot;&quot;</span>
915:       <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">save</span>
916:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除成功&quot;</span>
917:     <span class="ruby-keyword kw">else</span>
918:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件删除失败&quot;</span>
919:     <span class="ruby-keyword kw">end</span>
920:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
921:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002348" class="method-detail">
        <a name="M002348"></a>

        <div class="method-heading">
          <a href="#M002348" class="method-signature">
          <span class="method-name">file_down</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002348-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002348-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 901</span>
901:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_down</span>
902:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
903:     <span class="ruby-ivar">@yea</span> = <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
904:     <span class="ruby-identifier">send_file</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>)
905:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002343" class="method-detail">
        <a name="M002343"></a>

        <div class="method-heading">
          <a href="#M002343" class="method-signature">
          <span class="method-name">file_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002343-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002343-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 811</span>
811:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_edit</span>
812:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
813:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002340" class="method-detail">
        <a name="M002340"></a>

        <div class="method-heading">
          <a href="#M002340" class="method-signature">
          <span class="method-name">file_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
合同文件上传下载
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002340-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002340-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 787</span>
787:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_list</span>
788:     <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;recevice_code='#{params[:recevice_code]}' and typ='0005' and used='Y'&quot;</span>
789:     <span class="ruby-ivar">@contract</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'id'</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>)
790:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002341" class="method-detail">
        <a name="M002341"></a>

        <div class="method-heading">
          <a href="#M002341" class="method-signature">
          <span class="method-name">file_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002341-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002341-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 792</span>
792:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_new</span>
793:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">new</span>()
794:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002344" class="method-detail">
        <a name="M002344"></a>

        <div class="method-heading">
          <a href="#M002344" class="method-signature">
          <span class="method-name">file_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002344-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002344-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 815</span>
815:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_update</span>
816:     <span class="ruby-identifier">file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
817:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u</span> = <span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
818:     <span class="ruby-identifier">file</span>.<span class="ruby-identifier">u_t</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
819:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:file</span>])
820:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改成功&quot;</span>
821:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
822:     <span class="ruby-keyword kw">else</span>
823:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;修改失败&quot;</span>
824:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;fiel_edit&quot;</span>, <span class="ruby-identifier">:id</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>]
825:     <span class="ruby-keyword kw">end</span>
826:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002346" class="method-detail">
        <a name="M002346"></a>

        <div class="method-heading">
          <a href="#M002346" class="method-signature">
          <span class="method-name">file_upload</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002346-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002346-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 852</span>
852:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_upload</span>
853:     <span class="ruby-ivar">@file</span> = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
854:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002347" class="method-detail">
        <a name="M002347"></a>

        <div class="method-heading">
          <a href="#M002347" class="method-signature">
          <span class="method-name">file_upload_do</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002347-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002347-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 856</span>
856:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">file_upload_do</span>
857:     <span class="ruby-ivar">@file</span>    = <span class="ruby-constant">CaseBook</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
858:     <span class="ruby-ivar">@case</span>   = <span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-ivar">@file</span>.<span class="ruby-identifier">recevice_code</span>)
859:     <span class="ruby-comment cmt">#########################################</span>
860:     <span class="ruby-ivar">@yea</span>          = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>.<span class="ruby-identifier">slice</span>(<span class="ruby-value">0</span>,<span class="ruby-value">4</span>)
861:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_u</span>   = <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">clerk</span>
862:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_dat</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
863:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>].<span class="ruby-identifier">blank?</span>
864:       <span class="ruby-identifier">f_name</span>         = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>].<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">split</span>(<span class="ruby-value str">&quot;.&quot;</span>).<span class="ruby-identifier">last</span>
865:     <span class="ruby-keyword kw">end</span>
866:     <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">book_name</span> = <span class="ruby-node">&quot;#{@file.typ}_#{@file.recevice_code}_contractfile_#{@file.id}.#{f_name}&quot;</span>
867: 
868:     <span class="ruby-identifier">utf8_to_gbk</span>  = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'gbk'</span>,<span class="ruby-value str">'utf-8'</span>)
869:     <span class="ruby-identifier">gbk_to_utf8</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)
870:     
871:     <span class="ruby-identifier">file</span> = <span class="ruby-identifier">params</span>[<span class="ruby-value str">&quot;file&quot;</span>]   <span class="ruby-comment cmt">#获取文档，此处为tempfile类型的</span>
872:     <span class="ruby-comment cmt">#设置文档保存的路径，自由设置</span>
873:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs&quot;</span>)
874:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/&quot;</span>)
875:     <span class="ruby-keyword kw">end</span>
876:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
877:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}&quot;</span>)
878:     <span class="ruby-keyword kw">end</span>
879:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}&quot;</span>)
880:       <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}&quot;</span>)
881:     <span class="ruby-keyword kw">end</span>
882:     <span class="ruby-comment cmt">#读取文档的内容，目前不用编码转换即可正常显示，在存入数据库中时或许涉及到编码转换</span>
883:     <span class="ruby-keyword kw">begin</span>
884:       <span class="ruby-identifier">content</span> = <span class="ruby-identifier">file</span>.<span class="ruby-identifier">read</span>  <span class="ruby-comment cmt">#gbk_to_utf8.iconv</span>
885:       <span class="ruby-comment cmt">#新建同名文件，读取修改的文件内容用以覆盖源文件，注意路径要与读取的一致</span>
886:       <span class="ruby-identifier">f</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;#{SysArg.find_by_code(&quot;8010&quot;).val}/casedocs/#{@yea}/#{@file.recevice_code}/#{@file.book_name}&quot;</span>, <span class="ruby-value str">&quot;wb&quot;</span>)
887:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">write</span>(<span class="ruby-identifier">content</span>)
888:       <span class="ruby-identifier">f</span>.<span class="ruby-identifier">close</span>
889:       <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">original_filename</span>.<span class="ruby-identifier">empty?</span>
890:         <span class="ruby-ivar">@file</span>.<span class="ruby-identifier">save</span>
891:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传成功&quot;</span>
892:       <span class="ruby-keyword kw">else</span>
893:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败&quot;</span>
894:       <span class="ruby-keyword kw">end</span>
895:     <span class="ruby-keyword kw">rescue</span>
896:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>] = <span class="ruby-value str">&quot;文件上传失败！&quot;</span>
897:     <span class="ruby-keyword kw">end</span>
898:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;file_list&quot;</span>, <span class="ruby-identifier">:recevice_code</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
899:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002304" class="method-detail">
        <a name="M002304"></a>

        <div class="method-heading">
          <a href="#M002304" class="method-signature">
          <span class="method-name">list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002304-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002304-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 79</span>
 79:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">list</span>
 80:     <span class="ruby-ivar">@hant_search_1_page_name</span>=<span class="ruby-value str">&quot;list&quot;</span>
 81:     <span class="ruby-ivar">@hant_search_1</span>=[[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">' recevice_code) in (select recevice_code  from  tb_parties where partyname'</span>,<span class="ruby-value str">'当事人名称(不能联合查询)'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'char'</span>,<span class="ruby-value str">'recevice_code'</span>,<span class="ruby-value str">'咨询流水号'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'date'</span>,<span class="ruby-value str">'receivedate'</span>,<span class="ruby-value str">'咨询日期'</span>,<span class="ruby-value str">'text'</span>,[]],[<span class="ruby-value str">'number'</span>,<span class="ruby-value str">'amount'</span>,<span class="ruby-value str">'争议金额'</span>,<span class="ruby-value str">'text'</span>,[]]]
 82:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
 83:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
 84:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;recevice_code desc&quot;</span>
 85:     <span class="ruby-keyword kw">end</span>
 86:     <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
 87:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@page_lines</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
 88:       <span class="ruby-ivar">@page_lines</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:lines</span>]
 89:     <span class="ruby-keyword kw">end</span>
 90:     <span class="ruby-identifier">hant_search_1_word</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:hant_search_1_word</span>]
 91:     <span class="ruby-ivar">@search_condit</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>]
 92:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span>
 93:       <span class="ruby-ivar">@search_condit</span>=<span class="ruby-value str">&quot;&quot;</span>
 94:     <span class="ruby-keyword kw">end</span>
 95:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-identifier">hant_search_1_word</span> <span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
 96:     <span class="ruby-keyword kw">else</span>
 97:       <span class="ruby-ivar">@search_condit</span>= <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hant_search_1_word</span>
 98:     <span class="ruby-keyword kw">end</span>
 99:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0001&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
100:       <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;used='Y' and state=1 and recevice_code_limit_dat&gt;='#{Date.today}'&quot;</span>
101:     <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">session</span>[<span class="ruby-value str">&quot;0003&quot;</span>]<span class="ruby-operator">==</span><span class="ruby-value str">&quot;Y&quot;</span>
102:       <span class="ruby-identifier">c</span>=<span class="ruby-node">&quot;used='Y' and state=1 and (clerk='#{session[:user_code]}' or clerk='' or clerk is null) and recevice_code_limit_dat&gt;='#{Date.today}'&quot;</span>
103:     <span class="ruby-keyword kw">else</span>
104:       <span class="ruby-identifier">c</span>=<span class="ruby-value str">&quot;1=2&quot;</span>
105:     <span class="ruby-keyword kw">end</span>
106:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
107:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@search_condit!</span>= <span class="ruby-value str">&quot; and &quot;</span> <span class="ruby-keyword kw">and</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-ivar">@search_condit</span>)<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
108:       <span class="ruby-identifier">c</span> = <span class="ruby-identifier">c</span> <span class="ruby-operator">+</span> <span class="ruby-ivar">@search_condit</span>
109:     <span class="ruby-keyword kw">end</span>
110:     <span class="ruby-ivar">@case_pages</span>,<span class="ruby-ivar">@case</span>=<span class="ruby-identifier">paginate</span>(<span class="ruby-identifier">:tb_cases</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">c</span>,<span class="ruby-identifier">:per_page=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@page_lines</span>.<span class="ruby-identifier">to_i</span>)
111:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002305" class="method-detail">
        <a name="M002305"></a>

        <div class="method-heading">
          <a href="#M002305" class="method-signature">
          <span class="method-name">new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002305-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002305-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 113</span>
113:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new</span>
114:     <span class="ruby-ivar">@t_typ</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0043' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span><span class="ruby-operator">+</span><span class="ruby-value str">&quot; &quot;</span><span class="ruby-operator">+</span><span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
115:     <span class="ruby-ivar">@typ1</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
116:     <span class="ruby-identifier">oopp</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:first</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='0002' and state='Y' and data_parent=''&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val&quot;</span>)
117:     <span class="ruby-ivar">@typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{oopp.data_val}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_text</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">data_val</span>]}
118: 
119:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">new</span>()
120:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">receivedate</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>()
121:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">apply_code</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_code</span>]
122:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">casereason</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_casereason</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_casereason</span>]
123:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">special</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_remark</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:apply_remark</span>]
124:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002329" class="method-detail">
        <a name="M002329"></a>

        <div class="method-heading">
          <a href="#M002329" class="method-signature">
          <span class="method-name">new_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002329-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002329-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 578</span>
578:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">new_amount</span>
579:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">new</span>()
580:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">dt</span>=<span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>
581:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">currency</span>=<span class="ruby-value str">'0001'</span>
582:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">f_money</span>=<span class="ruby-value">0</span>
583:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rate</span>=<span class="ruby-value">1</span>
584:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">rmb_money</span>=<span class="ruby-value">0</span>
585:     <span class="ruby-ivar">@respondent</span> = <span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(
586:       <span class="ruby-identifier">:all</span>,
587:       <span class="ruby-identifier">:conditions</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-node">&quot;used='Y' and partytype=2 and recevice_code='#{params[:recevice_code]}'&quot;</span>,
588:       <span class="ruby-identifier">:order</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id&quot;</span>,
589:       <span class="ruby-identifier">:select</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;id,partyname&quot;</span>
590:     ).<span class="ruby-identifier">collect</span>{<span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span>[<span class="ruby-identifier">p</span>.<span class="ruby-identifier">partyname</span>,<span class="ruby-identifier">p</span>.<span class="ruby-identifier">id</span>]}.<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,[<span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-value str">&quot;&quot;</span>])
591:     <span class="ruby-comment cmt"># 当 @respondent.size 的值大于二的时候，说明有多个被申请人，此时才可以为多个被申请人录入各自的反请求争议金额</span>
592:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002300" class="method-detail">
        <a name="M002300"></a>

        <div class="method-heading">
          <a href="#M002300" class="method-signature">
          <span class="method-name">p_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面 Ajax 调用该方法查询当事人信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002300-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002300-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 27</span>
27:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_list</span>
28:     <span class="ruby-identifier">partyname</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:partyname</span>]
29:     <span class="ruby-identifier">cov</span> = <span class="ruby-constant">Iconv</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value str">'utf-8'</span>,<span class="ruby-value str">'gbk'</span>)  <span class="ruby-comment cmt"># Iconv 编码转换</span>
30:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">!=</span> <span class="ruby-value str">''</span> <span class="ruby-keyword kw">and</span> <span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>().<span class="ruby-identifier">sql_check_3</span>(<span class="ruby-identifier">partyname</span>) <span class="ruby-operator">!=</span> <span class="ruby-keyword kw">false</span>
31:       <span class="ruby-identifier">p_case</span> = <span class="ruby-constant">VParty</span>.<span class="ruby-identifier">find_by_sql</span>(
32:         <span class="ruby-node">&quot; select distinct partyname,recevice_code,case_code,nowdate,end_code,caseendbook_id_last,clerk,mobiletel,area,tel
33:           from  v_parties
34:           where partyname like \&quot;%#{cov.iconv(partyname)}%\&quot; order by tel desc&quot;</span>
35:       )
36:     <span class="ruby-keyword kw">else</span>
37:       <span class="ruby-identifier">p_case</span> = <span class="ruby-keyword kw">nil</span>
38:     <span class="ruby-keyword kw">end</span>
39:     
40:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
41:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'p_list'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'p_l'</span>, <span class="ruby-identifier">:object</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">p_case</span>
42:     <span class="ruby-keyword kw">end</span>
43:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002297" class="method-detail">
        <a name="M002297"></a>

        <div class="method-heading">
          <a href="#M002297" class="method-signature">
          <span class="method-name">p_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002297-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002297-source">
<pre>
   <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 2</span>
2:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set</span>
3:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='0002' and state='Y' and data_parent='#{params[:p_typ]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>)
4:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
5:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_casetype_num2'</span>
6:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
7:     <span class="ruby-keyword kw">end</span>
8:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002298" class="method-detail">
        <a name="M002298"></a>

        <div class="method-heading">
          <a href="#M002298" class="method-signature">
          <span class="method-name">p_set_2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002298-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002298-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 10</span>
10:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">p_set_2</span>
11:     <span class="ruby-identifier">typ2</span>=<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find_by_sql</span>([<span class="ruby-value str">&quot;select data_val,data_text from tb_dictionaries where used='Y' and state='Y' and typ_code = '0001' and data_val in (select app_code from charge_fun_detail where role_code=?  and used='Y')  order by ind,data_val&quot;</span>, <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:p_typ</span>]])
12:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
13:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'case_aribitprog_num'</span>
14:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'pv_set_2'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'pv_2'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">typ2</span>
15:     <span class="ruby-keyword kw">end</span>
16:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002313" class="method-detail">
        <a name="M002313"></a>

        <div class="method-heading">
          <a href="#M002313" class="method-signature">
          <span class="method-name">party_create</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002313-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002313-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 247</span>
247:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_create</span>
248:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
249:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
250:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
251:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
252:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
253:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
254:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
255:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
256:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建成功&quot;</span>
257:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
258:     <span class="ruby-keyword kw">else</span>
259:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;创建失败&quot;</span>
260:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_new&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
261:     <span class="ruby-keyword kw">end</span>
262:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002316" class="method-detail">
        <a name="M002316"></a>

        <div class="method-heading">
          <a href="#M002316" class="method-signature">
          <span class="method-name">party_delete</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002316-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002316-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 285</span>
285:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_delete</span>
286:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
287:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">used</span>=<span class="ruby-value str">&quot;N&quot;</span>
288:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
289:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
290:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
291: 
292:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除成功&quot;</span>
293:     <span class="ruby-keyword kw">else</span>
294:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;删除失败&quot;</span>
295:     <span class="ruby-keyword kw">end</span>
296:     <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
297:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002314" class="method-detail">
        <a name="M002314"></a>

        <div class="method-heading">
          <a href="#M002314" class="method-signature">
          <span class="method-name">party_edit</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002314-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002314-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 264</span>
264:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_edit</span>
265:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
266:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002311" class="method-detail">
        <a name="M002311"></a>

        <div class="method-heading">
          <a href="#M002311" class="method-signature">
          <span class="method-name">party_list</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002311-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002311-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 230</span>
230:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_list</span>
231:     <span class="ruby-ivar">@partytype</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;申请人&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;被申请人&quot;</span>}
232:     <span class="ruby-ivar">@isperson</span>={<span class="ruby-value">1</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;是&quot;</span>,<span class="ruby-value">2</span>=<span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;否&quot;</span>}
233:     <span class="ruby-ivar">@order</span>=<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>]
234:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@order</span><span class="ruby-operator">==</span><span class="ruby-value str">&quot;&quot;</span>
235:       <span class="ruby-ivar">@order</span>=<span class="ruby-value str">&quot;id asc&quot;</span>
236:     <span class="ruby-keyword kw">end</span>
237:     <span class="ruby-identifier">p</span>=<span class="ruby-constant">PubTool</span>.<span class="ruby-identifier">new</span>()
238:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">sql_check</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])<span class="ruby-operator">!=</span><span class="ruby-keyword kw">false</span>
239:       <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;used='Y' and recevice_code=#{params[:recevice_code]}&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-ivar">@order</span>)
240:     <span class="ruby-keyword kw">end</span>
241:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002312" class="method-detail">
        <a name="M002312"></a>

        <div class="method-heading">
          <a href="#M002312" class="method-signature">
          <span class="method-name">party_new</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002312-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002312-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 243</span>
243:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_new</span>
244:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">new</span>()
245:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002299" class="method-detail">
        <a name="M002299"></a>

        <div class="method-heading">
          <a href="#M002299" class="method-signature">
          <span class="method-name">party_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002299-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002299-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 18</span>
18:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_set</span>
19:     <span class="ruby-identifier">party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;partytype=#{params[:partytype]} and used='Y' and recevice_code='#{params[:recevice_code]}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'partyname'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;partyname,id&quot;</span>)
20:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
21:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'agent_party_id'</span>
22:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'party_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'par'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">party</span>
23:     <span class="ruby-keyword kw">end</span>
24:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002315" class="method-detail">
        <a name="M002315"></a>

        <div class="method-heading">
          <a href="#M002315" class="method-signature">
          <span class="method-name">party_update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002315-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002315-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 268</span>
268:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">party_update</span>
269:     <span class="ruby-ivar">@party</span>=<span class="ruby-constant">TbParty</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
270:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
271:     <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
272:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:party</span>])
273:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">partyname</span>.<span class="ruby-identifier">strip</span>
274:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>=<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">addr</span>.<span class="ruby-identifier">strip</span>
275:       <span class="ruby-ivar">@party</span>.<span class="ruby-identifier">save</span>
276:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@party</span>.<span class="ruby-identifier">recevice_code</span>)
277:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
278:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_list&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
279:     <span class="ruby-keyword kw">else</span>
280:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
281:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;party_edit&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>]
282:     <span class="ruby-keyword kw">end</span>
283:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002301" class="method-detail">
        <a name="M002301"></a>

        <div class="method-heading">
          <a href="#M002301" class="method-signature">
          <span class="method-name">rate_set</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002301-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002301-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 45</span>
45:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rate_set</span>
46:     <span class="ruby-identifier">render</span> <span class="ruby-identifier">:update</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">page</span><span class="ruby-operator">|</span>
47:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">remove</span> <span class="ruby-value str">'amount_rate'</span>
48:       <span class="ruby-identifier">page</span>.<span class="ruby-identifier">replace_html</span> <span class="ruby-value str">'rate_set'</span>, <span class="ruby-identifier">:partial</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">'rate'</span>,<span class="ruby-identifier">:object=</span><span class="ruby-operator">&gt;</span><span class="ruby-constant">Money</span>.<span class="ruby-identifier">find_by_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:money_code</span>]).<span class="ruby-identifier">rate</span>
49:     <span class="ruby-keyword kw">end</span>
50:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002303" class="method-detail">
        <a name="M002303"></a>

        <div class="method-heading">
          <a href="#M002303" class="method-signature">
          <span class="method-name">select_with_ajax</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
页面Ajax调用该方法获得行业小分类信息
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002303-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002303-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 69</span>
69:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">select_with_ajax</span>
70:     <span class="ruby-identifier">profession_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:profession_id</span>]
71:     <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">profession_id</span>.<span class="ruby-identifier">blank?</span>
72:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='000dd'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
73:     <span class="ruby-keyword kw">else</span>
74:       <span class="ruby-ivar">@subprofession</span> = <span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>,<span class="ruby-identifier">:conditions=</span><span class="ruby-operator">&gt;</span><span class="ruby-node">&quot;typ_code='9019' and state='Y' and used='Y' and data_parent='#{profession_id}'&quot;</span>,<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">'data_val'</span>,<span class="ruby-identifier">:select=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;data_val,data_text&quot;</span>).<span class="ruby-identifier">insert</span>(<span class="ruby-value">0</span>,<span class="ruby-constant">TbDictionary</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:data_text=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>,<span class="ruby-identifier">:data_val=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;&quot;</span>))
75:     <span class="ruby-keyword kw">end</span>
76:     <span class="ruby-identifier">render</span>
77:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002327" class="method-detail">
        <a name="M002327"></a>

        <div class="method-heading">
          <a href="#M002327" class="method-signature">
          <span class="method-name">set_case2</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
设置为历史案件
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002327-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002327-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 460</span>
460:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">set_case2</span>
461:      <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
462:      <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
463:      <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
464:      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span><span class="ruby-operator">==</span><span class="ruby-value">1</span>
465:        <span class="ruby-identifier">f</span>=<span class="ruby-constant">TbCaseFlow</span>.<span class="ruby-identifier">add_flow</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>,<span class="ruby-value str">'0002'</span>)
466:        <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">f!</span>=<span class="ruby-value">0</span>
467:         <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">state</span>=<span class="ruby-identifier">f</span>
468:        <span class="ruby-keyword kw">end</span>
469:      <span class="ruby-keyword kw">end</span>
470:      <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
471:         <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
472:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件成功设为历史案件&quot;</span>
473:      <span class="ruby-keyword kw">else</span>
474:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-node">&quot;#{params[:recevice_code]}案件设置历史案件失败&quot;</span>
475:      <span class="ruby-keyword kw">end</span>
476:      <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>]
477:    <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002308" class="method-detail">
        <a name="M002308"></a>

        <div class="method-heading">
          <a href="#M002308" class="method-signature">
          <span class="method-name">update</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002308-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002308-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 192</span>
192:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update</span>
193:     <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
194: <span class="ruby-comment cmt">#    @case.clerk_2=session[:user_code]</span>
195:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
196:     <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
197:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:case</span>])
198:       <span class="ruby-constant">SysArg</span>.<span class="ruby-identifier">get_pn_by_recevice_code</span>(<span class="ruby-ivar">@case</span>.<span class="ruby-identifier">recevice_code</span>)
199:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
200:       <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;list&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
201:     <span class="ruby-keyword kw">else</span>
202:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
203:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit&quot;</span>,<span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],<span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
204:     <span class="ruby-keyword kw">end</span>
205:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M002332" class="method-detail">
        <a name="M002332"></a>

        <div class="method-heading">
          <a href="#M002332" class="method-signature">
          <span class="method-name">update_amount</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M002332-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M002332-source">
<pre>
     <span class="ruby-comment cmt"># File app/controllers/case_consultation_controller.rb, line 670</span>
670:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">update_amount</span>
671:     <span class="ruby-ivar">@amount</span>=<span class="ruby-constant">TbCaseAmount</span>.<span class="ruby-identifier">find</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>])
672:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u</span>=<span class="ruby-identifier">session</span>[<span class="ruby-identifier">:user_code</span>]
673:     <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">u_t</span>=<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>()
674:     <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@amount</span>.<span class="ruby-identifier">update_attributes</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:amount</span>])
675:       <span class="ruby-ivar">@case</span>=<span class="ruby-constant">TbCase</span>.<span class="ruby-identifier">find_by_recevice_code</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>])
676:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;0&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
677:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_1</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;1&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
678:       <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">amount_2</span>=<span class="ruby-constant">Cost</span>.<span class="ruby-identifier">new</span>.<span class="ruby-identifier">get_sum</span>(<span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],<span class="ruby-value str">&quot;2&quot;</span>,<span class="ruby-value str">&quot;0000&quot;</span>)
679:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@case</span>.<span class="ruby-identifier">save</span>
680:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改成功&quot;</span>
681:         <span class="ruby-identifier">redirect_to</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;edit_dispute_amount&quot;</span>,<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
682:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
683:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
684:       <span class="ruby-keyword kw">else</span>
685:         <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
686:         <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
687:           <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
688:           <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
689:       <span class="ruby-keyword kw">end</span>
690:     <span class="ruby-keyword kw">else</span>
691:       <span class="ruby-identifier">flash</span>[<span class="ruby-identifier">:notice</span>]=<span class="ruby-value str">&quot;修改失败&quot;</span>
692:       <span class="ruby-identifier">render</span> <span class="ruby-identifier">:action=</span><span class="ruby-operator">&gt;</span><span class="ruby-value str">&quot;_amount&quot;</span>,<span class="ruby-identifier">:id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:id</span>],<span class="ruby-identifier">:recevice_code=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:recevice_code</span>],
693:         <span class="ruby-identifier">:search_condit=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:search_condit</span>],<span class="ruby-identifier">:order=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:order</span>],
694:         <span class="ruby-identifier">:page=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page</span>],<span class="ruby-identifier">:page_lines=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">params</span>[<span class="ruby-identifier">:page_lines</span>]
695:     <span class="ruby-keyword kw">end</span>
696: 
697:   <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>